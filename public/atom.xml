<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é™ˆå¹´é£æ¥¼ | åšå®¢</title>
  
  <subtitle>å½“ä½ çœ‹åˆ°äº†ä¸€åº§å±±ï¼Œä¸€å®šä¼šæƒ³å†çœ‹çœ‹å±±çš„åé¢æ˜¯ä»€ä¹ˆï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zhangjiaheng.cn/"/>
  <updated>2021-03-09T13:25:19.763Z</updated>
  <id>http://zhangjiaheng.cn/</id>
  
  <author>
    <name>é™ˆå¹´é£æ¥¼</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç”± SpringBoot å‡çº§åˆ° 2.4.2 å¼•å‘çš„ Jackson çš„ JsonFormat é—®é¢˜æ’æŸ¥</title>
    <link href="http://zhangjiaheng.cn/blog/20210120/spring-boot-to-2-4-2/"/>
    <id>http://zhangjiaheng.cn/blog/20210120/spring-boot-to-2-4-2/</id>
    <published>2021-01-20T11:37:43.000Z</published>
    <updated>2021-03-09T13:25:19.763Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/3hmYwN.jpg" alt="3hmYwN"></p><a id="more"></a><h2 id="äº‹æƒ…æ˜¯è¿™æ ·çš„"><a href="#äº‹æƒ…æ˜¯è¿™æ ·çš„" class="headerlink" title="äº‹æƒ…æ˜¯è¿™æ ·çš„"></a>äº‹æƒ…æ˜¯è¿™æ ·çš„</h2><p>åœ¨ä¸ä¹…çš„ä»¥å‰ï¼Œæˆ‘ä»¬é¡¹ç›®çš„ Tech Lead å†³å®šåœ¨git repoä¸­å¼•å…¥ DependaBot æ¥å¯¹é¡¹ç›®ä¸­çš„ä¾èµ–åšæ£€æŸ¥å¹¶å‡çº§ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªä½¿ç”¨ SpringBoot çš„æœåŠ¡ä¹Ÿå°±è¿™æ ·æˆäº†å¾…å‡çº§ä¾èµ–çš„ä¸€ä»½å­ã€‚æˆ‘ä»¬å¾…å‡çº§çš„ä¾èµ–åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>Bump newrelic-agent from 5.8.0 to 6.3.0 â€¦</li><li>Bump guava from 28.0-jre to 30.1-jre â€¦</li><li>Bump spring-hateoas from 1.1.0.RELEASE to 1.2.3 â€¦</li><li>Bump postgresql from 42.2.8 to 42.2.18 â€¦</li><li>Bump cloudwatch from 2.13.41 to 2.15.66 â€¦</li><li>Bump json-schema-validator from 4.2.0 to 4.3.3 â€¦</li><li>Bump org.springframework.boot from 2.2.5.RELEASE to 2.4.2 â€¦</li><li>Bump io.spring.dependency-management â€¦</li><li>Bump io.freefair.lombok from 4.1.3 to 5.3.0 â€¦</li><li>Bump org.flywaydb.flyway from 6.1.3 to 7.5.0 â€¦</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹éƒ½å°†è¿™äº›ä¾èµ–å‡çº§åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç”šè‡³ SpringBoot2.4.2 æ˜¯åœ¨è¿™æ¬¡å‡çº§çš„å‰ä¸‰å¤© release çš„ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸æ…Œï¼Œå‡çº§ä¾èµ–ä»€ä¹ˆçš„å¯¹æˆ‘ä»¬æ¥è¯´è·Ÿå–æ°´ä¸€æ ·ç®€å•ï¼Œå› ä¸ºâ€¦ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jacocoTestCoverageVerification &#123;</span><br><span class="line">  dependsOn <span class="string">'jacocoTestReport'</span></span><br><span class="line">  violationRules &#123;</span><br><span class="line">    rule &#123;</span><br><span class="line">      element = <span class="string">'CLASS'</span></span><br><span class="line">      limit &#123;</span><br><span class="line">        minimum = <span class="number">1.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ä»£ç çš„æµ‹è¯•è¦†ç›–ç‡çš„è¦æ±‚æ˜¯æƒŠäººçš„100%ğŸ¤£ è¿™åœ¨æˆ‘ä¹‹å‰çš„å…¬å¸æ˜¯ç»å¯¹æ— æ³•å®ç°çš„ã€‚ä¸ä»…ä»…æ˜¯ unit testï¼Œ æˆ‘ä»¬è¿˜æœ‰ integration æµ‹è¯•è¦†ç›–ï¼Œè¿˜æœ‰ç”¨åˆ°  cypress åˆä¸€æ¬¡è¦†ç›–äº†æ‰€æœ‰çš„ endpointã€‚ä¸å°±æ˜¯æ”¹æ”¹ä»£ç ä¹ˆ/å‡çº§ä¾èµ–å•¥çš„ä¹ˆï¼Œéšä¾¿ç©ã€‚</p><h2 id="äºæ˜¯"><a href="#äºæ˜¯" class="headerlink" title="äºæ˜¯"></a>äºæ˜¯</h2><p>æ¢­å“ˆï¼ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»ğŸ‘¨ğŸ»â€ğŸ’»å‡çº§ï¼Œè·‘æµ‹è¯•ï¼</p><p>å‡ åˆ†é’Ÿåï¼š<img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/do0JqI.png" alt="do0JqI"></p><p>è¡Œå˜›ï¼Œä¸å‡ºæˆ‘æ‰€æ–™ï¼ˆæ‰æ€ªğŸ™ƒï¼‰æœç„¶æŒ‚äº†ã€‚</p><p>æ‰“å¼€logä¸€çœ‹ï¼Œ emmmâ€¦ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Resolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of <span class="built_in">type</span> `java.time.LocalDate` from String <span class="string">"2020-01-15"</span>: Failed to deserialize java.time.LocalDate: (java.time.format.DateTimeParseException) Text <span class="string">'2020-01-15'</span> could not be parsed: Unable to obtain LocalDate from TemporalAccessor: &#123;YearOfEra=2020, MonthOfYear=1, DayOfMonth=15&#125;,ISO of <span class="built_in">type</span> java.time.format.Parsed; nested exception is com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot deserialize value of <span class="built_in">type</span> `java.time.LocalDate` from String <span class="string">"2020-01-15"</span>: Failed to deserialize java.time.LocalDate: (java.time.format.DateTimeParseException) Text <span class="string">'2020-01-15'</span> could not be parsed: Unable to obtain LocalDate from TemporalAccessor: &#123;YearOfEra=2020, MonthOfYear=1, DayOfMonth=15&#125;,ISO of <span class="built_in">type</span> java.time.format.Parsed</span><br><span class="line"> at [Source: (PushbackInputStream); line: 2, column: 18] (through reference chain: com.example.demo.Demo[<span class="string">"localDate"</span>])]</span><br></pre></td></tr></table></figure><p>æ±ªçš„å‘ï¼ï¼ŸğŸ˜¢ ç”¨çš„å¥½å¥½çš„<code>@JsonFormat</code>æ€ä¹ˆå°±çªç„¶ä¸å¥½ä½¿äº†ï¼Ÿ</p><h2 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h2><h4 id="æ‰“å¼€ä»£ç çœ‹ä¸€ä¸‹ï¼š"><a href="#æ‰“å¼€ä»£ç çœ‹ä¸€ä¸‹ï¼š" class="headerlink" title="æ‰“å¼€ä»£ç çœ‹ä¸€ä¸‹ï¼š"></a>æ‰“å¼€ä»£ç çœ‹ä¸€ä¸‹ï¼š</h4><p>æˆ‘æœ‰è¿™ä¹ˆä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo</span><span class="params">(LocalDate localDate)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.localDate = localDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>, lenient = OptBoolean.FALSE)</span><br><span class="line">    <span class="keyword">private</span> LocalDate localDate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalDate <span class="title">getLocalDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> localDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocalDate</span><span class="params">(LocalDate localDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.localDate = localDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­é…ç½®äº† localDate çš„ååºåˆ—åŒ–ä¸ºä¸¥æ ¼æ¨¡å¼<code>lenient = OptBoolean.FALSE</code>ï¼Œé˜²æ­¢å°† number ååºåˆ—åŒ–ä¸ºæ—¥æœŸï¼Œé‚£æ ·æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><p>æœ‰è¿™ä¹ˆä¸€ä¸ª controllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/demo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">test</span><span class="params">(@RequestBody Demo demo)</span> </span>&#123;</span><br><span class="line">        var localDate = demo.getLocalDate().toString();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(localDate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥æ”¶ä¸€ä¸ª LocalDate çš„å±æ€§ï¼Œç”¨pattern <code>yyyy-MM-dd</code> æ¥æ”¶ç±»ä¼¼äº<code>2020-01-15</code>è¿™æ ·æ ¼å¼çš„æ—¥æœŸã€‚</p><p>ä½†æ˜¯ä¹‹å‰ç”¨å¾—å¥½å¥½çš„å‡çº§äº† SpringBoot2.4.2ä¹‹åå´ç”¨ä¸äº†äº†ï¼Ÿemmmmâ€¦ ä¸€å®šæ˜¯ SpringBoot å‡çº§å‡äº†å•¥ä¸è¯¥å‡çš„ç©åº”ï¼ŒğŸ§æˆ‘è¦å» SpringBoot çš„å‡çº§æ—¥å¿—é‡Œçœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯å‡çº§äº† Jackson å•¥çš„ï¼Œä¸‡ä¸€æ‰¾åˆ°ä¸€ä¸ªå¤§éœ¸å“¥ğŸ¦Ÿï¼Œæä¸ª PR ä¸å°±ä»æ­¤æˆä¸ºé¡¶çº§å¼€æºé¡¹ç›®çš„ contributor äº†ã€‚ã€‚ã€‚ğŸ˜</p><h4 id="SpringBoot-2-4-2-å‡çº§æ—¥å¿—"><a href="#SpringBoot-2-4-2-å‡çº§æ—¥å¿—" class="headerlink" title="SpringBoot 2.4.2 å‡çº§æ—¥å¿—"></a>SpringBoot 2.4.2 å‡çº§æ—¥å¿—</h4><p>å» GitHub ä¸Šæ‰“å¼€  <a href="https://github.com/spring-projects/spring-boot/releases/tag/v2.4.2" target="_blank" rel="noopener">SpringBoot Release v2.4.2</a> ï¼Œ æµè§ˆä¸‹ <strong>Bug Fixes</strong> ã€ <strong>Documentation</strong>ã€<strong>Dependency Upgrades</strong>ï¼Œ å‘ç°ä¸€è¡Œï¼š</p><blockquote><p>Upgrade to Jackson Bom 2.11.4 #24726</p></blockquote><p>æœç„¶ï¼Œå‡çº§äº† Jackson åˆ°<code>2.11.4</code>ã€‚ å¯¹æ¯”äº†ä¸€ä¸‹å‘ç°æˆ‘åŸå…ˆçš„ SpringBoot ä¸­çš„ Jackson ç‰ˆæœ¬æ˜¯<code>2.10.2</code>ï¼Œ emmâ€¦ ä¸€èˆ¬è¿™ç§ç¨å¤§çš„ç‰ˆæœ¬å‡çº§éƒ½ä¼´éšç€å¾ˆå¤š magic çš„äº‹æƒ…ã€‚æ€»ä¹‹æ¥ä¸‹æ¥è¦å» Jackson çš„å‡çº§æ—¥å¿—é‡Œé¢çœ‹ä¸€ä¸‹ï¼Œæœ‰ä»€ä¹ˆå‡çº§è·¨è¶Šäº†<code>2.10.*</code>å’Œ<code>2.11.*</code>è¿™ä¸¤ä¸ªç‰ˆæœ¬ã€‚</p><h4 id="Jackson-2-11å‡çº§æ—¥å¿—"><a href="#Jackson-2-11å‡çº§æ—¥å¿—" class="headerlink" title="Jackson 2.11å‡çº§æ—¥å¿—"></a>Jackson 2.11å‡çº§æ—¥å¿—</h4><p>è¿™ä¸ªå‡çº§æ—¥å¿—åœ¨å®ƒ GitHub çš„ wiki é‡Œï¼Œç‚¹å‡»<a href="https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.11" target="_blank" rel="noopener">Jackson Release 2.11</a>ã€‚ </p><p>é˜…è¯»ä¸€ä¸‹ï¼Œç¬¬ä¸€éç«Ÿç„¶æ²¡æœ‰æ‰¾åˆ°ä»»ä½•çº¿ç´¢ï¼Œé˜¿è¥¿å§ğŸ¥µï¼Œé€šç¯‡ä¸<code>@JsonFormat</code>çš„å­—çœ¼å‡ ä¹æ²¡æœ‰ã€‚ä½†æ˜¯ï¼ŒåŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç”±äºæˆ‘è¿™ä¸ªé”™è¯¯æ˜¯æ—¶é—´ç±»å‹çš„è½¬æ¢é—®é¢˜ï¼Œåœ¨å¦‚ä¸‹æ‰€ç¤ºçš„æ›´æ”¹ä¸­ï¼Œå‘ç°å¯¹äº<code>Java 8date/time</code>æœ‰ç›¸å…³å‡çº§ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/xCxT2g.png" alt="xCxT2g"></p><blockquote><ul><li><a href="https://github.com/FasterXML/jackson-modules-java8/issues/148" target="_blank" rel="noopener">#148</a>: Allow strict <code>LocalDate</code> parsing</li></ul></blockquote><p>æ‰“å¼€è¿™ä¸ª <a href="https://github.com/FasterXML/jackson-modules-java8/issues/148" target="_blank" rel="noopener">issue</a> çœ‹ä¸€ä¸‹ï¼Œå¦‚ä»–ä»¬æ‰€è®¨è®ºçš„ï¼Œåœ¨ä¹‹å‰é…ç½®äº†<code>@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;, lenient = OptBoolean.FALSE)</code>, Jackson åˆ›å»ºçš„<code>DateTimeFormatter</code>è¿˜æ˜¯ä¼šä½¿ç”¨<code>ResolverStyle.SMART</code> smart æ¨¡å¼ï¼Œå¹¶ä¸èƒ½é˜»æ­¢éæ³•æ—¥æœŸ<code>2019-11-31</code>çš„è¾“å…¥ã€‚ æ‰€ä»¥åœ¨<code>2.11</code>ç‰ˆæœ¬ä¹‹åï¼Œ å¦‚æœè®¾ç½®äº†<code>lenient = OptBoolean.FALSE</code>, <code>DateTimeFormatter</code>ä¼šä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œçœ‹çœ‹ä»£ç ï¼š</p><p>åœ¨Jackson ä¸­çš„<code>JSR310DateTimeDeserializerBase</code>è¿™ä¸ªç±»ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•<code>createContextual</code>ï¼Œ æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!deser.isLenient()) &#123;</span><br><span class="line">  df = df.withResolverStyle(ResolverStyle.STRICT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ˜¯ï¼Œä¸ºä»€ä¹ˆ<code>DateTimeFormatter</code>ä½¿ç”¨äº†ä¸¥æ ¼æ¨¡å¼ï¼Œä¼šå¯¼è‡´ä¸Šè¿°æŠ¥é”™å‘¢ï¼Ÿ</p><h4 id="Java8-ä¹‹åçš„-java-time-ä¹‹-DateTimeFormatter"><a href="#Java8-ä¹‹åçš„-java-time-ä¹‹-DateTimeFormatter" class="headerlink" title="Java8 ä¹‹åçš„ java.time ä¹‹ DateTimeFormatter"></a>Java8 ä¹‹åçš„ java.time ä¹‹ DateTimeFormatter</h4><p><strong>ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å­—ç¬¦ä¸²è½¬LocalDate</strong></p><p><strong><em>ä¸¾ä¸ªğŸŒ°ğŸ‘€ğŸ‘€</em></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  DateTimeFormatter formatter = DateTimeFormatter</span><br><span class="line">    .ofPattern(<span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    .withResolverStyle(ResolverStyle.STRICT);</span><br><span class="line"></span><br><span class="line">  LocalDate localDate = LocalDate.parse(<span class="string">"2021-01-20"</span>, formatter);</span><br><span class="line">  System.out.println(<span class="string">"localDate = "</span> + localDate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œè½¬æ¢å¤±è´¥ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java.time.format.DateTimeParseException: Text <span class="string">'2021-01-20'</span> could not be parsed: Unable to obtain LocalDate from TemporalAccessor: &#123;YearOfEra=2021, DayOfMonth=20, MonthOfYear=1&#125;,ISO of <span class="built_in">type</span> java.time.format.Parsed</span><br></pre></td></tr></table></figure><p>å…³é”®å­—<code>YearOfEra</code>ï¼ŸğŸ§å•Šï¼Œå¸¦å¹´ä»£çš„å¹´ï¼Ÿæ²ƒå¾·å‘ğŸ˜±ï¼Ÿ</p><p>æ‰“å¼€ç±»<code>DateTimeFormatter</code>æœç´¢ä¸€ä¸‹<code>yyyy</code>ï¼Œå‘ç°ä¸€æ®µæ³¨é‡Šé‡Œé¢<code>y: year-of-era</code>ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* All letters 'A' to 'Z' and 'a' to 'z' are reserved as pattern letters. The</span><br><span class="line">* following pattern letters are defined:</span><br><span class="line">* &lt;table class="striped"&gt;</span><br><span class="line">* &lt;caption&gt;Pattern Letters and Symbols&lt;/caption&gt;</span><br><span class="line">* &lt;thead&gt;</span><br><span class="line">*  &lt;tr&gt;&lt;th scope="col"&gt;Symbol&lt;/th&gt;   &lt;th scope="col"&gt;Meaning&lt;/th&gt;         &lt;th scope="col"&gt;Presentation&lt;/th&gt; &lt;th scope="col"&gt;Examples&lt;/th&gt;</span><br><span class="line">* &lt;/thead&gt;</span><br><span class="line">* &lt;tbody&gt;</span><br><span class="line">*   &lt;tr&gt;&lt;th scope="row"&gt;G&lt;/th&gt;       &lt;td&gt;era&lt;/td&gt;                         &lt;td&gt;text&lt;/td&gt;              &lt;td&gt;AD; Anno Domini; A&lt;/td&gt;</span><br><span class="line">*   &lt;tr&gt;&lt;th scope="row"&gt;u&lt;/th&gt;       &lt;td&gt;year&lt;/td&gt;                        &lt;td&gt;year&lt;/td&gt;              &lt;td&gt;2004; 04&lt;/td&gt;</span><br><span class="line">*   &lt;tr&gt;&lt;th scope="row"&gt;y&lt;/th&gt;       &lt;td&gt;year-of-era&lt;/td&gt;                 &lt;td&gt;year&lt;/td&gt;              &lt;td&gt;2004; 04&lt;/td&gt;</span><br></pre></td></tr></table></figure><p>åŸæ¥ï¼Œ<code>u</code>æ‰æ˜¯ä»£è¡¨å¹´çš„é‚£ä¸ªå­—æ¯ï¼Œè€Œ<code>y</code>æ˜¯æŒ‡å¸¦æœ‰çºªå…ƒï¼ˆeraï¼‰çš„å¹´ï¼Œåœ¨<code>DateTimeFormatter</code>ä¸¥æ ¼æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œ<code>yyyy-MM-dd</code>å¹¶ä¸åˆæ³•ï¼Œæ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿æ˜¯<code>uuuu-MM-dd</code>ï¼ï¼ï¼</p><p>æ‰€ä»¥<code>yyyy</code>è¦æ€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚ä¸‹ï¼Œå¸¦ä¸Š<code>G</code>è¡¨ç¤ºä¸€ä¸‹å…¬å…ƒå‰æˆ–è€…å…¬å…ƒåå§ã€‚<code>AD/BC</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DateTimeFormatter formatter = DateTimeFormatter</span><br><span class="line">  .ofPattern(<span class="string">"yyyy-MM-dd G"</span>)</span><br><span class="line">  .withResolverStyle(ResolverStyle.STRICT);</span><br><span class="line"></span><br><span class="line">LocalDate localDate = LocalDate.parse(<span class="string">"2021-01-20 AD"</span>, formatter);</span><br></pre></td></tr></table></figure><p><strong>è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆï¼Œé—®é¢˜è§£å†³ï¼Œä¾èµ–ä¹ŸæˆåŠŸå‡çº§</strong></p><h4 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h4><p>é—®é¢˜è§£å†³äº†å¿ƒæƒ…å¾ˆå¥½ï¼Œä½†æ˜¯åæ€ä¸€ä¸‹ï¼ŒJava8 éƒ½å‡ºæ¥è¿™ä¹ˆä¹…äº†ï¼Œæ–°çš„æ—¥æœŸæ—¶é—´ä¹Ÿç”¨äº†å¾ˆå¤šï¼Œä½†æ˜¯å°±æ˜¯å¿½ç•¥äº†<code>y</code>å’Œ<code>u</code>è¿™ä¹ˆä¸èµ·çœ¼çš„å°é—®é¢˜ï¼</p><p>åœ¨é—®é¢˜çš„æ’æŸ¥ä¸­ï¼Œå®é™…ä¸Šå¹¶ä¸å¦‚ä¸Šè¿°æµç¨‹è¿™æ ·é¡ºåˆ©ï¼Œæˆ‘è¿˜åœ¨ Jackson çš„ GitHub é‡Œé¢æäº† issue</p><p><a href="https://github.com/FasterXML/jackson-modules-java8/issues/199" target="_blank" rel="noopener">https://github.com/FasterXML/jackson-modules-java8/issues/199</a></p><p>åœ¨æˆ‘æ’æŸ¥ Jackson çš„æºç çš„æ—¶å€™ï¼Œå‘ç°ä»–ä»¬å¯¹äºè¿™æ®µä»£ç <code>df = df.withResolverStyle(ResolverStyle.STRICT);</code>çš„å‡çº§ï¼Œå¹¶æ²¡æœ‰å¾ˆå®Œå–„çš„æµ‹è¯•ã€‚åœ¨ä»–ä»¬çš„æºç ä¸­å¯ä»¥çœ‹åˆ°test case éƒ½æ˜¯åªæ˜¯æµ‹è¯•äº†å¼‚å¸¸æƒ…å†µï¼Œå¹¶æ²¡æœ‰è¦†ç›–åŸå…ˆæœ¬åº”è¯¥æ­£ç¡®çš„ caseï¼ˆå¯è§ unit test æ˜¯å¤šä¹ˆçš„é‡è¦ï¼‰ï¼Œä»–ä»¬çš„æµ‹è¯•æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalDateDeserTest</span> <span class="keyword">extends</span> <span class="title">ModuleTestBase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper MAPPER = newMapper();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StrictWrapper</span> </span>&#123;</span><br><span class="line">        <span class="meta">@JsonFormat</span>(pattern=<span class="string">"yyyy-MM-dd"</span>,</span><br><span class="line">                lenient = OptBoolean.FALSE)</span><br><span class="line">        <span class="keyword">public</span> LocalDate value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StrictWrapper</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StrictWrapper</span><span class="params">(LocalDate v)</span> </span>&#123; value = v; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span>(expected = InvalidFormatException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStrictCustomFormat</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/*StrictWrapper w =*/</span> MAPPER.readValue(<span class="string">"&#123;\"value\":\"2019-11-31\"&#125;"</span>, StrictWrapper.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæµ‹è¯•çš„é—®é¢˜åœ¨äºï¼Œå°†<code>{ &quot;value&quot; : &quot;2019-11-31&quot;}</code>æ”¹æˆåˆæ³•çš„ä¹Ÿèƒ½è·‘è¿‡ã€‚å› ä¸ºä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ <code>yyyy-MM-dd</code>å¹¶ä¸åˆæ³•ï¼ŒåŒæ ·ä¼šè·‘å‡º<code>InvalidFormatException</code>å¼‚å¸¸ã€‚æ‰€ä»¥æˆ‘åœ¨ Jackson çš„<code>jackson-modules-java8</code>è¿™ä¸ª repo ä¸‹è¿˜æäº†ä¸€ä¸ª PR å»ä¿®æ”¹ä»–ä»¬çš„æµ‹è¯•ç”¨ä¾‹ï¼š</p><p><a href="https://github.com/FasterXML/jackson-modules-java8/pull/201" target="_blank" rel="noopener">https://github.com/FasterXML/jackson-modules-java8/pull/201</a></p><p> ä¸è¿‡ä¹Ÿåªæ˜¯ç®€å•è¦†ç›–ä¸€ä¸‹è¿™ä¸ª caseï¼Œå¯¹äºå…¶ä»–ç”¨åˆ°<code>yyyy</code>çš„æµ‹è¯•å¹¶æœªåšä¿®æ”¹ï¼Œå¸Œæœ›æˆ‘çš„ PR èƒ½è¢«åˆè¿›å»å§å“ˆå“ˆğŸ˜œè™½ç„¶åªæ˜¯å•å…ƒæµ‹è¯•å¹¶ä¸æ˜¯ä»£ç åŠŸèƒ½ï¼Œä½†ä¹Ÿå¾ˆæœ‰ç”¨å•Šã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/3hmYwN.jpg&quot; alt=&quot;3hmYwN&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="springboot" scheme="http://zhangjiaheng.cn/categories/springboot/"/>
    
    
      <category term="springboot" scheme="http://zhangjiaheng.cn/tags/springboot/"/>
    
      <category term="DateTimeFormatter" scheme="http://zhangjiaheng.cn/tags/DateTimeFormatter/"/>
    
      <category term="jackson" scheme="http://zhangjiaheng.cn/tags/jackson/"/>
    
      <category term="lenient" scheme="http://zhangjiaheng.cn/tags/lenient/"/>
    
      <category term="JsonFormat" scheme="http://zhangjiaheng.cn/tags/JsonFormat/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ UPic &amp; GitHub åšä¸ªè‡ªå·±çš„å›¾åºŠ</title>
    <link href="http://zhangjiaheng.cn/blog/20210113/%E4%BD%BF%E7%94%A8-UPic-GitHub-%E5%81%9A%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9B%BE%E5%BA%8A/"/>
    <id>http://zhangjiaheng.cn/blog/20210113/ä½¿ç”¨-UPic-GitHub-åšä¸ªè‡ªå·±çš„å›¾åºŠ/</id>
    <published>2021-01-13T13:42:28.000Z</published>
    <updated>2021-01-13T13:50:43.172Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/spider1.jpg" alt="spider1"></p><center><br><br>æœ‰å†™è¿‡ä¸€ä¸ªå°å°çš„åˆ›å»ºæ­¥éª¤ï¼Œä¸è¿‡æ˜¯è‹±æ–‡ç‰ˆçš„(åœ¨ç»ƒä¹ å†™è‹±æ–‡åšå®¢)ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç‚¹å¼€çœ‹ä¸‹ï¼Œæ­¥éª¤ä¹Ÿæ¯”è¾ƒç®€å•ã€‚<br><br><a href="https://chennianfenglou.github.io/#/blogs/upicGithub?id=create-your-image-service-by-upic-amp-github" target="_blank" rel="noopener">ç‚¹å‡»è·³è½¬åˆ°æ–‡ç« </a><br></center><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/spider1.jpg&quot; alt=&quot;spider1&quot;&gt;&lt;/p&gt;
&lt;center&gt;&lt;br&gt;&lt;br&gt;æœ‰å†™è¿‡ä¸€ä¸ªå°å°çš„åˆ›å»ºæ­¥éª¤ï¼Œä¸è¿‡æ˜¯è‹±
      
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Localstack æ­å»º AWS æœ¬åœ°å¼€å‘ç¯å¢ƒ</title>
    <link href="http://zhangjiaheng.cn/blog/20201227/%E4%BD%BF%E7%94%A8localstack-%E6%90%AD%E5%BB%BA-AWS-%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <id>http://zhangjiaheng.cn/blog/20201227/ä½¿ç”¨localstack-æ­å»º-AWS-æœ¬åœ°å¼€å‘ç¯å¢ƒ/</id>
    <published>2020-12-27T06:45:59.000Z</published>
    <updated>2020-12-27T09:45:48.171Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/DBhQX3.jpg" alt="DBhQX3"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›¸ä¿¡æœ‰å¾ˆå¤šåŒå­¦å…¬å¸é¡¹ç›®éƒ½æœ‰ç”¨åˆ° AWS æˆ–è€…æœ‰åŒå­¦åœ¨å­¦ä¹  AWSï¼Œæˆ‘ä»¬çŸ¥é“åƒ AWS è¿™æ ·çš„äº‘æœåŠ¡ï¼Œæˆ‘ä»¬ä¸å¤ªèƒ½å¾ˆæ–¹ä¾¿çš„å»åœ¨æœ¬åœ°å¼€å‘çš„æ—¶å€™è¿æ¥äº‘ä¸Šçš„æœåŠ¡ï¼Œæ›´ä½•å†µ staging/production ç¯å¢ƒè¿˜ä¼šæœ‰å®‰å…¨æ–¹é¢çš„è€ƒè™‘ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬åˆ›å»ºå¥½ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¦‚ä½•å»æ­å»ºå…¶æœ¬åœ°å¼€å‘ç¯å¢ƒæ–¹ä¾¿æˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘è°ƒè¯•å‘¢ï¼Ÿæ²¡é”™ï¼ä½¿ç”¨ localstackï¼</p><p><strong><a href="https://github.com/localstack/localstack" target="_blank" rel="noopener">LocalStack - A fully functional local AWS cloud stack</a></strong></p><blockquote><p><strong><em>LocalStack provides an easy-to-use test/mocking framework for developing Cloud applications.</em></strong></p><p><strong><em>Currently, the focus is primarily on supporting the AWS cloud stack.</em></strong></p></blockquote><p>LocalStack æ˜¯æä¾›ç»™å¼€å‘è€…ä¸€ä¸ªæ–¹ä¾¿å»æµ‹è¯•å’Œ mock æœåŠ¡çš„æ¡†æ¶ï¼Œ ç›®å‰ä¸»è¦æä¾› AWS äº‘æœåŠ¡ã€‚</p><a id="more"></a><h2 id="å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2><h3 id="ä¾‹ï¼šä½¿ç”¨-LocalStack-åˆ›å»ºä¸€ä¸ª-SNSæœåŠ¡"><a href="#ä¾‹ï¼šä½¿ç”¨-LocalStack-åˆ›å»ºä¸€ä¸ª-SNSæœåŠ¡" class="headerlink" title="ä¾‹ï¼šä½¿ç”¨ LocalStack åˆ›å»ºä¸€ä¸ª SNSæœåŠ¡"></a>ä¾‹ï¼šä½¿ç”¨ LocalStack åˆ›å»ºä¸€ä¸ª SNSæœåŠ¡</h3><p>æƒ³åƒæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ª SpringBoot æœåŠ¡ï¼Œæä¾›æ¥å£åœ¨ç”¨æˆ·æäº¤ä¸€æ¡è®°å½•çš„æ—¶å€™ç»™ç”¨æˆ·å‘é‚®ä»¶ï¼Œä¸€èˆ¬æƒ…å†µè¿™ç§ä¸šåŠ¡æˆ‘ä»¬éƒ½ä¼šå°†ä¿å­˜æ•°æ®åº“å’Œå‘é‚®ä»¶å¼‚æ­¥æ‰§è¡Œã€‚ä½¿ç”¨ AWS çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¿å­˜æ•°æ®åº“ä¹‹åè°ƒç”¨ SNS æœåŠ¡ï¼Œå‘å¸ƒä¸€ä¸ª <code>Event</code> ç„¶åç­‰å¾…ä¸‹æ¸¸é‚®ä»¶æœåŠ¡è®¢é˜…å¯¹åº”çš„ topic ç„¶åæ¶ˆè´¹ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºå‘¢ï¼Ÿå¦‚ä¸‹åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­åŠ å…¥<code>localstack</code>ï¼ŒSERVICES æŒ‡å®šå¥½ <code>sns</code>ï¼š</p><h4 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.7"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  localstack:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">localstack/localstack:0.12.1</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">app_net</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"4566:4566"</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">SERVICES=sns</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DEFAULT_REGION=ap-southeast-2</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DEBUG=1</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./auto/create-localstack-topic:/docker-entrypoint-initaws.d/create-localstack-topic.sh</span></span><br></pre></td></tr></table></figure><h4 id="create-localstack-topic-sh"><a href="#create-localstack-topic-sh" class="headerlink" title="create-localstack-topic.sh"></a>create-localstack-topic.sh</h4><p>æ­¤å¤–ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿˜ volume äº†ä¸€ä¸ªè„šæœ¬è¿›å»ï¼Œé‚£å°±æ˜¯åˆ›å»º SNS çš„è„šæœ¬ã€‚å®é™…ä¸Šè¿™ä¸ªå‘½ä»¤å°±æ˜¯ aws cliï¼Œåœ¨å…¶å®˜ç½‘å°±å¯ä»¥æ‰¾å¾—åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ <code>aws</code> æ¢æˆ <code>awslocal</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">REGION=<span class="variable">$&#123;DEFAULT_REGION:-ap-southeast-2&#125;</span></span><br><span class="line">TOPIC_NAME=demo-events-topic</span><br><span class="line"></span><br><span class="line">awslocal sns create-topic --name=<span class="variable">$&#123;TOPIC_NAME&#125;</span> --region <span class="string">"<span class="variable">$&#123;REGION&#125;</span>"</span></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æ—¥å¿—"><a href="#å¯åŠ¨æ—¥å¿—" class="headerlink" title="å¯åŠ¨æ—¥å¿—"></a>å¯åŠ¨æ—¥å¿—</h4><p>å½“å¯åŠ¨ <code>docker-compose up localstack</code> çš„æ—¶å€™ï¼Œå°±åœ¨è¯¥å®¹å™¨ä¸­åˆ›å»ºå¥½äº† SNS æœåŠ¡æä¾›ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">sns_1            | Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">sns_1            | 2020-12-27 07:02:36,554 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified <span class="keyword">in</span> the config file.  If you intend to run as root, you can <span class="built_in">set</span> user=root <span class="keyword">in</span> the config file to avoid this message.</span><br><span class="line">sns_1            | 2020-12-27 07:02:36,559 INFO supervisord started with pid 15</span><br><span class="line">sns_1            | 2020-12-27 07:02:37,566 INFO spawned: <span class="string">'dashboard'</span> with pid 21</span><br><span class="line">sns_1            | 2020-12-27 07:02:37,571 INFO spawned: <span class="string">'infra'</span> with pid 22</span><br><span class="line">sns_1            | 2020-12-27 07:02:37,577 INFO success: dashboard entered RUNNING state, process has stayed up <span class="keyword">for</span> &gt; than 0 seconds (startsecs)</span><br><span class="line">sns_1            | 2020-12-27 07:02:37,577 INFO exited: dashboard (<span class="built_in">exit</span> status 0; expected)</span><br><span class="line">sns_1            | (. .venv/bin/activate; <span class="built_in">exec</span> bin/localstack start --host)</span><br><span class="line">sns_1            | 2020-12-27 07:02:38,591 INFO success: infra entered RUNNING state, process has stayed up <span class="keyword">for</span> &gt; than 1 seconds (startsecs)</span><br><span class="line">sns_1            | LocalStack version: 0.12.1</span><br><span class="line">sns_1            | Starting <span class="built_in">local</span> dev environment. CTRL-C to quit.</span><br><span class="line">sns_1            | 2020-12-27T07:02:39:DEBUG:bootstrap.py: Loading plugins - scope <span class="string">"services"</span>, module <span class="string">"localstack"</span>: &lt;<span class="keyword">function</span> register_localstack_plugins at 0x7f963f120f70&gt;</span><br><span class="line">sns_1            | Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">sns_1            | 2020-12-27T07:02:43:INFO:localstack.utils.analytics.profiler: Execution of <span class="string">"load_plugin_from_path"</span> took 4333.9550495147705ms</span><br><span class="line">sns_1            | 2020-12-27T07:02:43:INFO:localstack.utils.analytics.profiler: Execution of <span class="string">"load_plugins"</span> took 4334.24186706543ms</span><br><span class="line">sns_1            | Starting edge router (https port 4566)...</span><br><span class="line">sns_1            | Starting mock SNS service on http port 4566 ...</span><br><span class="line">sns_1            | 2020-12-27T07:02:45:INFO:localstack.utils.analytics.profiler: Execution of <span class="string">"prepare_environment"</span> took 2061.4540576934814ms</span><br><span class="line">sns_1            | 2020-12-27T07:02:45:INFO:localstack.multiserver: Starting multi API server process on port 59903</span><br><span class="line">sns_1            | [2020-12-27 07:02:45 +0000] [23] [INFO] Running on https://0.0.0.0:4566 (CTRL + C to quit)</span><br><span class="line">sns_1            | 2020-12-27T07:02:45:INFO:hypercorn.error: Running on https://0.0.0.0:4566 (CTRL + C to quit)</span><br><span class="line">sns_1            | [2020-12-27 07:02:45 +0000] [23] [INFO] Running on http://0.0.0.0:59903 (CTRL + C to quit)</span><br><span class="line">sns_1            | 2020-12-27T07:02:45:INFO:hypercorn.error: Running on http://0.0.0.0:59903 (CTRL + C to quit)</span><br><span class="line">sns_1            | 2020-12-27 07:02:45,824:API:  * Running on http://0.0.0.0:57589/ (Press CTRL+C to quit)</span><br><span class="line">sns_1            | Waiting <span class="keyword">for</span> all LocalStack services to be ready</span><br><span class="line">sns_1            | Ready.</span><br><span class="line">sns_1            | 2020-12-27T07:02:50:INFO:localstack.utils.analytics.profiler: Execution of <span class="string">"start_api_services"</span> took 5102.221965789795ms</span><br><span class="line">sns_1            | /usr/<span class="built_in">local</span>/bin/docker-entrypoint.sh: running /docker-entrypoint-initaws.d/create-localstack-topic.sh</span><br><span class="line">sns_1            | &#123;</span><br><span class="line">sns_1            |     <span class="string">"TopicArn"</span>: <span class="string">"arn:aws:sns:ap-southeast-2:000000000000:demo-events-topic"</span></span><br><span class="line">sns_1            | &#125;</span><br></pre></td></tr></table></figure><h4 id="åœ¨å‘½ä»¤è¡Œè°ƒç”¨"><a href="#åœ¨å‘½ä»¤è¡Œè°ƒç”¨" class="headerlink" title="åœ¨å‘½ä»¤è¡Œè°ƒç”¨"></a>åœ¨å‘½ä»¤è¡Œè°ƒç”¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint-url=http://localhost:4566 sns publish --topic-arn arn:aws:sns:ap-southeast-2:000000000000:demo-events-topic --region ap-southeast-2 --message <span class="string">"Hello SNS"</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨æœ¬åœ°ä½¿ç”¨ aws å‘½ä»¤è°ƒç”¨ localstack ä¸­çš„æœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦è¦†ç›–<code>endpoint-url</code>, å¦åˆ™å›å»æ‹¿ç€ credentials è°ƒç”¨å®é™…ç¯å¢ƒçš„æœåŠ¡ã€‚</p><h4 id="åœ¨-SpringBoot-ä¸­ä½¿ç”¨çš„æ³¨æ„ç‚¹"><a href="#åœ¨-SpringBoot-ä¸­ä½¿ç”¨çš„æ³¨æ„ç‚¹" class="headerlink" title="åœ¨ SpringBoot ä¸­ä½¿ç”¨çš„æ³¨æ„ç‚¹"></a>åœ¨ SpringBoot ä¸­ä½¿ç”¨çš„æ³¨æ„ç‚¹</h4><p>åœ¨ SpringBoot æˆ–è€…å…¶ä»–ä»£ç åº“ï¼ˆå¦‚nodeï¼‰ä¸­ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒåˆ›å»ºä¸åŒçš„ <code>SNSClient</code>ï¼Œ æœ¬åœ°ç¯å¢ƒçš„æ³¨æ„è¦è¦†ç›– endpointï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile</span>(&#123;<span class="string">"local"</span>, <span class="string">"docker"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalSnsClientConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;aws.sns.endpoint&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String awsSnsEndpoint;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SnsClient <span class="title">snsClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        var clientBuilder = SnsClient.builder();</span><br><span class="line">        <span class="keyword">if</span> (!Strings.isNullOrEmpty(awsSnsEndpoint)) &#123;</span><br><span class="line">            clientBuilder.endpointOverride(URI.create(awsSnsEndpoint));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> clientBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å¤šä¸ªæœåŠ¡"><a href="#å¯åŠ¨å¤šä¸ªæœåŠ¡" class="headerlink" title="å¯åŠ¨å¤šä¸ªæœåŠ¡"></a>å¯åŠ¨å¤šä¸ªæœåŠ¡</h3><p>ä¸Šé¢åªæ˜¯ä¸€ä¸ªå¯åŠ¨ SNS æœåŠ¡çš„ä¾‹å­ï¼Œå®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šå¤šç§æœåŠ¡ç»“åˆä½¿ç”¨ã€‚æ¯”å¦‚ä¼šæœ‰ä¸€ä¸ª SQS æœåŠ¡ï¼Œ è®¢é˜…äº† SNS çš„ topicï¼Œç„¶åå» trigger ä¸€ä¸ª lambdaï¼Œæ‰§è¡Œç›¸åº”çš„ä¸€äº›ä»»åŠ¡ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨æœ¬åœ°å®ç°è¿™äº›æœåŠ¡çš„ç›¸äº’è®¢é˜…ä¸è§¦å‘å‘¢ï¼Ÿå®é™…ä¸Šåªéœ€è¦åœ¨ä¸€ä¸ª localstack ä¸­å¯åŠ¨å¤šä¸ªæœåŠ¡ç„¶åæ‰§è¡Œä¸€äº›è„šæœ¬å»ºç«‹ä¹‹é—´çš„å…³ç³»ï¼ˆå…·ä½“å‘½ä»¤å’Œ aws cli ä¸€æ ·ï¼‰å°±å¯ä»¥äº†ï¼Œå¦‚ä¸‹ï¼š</p><h4 id="docker-compose-yml-1"><a href="#docker-compose-yml-1" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.7"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  localstack:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">localstack/localstack:0.12.1</span></span><br><span class="line"><span class="attr">    privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">localstack</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">app_net</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"4566:4566"</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">SERVICES=sns,sqs,kms,cloudwatch,lambda</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DEFAULT_REGION=ap-southeast-2</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">LAMBDA_EXECUTOR=docker-reuse</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">LAMBDA_REMOTE_DOCKER=false</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">LAMBDA_DOCKER_NETWORK=host</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DEBUG=1</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">HOST_TMP_FOLDER=$&#123;TMPDIR&#125;</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DOCKER_HOST=unix:///var/run/docker.sock</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">LOCAL_CODE_PATH=$&#123;PWD&#125;</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">$&#123;TMPDIR:-/tmp/localstack&#125;:/tmp/localstack</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./auto/create-localstack:/docker-entrypoint-initaws.d/create-localstack.sh</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./kms/kms_seed.yaml:/init/seed.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">  app_net:</span></span><br></pre></td></tr></table></figure><h4 id="kms-seed-yaml"><a href="#kms-seed-yaml" class="headerlink" title="kms_seed.yaml"></a>kms_seed.yaml</h4><p>æˆ‘åœ¨è¿™é‡Œå¯åŠ¨äº† sns,sqs,kms,cloudwatch,lambdaã€‚ æ¯”è¾ƒå€¼å¾—ä¸€è¯´çš„é™¤äº†åœ¨æœ¬åœ°è®¿é—® sqs, sns, kms ç­‰éœ€è¦è¦†ç›–æ‰ <code>endpoint-url</code>ä¹‹å¤–ï¼Œ åœ¨æœ¬åœ°ä½¿ç”¨ kms è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ª <code>seed.yml</code> æ¥ç”¨å®ƒè¿›è¡ŒåŠ è§£å¯†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Keys:</span></span><br><span class="line"><span class="attr">  Symmetric:</span></span><br><span class="line"><span class="attr">    Aes:</span></span><br><span class="line"><span class="attr">      - Metadata:</span></span><br><span class="line"><span class="attr">          KeyId:</span> <span class="number">832</span><span class="string">ac356-3c82-4c4d-a3dc-7489da152197</span></span><br><span class="line"><span class="attr">        BackingKeys:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="number">2</span><span class="string">bdaead27fe7da2de47945d34cd6d79e36494e73802f3cd3869f1d2cb0b5d74c</span></span><br><span class="line"><span class="attr">Aliases:</span></span><br><span class="line"><span class="attr">  - AliasName:</span> <span class="string">alias/testing</span></span><br><span class="line"><span class="attr">    TargetKeyId:</span> <span class="number">832</span><span class="string">ac356-3c82-4c4d-a3dc-7489da152197</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºè„šæœ¬-create-localstack-sh"><a href="#åˆ›å»ºè„šæœ¬-create-localstack-sh" class="headerlink" title="åˆ›å»ºè„šæœ¬ create-localstack.sh"></a>åˆ›å»ºè„šæœ¬ <code>create-localstack.sh</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">QUEUE_NAME=demo-queue</span><br><span class="line">TOPIC_NAME=demo-topic</span><br><span class="line">FUNCTION_NAME=demo-function</span><br><span class="line">APP_ENV=dev</span><br><span class="line"></span><br><span class="line">awslocal sns create-topic --name=$&#123;TOPIC_NAME&#125;</span><br><span class="line">awslocal sqs create-queue --queue-name=$&#123;QUEUE_NAME&#125;</span><br><span class="line">awslocal sns subscribe \</span><br><span class="line">    --topic-arn arn:aws:sns:ap-southeast-2:000000000000:$&#123;TOPIC_NAME&#125; \</span><br><span class="line">    --protocol sqs \</span><br><span class="line">    --notification-endpoint http://localhost:4566/000000000000/$&#123;QUEUE_NAME&#125;</span><br><span class="line"></span><br><span class="line">awslocal lambda create-function \</span><br><span class="line">    --code S3Bucket="__local__",S3Key="$&#123;LOCAL_CODE_PATH&#125;" \</span><br><span class="line">    --function-name $&#123;FUNCTION_NAME&#125; \</span><br><span class="line">    --runtime nodejs12.x \</span><br><span class="line">    --timeout 5 \</span><br><span class="line">    --handler dist/index.handler \</span><br><span class="line">    --role dev \</span><br><span class="line">    --environment "&#123;\"Variables\":&#123;\"APP_ENV\":\"$&#123;APP_ENV&#125;\"&#125;&#125;"</span><br><span class="line"></span><br><span class="line">awslocal lambda create-event-source-mapping \</span><br><span class="line">    --event-source-arn arn:aws:sqs:ap-southeast-2:000000000000:$&#123;QUEUE_NAME&#125; \</span><br><span class="line">    --function-name $&#123;FUNCTION_NAME&#125; \</span><br><span class="line">    --enabled</span><br></pre></td></tr></table></figure><h4 id="æœ¬åœ°å¯åŠ¨"><a href="#æœ¬åœ°å¯åŠ¨" class="headerlink" title="æœ¬åœ°å¯åŠ¨"></a>æœ¬åœ°å¯åŠ¨</h4><p>ç›´æ¥è¿è¡Œ <code>docker-compose up localstack</code></p><h4 id="æœ¬åœ°æ‰§è¡Œ"><a href="#æœ¬åœ°æ‰§è¡Œ" class="headerlink" title="æœ¬åœ°æ‰§è¡Œ"></a>æœ¬åœ°æ‰§è¡Œ</h4><p>ç°åœ¨åœ¨å‘½ä»¤è¡Œå‘é€ä¸€æ¡ SNS çš„æ¶ˆæ¯ï¼Œå°±å¯ä»¥ trigger æˆ‘ä»¬çš„ Lambda æ‰§è¡Œäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint-url=http://localhost:4566 sns publish --topic-arn arn:aws:sns:ap-southeast-2:000000000000:demo-topic --region ap-southeast-2 --message "Hello SNS - SQS - Lambda"</span><br></pre></td></tr></table></figure><p>åœ¨ Lambda çš„ index.ts å†™ä¸€ä¸ª <code>handler()</code> æ–¹æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./overwriteAwsLocalEndpoint'</span>); <span class="comment">//overwrite aws local endpoint,Please keep it here.</span></span><br><span class="line"><span class="keyword">import</span> &#123; SQSEvent, SQSHandler &#125; <span class="keyword">from</span> <span class="string">'aws-lambda'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> handler: SQSHandler = <span class="function">(<span class="params">event: SQSEvent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(event.Records));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ä¸€ä¸‹ SQS çš„æ¶ˆæ¯ä½“ã€‚</p><p><strong>ç»“æœå¦‚ä¸‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">localstack    | &gt; START RequestId: ce5ae5ff-054d-16e0-dc62-71161118d3bd Version: <span class="variable">$LATEST</span></span><br><span class="line">localstack    | &gt; 2020-12-27T09:32:56.373Zce5ae5ff-054d-16e0-dc62-71161118d3bdINFO[&#123;<span class="string">"body"</span>:<span class="string">"&#123;\"Type\": \"Notification\", \"MessageId\": \"04c12e03-66d0-474a-a60a-f0b3c2451456\", \"Token\": null, \"TopicArn\": \"arn:aws:sns:ap-southeast-2:000000000000:demo-topic\", \"Message\": \"Hello SNS - SQS - Lambda\", \"SubscribeURL\": null, \"Timestamp\": \"2020-12-27T09:32:52.202Z\", \"SignatureVersion\": \"1\", \"Signature\": \"EXAMPLEpH+..\", \"SigningCertURL\": \"https://sns.us-east-1.amazonaws.com/SimpleNotificationService-0000000000000000000000.pem\"&#125;"</span>,<span class="string">"receiptHandle"</span>:<span class="string">"exexifyylldwuznxlicibcanaqvcplpaeoztcdlltkzbsuvwiifvlyixrxwuzrmumlmkggofmiencdxilzoaluyreszdppsbycpxcowwvmeiieeplulkitfztfxzkjazucucauhuobpvlzdcnjdcmygqvbrouxkxoggcfryzqtibyquhikawczuif"</span>,<span class="string">"md5OfBody"</span>:<span class="string">"d96df71c445e9282ed4c2fefbf4c8ca1"</span>,<span class="string">"eventSourceARN"</span>:<span class="string">"arn:aws:sqs:ap-southeast-2:000000000000:demo-queue"</span>,<span class="string">"eventSource"</span>:<span class="string">"aws:sqs"</span>,<span class="string">"awsRegion"</span>:<span class="string">"ap-southeast-2"</span>,<span class="string">"messageId"</span>:<span class="string">"a59f7c57-651b-54f6-70bd-a2933fa57099"</span>,<span class="string">"attributes"</span>:&#123;<span class="string">"SenderId"</span>:<span class="string">"AIDAIT2UOQQY3AUEKVGXU"</span>,<span class="string">"SentTimestamp"</span>:<span class="string">"1609061572241"</span>,<span class="string">"ApproximateReceiveCount"</span>:<span class="string">"1"</span>,<span class="string">"ApproximateFirstReceiveTimestamp"</span>:<span class="string">"1609061572312"</span>&#125;,<span class="string">"messageAttributes"</span>:&#123;&#125;,<span class="string">"md5OfMessageAttributes"</span>:null,<span class="string">"sqs"</span>:<span class="literal">true</span>&#125;]</span><br><span class="line">localstack    | &gt; END RequestId: ce5ae5ff-054d-16e0-dc62-71161118d3bd</span><br><span class="line">localstack    | &gt; REPORT RequestId: ce5ae5ff-054d-16e0-dc62-71161118d3bdInit Duration: 3381.65 msDuration: 13.13 msBilled Duration: 100 msMemory Size: 1536 MBMax Memory Used: 55 MB</span><br></pre></td></tr></table></figure><h3 id="å…³äº-LocalStack-ä¸­-Lambda-çš„ä½¿ç”¨"><a href="#å…³äº-LocalStack-ä¸­-Lambda-çš„ä½¿ç”¨" class="headerlink" title="å…³äº LocalStack ä¸­ Lambda çš„ä½¿ç”¨"></a>å…³äº LocalStack ä¸­ Lambda çš„ä½¿ç”¨</h3><p>åœ¨æœ¬åœ°åˆ›å»º Lambda è¿è¡Œç¯å¢ƒæ˜¯æˆ‘è§‰å¾—è¯¸å¤š service ä¸­æ¯”è¾ƒéº»çƒ¦çš„ä¸€ä¸ªï¼Œä»¥ä¸‹æ˜¯å®˜æ–¹å¯¹äº Lambda çš„åˆ›å»ºæ—¶å€™çš„<a href="https://github.com/localstack/localstack#configurations" target="_blank" rel="noopener">é…ç½®è¯¦è§£</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">STEPFUNCTIONS<span class="emphasis">_LAMBDA_</span>ENDPOINT: URL to use as the Lambda service endpoint in Step Functions. By default this is the LocalStack Lambda endpoint. Use default to select the original AWS Lambda endpoint.</span><br><span class="line"></span><br><span class="line">LAMBDA_EXECUTOR: Method to use for executing Lambda functions. Possible values are:</span><br><span class="line"></span><br><span class="line"><span class="code">- local: run Lambda functions in a temporary directory on the local machine</span></span><br><span class="line"><span class="code">- docker: run each function invocation in a separate Docker container</span></span><br><span class="line"><span class="code">- docker-reuse: create one Docker container per function and reuse it across invocations</span></span><br><span class="line"><span class="code">For docker and docker-reuse, if LocalStack itself is started inside Docker, then the docker command needs to be available inside the container (usually requires to run the container in privileged mode). Default is docker, fallback to local if Docker is not available.</span></span><br><span class="line"></span><br><span class="line">LAMBDA<span class="emphasis">_REMOTE_</span>DOCKER: determines whether Lambda code is copied or mounted into containers. Possible values are:</span><br><span class="line"></span><br><span class="line"><span class="code">- true (default): your Lambda function definitions will be passed to the container by copying the zip file (potentially slower). It allows for remote execution, where the host and the client are not on the same machine.</span></span><br><span class="line"><span class="code">- false: your Lambda function definitions will be passed to the container by mounting a volume (potentially faster). This requires to have the Docker client and the Docker host on the same machine.</span></span><br><span class="line"></span><br><span class="line">LAMBDA<span class="emphasis">_DOCKER_</span>NETWORK: Optional Docker network for the container running your lambda function.</span><br><span class="line"></span><br><span class="line">LAMBDA<span class="emphasis">_DOCKER_</span>DNS: Optional DNS server for the container running your lambda function.</span><br><span class="line"></span><br><span class="line">LAMBDA<span class="emphasis">_CONTAINER_</span>REGISTRY: Use an alternative docker registry to pull lambda execution containers (default: lambci/lambda).</span><br><span class="line"></span><br><span class="line">LAMBDA<span class="emphasis">_REMOVE_</span>CONTAINERS: Whether to remove containers after Lambdas finished executing (default: true).</span><br></pre></td></tr></table></figure><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ol><li>ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ SNSã€KMS æ€»æ˜¯æŠ¥ä¸€äº› client çš„ credentials çš„é”™è¯¯ï¼Ÿ<ul><li>å› ä¸ºæ²¡æœ‰è¦†ç›– æœ¬åœ°ç¯å¢ƒéœ€è¦çš„ endpoint-urlï¼Œ å‚è€ƒæœ¬æ–‡ä¸­çš„è§£é‡Š</li></ul></li><li>ä¸ºä»€ä¹ˆç»™ SNS å‘æ¶ˆæ¯æˆåŠŸäº†å´æ²¡æœ‰è§¦å‘åˆ° Lambdaï¼Ÿ<ul><li>è¯·æ£€æŸ¥ä½ çš„åˆ›å»ºè„šæœ¬ï¼Œç¡®ä¿ä½ çš„ SQS è®¢é˜…äº† SNS çš„å¯¹åº” topicï¼ŒSQS æœ‰èƒ½å¤Ÿè§¦å‘ Lambda çš„ Mapping</li></ul></li><li>æœ¬ä¾‹ä»£ç åº“åœ°å€ï¼Ÿ<ul><li><a href="https://github.com/Fatezhang/aws-localstack-demo" target="_blank" rel="noopener">Fatezhang/aws-localstack-demo</a></li></ul></li></ol><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¦‚æœä½ åœ¨ä½¿ç”¨ localstack çš„æ—¶å€™é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿å‘Šè¯‰æˆ‘ä¸€èµ·ç ”ç©¶è®¨è®ºã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/DBhQX3.jpg&quot; alt=&quot;DBhQX3&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç›¸ä¿¡æœ‰å¾ˆå¤šåŒå­¦å…¬å¸é¡¹ç›®éƒ½æœ‰ç”¨åˆ° AWS æˆ–è€…æœ‰åŒå­¦åœ¨å­¦ä¹  AWSï¼Œæˆ‘ä»¬çŸ¥é“åƒ AWS è¿™æ ·çš„äº‘æœåŠ¡ï¼Œæˆ‘ä»¬ä¸å¤ªèƒ½å¾ˆæ–¹ä¾¿çš„å»åœ¨æœ¬åœ°å¼€å‘çš„æ—¶å€™è¿æ¥äº‘ä¸Šçš„æœåŠ¡ï¼Œæ›´ä½•å†µ staging/production ç¯å¢ƒè¿˜ä¼šæœ‰å®‰å…¨æ–¹é¢çš„è€ƒè™‘ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬åˆ›å»ºå¥½ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¦‚ä½•å»æ­å»ºå…¶æœ¬åœ°å¼€å‘ç¯å¢ƒæ–¹ä¾¿æˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘è°ƒè¯•å‘¢ï¼Ÿæ²¡é”™ï¼ä½¿ç”¨ localstackï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/localstack/localstack&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;LocalStack - A fully functional local AWS cloud stack&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;LocalStack provides an easy-to-use test/mocking framework for developing Cloud applications.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Currently, the focus is primarily on supporting the AWS cloud stack.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;LocalStack æ˜¯æä¾›ç»™å¼€å‘è€…ä¸€ä¸ªæ–¹ä¾¿å»æµ‹è¯•å’Œ mock æœåŠ¡çš„æ¡†æ¶ï¼Œ ç›®å‰ä¸»è¦æä¾› AWS äº‘æœåŠ¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="AWS" scheme="http://zhangjiaheng.cn/categories/AWS/"/>
    
    
      <category term="AWS" scheme="http://zhangjiaheng.cn/tags/AWS/"/>
    
      <category term="localstack" scheme="http://zhangjiaheng.cn/tags/localstack/"/>
    
  </entry>
  
  <entry>
    <title>è®©ä¸€åˆ‡è¢«ä¸­æ–­çš„é‡æ–°å¯åŠ¨</title>
    <link href="http://zhangjiaheng.cn/blog/20200705/Make-everything-interrupted-reboot/"/>
    <id>http://zhangjiaheng.cn/blog/20200705/Make-everything-interrupted-reboot/</id>
    <published>2020-07-05T07:35:33.000Z</published>
    <updated>2020-12-27T03:00:24.916Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/cxlyp3.jpg" alt="cxlyp3"></p><a id="more"></a><p>2020å¹´å› ä¸ºç–«æƒ…åŸå› å¯¼è‡´è‡ªå·±æµ‘æµ‘å™©å™©åœ°åº¦è¿‡äº†åŠå¹´æ—¶é—´ï¼Œåšå®¢ä¸€ç›´éƒ½æ²¡æœ‰æ›´æ–°ï¼Œç”šè‡³éƒ½ä¸çŸ¥é“è‡ªå·±æ¯å¤©åœ¨å¹²ä»€ä¹ˆã€‚ç›¸æ¯”äº 2019 å¹´æ¯å¤©éƒ½æ‹ä¸€ç‚¹è§†é¢‘è®°å½•ä¸€ä¸‹è‡ªå·±å¹²äº†äº›ä»€ä¹ˆä¹‹å¤–ï¼ˆå…¶å®æ¯å¤©ä¹Ÿæ˜¯ä¸€æ ·æ¯ç‡¥æ— èŠï¼‰ï¼Œ2020 å¹´è¿™å¤§åŠå¹´å¥½åƒæ˜¯çªç„¶å°±æ¶ˆå¤±æ‰äº†ã€‚</p><p>æƒ³è¦åšçš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥ä»Šå¤©æ‰“ç®—æ•´ç†ä¸€ä¸‹æ€ç»ªï¼Œä¸‰çœä¸€ä¸‹å¾èº«ğŸ§ã€‚åœ¨ æ–°å…¬å¸å·¥ä½œ 8 ä¸ªæœˆä»¥æ¥ï¼Œå¥½åƒå¤±å»äº†æ–—å¿—ï¼Œåœ¨è¿™é‡Œæ¯å¤©åšç€ä¸€äº›ç®€å•çš„è²Œä¼¼æ— æ³•æå‡è‡ªå·±çš„å·¥ä½œï¼Œå…¶å®æœ‰ä¸€äº›å€¦äº†ã€‚å“ä¸è¿‡æå‡ä¸æå‡éƒ½æ˜¯çœ‹è‡ªå·±ï¼Œä¹Ÿè®¸æ˜¯æˆ‘ç°åœ¨å¤ªæµ®èºäº†ã€‚</p><p>ä»æ­å·å›æ¥ä¹‹å‰æƒ³ç€æ¯å¤©å·¥ä½œè½»æ¾äº†å¯ä»¥åšä¸€äº›å‰¯ä¸šæˆ–è€…å…¶ä»–ï¼Œæ¯”å¦‚è§†é¢‘å‰ªè¾‘ï¼Œç»§ç»­å­¦ä¹  <code>POPPIN</code> ä¹‹ç±»çš„äº‹æƒ…ï¼Œä½†æ˜¯ç°å®æ˜¯æ¯å¤©å›åˆ°å®¶å°±èººå°¸ã€‚è¥¿å®‰çš„å¤å¤©æ¯å¤©8ç‚¹æ‰æ—¥è½ï¼ŒçœŸçš„æ„Ÿè§‰å¥½æµªè´¹æ—¶é—´å•Šï¼Œå¤§å¥½çš„å…‰é˜´éƒ½è¢«è‡ªå·±æŒ¥éœæ‰äº†ã€‚20 å¹´çš„ååŠå¹´ç«‹ä¸€äº›FğŸš©LğŸ‡¨ğŸ‡³AğŸ³ï¸â€ğŸŒˆGå§ï¼Œä¾‹å¦‚ï¼Œå¤šå‰ªè¾‘ä¸€äº›æœ‰è¶£çš„ VLOGï¼ˆè¿™ä¸ªéœ€è¦çµæ„Ÿï¼‰ï¼Œå­˜ä¸€ä¸‹é’±ï¼ˆè¿˜å¥½è‚¡ç¥¨å·²ç»å›æœ¬äº†ï¼‰ï¼Œå¤šå»è¥¿å®‰å‘¨è¾¹èµ°ä¸€èµ°ï¼ˆæœ‰é©¾ç…§å°±æ–¹ä¾¿äº†ï¼‰ï¼Œè°ˆä¸ªå¥³æœ‹å‹ï¼ˆè¿™ä¸ªå¯¹æˆ‘æ¥è¯´å…¶å®æ˜¯æœ€éš¾çš„ï¼Œå› ä¸ºæˆ‘å‘ç°è‡ªå·±å…¶å®æ˜¯ä¸€ä¸ªå¾ˆé—·çš„äººï¼Œæœ‰æ—¶å€™å°±æƒ³ä¸€ä¸ªäººå‘†ç€ä¸æƒ³å’Œåˆ«äººè¯´è¯ï¼Œå’Œåˆ«äººç›¸å¤„çœŸçš„å¥½ç´¯ï¼‰ï¼Œè¿˜æœ‰å¥èº«ï¼ˆè‡³å°‘å¢é‡åˆ° 125 æ–¤å§ï¼‰å…ˆç»ƒå‡ºæ¥ä¸€ä¸ªå¥½çœ‹çš„èº«ä½“ã€‚</p><h3 id="å‰ªè¾‘"><a href="#å‰ªè¾‘" class="headerlink" title="å‰ªè¾‘"></a>å‰ªè¾‘</h3><p>2019 å¹´æ¯å¤©éƒ½æœ‰æ‹ä¸€æ®µå°è§†é¢‘ï¼Œ20 å¹´ååŠå¹´ä¸æ‰“ç®—è¿™æ ·æ‹äº†ï¼Œå¾ˆè€—è´¹ç²¾åŠ›ã€‚ä¹Ÿè®¸åœ¨é‡åˆ°ä¸€äº›å¥½ç©çš„ä¸œè¥¿çš„æ—¶å€™å¯ä»¥ä¸ç”¨ç…§ç‰‡è®°å½•ï¼Œè€Œç”¨ä¸€æ®µç®€çŸ­çš„å°è§†é¢‘è®°å½•ä¸‹æ¥ï¼ˆè¯´åˆ°è¿™é‡Œæƒ³èµ·æ¥ iPhone çš„å®å†µæ‹ç…§åŠŸèƒ½ï¼Œé•¿æŒ‰å¯ä»¥æ’­æ”¾æ‹æ‘„å½“æ—¶çš„è§†é¢‘ç‰‡æ®µï¼ŒçœŸçš„éå¸¸å¥½ç”¨ï¼‰ã€‚</p><p>ä¹Ÿè®¸å¯ä»¥èŠ±ç‚¹æ—¶é—´å­¦ä¹ ä¸€ä¸‹ç¨å¾®é«˜çº§ä¸€ç‚¹çš„å‰ªè¾‘æŠ€å·§ï¼Œemmmâ€¦çœ‹å¤©åˆ†äº†å§ï¼Œéšç¼˜å­¦ä¹ ã€‚</p><h3 id="å­˜é’±"><a href="#å­˜é’±" class="headerlink" title="å­˜é’±"></a>å­˜é’±</h3><p>è¿‡å¹´çš„æ—¶å€™æ•°äº†æ•°è‡ªå·±çš„å­˜æ¬¾å‘ç°ä¹Ÿæœ‰åä¸‡å‘¢ï¼Œç»“æœ 20 å¹´å¤§åŠå¹´è¿‡å»äº†è¿˜æ˜¯è¿™ä¸ªæ•°ç›®ï¼Œä¸çŸ¥é“è‡ªå·±è¿™å¤§åŠå¹´é’±éƒ½å»å“ªå„¿äº†ã€‚ä¸ç§‘å­¦å•Šï¼Œè‚¡ç¥¨ä¹Ÿå›æœ¬äº†å‘¢ï¼Œåœ¨æœ‹å‹é‚£é‡Œæ”¾äº† 5 ä¸‡ï¼Œè‡ªå·±è‚¡ç¥¨ä¸­ç•™äº† 6 ä¸‡ï¼Œæœ€è¿‘æ„Ÿè§‰ç‰›å¸‚å¿«æ¥äº†å‘¢ï¼Œå¸Œæœ›èƒ½å¤Ÿè®©æˆ‘èµšä¸€äº›å§ã€‚æœ‰ä¸ªåœ¨æ­å·çš„æœ‹å‹æœ€è¿‘é‡åˆ°ä¸€äº›æ£˜æ‰‹çš„äº‹æƒ…ï¼Œéœ€è¦æ‰“å®˜å¸ï¼Œå¯èƒ½è¿˜å¾—èµ”åå‡ ä¸‡ã€‚å“ï¼Œæ—©å°±åŠè¿‡ä»–è„šè¸å®åœ°çš„èµšé’±ï¼Œä»–ä»æ¥æ²¡æœ‰å¬è¿›å»è¿‡æˆ‘çš„ä¸€å¥è¯ï¼Œå…¶å®æˆ‘æ—©å°±å·²ç»éå¸¸å¤±æœ›äº†ã€‚</p><p>ä»¥åæˆ‘ç®¡å¥½è‡ªå·±å°±è¡Œäº†ï¼Œä¸å»ç®¡åˆ«äººå¥½ä¸å¥½ã€‚</p><h3 id="æˆ·å¤–"><a href="#æˆ·å¤–" class="headerlink" title="æˆ·å¤–"></a>æˆ·å¤–</h3><p>å›åˆ°è¥¿å®‰ä»¥åå¥½åƒå°±å‰æ®µæ—¶é—´å»äº†ç‰›èƒŒæ¢ã€‚æœ¬æ¥åœ¨äº”ä¸€çš„æ—¶å€™å’Œæˆä»–ä»¬å»å¤ªç™½å±±ï¼Œå› ä¸ºä¸€åœºå©šç¤¼æ²¡æœ‰å»æˆï¼Œä¸‹ä¸€ä¸ªç›®çš„åœ°åº”è¯¥å°±æ˜¯å¤ªç™½å±±äº†å§ï¼Œå’ŒåŒäº‹ä¸€èµ·å»ã€‚ä¸è¿‡ç›®å‰ç°é˜¶æ®µå¯¹æˆ‘æœ€é‡è¦çš„è¿˜æ˜¯å…ˆå°½å¿«æ‹¿ä¸€ä¸‹é©¾ç…§ã€‚æœ‰äº†é©¾ç…§ä¼šå¼€è½¦ä»¥åï¼Œç§¦å²­æˆ‘èƒ½æ¯å¤©ä¸‹ç­å»ä¸€è¶Ÿå“ˆå“ˆã€‚</p><p>å“¦å¯¹ï¼Œæˆ‘åº”è¯¥æŠŠå»ä¸€äº› livehouseï¼Œçœ‹ç³–è’œé“ºå­è„±å£ç§€ã€çœ‹ç”µå½±ç­‰ç­‰è¿™ç§æ´»åŠ¨ä¹Ÿç®—åœ¨æˆ·å¤–è¿™é‡Œï¼Œç–«æƒ…åŸå› æœ‰äº›ä¸€ç›´éƒ½çœ‹ä¸æˆï¼Œå¥½æ°”å•Šï¼</p><h3 id="å¥èº«"><a href="#å¥èº«" class="headerlink" title="å¥èº«"></a>å¥èº«</h3><p>å‰æ®µæ—¶é—´ç§°äº†ä¸‹ä½“é‡ï¼Œ<em>57.8KG</em>ï¼Œ å¥½æ°”å•Šï¼Œå¯èƒ½æˆ‘çš„é¥®é£Ÿä¹ æƒ¯ä¹Ÿä¸å¤ªå¥½ã€‚æˆ‘ä»¬ç»„æœ‰ä¸‰ä¸ªåŒäº‹éƒ½æ˜¯å¥èº«å¤§ç¥ï¼ŒçŒ›çš„ä¸è¡Œã€‚ä¹Ÿè®¸æˆ‘ä¹Ÿéœ€è¦åŠä¸€ä¸ªå¥èº«å¡ï¼Ÿè·Ÿç€å¤§ä½¬ä»¬æŠŠæˆ‘è¿™æ ¸å¿ƒåŠ›é‡ï¼Œæ‰‹è‡‚èƒŒèƒ¸è‚Œç»ƒä¸€ç»ƒå“ˆå“ˆã€‚ğŸŒš çŸ­æœŸç›®æ ‡ 125 æ–¤ï¼</p><p>2020 å¹´ä¸‹åŠå¹´å°±æš‚æ—¶ç«‹è¿™ä¹ˆå†™ FALG å§ï¼Œå¸Œæœ›éƒ½èƒ½å¤Ÿå®Œæˆï¼</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/Fatezhang/FigureCloud@master/uPic/cxlyp3.jpg&quot; alt=&quot;cxlyp3&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="http://zhangjiaheng.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="http://zhangjiaheng.cn/tags/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
  </entry>
  
  <entry>
    <title>Java å¹¶å‘ç¼–ç¨‹çš„ä¸€äº›æ€»ç»“</title>
    <link href="http://zhangjiaheng.cn/blog/20200129/Java-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    <id>http://zhangjiaheng.cn/blog/20200129/Java-å¹¶å‘ç¼–ç¨‹çš„ä¸€äº›æ€»ç»“/</id>
    <published>2020-01-29T14:06:28.000Z</published>
    <updated>2021-03-09T13:20:56.573Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3></blockquote><p>å…³äºJAVA å¹¶å‘ç¼–ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘å·²é›¶æ•£çš„å¹¶ä¸ç³»ç»Ÿåœ°ç§¯ç´¯äº†ä¸€äº›å­¦ä¹ åšå®¢ï¼Œå¦‚ä¸‹ï¼š</p><p><a href="/blog/20190517/ç¼–å†™ä¸€ä¸ªç®€æ˜“çš„å¯é‡å…¥é”-ä¸€/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸€)ï¼šç¼–å†™ä¸€ä¸ªç®€æ˜“çš„å¯é‡å…¥é”</a></p><p><a href="/blog/20190525/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äºŒ-ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (äºŒ)ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”</a></p><p><a href="/blog/20190602/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸‰-ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸‰)ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨</a></p><p><a href="/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (å››)ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± </a></p><p><a href="/blog/20190623/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äº”-ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (äº”)ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹</a></p><p><a href="/blog/20190701/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å…­-ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (å…­)ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯</a></p><p><a href="/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/">å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸ƒ)ï¼šFork/Joinæ¡†æ¶åŸç†åŠdemo</a></p><p><a href="/blog/20190716/Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹/">Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹</a></p><p>è¿™ç¯‡åšå®¢ï¼Œåˆ¶ä½œäº†ä¸€ä¸ª Slideï¼Œæ¥é’ˆå¯¹ Java å¹¶å‘ç¼–ç¨‹åšä¸€äº›å°å°çš„æ€»ç»“ï¼š</p><p><a href="/ppt/java-concurrent-knowledge.html">&gt; ç‚¹å‡»æŸ¥çœ‹ Slide</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;/blockquote&gt;
&lt;p&gt;å…³äºJAVA å¹¶å‘ç¼–ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘å·²é›¶æ•£çš„å¹¶ä¸ç³»ç»Ÿåœ°ç§¯ç´¯äº†ä¸€äº›å­¦ä¹ åšå®¢ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

      
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>How to Use Junit5 to Test You Java Application Elegantly</title>
    <link href="http://zhangjiaheng.cn/blog/20200115/How-to-use-Junit5-to-test-you-java-application-elegantly/"/>
    <id>http://zhangjiaheng.cn/blog/20200115/How-to-use-Junit5-to-test-you-java-application-elegantly/</id>
    <published>2020-01-15T06:25:14.000Z</published>
    <updated>2020-12-27T03:00:24.911Z</updated>
    
    <content type="html"><![CDATA[<h1 align="center">Junit5 çš„ä¸€äº›å®é™…å¼€å‘ä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€ TDD å‘ ã€‘</h1><p><img src="/blog/20200115/How-to-use-Junit5-to-test-you-java-application-elegantly/junit5.png" alt="Junit"></p><a id="more"></a><blockquote><p>è¿™ç¯‡åšå®¢æœ¬æ¥åº”è¯¥å†™äºé¼ å¹´è¿‡å¹´ä¹‹å‰ï¼Œè°æƒ³åˆ°çŠ¯äº†ä¸ªæ‡’ï¼Œç°åœ¨æ€€ç€æ²‰é‡çš„å¿ƒæƒ…å†™ä¸‹è¿™ç¯‡åšå®¢~</p><p>å› ä¸ºä¸­å›½ç°åœ¨æ­£åœ¨å—ç€æ–°å‹å† çŠ¶ç—…æ¯’ç–«æƒ…çš„å±å®³ï¼Œå¤§è¿‡å¹´çš„é—¨éƒ½å‡ºä¸å»ï¼Œéƒ½èº²åœ¨å®¶é‡Œç”Ÿæ€•è¢«æ„ŸæŸ“ã€‚æ— èŠçš„æˆ‘åªèƒ½å­¦ä¹ å­¦ä¹ æ¥æ‰“å‘ä¸€ä¸‹æ¯ç‡¥çš„å‡æœŸç”Ÿæ´»å“ˆå“ˆ~</p></blockquote><h3 id="Junit5"><a href="#Junit5" class="headerlink" title="Junit5"></a>Junit5</h3><p>è¯´åˆ° JUNIT5 å¯èƒ½å¾ˆå¤šäººéƒ½ä¸é™Œç”Ÿï¼Œå°±æ˜¯ä¸€ä¸ªæµ‹è¯•æ¡†æ¶è€Œå·²ã€‚ä½†æ˜¯ç›¸ä¿¡å¤§éƒ¨åˆ†çš„ç¨‹åºå‘˜éƒ½æ²¡æœ‰ç”¨è¿‡ï¼Œæ„Ÿè§‰å›½å†…å¥½å¤šå…¬å¸éƒ½æ²¡æœ‰å†™æµ‹è¯•çš„ä¹ æƒ¯ï¼Œä¹Ÿè®¸æ˜¯äº§å“å‚¬éœ€æ±‚å‚¬çš„å¤ªç´§Îµ=(Â´Î¿ï½€*)))ã€‚æˆ‘å°±ä¸åœ¨è¿™é‡Œä»‹ç» Junit5 äº†ï¼Œæ²¡æœ‰å‰ç½®çŸ¥è¯†çš„è¯éœ€è¦çœ‹ä¸€ä¸‹ï¼š<a href="https://junit.org/junit5/" target="_blank" rel="noopener">Junit5</a>ï¼Œæˆ‘åªåœ¨è¿™ç¯‡åšå®¢ä»‹ç»ä¸€ä¸‹æˆ‘åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ Junit5 çš„ã€‚</p><h3 id="åŸºæœ¬çš„æµ‹è¯•ä»£ç "><a href="#åŸºæœ¬çš„æµ‹è¯•ä»£ç " class="headerlink" title="åŸºæœ¬çš„æµ‹è¯•ä»£ç "></a>åŸºæœ¬çš„æµ‹è¯•ä»£ç </h3><p>é¦–å…ˆ gradleéœ€è¦å¼•å…¥ Junit5 ä»¥åŠå…¶ä»–ç›¸å…³çš„ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testImplementation <span class="string">'org.mockito:mockito-core:2.24.0'</span></span><br><span class="line">testImplementation <span class="string">'org.junit.jupiter:junit-jupiter-api:5.2.0'</span></span><br><span class="line">testImplementation <span class="string">'org.junit.jupiter:junit-jupiter-params:5.2.0'</span></span><br><span class="line">testRuntimeOnly <span class="string">'org.junit.jupiter:junit-jupiter-engine:5.2.0'</span></span><br><span class="line">testImplementation <span class="string">"org.testcontainers:junit-jupiter:1.12.3"</span></span><br><span class="line">testImplementation <span class="string">"org.testcontainers:postgresql:1.12.3"</span></span><br><span class="line">testImplementation <span class="string">'org.mockito:mockito-junit-jupiter:3.1.0'</span></span><br><span class="line">testImplementation <span class="string">'org.hamcrest:hamcrest:2.2'</span></span><br></pre></td></tr></table></figure><p>ç„¶åç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shouldReturnObjectsGivenValidIdWhenGetObjects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  when(objectService.findApplications(OBJECT_ID)).thenReturn(mockObjects);</span><br><span class="line"></span><br><span class="line">  var responseEntity = objectsController.getObjects(<span class="keyword">null</span>);</span><br><span class="line">  </span><br><span class="line">  assertThat(HttpStatus.OK).isEqualTo(responseEntity.getStatusCode());</span><br><span class="line">  assertThat(responseEntity.getBody()).isEqualTo(mockGetObjectsResponse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ä¸€ä¸‹ï¼Œä»¥ä¸Šæµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æ–¹æ³•å‘½å<br>ä¸€èˆ¬çš„å†™æµ‹è¯•çš„æ—¶å€™ï¼Œæ–¹æ³•çš„å‘½åè¦æ±‚è§£é‡Šæµ‹è¯•çš„åŠŸèƒ½ï¼Œéœ€è¦åŒ…å« should/given/when æ¡ä»¶ã€‚å¦‚ä»¥ä¸Šæ–¹æ³•çš„å‘½å<code>shouldReturnObjectsGivenValidIdWhenGetObjects</code>æ˜¯æŒ‡å½“è°ƒç”¨getObjects()çš„æ—¶å€™ï¼Œç»™å®šä¸€ä¸ªåˆæ³•çš„ IDï¼Œèƒ½å¤Ÿè¿”å›ä¸€ç»„ Objectsã€‚</li><li>æ–¹æ³•çš„æ¡ä»¶ã€æ‰§è¡Œã€ä»¥åŠå¯¹äºç»“æœçš„éªŒè¯çš„ä»£ç æ¢è¡Œéš”å¼€</li><li>ä½¿ç”¨ assertThat()éªŒè¯ç»“æœï¼š<br><code>assertThat</code>æ–¹æ³•æ˜¯åŒ…<code>import static org.assertj.core.api.Assertions.assertThat;</code>ä¸­çš„æ–¹æ³•ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå®é™…çš„å€¼ï¼Œç„¶åå†ä½¿ç”¨<code>isEqualTo</code>ç­‰æ–¹æ³•åˆ¤æ–­ä¸Šä¸€ä¸ªæ‰§è¡Œç»“æœæ˜¯å¦æ­£ç¡®ã€‚</li></ol><h3 id="åœ¨ç±»ä¸­çš„æµ‹è¯•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ä»£ç "><a href="#åœ¨ç±»ä¸­çš„æµ‹è¯•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ä»£ç " class="headerlink" title="åœ¨ç±»ä¸­çš„æµ‹è¯•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ä»£ç "></a>åœ¨ç±»ä¸­çš„æµ‹è¯•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ä»£ç </h3><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨<code>@BeforeAll</code>æ³¨è§£åœ¨æ–¹æ³• setupMDC ä¸Šé¢ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¿…é¡»æ˜¯ static é™æ€æ–¹æ³•ã€‚æ˜¯æŒ‡åœ¨æ‰€æœ‰ç±»ä¸­çš„æµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰åªæ‰§è¡Œä¸€æ¬¡è¯¥æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨äºè®¾ç½®æ— çŠ¶æ€çš„å…¨å±€å˜é‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@BeforeAll</span><br><span class="line">static void setupMDC() &#123;</span><br><span class="line">    MDC.put(TRANSACTION_ID, UUID.randomUUID().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰éƒ½æ‰§è¡Œä¸€äº›ä»£ç "><a href="#åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰éƒ½æ‰§è¡Œä¸€äº›ä»£ç " class="headerlink" title="åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰éƒ½æ‰§è¡Œä¸€äº›ä»£ç "></a>åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰éƒ½æ‰§è¡Œä¸€äº›ä»£ç </h3><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨<code>@BeforeEach</code>æ³¨è§£ï¼Œå¯ä»¥åœ¨æ¯ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œä¹‹å‰éƒ½æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œç”¨äºæ¯ä¸ªæ–¹æ³•æ‰§è¡Œå‰çš„åˆå§‹åŒ–æˆ–è€…åšä¸€äº›å…±åŒçš„ mock æ“ä½œï¼Œç›¸å½“äº AOP çš„ Beforeã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  when(service.save(any(String.class), any(UUID.class), any(UUID.class))).thenReturn(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶ä»–çš„æ¯”å¦‚<code>@AfterAll</code> <code>@AfterEach</code>ç­‰ç­‰åŠŸèƒ½ä¾æ¬¡ç±»æ¨ã€‚</p><h3 id="æµ‹è¯•åˆ†å±‚"><a href="#æµ‹è¯•åˆ†å±‚" class="headerlink" title="æµ‹è¯•åˆ†å±‚"></a>æµ‹è¯•åˆ†å±‚</h3><p>åœ¨ä½¿ç”¨ Junit5 æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæœ€è®©æˆ‘è§‰å¾—æ–¹ä¾¿çš„æ˜¯å¯¹äºæµ‹è¯•ç±»çš„ç»“æ„åˆ’åˆ†æ–¹å¼ï¼šå†…éƒ¨ç±»ã€‚é€šè¿‡å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬è¦æµ‹è¯•çš„ä¸œè¥¿ä½¿ç”¨ç±»ç»“æ„çš„å½¢å¼å»è¿›è¡Œæè¿°ï¼ˆä½¿ç”¨æ³¨è§£<code>@Nested</code>ä¿®é¥°ï¼‰ï¼Œç„¶åå†åœ¨ç±»ä¸­ç¼–å†™ç›¸åº”çš„æµ‹è¯•æ–¹æ³•è¿›è¡Œå…·ä½“çš„æµ‹è¯•ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ª Controller éœ€è¦æµ‹è¯• create/update/get ç­‰æ–¹æ³•ï¼Œå°±å¯ä»¥å°†è¿™å‡ ä¸ªæ–¹æ³•ä¾æ¬¡ç¼–å†™å†…éƒ¨ç±»åˆ†å¼€æè¿°ï¼Œç„¶åå†åœ¨ç±»ä¸­å¯¹äºä¸åŒçš„åˆ†æ”¯ç¼–å†™æµ‹è¯•æ–¹æ³•è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith</span>(MockitoExtension.class)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectsControllerTest</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">CreateObjects</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">someTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// some code</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UpdateObjects</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">someTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// some code</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">GetObjects</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">someTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// some code</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨ç¼–å†™ unit æµ‹è¯•çš„æ—¶å€™çš„ä¸€äº›å°å°çš„æ€»ç»“ï¼Œä»¥åä¼šç»§ç»­åŠ æ·±å¯¹äºæµ‹è¯•ä»£ç ç¼–å†™çš„å­¦ä¹ ï¼Œå®é™…ä¸Šæµ‹è¯•æ‰æ˜¯å†™ä»£ç è¿‡ç¨‹ä¸­æœ€é‡è¦çš„ä¸€ç¯ï¼Œå¯ä»¥ä¿éšœç³»ç»Ÿçš„åŠŸèƒ½çš„æ­£ç¡®æ€§ï¼Œè¿˜èƒ½ä¿æŠ¤é‡æ„ã€‚Junit5 ä¸º JAVA ç¨‹åºå‘˜æä¾›äº†æ›´å¼ºå¤§ã€æ–¹ä¾¿çš„æµ‹è¯•æ¡†æ¶ï¼Œå€¼å¾—æ·±å…¥ç ”ç©¶ä½¿ç”¨ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;h1 align=&quot;center&quot;&gt;Junit5 çš„ä¸€äº›å®é™…å¼€å‘ä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€ TDD å‘ ã€‘&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/blog/20200115/How-to-use-Junit5-to-test-you-java-application-elegantly/junit5.png&quot; alt=&quot;Junit&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Junit5" scheme="http://zhangjiaheng.cn/categories/Junit5/"/>
    
      <category term="Unit Test" scheme="http://zhangjiaheng.cn/categories/Junit5/Unit-Test/"/>
    
    
      <category term="Junit5" scheme="http://zhangjiaheng.cn/tags/Junit5/"/>
    
      <category term="Java åŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java-%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å•å…ƒæµ‹è¯•" scheme="http://zhangjiaheng.cn/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    
      <category term="unit test" scheme="http://zhangjiaheng.cn/tags/unit-test/"/>
    
  </entry>
  
  <entry>
    <title> è§£å†³@ResuestBodyä¸­çš„ JSON è‡ªåŠ¨è½¬åŒ–é Boolean ä¸º Boolean å€¼</title>
    <link href="http://zhangjiaheng.cn/blog/20191217/%E8%A7%A3%E5%86%B3-ResuestBody%E4%B8%AD%E7%9A%84-JSON-%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8C%96%E9%9D%9E-boolean-%E4%B8%BA-boolean-%E5%80%BC/"/>
    <id>http://zhangjiaheng.cn/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/</id>
    <published>2019-12-17T03:39:58.000Z</published>
    <updated>2019-12-17T06:44:08.492Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/code.jpg" alt="å°é¢"></p><a id="more"></a><h2 id="é—®é¢˜å‡ºç°"><a href="#é—®é¢˜å‡ºç°" class="headerlink" title="é—®é¢˜å‡ºç°"></a>é—®é¢˜å‡ºç°</h2><p>å½“æˆ‘ä»¬åœ¨ SpringBoot ä¸­å†™ API çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨<code>@RequestBody</code>æ³¨è§£ä¸€ä¸ªå‚æ•°å°†è¿™ä¸ªå¯¹è±¡æ ‡è®°ä¹‹åï¼Œç„¶åæˆ‘ä»¬åœ¨è¯·æ±‚å¤´ä½¿ç”¨<code>application/json</code>è°ƒç”¨è¿™ä¸ª APIï¼Œä¼ å…¥ JSON çš„ body ä½“ï¼Œå°±å¯ä»¥è‡ªåŠ¨çš„å°†æˆ‘ä»¬çš„ JSON è½¬åŒ–æˆ JAVA å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä½¿ç”¨çš„ JAVA å¯¹è±¡ä¸­æœ‰ä¸ª Boolean çš„å­—æ®µçš„æ—¶å€™ï¼Œæˆ‘çš„ JSON çš„ body å¯¹è¿™ä¸ªå¯¹è±¡ä¼ æ•°å€¼ã€â€Trueâ€ç­‰ç­‰å…¶ä»–å€¼å¾—æ—¶å€™ï¼Œå¾€å¾€ä¼šè¢«é»˜è®¤è½¬æˆç›¸åº”çš„ true æˆ–è€… falseã€‚ä¾‹å¦‚ä¼ å…¥{â€œableâ€:0}çš„æ—¶å€™ï¼Œæˆ‘çš„å¯¹è±¡ä¸­çš„ able å­—æ®µå°±æ˜¯ falseã€‚ä½†æ˜¯æˆ‘ä¸æƒ³è¦è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘å¸Œæœ›æ¥å£è°ƒç”¨è€…ä¼ çš„ç±»å‹éƒ½æ˜¯ Boolean ç±»å‹ã€‚</p><h2 id="Debug-æºç "><a href="#Debug-æºç " class="headerlink" title="Debug æºç "></a>Debug æºç </h2><p>é¦–å…ˆä½ è¦çŸ¥é“ï¼Œåœ¨ SpringBoot æˆ–è€… SpringMVC ä¸­å¯¹äºrequest å’Œ response çš„å¤„ç†æ˜¯ä½¿ç”¨çš„æ¶ˆæ¯è½¬æ¢å™¨å¤„ç†çš„ã€‚æ‰€ä»¥æˆ‘åœ¨ debug æºç çš„æ—¶å€™å‘ç°ï¼ŒSpringBoot ä½¿ç”¨<code>MappingJackson2HttpMessageConverter</code>å¤„ç† JSON è½¬åŒ–æˆå¯¹è±¡ï¼Œç„¶åå®é™…çš„è½¬åŒ–æ–¹æ³•<code>MappingJackson2HttpMessageConverter</code>æ²¡æœ‰é‡å†™ï¼Œè€Œæ˜¯äº¤ç»™çˆ¶ç±»<code>AbstractJackson2HttpMessageConverter</code>çš„æ–¹æ³•ï¼Œåœ¨è¯¥ç±»çš„ç¬¬239 è¡Œä¼šå‘ç°å®é™…ä¸Šæ˜¯ä½¿ç”¨çš„ <code>this.objectMapper.readValue(inputMessage.getBody(), javaType);</code> å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬åŒ–æˆ JAVA å¯¹è±¡ã€‚å†è¿›å»çœ‹ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">readValue</span><span class="params">(InputStream src, JavaType valueType)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException, JsonParseException, JsonMappingException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (T) _readMapAndClose(_jsonFactory.createParser(src), valueType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œ<code>_readMapAndClose</code>æ–¹æ³•æ˜¯è¿™æ ·çš„(é‡ç‚¹çœ‹ä¸‹ 4013 è¡Œ)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">_readMapAndClose</span><span class="params">(JsonParser p0, JavaType valueType)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">try</span> (JsonParser p = p0) &#123;</span><br><span class="line">    Object result;</span><br><span class="line">    JsonToken t = _initForReading(p, valueType);</span><br><span class="line">    <span class="keyword">final</span> DeserializationConfig cfg = getDeserializationConfig();</span><br><span class="line">    <span class="keyword">final</span> DeserializationContext ctxt = createDeserializationContext(p, cfg);</span><br><span class="line">    <span class="keyword">if</span> (t == JsonToken.VALUE_NULL) &#123;</span><br><span class="line">      <span class="comment">// Ask JsonDeserializer what 'null value' to use:</span></span><br><span class="line">      result = _findRootDeserializer(ctxt, valueType).getNullValue(ctxt);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == JsonToken.END_ARRAY || t == JsonToken.END_OBJECT) &#123;</span><br><span class="line">      result = <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      JsonDeserializer&lt;Object&gt; deser = _findRootDeserializer(ctxt, valueType);</span><br><span class="line">      <span class="keyword">if</span> (cfg.useRootWrapping()) &#123;</span><br><span class="line">        result = _unwrapAndDeserialize(p, ctxt, cfg, valueType, deser);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = deser.deserialize(p, ctxt);</span><br><span class="line">      &#125;</span><br><span class="line">      ctxt.checkUnresolvedObjectId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cfg.isEnabled(DeserializationFeature.FAIL_ON_TRAILING_TOKENS)) &#123;</span><br><span class="line">      _verifyNoTrailingTokens(p, ctxt, valueType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç <code>result = deser.deserialize(p, ctxt);</code>ä½¿ç”¨ä¸€ä¸ªååºåˆ—åŒ–å¯¹è±¡è¿›è¡Œ JSON çš„ååºåˆ—åŒ–ï¼Œè¿™é‡Œå¦‚æœä¼ å…¥çš„æ˜¯æ•°å­—è½¬åŒ–æˆ Booleançš„è¯å°±æ˜¯ç”¨çš„æ˜¯<code>NumberDeserializers</code>ä¸­çš„<code>BooleanDeserializer</code>ï¼Œè€Œå®ƒçš„<code>deserialize</code>æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  JsonToken t = p.getCurrentToken();</span><br><span class="line">  <span class="keyword">if</span> (t == JsonToken.VALUE_TRUE) &#123;</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (t == JsonToken.VALUE_FALSE) &#123;</span><br><span class="line">    <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _parseBoolean(p, ctxt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å<code>_parseBoolean</code>ä¸­å°†å…¶ä»–çš„æ•°å€¼è½¬åŒ–æˆ Booleanã€‚</p><h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª debug çš„å…¨è¿‡ç¨‹äº†ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯<code>AbstractJackson2HttpMessageConverter</code>ä¸­ä¼šé»˜è®¤åœ°å°†é Boolean çš„æ•°å€¼è½¬åŒ–æˆ Booleanã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>é¦–å…ˆä½¿ç”¨æœç´¢å¼•æ“è§£å†³ğŸ˜¹ç„¶åæœç´¢ä¸åˆ°ã€‚ã€‚ã€‚ç„¶åæˆ‘åœ¨ StackOverFlow ä¸Šæäº†ä¸€ä¸ª<a href="https://stackoverflow.com/questions/59353379/springboot-atomically-convert-integer-to-boolean-with-requestbody-annotation-h/59355180#59355180" target="_blank" rel="noopener">é—®é¢˜ &lt;click</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹è¿™ç§æ–¹å¼ï¼š</p><ul><li><p>è‡ªå®šä¹‰è‡ªå·±çš„ååºåˆ—åŒ–å·¥å…·ï¼Œç„¶åè®© Spring å»ç®¡ç†è¿™ä¸ªé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleModule <span class="title">addDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleModule().addDeserializer(Boolean.class, <span class="keyword">new</span> MyDeserializer());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDeserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Boolean <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            JsonToken t = p.getCurrentToken();</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_TRUE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_FALSE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_STRING) &#123;</span><br><span class="line">                String value = p.getValueAsString();</span><br><span class="line">                <span class="keyword">return</span> value.equals(<span class="string">"true"</span>) ? <span class="keyword">true</span> : value.equals(<span class="string">"false"</span>) ? <span class="keyword">false</span> : <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·å°±å°†æ‰€æœ‰ API ä¸­ï¼Œå­˜åœ¨ Boolean çš„æƒ…å†µéƒ½å¤„ç†æ‰äº†ã€‚åªèƒ½æ¥å— Boolean å€¼æˆ–è€…å­—ç¬¦ä¸²çš„â€trueâ€æˆ–è€…â€falseâ€ã€‚</p><p>ä½†æ˜¯ä½œä¸ºä¸€ä¸ªä¼˜ç§€(pa ma fan)çš„ğŸ‘©â€ğŸ’»coderğŸ˜·ï¼Œæˆ‘ä»¬åº”è¯¥ä¿è¯è‡ªå·±ä¿®æ”¹çš„ä»£ç ä¸ä¼šå½±å“åˆ°å…¶ä»–äººæˆ–è€…å…¶ä»–æ¨¡å—ï¼Œéšä¾¿çš„ä¿®æ”¹å…¨å±€çš„é…ç½®ä¸å¤ªå¥½ã€‚æ‰€ä»¥æˆ‘å¯»æ‰¾åˆ°äº†ä¸€ä¸ªæ›´åŠ à­§(à¹‘â€¢Ì€â—¡â€¢Ìà¹‘)à«­çš„æ–¹å¼ â€”â€” ç¼–å†™ä¸€ä¸ªè¯¥å±æ€§çš„ set æ–¹æ³•å³å¯ã€‚</p><p>å› ä¸ºDeserializerä¼šå°†è¯»å–åˆ°çš„ JSON çš„å€¼é€šè¿‡ set æ–¹æ³•å¡«å…¥å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAble</span><span class="params">(Object value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">    able = (Boolean) value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"true"</span>.equals(value)) &#123;</span><br><span class="line">    able = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆã€‚ä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªè¿‡ç¨‹ debug çš„æ—¶å€™æ˜¯æœ€æœ‰æ„æ€çš„ï¼Œå¯ä»¥äº†è§£åˆ°å®ƒåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šéƒ½åšäº†äº›ä»€ä¹ˆäº‹æƒ…ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/code.jpg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/tags/SpringBoot/"/>
    
      <category term="Spring" scheme="http://zhangjiaheng.cn/tags/Spring/"/>
    
      <category term="SpringMVC" scheme="http://zhangjiaheng.cn/tags/SpringMVC/"/>
    
      <category term="JSON" scheme="http://zhangjiaheng.cn/tags/JSON/"/>
    
      <category term="converter" scheme="http://zhangjiaheng.cn/tags/converter/"/>
    
      <category term="RequestBody" scheme="http://zhangjiaheng.cn/tags/RequestBody/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨ SpringCloud å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½² Docker å¯åŠ¨</title>
    <link href="http://zhangjiaheng.cn/blog/20191211/%E5%A6%82%E4%BD%95%E5%9C%A8-SpringCloud-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2-docker-%E5%90%AF%E5%8A%A8/"/>
    <id>http://zhangjiaheng.cn/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/</id>
    <published>2019-12-11T09:26:46.000Z</published>
    <updated>2019-12-11T10:13:18.063Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/docker.jpg" alt=""></p><a id="more"></a><h2 id="å¦‚ä½•ç”¨-docker-ä¸€é”®å¯åŠ¨-SpringCloud-å¾®æœåŠ¡ï¼Ÿ"><a href="#å¦‚ä½•ç”¨-docker-ä¸€é”®å¯åŠ¨-SpringCloud-å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç”¨ docker ä¸€é”®å¯åŠ¨ SpringCloud å¾®æœåŠ¡ï¼Ÿ"></a>å¦‚ä½•ç”¨ docker ä¸€é”®å¯åŠ¨ SpringCloud å¾®æœåŠ¡ï¼Ÿ</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-docker-å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-docker-å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ docker å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ docker å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ</h3><p>åŸå§‹ä¼ ç»Ÿçš„éƒ¨ç½²æ–¹å¼ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å¤ªå¤šé—®é¢˜ï¼Œæ¯”å¦‚å½“ä½ çš„æœåŠ¡åœ¨æµ‹è¯•ç¯å¢ƒæ­£è¿è¡Œçš„æ­£å¸¸ï¼Œä½†æ˜¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå°±ä¼šå‡ºç°ä¸€å¤§å †æœªçŸ¥é—®é¢˜ï¼Œä½ æŸ¥äº†å¥½ä¹…ï¼Œdebug ä»£ç ä¹‹åå‘ç°ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼Œå¯¼è‡´äº§ç”Ÿäº†ç›®å‰è¿™ä¹ˆä¸€å¤§ä¸²é—®é¢˜ï¼Œæµªè´¹äº†ä½ çš„æ—¶é—´ï¼Œæ‹–å»¶äº†é¡¹ç›®ä¸Šçº¿çš„æ—¶é—´ï¼Œç”šè‡³äº§ç”Ÿäº†ä¸¥é‡çš„ç”Ÿäº§äº‹æ•…ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæœºåˆ¶æ¥ä¿è¯æˆ‘ä»¬çš„ä»£ç åœ¨éƒ¨ç½²åˆ°æœ¬åœ°ã€æµ‹è¯•ä»¥åŠç”Ÿäº§çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸ä¼šå—åˆ°ç¯å¢ƒä¸ä¸€è‡´çš„å½±å“è€Œå¯¼è‡´æˆ‘ä»¬éƒ¨ç½²å¤±è´¥ï¼</p><p>è¿˜æœ‰å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker æ‰“åŒ…é•œåƒç„¶åä½¿ç”¨ docker-compose ç¼–æ’å®¹å™¨ä¸€é”®å¯åŠ¨ï¼Œè®©è¿ç»´è‡ªåŠ¨åŒ–ï¼Œæå¤§çš„èŠ‚çœæˆ‘ä»¬çš„å·¥ä½œæ—¶é—´ã€‚</p><h3 id="åœ¨-Spring-Cloud-å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨-DOCKERï¼Ÿ"><a href="#åœ¨-Spring-Cloud-å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨-DOCKERï¼Ÿ" class="headerlink" title="åœ¨ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ DOCKERï¼Ÿ"></a>åœ¨ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ DOCKERï¼Ÿ</h3><h4 id="é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ"><a href="#é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ"></a>é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ</h4><p>ä¾‹å¦‚æˆ‘çš„<a href="https://github.com/Fatezhang/scaffold-cloud/blob/a6dd55772f59eecd99b099e013ce2ef4470cec91/scaffold-eureka/pom.xml#L43" target="_blank" rel="noopener"> Scaffold-Cloud é¡¹ç›®ä¸­çš„ eureka æœåŠ¡çš„ pom æ–‡ä»¶</a>(ç‚¹å‡»é“¾æ¥è·³è½¬åˆ° github ä»¥ä¸‹ä»£ç è¡Œ)å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>scaffold-cloud/$&#123;project.artifactId&#125;:$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">forceTags</span>&gt;</span>true<span class="tag">&lt;/<span class="name">forceTags</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">baseImage</span>&gt;</span>java<span class="tag">&lt;/<span class="name">baseImage</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå…¶ä»–æ¨¡å—ä¹Ÿä¸€æ ·ï¼Œåœ¨ pom æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸Š maven æ’ä»¶ï¼Œå®Œæ•´é¡¹ç›®ä»£ç å¦‚ä¸‹(è§‰å¾—å¥½ç”¨ starâœ¨ä¸€ä¸‹å“¦)ï¼š</p><p><a href="https://github.com/Fatezhang/scaffold-cloud" target="_blank" rel="noopener">https://github.com/Fatezhang/scaffold-cloud/</a></p><h4 id="ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º-docker-é•œåƒ"><a href="#ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º-docker-é•œåƒ" class="headerlink" title="ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º docker é•œåƒ"></a>ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º docker é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo "============start to package with maven and recreate docker image=============="</span><br><span class="line"></span><br><span class="line">SERVICE_FOLDERS=(</span><br><span class="line">  scaffold-eureka</span><br><span class="line">  scaffold-zuul</span><br><span class="line">  scaffold-tx-manager</span><br><span class="line">  scaffold-business/scaffold-business-sys-service</span><br><span class="line">  scaffold-business/scaffold-business-job-service</span><br><span class="line">  scaffold-business/scaffold-business-thirdparty-service</span><br><span class="line">  scaffold-route/scaffold-route-app</span><br><span class="line">  scaffold-route/scaffold-route-openapi</span><br><span class="line">  scaffold-route/scaffold-route-operate</span><br><span class="line">)</span><br><span class="line">path=</span><br><span class="line">for (( i = 0; i &lt; $&#123;#SERVICE_FOLDERS[@]&#125;; i++ )); do</span><br><span class="line">    path=$&#123;SERVICE_FOLDERS[$&#123;i&#125;]&#125;</span><br><span class="line">    echo "è¿›å…¥ç›®å½• &gt;&gt;&gt;&gt; cd $&#123;path&#125;"</span><br><span class="line">    cd "$&#123;path&#125;" || exit</span><br><span class="line">    pwd</span><br><span class="line">    mvn clean package docker:build -Pdocker</span><br><span class="line">    cd - || exit</span><br><span class="line">done</span><br><span class="line">echo "============                      create end                     =============="</span><br></pre></td></tr></table></figure><h4 id="ç¼–æ’-docker-compose-å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡"><a href="#ç¼–æ’-docker-compose-å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡" class="headerlink" title="ç¼–æ’ docker-compose å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡"></a>ç¼–æ’ docker-compose å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡</h4><p>ç„¶ååªéœ€è¦å°†æ‰€æœ‰é•œåƒç¼–æ’åœ¨ docker-compose.yml æ–‡ä»¶ä¸­å³å¯ï¼Œå…¶ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä»¥è®¿é—®åˆ°å¯¹æ–¹æœåŠ¡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">scaffold-cloud</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ docker-compose.yml æ–‡ä»¶å¦‚ä¸‹ï¼ˆæ³¨æ„æœ‰ä¸€ä¸ª<code>wait-for-it.sh</code>ï¼‰ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.7"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  micro-sys:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="attr">tx_manager:7970</span> <span class="string">'java -jar scaffold-business-sys-service-1.0-SNAPSHOT.jar'</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">scaffold-cloud/scaffold-business-sys-service:1.0-SNAPSHOT</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/tmp:/tmp</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8750</span><span class="string">:8750</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">eureka</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">mysql</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">rmqbroker</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">rmqnamesrv</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">tx_manager</span></span><br><span class="line"><span class="attr">  route-operate:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="attr">micro-sys:8750</span> <span class="string">'java -jar scaffold-route-operate-1.0-SNAPSHOT.jar'</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">scaffold-cloud/scaffold-route-operate:1.0-SNAPSHOT</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/tmp:/tmp</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8850</span><span class="string">:8850</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">micro-sys</span></span><br><span class="line"><span class="attr">  eureka:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">java</span> <span class="bullet">-jar</span> <span class="string">scaffold-eureka-1.0-SNAPSHOT.jar</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">scaffold-cloud/scaffold-eureka:1.0-SNAPSHOT</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/tmp:/tmp</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8761</span><span class="string">:8761</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">  zuul:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="attr">eureka:8761</span> <span class="string">'java -jar scaffold-zuul-1.0-SNAPSHOT.jar'</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">scaffold-cloud/scaffold-zuul:1.0-SNAPSHOT</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/tmp:/tmp</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8861</span><span class="string">:8861</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">  tx_manager:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="attr">mysql:3306,redis:6379</span> <span class="string">'java -jar scaffold-txmanager-1.0-SNAPSHOT.jar'</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">scaffold-cloud/scaffold-txmanager:1.0-SNAPSHOT</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/tmp:/tmp</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8890</span><span class="string">:8890</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">7970</span><span class="string">:7970</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">mysql</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">redis</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">eureka</span></span><br><span class="line"><span class="attr">  mysql:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">mysql/mysql-server:5.7</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./mysql/data:/var/lib/mysql</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./mysql/config/my.cnf:/etc/my.cnf</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d/</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">redis:latest</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">redis-server</span> <span class="bullet">--requirepass</span> <span class="string">pwd8ok8</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">  rmqnamesrv:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">foxiswho/rocketmq:server-4.5.2</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">rmqnamesrv</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">9876</span><span class="string">:9876</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./rmq/logs:/opt/logs</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./rmq/store:/opt/store</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      JAVA_OPT_EXT:</span> <span class="string">"-Duser.home=/opt -Xms128m -Xmx128m -Xmn128m"</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">  rmqbroker:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">foxiswho/rocketmq:broker-4.5.2</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">rmqbroker</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">10909</span><span class="string">:10909</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">10911</span><span class="string">:10911</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./rmq/logs:/opt/logs</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./rmq/store:/opt/store</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">./rmq/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      JAVA_OPT_EXT:</span> <span class="string">"-Duser.home=/opt -server -Xms128m -Xmx128m -Xmn128m"</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/bash","mqbroker","-c","/etc/rocketmq/broker.conf","-n","rmqnamesrv:9876","autoCreateTopicEnable=true"]</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">rmqnamesrv</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  rmqconsole:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">styletang/rocketmq-console-ng</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">rmqconsole</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8180</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      JAVA_OPTS:</span> <span class="string">"-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"</span></span><br><span class="line"><span class="attr">    depends_on:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">rmqnamesrv</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">  scaffold-cloud:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">    driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure></p><h4 id="å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ"><a href="#å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ"></a>å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ</h4><p>æˆ‘ä»¬çŸ¥é“ï¼ŒSpringCloud å¾®æœåŠ¡ä¸­å„ä¸ªæœåŠ¡ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ tx-manager æœåŠ¡éœ€è¦ç­‰å¾… MySQL å’Œ Redis éƒ½å¯åŠ¨å®Œæˆä¹‹åæ‰èƒ½å¤Ÿé¡ºåˆ©å¯åŠ¨ï¼Œä½†æ˜¯ docker-compose.yml æ–‡ä»¶ä¸­çš„ <code>depends_on</code>åªèƒ½ç­‰å¾… docker å®¹å™¨å¯åŠ¨æˆåŠŸï¼Œè€Œä¸èƒ½ç­‰å¾… docker å®¹å™¨ä¸­çš„æœåŠ¡å¯åŠ¨å®Œæˆï¼</p><p>docker å®˜æ–¹ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨wait-for-it.shè„šæœ¬ï¼Œåœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œè„šæœ¬ï¼Œåˆ¤æ–­ä¾èµ–çš„æœåŠ¡å’Œç«¯å£æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œç„¶åå†æ‰§è¡Œè‡ªå·±æœåŠ¡çš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·å»å†™ä¸€ä¸ªè„šæœ¬ï¼š<code>wait-for-it.sh</code>å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2223</span></span><br><span class="line">: $&#123;SLEEP_SECOND:=2&#125;</span><br><span class="line"></span><br><span class="line">wait_for() &#123;</span><br><span class="line">  echo Waiting for $1 on port $2... ...</span><br><span class="line"><span class="meta">  #</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2086</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2188</span></span><br><span class="line">  while ! &lt;/dev/tcp/$1/$2; do</span><br><span class="line">    echo Waiting for $1 on port $2... ...</span><br><span class="line">    sleep $SLEEP_SECOND</span><br><span class="line">  done</span><br><span class="line">  echo Server:"$1" on port:"$2" is running... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SER_STRS=$1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2207</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2006</span></span><br><span class="line">SERVICES_PORTS=($(echo "$SER_STRS" | tr ',' ' '))</span><br><span class="line"></span><br><span class="line">THEN_COMMAND=$2</span><br><span class="line"></span><br><span class="line">for ((i = 0; i &lt; $&#123;#SERVICES_PORTS[@]&#125;; i++)); do</span><br><span class="line">  SERVICE_PORT=$&#123;SERVICES_PORTS[$&#123;i&#125;]&#125;</span><br><span class="line"><span class="meta">  #</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2207</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2006</span></span><br><span class="line">  array=($(echo "$SERVICE_PORT" | tr ':' ' '))</span><br><span class="line">  servername=$&#123;array[0]&#125;</span><br><span class="line">  serverport=$&#123;array[1]&#125;</span><br><span class="line">  wait_for "$servername" "$&#123;serverport&#125;"</span><br><span class="line">done</span><br><span class="line">echo "start to run command: $THEN_COMMAND"</span><br><span class="line"><span class="meta">#</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2004</span></span><br><span class="line">if [ "$THEN_COMMAND" ]; then</span><br><span class="line">  eval "$THEN_COMMAND"</span><br><span class="line">else</span><br><span class="line"><span class="meta">  #</span><span class="bash"> shellcheck <span class="built_in">disable</span>=SC2102</span></span><br><span class="line">  echo command: [$THEN_COMMAND] is invalid... ...</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è„šæœ¬çš„ä½œç”¨å°±æ˜¯ç­‰å¾…å¯åŠ¨çš„æœåŠ¡ä»¥åŠç«¯å£å¯åŠ¨æˆåŠŸï¼Œæ²¡æœ‰æˆåŠŸçš„è¯å°±ç»§ç»­ wait ç­‰å¾…ï¼Œé»˜è®¤ç­‰å¾… 2 ç§’ï¼Œå¯åŠ¨æˆåŠŸçš„è¯å°±æ‰§è¡Œè‡ªå·±çš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tx_manager:</span></span><br><span class="line"><span class="attr">    entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="attr">mysql:3306,redis:6379</span> <span class="string">'java -jar scaffold-txmanager-1.0-SNAPSHOT.jar'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ docker å¯åŠ¨ SpringCloud å¾®æœåŠ¡çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œå¸Œæœ›èƒ½å¤Ÿç»™æˆ‘çš„é¡¹ç›®<a href="https://github.com/Fatezhang/scaffold-cloud/ç‚¹ä¸ªstar" target="_blank" rel="noopener">https://github.com/Fatezhang/scaffold-cloud/ç‚¹ä¸ªstar</a> å“¦~</p><p>è€Œä¸”ä½ ä¹Ÿå¯ä»¥ç»™æˆ‘æ issueï¼Œæ PRï¼Œæ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œä¸€èµ·å¼€å‘~</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/docker.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/categories/SpringCloud/"/>
    
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/tags/SpringCloud/"/>
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="springboot" scheme="http://zhangjiaheng.cn/tags/springboot/"/>
    
      <category term="spring" scheme="http://zhangjiaheng.cn/tags/spring/"/>
    
      <category term="docker" scheme="http://zhangjiaheng.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Scaffold-Cloud â€”â€” SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ</title>
    <link href="http://zhangjiaheng.cn/blog/20191025/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"/>
    <id>http://zhangjiaheng.cn/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/</id>
    <published>2019-10-25T05:42:24.000Z</published>
    <updated>2020-12-27T03:00:24.923Z</updated>
    
    <content type="html"><![CDATA[<p><center><u style="font-size=16px;"><a href="/">Scaffold-Cloud: SpringCloudå¾®æœåŠ¡è„šæ‰‹æ¶</a></u></center> <a href="https://mubu.com/doc/6NZlNw3DIw" target="_blank" rel="noopener">å¹•å¸ƒ</a><br>Scaffold-Cloud æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¼€å‘è€…å­¦ä¹ çš„ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®è„šæ‰‹æ¶ã€‚é¡¹ç›®æœŸæœ›é›†æˆå¤§éƒ¨åˆ†ç›®å‰äº’è”ç½‘å…¬å¸ä½¿ç”¨çš„ä¸»æµçš„Spring-Cloudå¾®æœåŠ¡ç›¸å…³å·¥å…·å’ŒæœåŠ¡ã€‚å¹¶ç»“åˆä¸€äº›å®é™…çš„ä¸šåŠ¡å¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œå¦‚ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—åˆ†æç­‰ç­‰ï¼Œç„¶ååŠ å…¥ CI/CD å¹¶å¼•å…¥ docker éƒ¨ç½²ã€‚</p><p>Scaffold-Cloud åŸºäº SpringCloud Netflix å…¨å®¶æ¡¶è¿›è¡Œå¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºï¼Œæ‰€ä»¥åœ¨è¿™ä¹‹å‰ï¼Œä½¿ç”¨ Scaffold-Cloud éœ€è¦å…ˆäº†è§£ä¸‹ SpringCloud ä»¥åŠ Netflix å·¥å…·å…¨å®¶æ¡¶ã€‚</p><p><img src="/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/netflix.png" alt=""></p><p><center><u style="font-size=6px; color:gray">Sorry, NetFlix is not available in your country yet.</u></center><br><a id="more"></a></p><h2 id="Spring-Cloud-ä»‹ç»"><a href="#Spring-Cloud-ä»‹ç»" class="headerlink" title="Spring Cloud ä»‹ç»"></a>Spring Cloud ä»‹ç»</h2><h4 id="ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡"><a href="#ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡" class="headerlink" title="ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡"></a>ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡</h4><p>åœ¨æ—©æœŸçš„ä¼ä¸šä¸­ï¼Œé¡¹ç›®åŸºæœ¬ä¸Šéƒ½æ˜¯å•ä½“åº”ç”¨ï¼Œå°†ä¸€ä¸ªç½‘ç«™éƒ¨ç½²åœ¨ä¸€å°å•ç‹¬çš„æœåŠ¡å™¨ä¸Šå¯¹ç”¨æˆ·æä¾›æœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·çš„æœåŠ¡æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå½“æœåŠ¡å™¨æ–­ç”µæˆ–è€…æœåŠ¡è¿›ç¨‹æŒ‚æ‰ï¼Œç”¨æˆ·ç›´æ¥å°±æ— æ³•è®¿é—®ã€‚åæ¥æ¼”è¿›å‡ºé›†ç¾¤æœåŠ¡ï¼Œå°†åŒæ ·çš„æœåŠ¡åœ¨å¤šå°æœåŠ¡å™¨åˆ†åˆ«éƒ¨ç½²ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡ç­‰æ‰‹æ®µè®©æœåŠ¡å¯¹äºç”¨æˆ·æ¥è¯´çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™æ ·å½“ä¸€å°æœåŠ¡å™¨å¤¯æœºè‡³å°‘è¿˜æœ‰å…¶ä»–çš„æœåŠ¡å™¨æä¾›ç›¸åŒçš„åº”ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå½“ä¼ä¸šçº§æœåŠ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚çš„æ—¶å€™ï¼Œé¡¹ç›®å˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œæœ‰æ—¶ç”šè‡³å½±å“åˆ°äº†æœåŠ¡çš„éƒ¨ç½²ï¼Œè¿™ä¸ªæ—¶å€™å°±åº”è¯¥å°†åºå¤§çš„æœåŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ç³»ç»Ÿï¼Œéƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·çš„æœåŠ¡å½“é­é‡é«˜å¹¶å‘è®¿é—®çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿå°†è¯·æ±‚å‹åŠ›åˆ†æ‘Šåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼ã€‚</p><p>è€Œå½“ä¼ä¸šéœ€è¦å¼€å¯ä¸€ä¸ªæ–°çš„é¡¹ç›®æ—¶ï¼Œä¸ºäº†é¿å…é‡å¤é€ è½®å­ï¼Œå¾€å¾€ä¸€äº›å¯å¤ç”¨çš„æ¨¡å—ä¼šè¢«æ‹†åˆ†å‡ºæ¥ä½œä¸ºä¸€ä¸ªå¾®å°çš„ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç‹¬ç«‹çš„å¼€å‘ã€è®¾è®¡ã€è¿è¡Œå’Œè¿ç»´ï¼Œåªéœ€è¦ä½¿ç”¨ ESBä¼ä¸šæœåŠ¡æ€»çº¿å°†æ‰€æœ‰æœåŠ¡æ•´åˆå¹¶æä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œå°±èƒ½å¤Ÿå¤ç”¨ï¼Œè¿™å°±æ˜¯ SOAã€‚</p><p>è€Œå¾®æœåŠ¡æ˜¯å¯¹ä»¥ä¸ŠæœåŠ¡æ¶æ„çš„æœ€ç»ˆæ¼”è¿›ç»“æ„ï¼šå°†æœåŠ¡åˆ‡åˆ†æˆå¤šä¸ªå¾®å°çš„åº”ç”¨ï¼Œæä¾›ç»Ÿä¸€çš„æœåŠ¡è®¿é—®åè®®HTTP(SpringCloud)/TCP(Dubbo)ï¼Œå¼ºè°ƒè¿è¡Œæ—¶çš„åˆ†æ•£è§£è€¦ï¼Œåœ¨ä¸šåŠ¡ä¸Šä¹Ÿæœ‰ç€é«˜åº¦çš„æŠ½ç¦»ã€‚</p><blockquote><p><code>å¾®æœåŠ¡æ¶æ„é£æ ¼</code><strong>æ˜¯ä¸€ç§å°†<code>ä¸€ä¸ªå•ä¸€åº”ç”¨ç¨‹åº</code>å¼€å‘ä¸º<code>ä¸€ç»„å°å‹æœåŠ¡</code>çš„æ–¹æ³•ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶</strong>(é€šå¸¸ä½¿ç”¨HTTPèµ„æºAPI)ã€‚è¿™äº›<strong>æœåŠ¡å›´ç»•<code>ä¸šåŠ¡èƒ½åŠ›</code>æ„å»º</strong>ï¼Œå¹¶ä¸”å¯é€šè¿‡<strong>å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²</strong>ã€‚è¿™äº›æœåŠ¡å…±ç”¨ä¸€ä¸ª<strong>æœ€å°å‹çš„é›†ä¸­å¼çš„ç®¡ç†</strong>ï¼ŒæœåŠ¡å¯ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨ä¸åŒçš„<strong>æ•°æ®å­˜å‚¨æŠ€æœ¯</strong>ã€‚<br><img src="/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/microservice.webp" alt=""><br>â€”â€” Martin Fowler</p></blockquote><p><strong>ä½†æ˜¯æ‹†åˆ†æˆè¿™ä¹ˆå¾®å°çš„å¾®æœåŠ¡ä¸€å®šä¼šç¢°åˆ°å„ç§å„æ ·çš„é—®é¢˜â€”â€”å¦‚ä½•æ‹†åˆ†ï¼ŸæœåŠ¡ä¹‹é—´å¦‚ä½•å‘ç°ï¼Ÿå¦‚ä½•æˆæƒï¼Ÿå¦‚ä½•åšè´Ÿè½½å‡è¡¡ï¼Ÿå¦‚ä½•ç®¡ç†å¤šæœåŠ¡é…ç½®ï¼Ÿå¦‚ä½•è·Ÿè¸ªè°ƒç”¨é“¾è·¯ï¼Ÿå¦‚ä½•å®æ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€ç­‰ç­‰â€¦ â€¦ SpringCloud å°±æ˜¯ä»¥ä¸Šä¸€ç³»åˆ—é—®é¢˜çš„ Solverã€‚å®ƒæä¾›äº†ä¸€æ•´å¥—çš„è§£å†³æ–¹æ¡ˆï¼</strong></p><h4 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h4><p>é¦–å…ˆï¼ŒSpringCloud å¹¶ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ä¸ªå¾®æœåŠ¡çš„è§„èŒƒï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªå¾®æœåŠ¡å·¥å…·é›†åˆã€‚</p><h5 id="SpringCloudç‰¹ç‚¹ï¼š"><a href="#SpringCloudç‰¹ç‚¹ï¼š" class="headerlink" title="SpringCloudç‰¹ç‚¹ï¼š"></a>SpringCloudç‰¹ç‚¹ï¼š</h5><ul><li>çº¦å®šå¤§äºé…ç½®ï¼ŒåŸºäº SpringBoot</li><li>å¼€å‘éƒ¨ç½²äºå„ç§ç¯å¢ƒï¼ŒAWSï¼Œé˜¿é‡Œäº‘ï¼ŒPC ç­‰</li><li>éšè—ç»„ä»¶å¤æ‚æ€§ï¼Œå£°æ˜å¼é…ç½®ï¼Œæ—  xml</li><li>å¼€ç®±å³ç”¨ï¼Œå¿«é€Ÿå¯åŠ¨</li><li>ä¸°å¯Œçš„è½»é‡çº§ç»„ä»¶</li><li>çµæ´»é€‰å‹ï¼Œå¦‚æ³¨å†Œå‘ç°å¯ç”¨ eurekaï¼Œzookeeper æˆ–è€… Redis</li></ul><h5 id="SpringCloud-å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§"><a href="#SpringCloud-å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§" class="headerlink" title="SpringCloud å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§"></a>SpringCloud å„ç‰ˆæœ¬ç»„ä»¶åŠ<a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">ç‰ˆæœ¬å…¼å®¹æ€§</a></h5><table><thead><tr><th>Component</th><th>Edgware.SR6</th><th>Greenwich.SR2</th><th>Greenwich.BUILD-SNAPSHOT</th></tr></thead><tbody><tr><td>spring-cloud-aws</td><td>1.2.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-bus</td><td>1.3.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-cli</td><td>1.4.1.RELEASE</td><td>2.0.0.RELEASE</td><td>2.0.1.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-commons</td><td>1.3.6.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-contract</td><td>1.2.7.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-config</td><td>1.4.7.RELEASE</td><td>2.1.3.RELEASE</td><td>2.1.4.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-netflix</td><td>1.4.7.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-security</td><td>1.2.4.RELEASE</td><td>2.1.3.RELEASE</td><td>2.1.4.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-cloudfoundry</td><td>1.1.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-consul</td><td>1.3.6.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-sleuth</td><td>1.3.6.RELEASE</td><td>2.1.1.RELEASE</td><td>2.1.2.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-stream</td><td>Ditmars.SR5</td><td>Fishtown.SR3</td><td>Fishtown.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-zookeeper</td><td>1.2.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-boot</td><td>1.5.21.RELEASE</td><td>2.1.5.RELEASE</td><td>2.1.8.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-task</td><td>1.2.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-vault</td><td>1.1.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-gateway</td><td>1.0.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-openfeign</td><td></td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-function</td><td>1.0.2.RELEASE</td><td>2.0.2.RELEASE</td><td>2.0.3.BUILD-SNAPSHOT</td></tr></tbody></table><h3 id="SpringCloud-å…¨å®¶æ¡¶"><a href="#SpringCloud-å…¨å®¶æ¡¶" class="headerlink" title="SpringCloud å…¨å®¶æ¡¶"></a><a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">SpringCloud å…¨å®¶æ¡¶</a></h3><h4 id="spring-cloud-netflix"><a href="#spring-cloud-netflix" class="headerlink" title="spring-cloud-netflix"></a>spring-cloud-netflix</h4><h5 id="eureka-åŸç†ï¼š"><a href="#eureka-åŸç†ï¼š" class="headerlink" title="eureka åŸç†ï¼š"></a>eureka åŸç†ï¼š</h5><ul><li>æœåŠ¡å¯åŠ¨æ—¶ï¼Œè°ƒç”¨ eureka æ¥å£è¿›è¡Œæ³¨å†Œï¼ŒEureka Server ä¼šå­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ŒIPã€ç«¯å£ã€å¾®æœåŠ¡åç§°ç­‰</li><li>å¾®æœåŠ¡å¯åŠ¨ä¹‹åï¼Œä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³è¿›è¡Œâ€œç»­ç§Ÿâ€ï¼Œé»˜è®¤ 30 ç§’</li><li>å¦‚æœä¸€å®šæ—¶é—´æ²¡æœ‰â€œç»­ç§Ÿâ€ï¼Œé»˜è®¤ 90 ç§’ï¼Œå°±é”€æ¯å¾®æœåŠ¡å®ä¾‹</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEureka Server ä¹Ÿæ˜¯ä¸€ä¸ª Eureka Clientï¼Œé›†ç¾¤ä¸‹ä¼šäº’ç›¸å¤åˆ¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯è¿›è¡ŒåŒæ­¥</li><li>Eureka Client ä¼šç¼“å­˜æ³¨å†Œè¡¨çš„ä¿¡æ¯ï¼Œå‡å°‘Eureka Server çš„è¯·æ±‚å‹åŠ›ï¼Œä»¥åŠå®¹ç¾</li></ul><h4 id="spring-cloud-openfeign"><a href="#spring-cloud-openfeign" class="headerlink" title="spring-cloud-openfeign"></a>spring-cloud-openfeign</h4><h4 id="spring-cloud-zuul-å¾®æœåŠ¡ç½‘å…³"><a href="#spring-cloud-zuul-å¾®æœåŠ¡ç½‘å…³" class="headerlink" title="spring-cloud-zuul å¾®æœåŠ¡ç½‘å…³"></a>spring-cloud-zuul å¾®æœåŠ¡ç½‘å…³</h4><h4 id="spring-cloud-config-é…ç½®ä¸­å¿ƒ"><a href="#spring-cloud-config-é…ç½®ä¸­å¿ƒ" class="headerlink" title="spring-cloud-config é…ç½®ä¸­å¿ƒ"></a>spring-cloud-config é…ç½®ä¸­å¿ƒ</h4><h2 id="é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ"><a href="#é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ" class="headerlink" title="é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ"></a>é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ</h2><p>ç¬¬ä¸€ä¸ªç›®çš„æ˜¯ä¸ºäº†æœ¬äººèƒ½å¤Ÿç†Ÿæ‚‰å’Œå­¦ä¹  Spring-Cloud ç›¸å…³çŸ¥è¯†ï¼Œä¸è¿‡åœ¨åšäº†ä¸€æ®µæ—¶é—´ä¹‹åè¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ†äº«å‡ºæ¥è®©æ›´å¤šçš„åŒå­¦ä¸€èµ·å­¦ä¹ å’Œè®¨è®ºã€‚</p><h2 id="é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ"><a href="#é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ" class="headerlink" title="é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ"></a>é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ</h2><ul><li>scaffold-business <a href="#">ä¸šåŠ¡æœåŠ¡æä¾›è€…</a> ç«¯å£ä»8850 - 8860<ul><li>scaffold-business-sys-service <a href="#">ç³»ç»Ÿä¸šåŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8850</li><li>scaffold-business-job-service <a href="#">å®šæ—¶ä»»åŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8851</li><li>scaffold-business-thirdparty-service <a href="#">ç¬¬ä¸‰æ–¹ä¸šåŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8852</li></ul></li><li>scaffold-business-api <a href="#">ä¸šåŠ¡APIåŒ… ç”¨äºæ¥å£ä¸å®ç°åˆ†ç¦»</a><ul><li>scaffold-business-sys-api <a href="#">ç³»ç»Ÿèµ„æºã€èœå•ã€æƒé™ç­‰APIå°è£…</a></li><li>scaffold-business-job-api <a href="#">å®šæ—¶ä»»åŠ¡APIå°è£…</a></li><li>scaffold-business-thirdparty-api <a href="#">ç¬¬ä¸‰æ–¹æœåŠ¡APIå°è£…</a></li></ul></li><li>scaffold-core <a href="#">å·¥å…·ç±»ä»¥åŠå„ç§å…¬å…±ä»£ç </a><ul><li>scaffold-core-code <a href="#">æ¯ä¸ªæ¨¡å—éƒ½ä¼šç”¨åˆ°çš„å…¬å…±ä»£ç ï¼ŒBeanï¼Œconfigç­‰</a></li><li>scaffold-core-common <a href="#">å·¥å…·ç±»æ¨¡å—ï¼Œå…¬å…±ä»£ç </a></li><li>scaffold-core-plugin <a href="#">è‡ªåŠ¨ä»£ç ç”Ÿæˆæ’ä»¶æ¨¡å—</a></li></ul></li><li>scaffold-eureka <a href="#">æ³¨å†Œä¸­å¿ƒEureka</a> ç«¯å£ 8761 - 8771</li><li>scaffold-zuul <a href="#">ç½‘å…³æœåŠ¡</a> ç«¯å£ 8861 - 8870</li><li>scaffold-config-server <a href="#">é…ç½®æœåŠ¡ç«¯æœåŠ¡</a> ç«¯å£ 8871 - 8881</li><li>scaffold-config-client <a href="#">é…ç½®å®¢æˆ·ç«¯æœåŠ¡</a> ç«¯å£ 8880 - 8891</li><li>scaffold-tx-manager <a href="#">åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒæœåŠ¡</a> ç«¯å£7970 </li><li>scaffold-feign <a href="#">Feignæ¨¡å—</a><ul><li>scaffold-feign-sys <a href="#">feign-sysæ¨¡å—</a></li><li>scaffold-feign-job <a href="#">feign-jobæ¨¡å—</a></li><li>scaffold-feign-thirdparty <a href="#">feign-thirdpartyæ¨¡å—</a></li></ul></li><li>scaffold-route <a href="#">ä¸»ä¸šåŠ¡æ¶ˆè´¹è€…</a> ç«¯å£ä»8750 - 8760<ul><li>scaffold-route-operate <a href="#">åå°ç®¡ç†æ¥å£åŠé¡µé¢</a> ç«¯å£ 8750</li><li>scaffold-route-app <a href="#">APPå®¢æˆ·ç«¯æ¥å£</a> ç«¯å£ 8751</li></ul></li></ul><h2 id="å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ"><a href="#å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ"></a>å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ</h2><h3 id="1-æœ¬åœ°ç›´æ¥å¯åŠ¨"><a href="#1-æœ¬åœ°ç›´æ¥å¯åŠ¨" class="headerlink" title="1. æœ¬åœ°ç›´æ¥å¯åŠ¨"></a>1. æœ¬åœ°ç›´æ¥å¯åŠ¨</h3><ul><li><p>ä¸‹è½½/å…‹éš†é¡¹ç›®åˆ°æœ¬åœ° </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/Fatezhang/scaffold-cloud</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…MySqlæ•°æ®åº“å¹¶å¯åŠ¨</p></li><li>åˆ›å»ºæ•°æ®åº“scaffold_cloud_base å’Œ tx_manager</li><li>ä¿®æ”¹ scaffold-cloud ä¸­å¾®æœåŠ¡çš„æ•°æ®åº“é“¾æ¥é…ç½®ï¼Œæœ¬åœ°è¿è¡Œåªéœ€è¦ä¿®æ”¹application-local.yml</li><li>å®‰è£…redisæœåŠ¡å¹¶å¯åŠ¨ï¼Œä¿®æ”¹scaffold-core-codeé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼ŒåŒæ ·åªéœ€è¦ä¿®æ”¹localä¸­çš„</li><li>å®‰è£…Rocket MQæœåŠ¡ï¼ŒåŒæ ·ä¿®æ”¹é…ç½®</li><li>å¦‚æœæœ‰éœ€è¦ï¼Œæ³¨å†Œé˜¿é‡ŒOSSï¼Œå¹¶ä¿®æ”¹é…ç½®ä¸­çš„é…ç½®</li><li>å¯åŠ¨EurekaApplicationæ³¨å†Œä¸­å¿ƒ</li><li>å¯åŠ¨TxlcnApplicationåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒæœåŠ¡</li><li>å¯åŠ¨SysServiceApplicationï¼ŒåŠ è½½æ•°æ®åº“å­—å…¸ç­‰é…ç½®åˆ°ç¼“å­˜ã€æä¾›åå°ç®¡ç†å¾®æœåŠ¡ï¼ˆæƒé™ã€æ“ä½œå‘˜ã€è§’è‰²ã€å›½é™…åŒ–é…ç½®ç­‰ï¼‰</li><li>å¯åŠ¨RouteOperateApplicationæœåŠ¡ï¼Œé»˜è®¤ç«¯å£ä¸º8750</li><li>è®¿é—®<a href="http://localhost:8750/ÃŸÃŸ" target="_blank" rel="noopener">http://localhost:8750/ÃŸÃŸ</a></li><li>é»˜è®¤è´¦å·å¯†ç ä¸ºadmin/admin123</li></ul><h3 id="2-ä½¿ç”¨-docker-éƒ¨ç½²"><a href="#2-ä½¿ç”¨-docker-éƒ¨ç½²" class="headerlink" title="2. ä½¿ç”¨ docker éƒ¨ç½²"></a>2. ä½¿ç”¨ docker éƒ¨ç½²</h3><h4 id="docker-å¯åŠ¨-Linux-æˆ–è€…-Mac-ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬-Windows-ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ"><a href="#docker-å¯åŠ¨-Linux-æˆ–è€…-Mac-ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬-Windows-ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ" class="headerlink" title="docker å¯åŠ¨ : Linux æˆ–è€… Mac ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬, Windows ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ"></a>docker å¯åŠ¨ : Linux æˆ–è€… Mac ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬, Windows ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ</h4><h4 id="mvn-clean-package-docker-build-Pdocker"><a href="#mvn-clean-package-docker-build-Pdocker" class="headerlink" title="mvn clean package docker:build -Pdocker"></a><code>mvn clean package docker:build -Pdocker</code></h4><pre><code>1. è¿›å…¥é¡¹ç›®æ‰€åœ¨ç›®å½•2. æ‰§è¡Œ `./.scripts/recreate-docker-image.sh` åˆ›å»º docker é•œåƒ3. æ‰§è¡Œ `./.scripts/start-docker-service.sh` å³ä½¿ç”¨ docker-compose å¯åŠ¨</code></pre><h2 id="é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ"><a href="#é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ"></a>é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ</h2><ul><li>æ›´æ”¹é¡¹ç›®æ³¨å†Œå‘ç°ä¸­å¿ƒï¼Œä¹Ÿè®¸ç”¨ nacos æˆ–è€… zookeeper</li><li>åŠ å…¥æ›´å¤š spring-cloud å‘¨è¾¹æœåŠ¡ï¼ŒåŒ…æ‹¬å„ç§ç›‘æ§å¹³å°ç­‰</li><li>CI/CD ä½¿ç”¨ Jenkins æˆ–è€… BuildKite</li><li>ä½¿ç”¨ docker å®¹å™¨åŒ–éƒ¨ç½²</li><li>ElasticSearch æ—¥å¿—æ”¶é›†</li><li><a href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener">xxl-job</a> åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ <a href="https://www.xuxueli.com/xxl-job/" target="_blank" rel="noopener">https://www.xuxueli.com/xxl-job/</a></li><li>æ•´åˆ<a href="https://github.com/justauth/JustAuth" target="_blank" rel="noopener">ç¬¬ä¸‰æ–¹å¼€æºåº“</a>ç”¨ä»¥ç™»å½•ã€æ”¯ä»˜ç­‰</li><li>æœ€åï¼Œå®é™…å¼€å‘ä¸€äº›ä¸šåŠ¡åŠŸèƒ½</li></ul><hr><h4 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h4><blockquote><p><a href="https://juejin.im/post/5c28f2fe51882565a15776fb" target="_blank" rel="noopener">https://juejin.im/post/5c28f2fe51882565a15776fb</a></p><p><a href="https://juejin.im/post/5de740566fb9a0165721b744" target="_blank" rel="noopener">https://juejin.im/post/5de740566fb9a0165721b744</a></p><p><a href="https://juejin.im/post/5dc220126fb9a04aa660dcfb" target="_blank" rel="noopener">https://juejin.im/post/5dc220126fb9a04aa660dcfb</a></p></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;center&gt;&lt;u style=&quot;font-size=16px;&quot;&gt;&lt;a href=&quot;/&quot;&gt;Scaffold-Cloud: SpringCloudå¾®æœåŠ¡è„šæ‰‹æ¶&lt;/a&gt;&lt;/u&gt;&lt;/center&gt; &lt;a href=&quot;https://mubu.com/doc/6NZlNw3DIw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¹•å¸ƒ&lt;/a&gt;&lt;br&gt;Scaffold-Cloud æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¼€å‘è€…å­¦ä¹ çš„ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®è„šæ‰‹æ¶ã€‚é¡¹ç›®æœŸæœ›é›†æˆå¤§éƒ¨åˆ†ç›®å‰äº’è”ç½‘å…¬å¸ä½¿ç”¨çš„ä¸»æµçš„Spring-Cloudå¾®æœåŠ¡ç›¸å…³å·¥å…·å’ŒæœåŠ¡ã€‚å¹¶ç»“åˆä¸€äº›å®é™…çš„ä¸šåŠ¡å¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œå¦‚ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—åˆ†æç­‰ç­‰ï¼Œç„¶ååŠ å…¥ CI/CD å¹¶å¼•å…¥ docker éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;Scaffold-Cloud åŸºäº SpringCloud Netflix å…¨å®¶æ¡¶è¿›è¡Œå¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºï¼Œæ‰€ä»¥åœ¨è¿™ä¹‹å‰ï¼Œä½¿ç”¨ Scaffold-Cloud éœ€è¦å…ˆäº†è§£ä¸‹ SpringCloud ä»¥åŠ Netflix å·¥å…·å…¨å®¶æ¡¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/netflix.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;u style=&quot;font-size=6px; color:gray&quot;&gt;Sorry, NetFlix is not available in your country yet.&lt;/u&gt;&lt;/center&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/categories/SpringCloud/"/>
    
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/tags/SpringCloud/"/>
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN</title>
    <link href="http://zhangjiaheng.cn/blog/20191020/%E6%88%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%9ALCN/"/>
    <id>http://zhangjiaheng.cn/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/</id>
    <published>2019-10-20T03:14:44.000Z</published>
    <updated>2019-12-05T15:41:57.697Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png" alt="å®˜ç½‘é¦–é¡µ"></p><center><a href="#more2">å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†</a></center><a id="more"></a><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç”±äºå…¬å¸é¡¹ç›®æ˜¯ä½¿ç”¨dubboè¿›è¡Œå¼€å‘çš„åˆ†å¸ƒå¼æœåŠ¡ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­æœ‰å¾ˆå¤šæ¶‰åŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„åœºæ™¯ã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªæ¨¡å—ï¼šç”¨æˆ·æ¨¡å—å’Œè´¦æˆ·èµ„é‡‘æ¨¡å—ã€‚æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯ç”¨æˆ·è¢«é‚€è¯·æˆä¸ºç³»ç»Ÿçš„æ–°ç”¨æˆ·ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå†å»è´¦æˆ·èµ„é‡‘æ¨¡å—åˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚ä¸¤ä¸ªä¸åŒçš„æ¨¡å—ä¸ºä¸¤ä¸ªä¸åŒçš„RPCæœåŠ¡ï¼Œåˆ†åˆ«è¢«è°ƒç”¨ç„¶åæ’å…¥æ•°æ®ï¼Œè¿™æ—¶å€™å¦‚æœè´¦æˆ·èµ„é‡‘æ’å…¥å¤±è´¥ï¼Œä¸åŠ å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ç”¨æˆ·ç›´æ¥åˆå§‹åŒ–æˆåŠŸã€‚æˆ‘ä»¬å¸Œæœ›è¿™ç§æƒ…å†µä¸‹ç”¨æˆ·æ’å…¥çš„ä¿¡æ¯è¢«å›æ»šï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æ¥è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</p><h4 id="ä½¿ç”¨çš„æ¡†æ¶"><a href="#ä½¿ç”¨çš„æ¡†æ¶" class="headerlink" title="ä½¿ç”¨çš„æ¡†æ¶"></a>ä½¿ç”¨çš„æ¡†æ¶</h4><p>ç»è¿‡è°ƒç ”ï¼Œæˆ‘ä»¬å‘ç°TX-LCNæ¡†æ¶æ¯”è¾ƒé€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬æ‰“ç®—å¼•å…¥å¹¶ä½¿ç”¨LCNäº‹åŠ¡æ¨¡å¼æ¥è¿›è¡ŒæœåŠ¡ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸šåŠ¡å¤„ç†ã€‚å…³äºLCNã€TCCã€TXCå‡ ç§äº‹åŠ¡æ¨¡å¼çš„åŒºåˆ«åœ¨<a href="#more2">ä¸‹é¢</a>æ•´ç†ã€‚</p><p>åœ¨<a href="https://www.txlcn.org/zh-cn/index.html" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½å¯¹åº”çš„æœåŠ¡ï¼Œå¹¶å¼•å…¥é¡¹ç›®æˆ–è€…å•ç‹¬å¯åŠ¨ï¼š</p><p><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png" alt="å®˜ç½‘é¦–é¡µ"></p><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.codingapi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transaction-dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lcn.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.codingapi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tx-plugins-db<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lcn.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><p>åœ¨æœåŠ¡çš„å‘èµ·æ–¹ä½¿ç”¨æ³¨è§£<code>@TxTransaction(isStart = true)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@TxTransaction</span>(isStart = <span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ExperienceLogVO <span class="title">doUseExperience</span><span class="params">(Long userId, Long experienceRecordId, ExperienceLogCreateModel createModel)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">    userFacade.insert();</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">    accountFacede.insert();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœåŠ¡çš„å‚ä¸æ–¹ä½¿ç”¨æ³¨è§£<code>@TxTransaction</code>æ ‡è¯†å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TxTransaction</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†å¯åŠ¨é¡¹ç›®ä¹‹å‰ï¼Œå…ˆå¯åŠ¨tx-manageræœåŠ¡ï¼Œä½œä¸ºåè°ƒè€…çš„è§’è‰²å­˜åœ¨ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨æ¥å£çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p><p><a id="more2" class="active"></a></p><h4 id="å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†"><a href="#å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†" class="headerlink" title="å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†"></a>å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†</h4><h5 id="å…³äºTx-LCN-å®˜ç½‘æ–‡æ¡£"><a href="#å…³äºTx-LCN-å®˜ç½‘æ–‡æ¡£" class="headerlink" title="å…³äºTx-LCN - å®˜ç½‘æ–‡æ¡£"></a>å…³äºTx-LCN - <a href="https://www.txlcn.org/zh-cn/docs/preface.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a></h5><p>Tx-LCNæ—©æœŸæ˜¯ä¸ºäº†è®¾è®¡å‡ºLCNåˆ†å¸ƒå¼äº‹åŠ¡è€Œå‘½åçš„ï¼Œä¸è¿‡åœ¨5.0ä¹‹åå¯ä»¥æ”¯æŒLCNã€TXCã€TCCä¸‰ç§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ã€‚LCNæ¡†æ¶å®šä½ä¸º<code>ä¸ç”Ÿäº§äº‹åŠ¡ï¼Œåªåšäº‹åŠ¡çš„æ¬è¿å·¥</code>ã€‚å³TX-LCNæ˜¯ä¸€æ¬¾äº‹åŠ¡åè°ƒæ¡†æ¶ï¼Œæœ¬èº«å¹¶ä¸æ“ä½œäº‹åŠ¡ï¼Œåªæ˜¯åŸºäºå¯¹äº‹åŠ¡çš„åè°ƒä»è€Œè¾¾åˆ°äº‹åŠ¡ä¸€è‡´æ€§çš„æ•ˆæœã€‚</p><p>æœ€æ–°ç‰ˆæœ¬çš„TX-LCNåŒæ—¶æ”¯æŒå¤šç§äº‹åŠ¡æ¨¡å¼ã€‚å¹¶æ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®æºåŒæ—¶ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®Œå…¨è¾¾åˆ°æ‹”æ’æ•ˆæœã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§äº‹åŠ¡æ¨¡å¼çš„ä»‹ç»ã€åŒºåˆ«åŠä¼˜ç¼ºç‚¹ã€‚</p><h6 id="LCNäº‹åŠ¡æ¨¡å¼"><a href="#LCNäº‹åŠ¡æ¨¡å¼" class="headerlink" title="LCNäº‹åŠ¡æ¨¡å¼"></a>LCNäº‹åŠ¡æ¨¡å¼</h6><ul><li>ä»…ä»…ä½œä¸ºäº‹åŠ¡çš„åè°ƒè€…ï¼Œæœ¬èº«ä¸ç”Ÿäº§äº‹åŠ¡ã€‚åŸç†æ˜¯åœ¨äº‹åŠ¡å‘èµ·æ–¹åˆ›å»ºäº‹åŠ¡åˆ†ç»„ï¼Œå¹¶é€šè¿‡Http/Tcpåè®®è°ƒç”¨çš„æ—¶å€™å°†äº‹åŠ¡åˆ†ç»„ä¼ é€’åˆ°äº‹åŠ¡å‚ä¸æ–¹ã€‚äº‹åŠ¡å‚ä¸æ–¹çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œæ ¹æ®äº‹åŠ¡åˆ†ç»„IDé€šçŸ¥äº‹åŠ¡çš„å‘èµ·æ–¹æäº¤æ‰€æœ‰äº‹åŠ¡ã€‚åœ¨å…¨éƒ¨äº‹åŠ¡æˆåŠŸé€šçŸ¥ä¹‹å‰ï¼Œå…¶å„ä¸ªæœ¬åœ°äº‹åŠ¡å‡ä¸ºå‡å…³é—­ï¼Œç­‰å¾…TxManageråè°ƒå®Œæˆäº‹åŠ¡ä¹‹åå†å…³é—­è¿æ¥ã€‚</li><li>LCNäº‹åŠ¡å¯¹äºä»£ç å‡ ä¹æ²¡æœ‰åµŒå…¥æ€§ï¼Œåªéœ€è¦æ·»åŠ æ³¨è§£å³å¯å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li><li>LCNçš„äº‹åŠ¡æäº¤ä¸å›æ»šéƒ½æœ‰æœ¬åœ°äº‹åŠ¡ä¿éšœï¼Œæ›´å®‰å…¨çš„ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>ä½†æ˜¯LCNä»…é™äºå­˜åœ¨æœ¬åœ°äº‹åŠ¡å¹¶ä¸”å¯ä»¥é€šè¿‡è¿æ¥å¯¹è±¡æ§åˆ¶äº‹åŠ¡æ¨¡å—çš„ç³»ç»Ÿã€‚</li><li>LCNæ¨¡å¼ä¾èµ–äºè¿æ¥ä»£ç†æœåŠ¡ï¼Œäº‹åŠ¡çš„å‘èµ·æ–¹ä¸å‚ä¸æ–¹è¦ä¸€èµ·è¿æ¥ä¸é‡Šæ”¾ï¼Œè¾ƒè€—æ€§èƒ½ã€‚</li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN1.png" alt="æƒ…å†µ1"></li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN2.png" alt="æƒ…å†µ1"></li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN3.png" alt="æƒ…å†µ1"><h6 id="TCCäº‹åŠ¡æ¨¡å¼"><a href="#TCCäº‹åŠ¡æ¨¡å¼" class="headerlink" title="TCCäº‹åŠ¡æ¨¡å¼"></a>TCCäº‹åŠ¡æ¨¡å¼</h6></li><li>TCCäº‹åŠ¡æ¨¡å¼ä¸ä¾èµ–äºèµ„æºç®¡ç†å™¨å¯¹äºXAçš„æ”¯æŒï¼Œè€Œæ˜¯é€šè¿‡ä¸šåŠ¡ç³»ç»Ÿæä¾›çš„ä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å³ç¼–å†™ä¸‰æ­¥æ“ä½œï¼šTryï¼šå°è¯•æ‰§è¡Œä¸šåŠ¡ï¼ˆå…ˆæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒçŠ¶æ€ä¸ºTryï¼‰ã€Confrimï¼šç¡®è®¤æ‰§è¡Œä¸šåŠ¡ï¼ˆæˆåŠŸåçŠ¶æ€æ”¹ä¸ºConfrimï¼‰ã€Cancelï¼šå–æ¶ˆæ‰§è¡Œä¸šåŠ¡ï¼ˆéœ€è¦å›æ»šçš„è¯æ ¹æ®å‰ä¸¤ä¸ªæ­¥éª¤çš„idç»§ç»­æ›´æ”¹çŠ¶æ€æˆ–è€…åˆ é™¤æ•°æ®ï¼‰ã€‚</li><li>TCCæ¨¡å¼å¯¹äºä»£ç çš„ä¾µå…¥æ€§å¾ˆé«˜ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªæ¥å£éœ€è¦æ‹†åˆ†æˆ3ä¸ªï¼Œå¯¹äºç¨‹åºå‘˜çš„ç¼–ç è¦æ±‚å¾ˆé«˜ï¼Œä¸šåŠ¡çš„æ­£ç¡®æ€§ã€æ•°æ®ä¸€è‡´æ€§éƒ½ç”±å¼€å‘è€…æ¥ä¿è¯</li><li>ä¼˜ç‚¹æ˜¯TCCæ¨¡å¼å¯¹äºæœ‰æ— æœ¬åœ°äº‹åŠ¡çš„åœºæ™¯éƒ½é€‚ç”¨ï¼Œç”šè‡³å¯ä»¥è·¨æ•°æ®æºï¼Œé’ˆå¯¹MySQLã€redisã€Mongoç­‰æ•´åˆæˆä¸€ä¸ªå¤§çš„äº‹åŠ¡<h6 id="TXCäº‹åŠ¡æ¨¡å¼"><a href="#TXCäº‹åŠ¡æ¨¡å¼" class="headerlink" title="TXCäº‹åŠ¡æ¨¡å¼"></a>TXCäº‹åŠ¡æ¨¡å¼</h6></li><li>å…¶æ¥æºäºé˜¿é‡Œå·´å·´çš„ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Œå¯ä»¥é€šè¿‡æå°‘é‡çš„ä»£ç ä¾µå…¥ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åŸç†æ˜¯åœ¨æ‰§è¡ŒSQLä¹‹å‰ï¼Œå…ˆæŸ¥è¯¢SQLçš„å½±å“æ•°æ®ï¼Œç„¶åä¿å­˜æ‰§è¡Œçš„SQLå¿«ç…§ä¿¡æ¯å¹¶åˆ›å»ºé”ã€‚å½“éœ€è¦å›æ»šçš„æ—¶å€™å°±é‡‡ç”¨è¿™äº›è®°å½•å›æ»šæ•°æ®åº“ã€‚ç›®å‰å®ç°é”ä½¿ç”¨çš„æ˜¯redisåˆ†å¸ƒå¼é”æ§åˆ¶ã€‚</li><li>TXCäº‹åŠ¡æ¨¡å¼åŒæ ·å¯¹ä»£ç çš„ä¾µå…¥æ€§ä½</li><li>è¯¥æ¨¡å¼ä»…é™äºå¯¹æ”¯æŒSQLæ–¹å¼çš„æ¨¡å—æ”¯æŒ</li><li>è¯¥æ¨¡å¼ç”±äºæ¯æ¬¡æ‰§è¡ŒSQLä¹‹å‰éœ€è¦å…ˆæŸ¥è¯¢å½±å“æ•°æ®ï¼Œå› æ­¤ç›¸æ¯”LCNæ¨¡å¼æ›´æ¶ˆè€—æ€§èƒ½</li><li>TXCäº‹åŠ¡æ¨¡å¼ä¸ä¼šå ç”¨æ•°æ®åº“èµ„æº</li><li>å…³äºTXCäº‹åŠ¡çš„è¯¦ç»†ä»‹ç»å¯ä»¥æŸ¥çœ‹<a href="https://blog.csdn.net/m0_38110132/article/details/77043580" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a></li></ul><h5 id="CAPç†è®ºå’ŒBASEç†è®º"><a href="#CAPç†è®ºå’ŒBASEç†è®º" class="headerlink" title="CAPç†è®ºå’ŒBASEç†è®º"></a>CAPç†è®ºå’ŒBASEç†è®º</h5><h6 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h6><p>CAPç†è®ºå³æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§çš„ç®€ç§°ã€‚</p><ul><li>Consistency æ•°æ®ä¸€è‡´æ€§ï¼šä¸€æ¬¡å®Œæ•´çš„æ›´æ–°æ“ä½œï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»è®¿é—®åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„</li><li>Availability æœåŠ¡å¯ç”¨æ€§ï¼šæœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œå¹¶ä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´</li><li>Partition tolerance åˆ†åŒºå®¹é”™æ€§ï¼šåˆ†å¸ƒå¼å¤šèŠ‚ç‚¹åœ¨æŸå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰åä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æ­£å¸¸çš„æœåŠ¡</li></ul><p>äº‹å®ä¸Šï¼ŒCAPè¿™ä¸‰ç§å¹¶æ— æ³•ä¿è¯å®Œå…¨æ»¡è¶³ï¼Œä¸€èˆ¬åªèƒ½æ»¡è¶³å…¶äºŒã€‚å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯æœ€åŸºæœ¬éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¸èƒ½ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåªæ»¡è¶³CA å…¶å®æ˜¯ä¼ ç»Ÿçš„å•æœºæœåŠ¡ã€‚é‚£ä¹ˆåœ¨æ»¡è¶³Pï¼ˆåˆ†åŒºå®¹é”™ï¼‰çš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨Cå’ŒAä¹‹é—´æƒè¡¡ã€‚äº‹å®ä¸Šï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ä¸€èˆ¬ä¼šä¿è¯Aï¼ˆæœåŠ¡å¯ç”¨ï¼‰Pï¼Œæ”¾å¼ƒæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåªä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™æ ·å°±è¡ç”Ÿå‡ºäº†BASEç†è®ºã€‚</p><h6 id="BASEç†è®º"><a href="#BASEç†è®º" class="headerlink" title="BASEç†è®º"></a>BASEç†è®º</h6><p>BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚BASEç†è®ºæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„æ€»ç»“ï¼Œæ˜¯åŸºäºCAPå®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ã€‚BASEç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p><ul><li>åŸºæœ¬å¯ç”¨ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå…è®¸åœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æƒ…å†µä¸‹æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼ˆå¹¶ä¸æ˜¯å…è®¸ç³»ç»Ÿä¸å¯ç”¨ï¼‰ï¼Œå…è®¸å“åº”æ—¶é—´ä¸Šçš„ç¡®å®å’Œéƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½çš„é”™è¯¯ï¼ˆå¹¶å‘åœºæ™¯ä¸‹æ‹’ç»æœåŠ¡äº§ç”ŸæŠ¥é”™ç­‰ï¼‰</li><li>è½¯çŠ¶æ€ï¼šå³å…è®¸æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå…è®¸ä¸åŒèŠ‚ç‚¹çš„æ•°æ®ä¹‹é—´å­˜åœ¨æ—¶é—´ä¸Šçš„æ•°æ®å·®å¼‚</li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼ºè°ƒæ‰€æœ‰æ•°æ®å‰¯æœ¬èƒ½å¤Ÿæœ€ç»ˆä¸€è‡´ï¼Œä¸éœ€è¦ä¿è¯æ•°æ®å®æ—¶å¼ºä¸€è‡´ã€‚</li></ul><p>ä¼ ç»Ÿäº‹åŠ¡çš„ACIDæœºåˆ¶è¿½æ±‚å¼ºä¸€è‡´æ€§ï¼Œè€ŒBASEç†è®ºä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œç”Ÿï¼Œä¸»å¼ ç‰ºç‰²å¼ºä¸€è‡´æ€§ï¼Œä½¿å¾—æœåŠ¡è¾¾åˆ°é«˜å¯ç”¨ã€‚ä¸è¿‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒåœºæ™¯ä¸‹å¯¹äºæ•°æ®çš„ä¸€è‡´æ€§åˆæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´ï¼Œå³ACIDä¸BASEç†è®ºç»“åˆä½¿ç”¨ã€‚</p><h5 id="2PCå’Œ3PC"><a href="#2PCå’Œ3PC" class="headerlink" title="2PCå’Œ3PC"></a>2PCå’Œ3PC</h5><h6 id="2PC-äºŒæ®µå¼æäº¤"><a href="#2PC-äºŒæ®µå¼æäº¤" class="headerlink" title="2PC - äºŒæ®µå¼æäº¤"></a>2PC - äºŒæ®µå¼æäº¤</h6><p>2PCï¼Œæ˜¯Two-Phase Commitçš„ç¼©å†™ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>é˜¶æ®µä¸€ï¼šæäº¤äº‹åŠ¡è¯·æ±‚</p><ul><li>åè°ƒè€…è¯¢é—®å‚ä¸æ–¹æ˜¯å¦å¯ä»¥æ‰§è¡Œæäº¤æ“ä½œå¹¶ç­‰å¾…å“åº”</li><li>å‚ä¸è€…æ‰§è¡Œè¯¢é—®ä¸ºæ­¢çš„æ‰€æœ‰äº‹åŠ¡æ“ä½œ</li><li>å‚ä¸è€…å“åº”åè°ƒè€…ï¼Œè¿”å›äº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦</li></ul></li><li><p>é˜¶æ®µäºŒï¼šæ‰§è¡Œäº‹åŠ¡æäº¤</p><ul><li><p>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰ç¬¬ä¸€é˜¶æ®µå“åº”ä¹‹åå‘èµ·æ­£å¼æäº¤è¯·æ±‚</p></li><li><p>å‚ä¸è€…æ­£å¼å®Œæˆæ“ä½œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æº</p></li><li><p>åé¦ˆäº‹åŠ¡æäº¤ç»“æœ</p></li><li><p>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å®Œæˆçš„æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚</p></li><li><p>å¦‚æœä»»æ„å‚ä¸è€…åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›æ‰§è¡Œå¤±è´¥æˆ–è€…è¶…æ—¶çš„æ¶ˆæ¯ï¼Œä¸­æ–­äº‹åŠ¡</p></li><li><p>å‚ä¸è€…èŠ‚ç‚¹åˆ©ç”¨ä¹‹å‰å†™å…¥çš„Undoä¿¡æ¯æ‰§è¡Œå›æ»šï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚</p></li><li><p>å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹å‘é€â€å›æ»šå®Œæˆâ€æ¶ˆæ¯ã€‚</p></li><li><p>åè°ƒè€…èŠ‚ç‚¹å—åˆ°æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹åé¦ˆçš„â€å›æ»šå®Œæˆâ€æ¶ˆæ¯åï¼Œå–æ¶ˆäº‹åŠ¡ã€‚</p></li><li><p>ä¸ç®¡æœ€åç»“æœå¦‚ä½•ï¼Œç¬¬äºŒé˜¶æ®µéƒ½ä¼šç»“æŸå½“å‰äº‹åŠ¡</p></li></ul></li></ul><p>  <strong>2PCçš„ç¼ºç‚¹ï¼š</strong> æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼›å¦‚æœåè°ƒè€…æ˜¯å•ç‚¹å¹¶ä¸”å‘ç”Ÿæ•…éšœï¼Œå‚ä¸è€…å°†ä¸€ç›´é˜»å¡ï¼›å¦‚æœåœ¨ç¬¬äºŒé˜¶æ®µåè°ƒè€…æ­£å¼å‘æ‰€æœ‰å‚ä¸è€…å‘é€æ­£å¼æäº¤äº‹åŠ¡çš„è¯·æ±‚ï¼Œå…¶ä¸­éƒ¨åˆ†å› ä¸ºç½‘ç»œé—®é¢˜æ²¡æœ‰æ”¶åˆ°ï¼Œå¦ä¸€éƒ¨åˆ†å´å·²ç»æäº¤æ— æ³•å›æ»šï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼›åè°ƒè€…å†å‘å‡ºcommitæ¶ˆæ¯ä¹‹åå®•æœºï¼Œè€Œå”¯ä¸€æ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸è€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚</p><p>  ç”±äºäºŒé˜¶æ®µæäº¤å­˜åœ¨ç€è¯¸å¦‚åŒæ­¥é˜»å¡ã€å•ç‚¹é—®é¢˜ã€è„‘è£‚ç­‰ç¼ºé™·ï¼Œæ‰€ä»¥ï¼Œç ”ç©¶è€…ä»¬åœ¨äºŒé˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œæå‡ºäº†ä¸‰é˜¶æ®µæäº¤ã€‚</p><h6 id="3PC-ä¸‰æ®µå¼æäº¤"><a href="#3PC-ä¸‰æ®µå¼æäº¤" class="headerlink" title="3PC - ä¸‰æ®µå¼æäº¤"></a>3PC - ä¸‰æ®µå¼æäº¤</h6><p>3PCå°†2PCçš„å‡†å¤‡é˜¶æ®µåˆåˆ’åˆ†ä¸ºä¸¤æ¬¡å‡†å¤‡ï¼Œè¿™æ ·ä¸‰é˜¶æ®µæäº¤å°±æœ‰CanCommitã€PreCommitã€DoCommitä¸‰ä¸ªé˜¶æ®µã€‚ã€‚å¹¶ä¸”åœ¨åè°ƒè€…ä¸å‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚</p><ul><li><p>CanCommité˜¶æ®µ</p><ul><li>åŒ2PCçš„å‡†å¤‡é˜¶æ®µï¼Œåè°ƒè€…å‘å‚ä¸è€…å‘é€äº‹åŠ¡æäº¤è¯·æ±‚ï¼Œè¯¢é—®å¹¶ç­‰å¾…å“åº”</li><li>å¾—åˆ°å“åº”ä¹‹åè¿›å…¥é¢„å¤‡æäº¤é˜¶æ®µ</li></ul></li><li><p>PreCommité˜¶æ®µ</p><ul><li>æ‰€æœ‰å‚ä¸è€…ç¬¬ä¸€é˜¶æ®µéƒ½è¿”å›æˆåŠŸçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹äº‹åŠ¡çš„é¢„æ‰§è¡Œ</li><li>è¿›å…¥PreCommitå¹¶æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå…¨éƒ¨æˆåŠŸå°±è¿”å›ç»™æäº¤è€…</li><li>å‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚;ä¸­æ–­äº‹åŠ¡å‚ä¸è€…æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ä¹‹åï¼ˆæˆ–è¶…æ—¶ä¹‹åï¼Œä»æœªæ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼‰ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</li></ul></li><li><p>doCommité˜¶æ®µ</p><ul><li><p>å‘é€æäº¤è¯·æ±‚åè°ƒæ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»é¢„æäº¤çŠ¶æ€è¿›å…¥åˆ°æäº¤çŠ¶æ€ã€‚å¹¶å‘æ‰€æœ‰å‚ä¸è€…å‘é€doCommitè¯·æ±‚ã€‚</p></li><li><p>äº‹åŠ¡æäº¤å‚ä¸è€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œæ‰§è¡Œæ­£å¼çš„äº‹åŠ¡æäº¤ã€‚å¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºã€‚</p></li><li><p>å“åº”åé¦ˆäº‹åŠ¡æäº¤å®Œä¹‹åï¼Œå‘åè°ƒè€…å‘é€Ackå“åº”ã€‚</p></li><li><p>å®Œæˆäº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ackå“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ã€‚</p></li></ul></li></ul><p>  ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ²¡æœ‰æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼ˆå¯èƒ½æ˜¯æ¥å—è€…å‘é€çš„ä¸æ˜¯ACKå“åº”ï¼Œä¹Ÿå¯èƒ½å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ã€‚</p><ul><li><p>å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚</p></li><li><p>äº‹åŠ¡å›æ»šå‚ä¸è€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºã€‚</p></li><li><p>åé¦ˆç»“æœå‚ä¸è€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKæ¶ˆæ¯</p></li><li><p>ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ACKæ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</p></li></ul><p>  ç›¸æ¯”äº2PCï¼Œ3PCæœ€å…³é”®è¦è§£å†³çš„å°±æ˜¯åè°ƒè€…å’Œå‚ä¸è€…åŒæ—¶æŒ‚æ‰çš„é—®é¢˜ï¼Œæ‰€ä»¥3PCæŠŠ2PCçš„å‡†å¤‡é˜¶æ®µå†æ¬¡ä¸€åˆ†ä¸ºäºŒã€‚åœ¨ç¬¬ä¸€é˜¶æ®µåªæ˜¯è¯¢é—®æ‰€æœ‰å‚ä¸è€…æ˜¯å¦éƒ½å¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶ä¸åœ¨æœ¬é˜¶æ®µæ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚å½“åè°ƒè€…æ”¶åˆ°æ‰€æœ‰çš„å‚ä¸è€…éƒ½è¿”å›YESæ—¶ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæ‰æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œç„¶ååœ¨ç¬¬ä¸‰é˜¶æ®µåœ¨æ‰§è¡Œcommitæˆ–è€…rollbackã€‚</p><p>  <strong>3PCå­˜åœ¨çš„é—®é¢˜ï¼š</strong> åœ¨doCommité˜¶æ®µï¼Œå¦‚æœå‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…abortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚è¿™æ ·ä¸å…¶ä»–æ‰§è¡Œå›æ»šçš„å‚ä¸è€…å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><hr><blockquote><p>å‚è€ƒï¼š</p><ul><li><p><a href="https://www.hollischuang.com/archives/1580" target="_blank" rel="noopener">https://www.hollischuang.com/archives/1580</a></p></li><li><p><a href="http://anruence.com/2018/03/05/tcc-2pc-3pc/" target="_blank" rel="noopener">http://anruence.com/2018/03/05/tcc-2pc-3pc/</a></p></li><li><p><a href="http://blog.jobbole.com/95632/" target="_blank" rel="noopener">http://blog.jobbole.com/95632/</a></p></li><li><a href="http://blog.csdn.net/zhangjq520/article/details/78433686" target="_blank" rel="noopener">http://blog.csdn.net/zhangjq520/article/details/78433686</a></li><li><a href="https://www.zhihu.com/question/48627764/answer/111983553" target="_blank" rel="noopener">https://www.zhihu.com/question/48627764/answer/111983553</a></li><li><a href="https://www.jianshu.com/p/d3eda795188a" target="_blank" rel="noopener">https://www.jianshu.com/p/d3eda795188a</a></li></ul></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png&quot; alt=&quot;å®˜ç½‘é¦–é¡µ&quot;&gt;&lt;/p&gt;
&lt;center&gt;&lt;a href=&quot;#more2&quot;&gt;å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†&lt;/a&gt;&lt;/center&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="http://zhangjiaheng.cn/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="æ•°æ®åº“" scheme="http://zhangjiaheng.cn/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>å…¶å®æˆ‘ä¸å¤ªæƒ³ç¦»å¼€è¿™é‡Œ</title>
    <link href="http://zhangjiaheng.cn/blog/20190909/%E5%85%B6%E5%AE%9E%E6%88%91%E4%B8%8D%E6%83%B3%E7%A6%BB%E5%BC%80%E8%BF%99%E9%87%8C/"/>
    <id>http://zhangjiaheng.cn/blog/20190909/å…¶å®æˆ‘ä¸æƒ³ç¦»å¼€è¿™é‡Œ/</id>
    <published>2019-09-09T14:01:04.000Z</published>
    <updated>2020-12-27T03:00:24.936Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190909/å…¶å®æˆ‘ä¸æƒ³ç¦»å¼€è¿™é‡Œ/fm.png" alt="æ­å·è¥¿æ¹–"></p><a id="more"></a><blockquote><p>å†™äº 2018-09-09 22:01:04</p></blockquote><h4 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h4><p>æˆ‘è¦ç¦»å¼€äº†ã€‚ç¦»å¼€æ­å·ï¼Œç¦»å¼€è¿™ä¸ªç”Ÿæ´»äº†å¿«ä¸‰å¹´çš„åœ°å„¿ã€‚æ”¾å¼ƒè¦å»ä¸€çº¿å¤§å…¬å¸çš„æ¬²æœ›ï¼Œæ”¾å¼ƒå¹´è–ªç™¾ä¸‡çš„æ¢¦æƒ³ï¼Œæ”¾å¼ƒæ¸©æŸ”å¯çˆ±çš„å—æ–¹å§‘å¨˜ï¼Œæ”¾å¼ƒæˆ‘æ¯•ä¸šä¹‹å‰ä¸€ç›´å‘å¾€çš„è‡ªç”±å’Œè¿œæ–¹â€¦ â€¦ æœ€è®©æˆ‘éš¾å—çš„ï¼Œåœ¨æ­å·ä¸¤å¹´è®¤è¯†çš„å‡ ä¸ªæœ‹å‹ï¼Œä¹Ÿè®¸ä»¥åå†éš¾è§ä¸Šä¸€é¢ã€‚è¿˜æœ‰ï¼Œå›åˆ°äº†å®¶ä¹¡ï¼Œæˆ‘æ˜¯å¦å°±æ­¤è¿‡ä¸Šä¸€ä¸ªå®‰é€¸çš„ç”Ÿæ´»ï¼Œè¿˜èƒ½å¦ä¿æŒç›®å‰çš„è¿™ä»½æ–—å¿—ã€‚æ­å·è¢«ç¨‹åºå‘˜è®ºå›ç§°ä¸ºâ€œå¥‹æ–—é€¼ä¹‹éƒ½â€ï¼Œæºäºé©¬è€å¸ˆçš„ç¦æŠ¥ï¼Œæˆ‘è™½ä¸å–œæ¬¢è¿™ç§996çš„å·¥ä½œèŠ‚å¥ï¼Œä½†æ˜¯ç¦»å¼€è¿™é‡Œï¼ŒçœŸçš„è¦æ”¾å¼ƒå¾ˆå¤šã€‚</p><h4 id="è¾èŒ"><a href="#è¾èŒ" class="headerlink" title="è¾èŒ"></a>è¾èŒ</h4><p>2019å¹´8æœˆ21æ—¥ï¼Œåœ¨è¢«ç§°ä¸ºäº’è”ç½‘å¯’å†¬çš„è¿™å¹´ï¼Œæˆ‘è¾èŒäº†ã€‚å› ä¸ºè¿™ä¸€å¹´ä»¥æ¥ï¼Œå…¬å¸çš„ç»è¥çŠ¶å†µå‡ºäº†å¾ˆå¤§çš„é—®é¢˜ï¼Œ8æœˆï¼Œçº¿ä¸ŠæœåŠ¡å™¨å…³é—­äº†ï¼Œè¿™æ„å‘³ç€ç†è´¢ä¸šåŠ¡æ­¤æ—¶å·²ç»å®Œå…¨åœæ­¢ï¼Œå…¬å¸é‡‘èéƒ¨é—¨ç”¨ä»…å‰©çš„æµ·å¤–è´·æ¬¾ä¸šåŠ¡ç»´æŒç€æœ€åä¸€çº¿ç”Ÿæœºã€‚è¿™ç§æ—¶åˆ»ï¼Œä½†å‡¡æ˜¯è§‰å¾—è‡ªå·±åœ¨ç¦»å¼€ä¹‹åèƒ½å¤Ÿæ‰¾åˆ°åˆé€‚å·¥ä½œçš„äººï¼Œéƒ½ä¸ä¼šæƒ³è¦å†ç»§ç»­å†å…¬å¸å‘†ä¸‹å»ã€‚æˆ‘å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œæ‰€ä»¥æˆ‘å‘è€å¤§è¯´ï¼Œæˆ‘æƒ³èµ°äº†ï¼</p><p>åæ¥ï¼Œæˆ‘ä»¬ä¸€èµ·å»åƒäº†æ•£ä¼™é¥­ï¼Œåˆæ˜¯ç«é”…ï¼Œæ¯æ¬¡éƒ½æ˜¯ã€‚ä¸ºä»€ä¹ˆè¯´â€œæ¯æ¬¡â€å‘¢ï¼Ÿå› ä¸ºåœ¨æˆ‘ä¹‹å‰ï¼Œè¿˜æœ‰5ä¸ªäººã€‚æˆ‘æƒ³æˆ‘ä¹Ÿä¸ä¼šæ˜¯æœ€åä¸€ä¸ªå§ã€‚</p><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p>äº‹å®ä¸ŠåŠå¹´ä»¥æ¥æˆ‘éƒ½åœ¨ä½¿ç”¨ç©ºé—²æ—¶é—´å­¦ä¹ ã€åˆ·ç®—æ³•é¢˜ã€å†™åšå®¢ã€ç‚¹äº®GitHubç»¿ç‚¹ä»¥æœŸæœ›è‡ªå·±åœ¨ä¹‹åæ‰¾å·¥ä½œèƒ½å¤Ÿé ç€åšå®¢å’ŒGitHubçš„æ´»è·ƒç¨‹åº¦å¸å¼•åˆ°æŸå…¬å¸çš„é¢è¯•å®˜ï¼ˆåæ¥äº‹å®è¯æ˜ï¼Œè¿™ä¸ªåšæ³•è¿˜æŒºç®¡ç”¨ï¼Œå½“ç„¶æˆ‘çš„ç¡®æœ‰åœ¨ä¸°å¯Œè‡ªå·±çš„çŸ¥è¯†è€Œä¸åªæ˜¯ç‚¹â€œç»¿ç‚¹â€ï¼‰ã€‚è¿™åŠå¹´ä»¥æ¥ï¼Œåœ¨å…¬å¸æ‰€åšçš„å·¥ä½œå‡ ä¹å¯ä»¥ç”¨æ‚æ´»æ¥å½¢å®¹ï¼ä¸è¿‡è¿™äº›æ‚æ´»ï¼Œä¸ºæˆ‘è¥é€ äº†å……è¶³çš„å­¦ä¹ æ—¶é—´çš„åŒæ—¶ï¼Œå´ä¹Ÿè®©æˆ‘åæ¥çš„ç®€å†ä¸Šéš¾ä»¥å†™ä¸Šä¸€äº›æœ‰å«é‡‘é‡çš„é¡¹ç›®ã€‚</p><p>ä»Šå¹´ä»¥æ¥ï¼Œæˆ‘å†™äº†å¤§æ¦‚30å¤šç¯‡åšå®¢ï¼Œæœ‰æ®µæ—¶é—´å‡ ä¹æ˜¯ä¸€å‘¨ä¸¤ç¯‡ï¼Œå°±åœ¨å…¬å¸ç”¨ä¸Šç­æ—¶é—´å†™ï¼åšå®¢ä¸»è¦å­¦ä¹ å’Œæ•´ç†ä¸€äº›JavaåŸºç¡€ã€å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ç³»åˆ—çš„çŸ¥è¯†ï¼Œä»¥åŠæ•´ç†ä¸€äº›æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­çš„ä¸€äº›éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆã€‚é™¤äº†åšå®¢ï¼Œæˆ‘è¿˜åœ¨GitHubæ•´ç†äº†è‡ªå·±åœ¨å…¬å¸ä½¿ç”¨çš„ä¸€äº›åŸºç¡€æ¡†æ¶ï¼Œç„¶åè‡ªå·±æ­å»ºäº†ä¸€ä¸ªspring cloudç‰ˆæœ¬çš„è„šæ‰‹æ¶ï¼š<a href="https://github.com/Fatezhang/scaffold-cloud" target="_blank" rel="noopener">Scaffold-Cloud</a>ã€‚è¿˜åœ¨å¹•å¸ƒä¸Šæ•´ç†äº†å¤§ç¯‡å¹…çš„<a href="https://mubu.com/doc/hpBd1e5h6z" target="_blank" rel="noopener">Javaå­¦ä¹ å¤§çº²</a>å’Œä¸€äº›é¢è¯•é¢˜ç›®ã€JavaçŸ¥è¯†ç‚¹ã€é˜¿é‡ŒJavaå¼€å‘æ‰‹å†Œï¼Œä¸è¿‡åˆ°ç›®å‰è¿˜æ²¡æœ‰æ•´ç†å®Œæˆï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªå¤šäº†ï¼ŒJavaåŸºç¡€ã€è®¾è®¡æ¨¡å¼ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€åˆ†å¸ƒå¼ã€æ•°æ®åº“ã€è®¡ç®—æœºç½‘ç»œç­‰ç­‰ï¼Œä¸€ç‚¹ç‚¹æ•²ä¸‹æ¥ä¹Ÿæ˜¯éå¸¸è´¹æ—¶é—´çš„ã€‚</p><h4 id="é¢è¯•"><a href="#é¢è¯•" class="headerlink" title="é¢è¯•"></a>é¢è¯•</h4><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä½ å¯èƒ½ä»¥ä¸ºç¦»èŒä¹‹åæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªå¥½å·¥ä½œã€‚ç„¶è€Œï¼Œåœ¨ç¦»èŒåçš„ä¸€å‘¨ï¼Œæˆ‘åœ¨æŸç›´è˜APPä¸ŠæŠ•é€’äº†å‡ åå®¶ç®€å†ï¼Œåœ¨å…«æœˆçš„æœ€åä¸€å‘¨ï¼Œæˆ‘é¢è¯•äº†äº”å®¶å…¬å¸ï¼ŒåŒ…æ‹¬ä¸€å®¶ä»…æœ‰ç”µè¯é¢è¯•çš„å…¬å¸ã€‚äº‹å®ä¸Šåœ¨é¢è¯•ä¹‹å‰ï¼Œæˆ‘å¯¹è‡ªå·±è¿˜æ˜¯å¾ˆæœ‰è‡ªä¿¡çš„ï¼Œæ¯•ç«Ÿå­¦äº†åŠå¹´ï¼Œæ€ä¹ˆç€å°å…¬å¸çš„offerè¿˜æ˜¯å¯ä»¥æ‹¿åˆ°æ‰‹çš„ï¼Œæ‹¿åˆ°å°å…¬å¸offeråœ¨å¼€å§‹æŠ•å¤§å…¬å¸ï¼Œå¼€å¯offeræ”¶å‰²æœºæ¨¡å¼ã€‚ç„¶è€Œæˆ‘çš„è„¸è¢«ç°å®ç‹ ç‹ çš„æ‰“è‚¿äº†ã€‚æˆ‘é¢è¯•äº†é²¸çµã€å¤§åã€å…‘å§ã€æ¶‚é¸¦ï¼ç°å®å‘Šè¯‰æˆ‘ï¼šä½ å°±æ˜¯ä¸ªå½©ç¬”ï¼è¿˜ä»–ä¹ˆæƒ³æ‹¿å¤§å‚çš„offerï¼Ÿåšæ¢¦å»å§ï¼</p><p>äº‹å®ä¸Šï¼Œæˆ‘åœ¨é¢è¯•çš„æ—¶å€™åŸºæœ¬ä¸Šéƒ½èƒ½å¤Ÿå›ç­”çš„å‡ºæ¥é¢è¯•å®˜çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¤šçº¿ç¨‹å’Œä¸€äº›åˆ†å¸ƒå¼ç›¸å…³çš„é—®é¢˜ï¼ŒJavaåŸºç¡€ã€JVMæ›´æ˜¯ä¸€ç›´åœ¨æˆ‘çš„å¤ä¹ èŒƒå›´ã€‚ç„¶è€Œï¼Œå½“é¢è¯•å®˜é—®åˆ°ä¸€äº›å®é™…é¡¹ç›®é‡åˆ°çš„é—®é¢˜ä»¥åŠè‡ªå·±æ˜¯å¦‚ä½•è§£å†³çš„ï¼Œæˆ‘å°±æ­‡èœäº†ã€‚ä¾‹å¦‚å®é™…ç”Ÿäº§ä¸­æ˜¯å¦‚ä½•åšæ€§èƒ½è°ƒä¼˜çš„ï¼Œå®é™…é¡¹ç›®ä¸­é‡åˆ°äº†å“ªäº›é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿæˆ‘çŸ¥é“é¢è¯•å®˜æ˜¯æƒ³è€ƒå¯Ÿæˆ‘è§£å†³é—®é¢˜çš„æ€è·¯ï¼Œç„¶è€Œå½“æˆ‘å°†è‡ªå·±å·¥ä½œä¸­æ‰€åšçš„å…¨ç›˜æ‰˜å‡ºï¼Œæ¢æ¥çš„å´æ˜¯é¢è¯•å®˜çš„é„™è§†ï¼å› ä¸ºå®åœ¨æ˜¯å¤ªæ²¡æœ‰æŠ€æœ¯å«é‡äº†ï¼Œè€Œæˆ‘è‡ªå·±ä¹Ÿç¡®å®æ²¡æœ‰åœ¨å®é™…ç”Ÿäº§ä¸­é‡åˆ°ä¸€äº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ã€‚è¿™ä¸€å‘¨çš„é¢è¯•å°†æˆ‘çš„ä¿¡å¿ƒæ‰“å‹åˆ°è°·åº•ã€‚</p><h4 id="è½¬æœº"><a href="#è½¬æœº" class="headerlink" title="è½¬æœº"></a>è½¬æœº</h4><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘åœ¨æ­£å¼åŠå¥½ç¦»èŒæ‰‹ç»­çš„æœ€åä¸€ä¸ªç¤¼æ‹œï¼Œä¸€ä¸ªå¤§å­¦çš„æ—¶å€™è¿›äº†è¥¿å®‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¤–ä¼çš„åŒå­¦å‘Šè¯‰æˆ‘ï¼Œä»–ä»¬å…¬å¸æ‹›äººï¼Œé—®æˆ‘è¦ä¸è¦è¯•ä¸€ä¸‹ã€‚åœ¨ä»åŒèŠ±é¡ºç¦»èŒçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ä¸€å¹´ä¹‹å‰ï¼Œæˆ‘æœ‰å°è¯•é¢è¯•è¿‡è¿™å®¶å…¬å¸ï¼Œå¯æƒœåœ¨homeworké˜¶æ®µç”±äºä»£ç æ²¡æœ‰å†™çš„å¾ˆå¥½è¢«æ·˜æ±°äº†ã€‚è¿™æ¬¡ï¼Œæˆ‘è¦æ±‚è‡ªå·±è¦åšå¥½å……è¶³çš„å‡†å¤‡ã€‚</p><p>ä»–ä»¬å…¬å¸é¢è¯•ä¸åƒæ­å·è¿™è¾¹çš„äº’è”ç½‘å…¬å¸ï¼Œé¢è¯•æ€»çˆ±é—®ä¸€äº›é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ç­‰ç­‰åªä¼šå‡ºç°åœ¨é¢è¯•ä¸­è€Œä¸ä¼šå‡ºç°åœ¨å®é™…å·¥ä½œä¸­çš„é—®é¢˜ï¼ˆå½“ç„¶è¿™ç§è¯´æ³•ä¹Ÿå¾ˆç‰‡é¢ï¼‰ã€‚è¿™ä¸ªå¤–ä¼çš„é¢è¯•æµç¨‹æ˜¯ç»™å‡ºä¸€é“ç¨‹åºè®¾è®¡é¢˜ï¼Œ3å¤©æ—¶é—´æäº¤ä»£ç ï¼Œå®¡æ ¸ä»£ç çš„è´¨é‡ä»¥åŠæ˜¯å¦ä¼˜é›…çš„å®Œæˆé¢˜ç›®è¦æ±‚ï¼Œç„¶åäºŒé¢é’ˆå¯¹æ‰€åšçš„é¢˜ç›®å¢åŠ éœ€æ±‚ï¼Œè€ƒå¯Ÿåº”è¯•è€…å®é™…åŠ¨æ‰‹èƒ½åŠ›ä»¥åŠç¨‹åºè®¾è®¡èƒ½åŠ›ã€‚ä¸‰é¢é’ˆå¯¹é¡¹ç›®ç»éªŒã€å·¥ä½œç»éªŒå†è¿›è¡Œä¸€è½®é¢è¯•ã€‚</p><p>9æœˆ6æ—¥å‘¨äº”ä¸‹åˆ4:19ï¼Œæˆ‘æ”¶åˆ°äº†è¿™å®¶å…¬å¸çš„offerï¼Œä¸°åšçš„æŠ¥é…¬å’Œç¦åˆ©ï¼Œè¿˜æœ‰ç¦»å®¶è¿‘çš„æ¡ä»¶è®©æˆ‘æ— æ³•æ‹’ç»è¿™æ ·ä¸€ä¸ªofferã€‚å†åŠ ä¸Šåœ¨æ­å·è¿™è¾¹é¢è¯•çš„ä¸é¡ºåˆ©ï¼Œæˆ‘å†³å®šå›å»äº†ã€‚åœ¨æˆ‘æœ€åä¸€ä¸ªé¢è¯•â€”â€”æ­å·æ¶‚é¸¦çš„æ—¶å€™ï¼Œæˆ‘æ¸…æ¥šåœ°è®°å¾—æ¶‚é¸¦HRå¾ˆæ˜ç¡®çš„å‘Šè¯‰æˆ‘ï¼Œå…¬å¸åŠ ç­ä¸¥é‡ï¼Œå¤§å°å‘¨ã€‚æˆ‘æƒ³ï¼Œè¿™æ ·çš„å…¬å¸æ˜¯æˆ‘æƒ³è¦å»ä¸ºä¹‹å¥‹æ–—çš„å—ï¼Ÿä¸ï¼Œå¯¹äºå…¬å¸æ¥è¯´ï¼Œå‘˜å·¥éƒ½åªæ˜¯å…¬å¸çš„ä¸€é¢—é¢—çš„èºä¸é’‰ï¼Œéƒ½æ˜¯å¯è¢«æ›¿ä»£çš„é›¶ä»¶ï¼Œä¸ºä½•è¦ä¸ºè¿™ç§è¡€æ±—å·¥å‚å»ç‰ºç‰²è‡ªå·±çš„ç”Ÿæ´»ï¼Œæ­å·çš„996ç›¸å¿…åœ¨æœ€è¿‘äº”å¹´ä¹‹å†…éƒ½ä¼šæ˜¯è¿™ä¸ªåŸå¸‚ç¨‹åºå‘˜çš„æ¢¦é­‡ï¼Œæœ€è®©äººæ— å¥ˆçš„æ˜¯ï¼Œæœ‰äº›äººç«Ÿç„¶çœŸçš„è®¤ä¸ºè‡ªå·±æ˜¯åœ¨ä¸ºè‡ªå·±â€œå¥‹æ–—â€ï¼Œæ®Šä¸çŸ¥ä»–ä»¬æ˜¯è¢«å‹è¿«çš„ç¤¾ä¼šåº•å±‚çš„åŠ³åŠ¨è€…ï¼Œå¿˜è®°äº†æ›¾ç»çš„â€œ8å°æ—¶å·¥ä½œåˆ¶â€æ˜¯ç”±ä¸€äº›å¤šä¹ˆå‘å¾€è‡ªç”±çš„äººåæŠ—äº‰å–æ¥çš„ï¼ŒçœŸæ­£å®£ä¼ 996â€œç¦æŠ¥â€çš„èµ„æœ¬å®¶å·²ç»èµšè¶³äº†é’±é€€ä¼‘äº†ï¼ˆå†™äº2019å¹´9æœˆ10æ—¥ï¼‰ã€‚</p><h4 id="å›é¦–"><a href="#å›é¦–" class="headerlink" title="å›é¦–"></a>å›é¦–</h4><p>æˆ‘åœ¨å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ï¼Œè„‘ä¸­ä¸æ–­åœ°å›å¿†èµ·17å¹´2æœˆåº•æ¥åˆ°æ­å·ç›´åˆ°ç°åœ¨å‘ç”Ÿçš„ç§ç§äº‹æƒ…ã€‚ç¡®å®ç”±é‚£å¥è¯æ‰€è¯´ï¼Œå¾ˆå¤šå¹´åå›æƒ³èµ·æ¥ï¼Œä½ ä»€ä¹ˆæ—¶å€™å‡†å¤‡è€ƒç ”ã€å‡ºå›½ç•™å­¦ã€å·¥ä½œã€æ‹çˆ±ã€ç»“å©šç”Ÿå­ã€è·³æ§½ï¼Œéƒ½æœ‰å¯èƒ½ä¼šæ˜¯äººç”Ÿä¸­çš„ä¸€ä¸ªå¤§çš„è½¬æŠ˜ç‚¹ï¼Œè€Œè‡ªå·±å½“æ—¶è¿˜åªæ˜¯è®¤ä¸ºè¿™äº›äº‹åªæ˜¯äººç”Ÿä¸­å¾ˆå°çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><p>ä»åŒèŠ±é¡ºè·³æ§½å»æ­å·çš„ç¬¬äºŒå®¶å…¬å¸å·¥ä½œï¼Œæ˜¯æˆ‘è¿™ä¸¤å¹´æœ€åæ‚”çš„äº‹æƒ…ã€‚å¦‚æœæˆ‘å½“æ—¶ä¸ä»åŒèŠ±é¡ºèµ°ï¼Œæˆ–è€…è¯´åœ¨åŒèŠ±é¡ºèƒ½æœ‰ä¸€äº›å¥½çš„å·¥ä½œä½“éªŒï¼Œä¹Ÿè®¸ç›®å‰å°±æ˜¯å¦ä¸€ç§çŠ¶æ€äº†å§ã€‚åŸæœ¬æˆ‘è·³æ§½åçš„è®¡åˆ’æ˜¯ï¼Œåœ¨æ–°çš„å…¬å¸å°†è‡ªå·±æ²‰æ·€ä¸¤ä¸‰å¹´ï¼Œå°†æŠ€æœ¯æå‡ä¸Šå»ï¼Œä¸‰å¹´åè·³æ§½å»ä¸€çº¿å¤§å…¬å¸ï¼Œä½†æ˜¯æ— å¥ˆå…¬å¸è¿æ”¯æŒæˆ‘å¾…å¤Ÿä¸¤å¹´éƒ½åšä¸åˆ°ã€‚2019å¹´ï¼Œå…¶å®æ˜¯æˆ‘æœ€æŠ‘éƒï¼Œä¸–ç•Œæœ€é»‘æš—çš„ä¸€å¹´ã€‚è¿™å¹´æ¥ï¼Œåœ¨æ–°çš„å…¬å¸å·¥ä½œï¼Œå…¬å¸å‘å±•ä¸é¡ºåˆ©ï¼Œå¿—åŒé“åˆçš„æœ‹å‹ä¹Ÿæ¸å°‘ï¼Œä»¥å‰å‡ ä¸ªè€æœ‹å‹ä»æ¯å‘¨å‡ æ¬¡åœ¨ä¸€èµ·åƒé¥­ã€ç©çš„çŠ¶æ€çªç„¶å°±å˜æˆä¸€ä¸ªæœˆéƒ½è§ä¸äº†ä¸€é¢ã€‚ä¹Ÿè®¸æ˜¯ä»–ä»¬ä¹Ÿéƒ½æœ‰äº†è‡ªå·±çš„å¥³æœ‹å‹ï¼Œæœ‰äº†è‡ªå·±çš„ç”Ÿæ´»ï¼Œé¡¾ä¸ä¸Šæˆ‘äº†å§ã€‚è€Œæˆ‘æ¯å‘¨æœ«éƒ½æƒ³å‡ºå»ç©ï¼Œå´æ‰¾ä¸åˆ°åŒè¡Œçš„ä¼™ä¼´ã€‚</p><p>åœ¨æ­å·çš„ä¸¤å¹´æ—¶é—´ï¼Œæˆ‘å»äº†å‘¨è¾¹çš„å¾ˆå¤šåœ°æ–¹ï¼Œåˆšæ¯•ä¸šé‚£ä¼šä¹Ÿè®¸æƒ³çš„æ˜¯ï¼Œæˆ‘ç»ˆäºè·å¾—äº†è‡ªå·±æƒ³è¦çš„è‡ªç”±ç”Ÿæ´»ï¼Œå·¥èµ„ä¹Ÿè¶³ä»¥è®©æˆ‘åˆ°å¤„å»æ—…æ¸¸ã€‚æˆ‘æ›¾ç»æƒ³ï¼Œè‡ªå·±å®¶è¦æ˜¯æ±Ÿæµ™æ²ªè¿™ä¸€å¸¦çš„è¯¥æœ‰å¤šå¥½ï¼Œè¥¿å®‰é‚£è¾¹çœŸçš„å¾ˆè½åï¼Œè™½ç„¶åŸå¸‚ä¸­ä¸å¤ªçœ‹å¾—å‡ºå·®è·ï¼Œä½†æ˜¯åŸå¸‚å‘¨è¾¹çš„å¸‚ã€å¿ã€æ‘ï¼Œå´æ˜¯è¥¿åŒ—é‚£è¾¹æ€ä¹ˆä¹Ÿè¿½èµ¶ä¸ä¸Šæ¥çš„ã€‚è€Œä¸”æˆ‘åœ¨è¿™è¾¹èƒ½å¤Ÿæ¥è§¦åˆ°æ›´æ–°çš„ä¸œè¥¿ï¼Œä¸€äº›æ–°å…´çš„äº’è”ç½‘äº§å“éƒ½ä¼šåœ¨è¿™ä¸€å¸¦ä¼˜å…ˆæŠ•æ”¾ï¼Œä¾‹å¦‚å…±äº«å•è½¦ã€å…±äº«å……ç”µå®ã€æ™ºæ…§åŸå¸‚æœåŠ¡ç­‰ç­‰ã€‚æˆ‘æƒ³æ­å·åº”è¯¥ä¼šæ˜¯æœ€ä¼˜å…ˆå¼€å§‹æ™ºèƒ½åŒ–ã€äº’è”ç½‘åŒ–çš„åŸå¸‚ä¹‹ä¸€å§ã€‚</p><p>å¯æƒœäº†ï¼Œå³å°†ç¦»å¼€è¿™é‡Œï¼Œæ”¾å¼ƒä¸¤å¹´æ¥åœ¨è¿™è¾¹æ‹¥æœ‰çš„ä¸€åˆ‡ã€‚æˆ‘çš„æœ‹å‹ï¼Œè¿˜æœ‰æˆ‘çš„ç”Ÿæ´»ã€‚è™½ç„¶å¾ˆä¸æƒ³è¯´å†è§ï¼Œä½†æ˜¯è°åˆèƒ½ä¸»å¯¼è‡ªå·±çš„å‘½è¿å‘¢ã€‚</p><p>æ­å·ï¼Œæœ‰ç¼˜å†è§å§ï¼</p><p><img src="/blog/20190909/å…¶å®æˆ‘ä¸æƒ³ç¦»å¼€è¿™é‡Œ/mu.jpg" alt=""></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190909/å…¶å®æˆ‘ä¸æƒ³ç¦»å¼€è¿™é‡Œ/fm.png&quot; alt=&quot;æ­å·è¥¿æ¹–&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="http://zhangjiaheng.cn/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
    
      <category term="ä¸ªäººéšç¬”" scheme="http://zhangjiaheng.cn/tags/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸ƒ)ï¼šFork/Joinæ¡†æ¶åŸç†åŠdemo</title>
    <link href="http://zhangjiaheng.cn/blog/20190814/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E4%B8%83-%EF%BC%9AFork-Join%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E5%8F%8Ademo/"/>
    <id>http://zhangjiaheng.cn/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/</id>
    <published>2019-08-14T08:48:56.000Z</published>
    <updated>2019-11-01T01:40:48.237Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fm.jpg" alt="fm.jpg"></p><a id="more"></a><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Fork/Joinæ¡†æ¶æ˜¯jdk1.7å¼•å…¥çš„ä¸€ä¸ªåŸºäºâ€œåˆ†æ²»â€æ€æƒ³çš„å¤šçº¿ç¨‹æ¡†æ¶ã€‚å®ƒçš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ‡åˆ†(<strong>fork</strong>)æˆå¤šä¸ªç›¸åŒé€»è¾‘çš„å°ä»»åŠ¡ï¼Œåˆ†è€Œæ²»ä¹‹ï¼Œå½“å­ä»»åŠ¡å…¨éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°†ç»“æœåˆå¹¶(<strong>join</strong>)èµ·æ¥ï¼Œæœ€ç»ˆæˆä¸ºæ•´ä½“ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚åŸç†å¯ä»¥æŠ½è±¡æˆä¸‹å›¾è¡¨ç¤ºï¼š</p><p><img src="/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fj.png" alt="Fork/Join"></p><h3 id="Fork-Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³"><a href="#Fork-Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³" class="headerlink" title="Fork/Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³"></a>Fork/Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³</h3><h6 id="Fork-Joinæ‰§è¡Œæ­¥éª¤"><a href="#Fork-Joinæ‰§è¡Œæ­¥éª¤" class="headerlink" title="Fork/Joinæ‰§è¡Œæ­¥éª¤"></a>Fork/Joinæ‰§è¡Œæ­¥éª¤</h6><ol><li><p>è¿›è¡Œä»»åŠ¡åˆ†å‰²ï¼šå°†ä»»åŠ¡åˆ†å‰²æˆå°ä»»åŠ¡ï¼Œç„¶åè¿™ä¸ªå°ä»»åŠ¡æœ‰å¯èƒ½è¿˜éœ€è¦ç»§ç»­åˆ†å‰²ï¼Œç›´åˆ°è¶³å¤Ÿå°ã€‚</p></li><li><p>æ‰§è¡Œå¹¶åˆå¹¶ç»“æœï¼šåˆ†å‰²çš„å­ä»»åŠ¡åˆ†åˆ«æ”¾åœ¨åŒç«¯é˜Ÿåˆ—é‡Œï¼Œç„¶åå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»åŒç«¯é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ‰§è¡Œã€‚å­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœéƒ½ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä»é˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ï¼Œç„¶ååˆå¹¶è¿™äº›æ•°æ®ã€‚</p></li></ol><p>Fork/Joinä½¿ç”¨ä¸¤ä¸ªç±»å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼š</p><ul><li><strong>ForkJoinTask</strong>ï¼š<ul><li>Fork/Joinæä¾›äº†ä¸¤ä¸ªå­ç±»ï¼šRecursiveActionï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ï¼›RecursiveTask ï¼šç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡</li></ul></li><li><strong>ForkJoinPool</strong> ï¼š<code>public class ForkJoinPool extends AbstractExecutorService{ ... }</code>ForkJoinTaskéœ€è¦é€šè¿‡ForkJoinPoolæ¥æ‰§è¡Œï¼Œä»»åŠ¡åˆ†å‰²å‡ºçš„å­ä»»åŠ¡ä¼šæ·»åŠ åˆ°å½“å‰å·¥ä½œçº¿ç¨‹æ‰€ç»´æŠ¤çš„åŒç«¯é˜Ÿåˆ—ä¸­ï¼Œè¿›å…¥é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—é‡Œæš‚æ—¶æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šéšæœºä»å…¶ä»–å·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—çš„å°¾éƒ¨è·å–ä¸€ä¸ªä»»åŠ¡ã€‚è¿™ç§ç®—æ³•æˆä¸º<strong>å·¥ä½œçªƒå–ç®—æ³•(work-stealing)</strong></li></ul><h6 id="å·¥ä½œçªƒå–ç®—æ³•-work-stealing"><a href="#å·¥ä½œçªƒå–ç®—æ³•-work-stealing" class="headerlink" title="å·¥ä½œçªƒå–ç®—æ³•(work-stealing)"></a>å·¥ä½œçªƒå–ç®—æ³•(work-stealing)</h6><ul><li><p>Fork/Joinæ¡†æ¶å†…éƒ¨å®ç°äº†ä¸€ä¸ªç±»ä¼¼äºLinkedBlockingDequeçš„åŒç«¯é˜Ÿåˆ—ç”¨ä½œå·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—<strong>WorkQueue</strong>ã€‚ä½¿ç”¨<code>ForkJoinWorkerThread</code>ä¿å­˜å·¥ä½œçº¿ç¨‹ï¼Œ<code>ForkJoinPool.WorkQueue</code>å°±åœ¨å…¶å†…éƒ¨ã€‚</p></li><li><p>Fork/Joinæ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨è¿è¡Œä¸­äº§ç”Ÿäº†æ–°çš„ä»»åŠ¡(é€šå¸¸æ˜¯è°ƒç”¨forkæ–¹æ³•)çš„æ—¶å€™ï¼Œå°†ä»»åŠ¡åŠ å…¥WorkQueueå°¾éƒ¨ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹æ¯æ¬¡å–å‡ºä»»åŠ¡æ‰§è¡Œä¹Ÿæ˜¯ä»é˜Ÿå°¾å–å‡ºæ‰§è¡Œï¼Œå³LIFO</p></li><li><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨å¤„ç†è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—åŒæ—¶ï¼Œä¼šå°è¯•çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼ˆæˆ–æ˜¯æ¥è‡ªäºåˆšåˆšæäº¤åˆ° pool çš„ä»»åŠ¡ï¼Œæˆ–æ˜¯æ¥è‡ªäºå…¶ä»–å·¥ä½œçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ï¼‰ï¼Œçªƒå–çš„ä»»åŠ¡ä½äºå…¶ä»–çº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯è¯´å·¥ä½œçº¿ç¨‹åœ¨çªƒå–å…¶ä»–å·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ FIFO æ–¹å¼ã€‚</p></li><li><p>åœ¨é‡åˆ° join() æ—¶ï¼Œå¦‚æœéœ€è¦ join çš„ä»»åŠ¡å°šæœªå®Œæˆï¼Œåˆ™ä¼šå…ˆå¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚</p></li><li><p>åœ¨æ—¢æ²¡æœ‰è‡ªå·±çš„ä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥çªƒå–çš„ä»»åŠ¡æ—¶ï¼Œè¿›å…¥ä¼‘çœ ã€‚</p></li></ul><h3 id="Fork-Join-demoæ¼”ç¤º"><a href="#Fork-Join-demoæ¼”ç¤º" class="headerlink" title="Fork/Join demoæ¼”ç¤º"></a>Fork/Join demoæ¼”ç¤º</h3><blockquote><p>ä½¿ç”¨Fork/Joinå®Œæˆå¤§é‡æœ‰åºæ•°å­—çš„åŠ å’Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculateTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THREADSHOLD = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> start;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyCalculateTask</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end, List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.start = start;</span><br><span class="line">    <span class="keyword">this</span>.end = end;</span><br><span class="line">    <span class="keyword">this</span>.list = list;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (end - start &lt; THREADSHOLD) &#123;</span><br><span class="line">      <span class="comment">// å½“ä¸¤æ•°å­—ä¹‹é—´å·®å€¼å°äºæŒ‡å®šå€¼ å°±ä¸å†æŸ¥åˆ†æˆå°ä»»åŠ¡ </span></span><br><span class="line">      String so = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">        so += list.get(i) + <span class="string">","</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(Thread.currentThread().getName() + <span class="string">"å¤„ç† "</span> + so + <span class="string">" çš„æ•°æ®"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">int</span> mid = (start + end) / <span class="number">2</span>;</span><br><span class="line">      <span class="comment">// ä¸€åˆ†ä¸ºäºŒ æ‹†åˆ†ä»»åŠ¡</span></span><br><span class="line">      <span class="keyword">final</span> MyCalculateTask left = <span class="keyword">new</span> MyCalculateTask(start, mid, list);</span><br><span class="line">      <span class="keyword">final</span> MyCalculateTask right = <span class="keyword">new</span> MyCalculateTask(mid, end, list);</span><br><span class="line">      left.fork();</span><br><span class="line">      right.fork();</span><br><span class="line">      sum += left.join();</span><br><span class="line">      sum += right.join();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">400</span>;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      list.add(<span class="string">"i-"</span> + i);</span><br><span class="line">      sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    MyCalculateTask task = <span class="keyword">new</span> MyCalculateTask(<span class="number">0</span>, count, list);</span><br><span class="line">    <span class="keyword">final</span> ForkJoinTask&lt;Integer&gt; submit = pool.submit(task);</span><br><span class="line">    System.out.println(<span class="string">"sum = "</span> + sum + <span class="string">" --- submit.get() = "</span> + submit.get());</span><br><span class="line">    pool.awaitTermination(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">    pool.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Fork/Joinæ¡†æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå¾ˆå¤šè¿™ç§å¤§ä»»åŠ¡å¯ä»¥æ‹†åˆ†æˆå°ä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯ï¼Œä¸è¿‡ä¸Šé¢çš„æ–¹æ³•å¹¶ä¸æ˜¯æœ€ä½³æ‰§è¡Œè°ƒç”¨æ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">left.fork();  </span><br><span class="line">right.fork();</span><br><span class="line">æ›¿æ¢ä¸º</span><br><span class="line">invokeAll(left, right);</span><br></pre></td></tr></table></figure><p>å› ä¸ºå¯¹äºFork/Joinæ¨¡å¼ï¼Œå‡å¦‚Poolé‡Œé¢çº¿ç¨‹æ•°é‡æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆè°ƒç”¨å­ä»»åŠ¡çš„forkæ–¹æ³•ç›¸å½“äºAå…ˆåˆ†å·¥ç»™Bï¼Œç„¶åAå½“ç›‘å·¥ä¸å¹²æ´»ï¼ŒBå»å®ŒæˆAäº¤ä»£çš„ä»»åŠ¡ã€‚æ‰€ä»¥ä¸Šé¢çš„æ¨¡å¼ç›¸å½“äºæµªè´¹äº†ä¸€ä¸ªçº¿ç¨‹ã€‚é‚£ä¹ˆå¦‚æœä½¿ç”¨invokeAllç›¸å½“äºAåˆ†å·¥ç»™Båï¼ŒAå’ŒBéƒ½å»å®Œæˆå·¥ä½œã€‚è¿™æ ·å¯ä»¥æ›´å¥½çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œç¼©çŸ­æ‰§è¡Œçš„æ—¶é—´ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="http://ifeve.com/talk-concurrency-forkjoin/" target="_blank" rel="noopener">http://ifeve.com/talk-concurrency-forkjoin/</a></p></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fm.jpg&quot; alt=&quot;fm.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Fork/Joinæ¡†æ¶" scheme="http://zhangjiaheng.cn/tags/Fork-Join%E6%A1%86%E6%9E%B6/"/>
    
      <category term="ForkJoinPool" scheme="http://zhangjiaheng.cn/tags/ForkJoinPool/"/>
    
      <category term="çº¿ç¨‹æ± " scheme="http://zhangjiaheng.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†</title>
    <link href="http://zhangjiaheng.cn/blog/20190812/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9F%BA%E6%9C%AC%E6%80%9D%E6%83%B3%E4%BB%A5%E5%8F%8A23%E7%A7%8D%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E6%95%B4%E7%90%86/"/>
    <id>http://zhangjiaheng.cn/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/</id>
    <published>2019-08-12T03:47:54.000Z</published>
    <updated>2019-11-01T01:40:48.200Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/bz.png" alt="å°é¢"></p><a id="more"></a><h3 id="è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³"><a href="#è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³"></a>è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³</h3><p>è®¾è®¡æ¨¡å¼æ˜¯åœ¨é•¿æœŸåº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼—å¤šå¼€å‘è€…æ€»ç»“å½’çº³å‡ºæ¥çš„ç¨‹åºæ¶æ„ä¸è®¾è®¡æ€æƒ³ã€‚æ˜¯ç»è¿‡å®è·µè¯æ˜çš„ï¼Œå¯åœ¨å®é™…èƒŒæ™¯ä¸‹ä½¿ç”¨çš„ä¸€ç³»åˆ—ç¨‹åºè®¾è®¡æ–¹æ¡ˆã€‚è®¾è®¡æ¨¡å¼äº§ç”Ÿçš„æ ¹æœ¬ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³å¼€å‘è¿‡ç¨‹ä¸­é‡å¤çš„ä»£ç ç¼–å†™ï¼Œä»¥åŠè®©ç¨‹åºæ›´æ˜“æ‰©å±•å¤ç”¨ã€‚</p><h4 id="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„åŸåˆ™</h4><ul><li>å•ä¸€èŒè´£ï¼šæ¯ä¸ªç±»éƒ½åº”è¯¥å®ç°å•ä¸€çš„åŠŸèƒ½ï¼Œå¦åˆ™åº”è¯¥å°†ç±»è¿›è¡Œæ‹†åˆ†</li><li>é‡Œæ°æ›¿æ¢ï¼šå³ç»§æ‰¿å¤ç”¨/åˆæˆå¤ç”¨ã€‚å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼è€Œä¸æ˜¯ç»§æ‰¿ã€‚ä»»ä½•çˆ¶ç±»å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»éƒ½å¯ä»¥å‡ºç°ã€‚æ´¾ç”Ÿç±»å¯ä»¥åœ¨åŸºç±»çš„åŸºç¡€ä¸Šæ‰©å±•è‡ªå·±çš„åŠŸèƒ½å®ç°ã€‚æ˜¯å¯¹â€œå¼€é—­åŸåˆ™â€çš„ä¸€ä¸ªè¡¥å……ã€‚åœ¨é‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ï¼Œå°½é‡ä¸è¦å¯¹çˆ¶ç±»è¿›è¡Œé‡è½½æˆ–è€…é‡å†™ï¼Œå› ä¸ºçˆ¶ç±»ä»£è¡¨ä¸€ä¸ªå®šä¹‰å¥½çš„ç»“æ„ï¼Œé€šè¿‡è§„èŒƒå¥½çš„æ¥å£ä¸å¤–ç•Œè¿›è¡Œäº¤äº’ï¼Œå­ç±»ä¸åº”è¯¥éšæ„ç ´åå®ƒï¼Œè€Œæ˜¯å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚</li><li>ä¾èµ–å€’ç½®ï¼šâ€œå¼€é—­åŸåˆ™â€çš„åŸºç¡€ã€‚å³é¢å‘æ¥å£ç¼–ç¨‹ã€‚ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¾èµ–äºå…·ä½“çš„å®ç°ï¼Œç¼–ç¨‹æ—¶é‡åˆ°å…·ä½“çš„ç±»æ—¶ï¼Œä¸ä¸å…·ä½“çš„ç±»äº¤äº’ï¼Œè€Œä¸æŠ½è±¡æ¥å£è¿›è¡Œäº¤äº’ã€‚ä¾¿äºå¢åŠ æ–°çš„å…·ä½“ç±»çš„æ—¶å€™ä»£ç å¯ä»¥å¤ç”¨ã€‚</li><li>æ¥å£éš”ç¦»ï¼šæ¯ä¸ªæ¥å£ä¸åº”è¯¥å­˜åœ¨å­ç±»ç”¨ä¸åˆ°å´å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œå¦åˆ™å°±åº”è¯¥å°†æ¥å£æ‹†åˆ†ï¼Œå°†èŒè´£å•ä¸€åŒ–ã€‚</li><li>æœ€å°‘çŸ¥é“ï¼šå³è¿ªç±³ç‰¹æ³•åˆ™ã€‚ä¸€ä¸ªç±»å¯¹äºè‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ï¼Œæ— è®ºè¢«ä¾èµ–çš„ç±»å¤šä¹ˆå¤æ‚ï¼Œéƒ½åº”è¯¥å°†é€»è¾‘å°è£…åœ¨æ–¹æ³•å†…éƒ¨ï¼Œé€šè¿‡ä¸€ä¸ªå…±æœ‰çš„æ–¹æ³•æä¾›ç»™ä¾èµ–ç±»ä½¿ç”¨ï¼Œè¿™æ ·å½“è¢«ä¾èµ–ç±»å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šå°½å¯èƒ½å°‘çš„å½±å“ä¾èµ–ç±»ã€‚</li></ul><h3 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h3><blockquote><p>ç‚¹å‡»å¯¹åº”é“¾æ¥è·³è½¬åˆ°è¯¥è®¾è®¡æ¨¡å¼çš„è¯¦ç»†æ•´ç†ä¸ä»£ç ç¤ºä¾‹</p></blockquote><table><thead><tr><th>èŒƒå›´</th><th>åˆ›å»ºå‹æ¨¡å¼</th><th>ç»“æ„å‹æ¨¡å¼</th><th>è¡Œä¸ºå‹æ¨¡å¼</th></tr></thead><tbody><tr><td>å¯¹è±¡åˆ›å»º</td><td><a href="http://zhangjiaheng.cn/blog/20190607/%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%95%E4%BE%8B/">Singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</a><br>Prototype(åŸå‹æ¨¡å¼)<br>Factory Methodï¼ˆå·¥å‚æ–¹æ³•æ¨¡å¼ï¼‰<br>Abstract Factoryï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰<br>Builderï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰</td><td></td><td></td></tr><tr><td>æ¥å£é€‚é…</td><td></td><td>Adapterï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰<br>Bridgeï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰<br>Facadeï¼ˆå¤–è§‚æ¨¡å¼ï¼‰</td><td></td></tr><tr><td>å¯¹è±¡è§£è€¦</td><td></td><td></td><td>Mediatorï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰<br>Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰</td></tr><tr><td>æŠ½è±¡é›†åˆ</td><td></td><td>Compositeï¼ˆç»„åˆæ¨¡å¼ï¼‰</td><td>Iteratorï¼ˆè¿­ä»£å™¨æ¨¡å¼ï¼‰</td></tr><tr><td>è¡Œä¸ºæ‰©å±•</td><td></td><td>Decoratorï¼ˆè£…é¥°æ¨¡å¼ï¼‰</td><td>Visitorï¼ˆè®¿é—®è€…æ¨¡å¼ï¼‰<br>Chain of Responsibilityï¼ˆèŒè´£é“¾ï¼‰</td></tr><tr><td>ç®—æ³•å°è£…</td><td></td><td></td><td><a href="http://zhangjiaheng.cn/blog/20190707/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/">Templateï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰</a><br>Strategyï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</td></tr><tr><td>æ€§èƒ½ä¸å¯¹è±¡è®¿é—®</td><td></td><td>Flyweightï¼ˆäº«å…ƒæ¨¡å¼ï¼‰<br>Proxyï¼ˆä»£ç†æ¨¡å¼ï¼‰</td><td></td></tr><tr><td>å¯¹è±¡çŠ¶æ€</td><td></td><td></td><td>Mementoï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰<br>Stateï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰</td></tr><tr><td>å…¶ä»–</td><td></td><td></td><td>Interpreterï¼ˆè§£é‡Šå™¨æ¨¡å¼ï¼‰</td></tr></tbody></table><h4 id="æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»"><a href="#æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»" class="headerlink" title="æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»"></a>æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»</h4><p><img src="/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/sjmo.png" alt="è®¾è®¡æ¨¡å¼åˆ†ç±» - å¹•å¸ƒ"></p><h4 id="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"><a href="#åˆ›å»ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"></a>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</h4><p>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œä½¿è°ƒç”¨è€…æ— éœ€newå¯¹è±¡ï¼Œåœ¨ç¨‹åºä¸­é’ˆå¯¹ç»™å®šä¸šåŠ¡åœºæ™¯å»è°ƒç”¨ç‰¹å®šçš„å¯¹è±¡åˆ›å»ºæ–¹æ³•ï¼Œä½¿ç¨‹åºæ›´åŠ çµæ´»ã€‚</p><h4 id="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"><a href="#è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"></a>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</h4><p>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚</p><h4 id="ç»“æ„å‹è®¾è®¡æ¨¡å¼"><a href="#ç»“æ„å‹è®¾è®¡æ¨¡å¼" class="headerlink" title="ç»“æ„å‹è®¾è®¡æ¨¡å¼"></a>ç»“æ„å‹è®¾è®¡æ¨¡å¼</h4><p>ç»“æ„å‹è®¾è®¡æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œç»§æ‰¿çš„æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡è·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/bz.png&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9F%BA%E6%9C%AC%E6%80%9D%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode - 52. Nçš‡å II å›æº¯ç®—æ³•æ±‚è§£</title>
    <link href="http://zhangjiaheng.cn/blog/20190809/Leetcode-52-N%E7%9A%87%E5%90%8E-II-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E6%B1%82%E8%A7%A3/"/>
    <id>http://zhangjiaheng.cn/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/</id>
    <published>2019-08-09T10:19:50.000Z</published>
    <updated>2019-11-01T01:40:48.191Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Nçš‡åé—®é¢˜-leetcode"><a href="#Nçš‡åé—®é¢˜-leetcode" class="headerlink" title="Nçš‡åé—®é¢˜ - leetcode"></a>Nçš‡åé—®é¢˜ - <a href="https://leetcode-cn.com/problems/n-queens-ii/" target="_blank" rel="noopener">leetcode</a></h4><p>n çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚<img src="/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/8-queens.png" alt="8çš‡åç¤ºä¾‹"><br>ä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å› n çš‡åä¸åŒçš„è§£å†³æ–¹æ¡ˆçš„æ•°é‡ã€‚</p><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><blockquote><p>è¾“å…¥: 4<br>è¾“å‡º: 2<br>è§£é‡Š: 4 çš‡åé—®é¢˜å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªä¸åŒçš„è§£æ³•ã€‚<br><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">[".Q..", Â // è§£æ³• 1</span><br><span class="line">"...Q",</span><br><span class="line">"Q...",</span><br><span class="line">"..Q."],</span><br><span class="line">["..Q.", Â // è§£æ³• 2</span><br><span class="line">"Q...",</span><br><span class="line">"...Q",</span><br><span class="line">".Q.."]</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p></blockquote><a id="more"></a><h4 id="è§£é¢˜æ€è·¯ï¼š"><a href="#è§£é¢˜æ€è·¯ï¼š" class="headerlink" title="è§£é¢˜æ€è·¯ï¼š"></a>è§£é¢˜æ€è·¯ï¼š</h4><p>ä½¿ç”¨å›æº¯ç®—æ³•ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œè¿›è¡Œéå†æŸ¥è¯¢æ·±åº¦ä¼˜å…ˆæœç´¢çš„æ¡ä»¶æ˜¯æœ‰èƒ½å¤Ÿåˆ¤æ–­æ£‹ç›˜æ˜¯å¦èƒ½è½å­çš„ä¾æ®ã€‚</p><p>æˆ‘è¿™è¾¹ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°ç»„å­˜å‚¨ç¬¬Jåˆ—æ˜¯å¦æœ‰æ£‹å­ï¼Œä½¿ç”¨ä¸¤ä¸ªN*2-1é•¿åº¦çš„æ•°ç»„åˆ†åˆ«å­˜å‚¨å·¦å¯¹è§’çº¿å’Œå³å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­ã€‚</p><p>å¯¹äºå·¦å³å¯¹è§’çº¿æ¥è¯´ï¼Œå·¦å¯¹è§’çº¿çš„æ¯ä¸€ä¸ªä½ç½®iä¸jçš„å’Œéƒ½ç›¸åŒï¼Œå³å¯¹è§’çº¿çš„æ¯ä¸€ä¸ªä½ç½®çš„iä¸jçš„å·®éƒ½ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªä½ç½®çš„æ–œçº¿ä¸Šæ˜¯å¦å­˜åœ¨æ£‹å­ï¼Œå¯¹åº”å¯¹è§’çº¿çš„æ•°ç»„æ ‡å¿—ä¸ºæœ‰æˆ–è€…æ²¡æœ‰ã€‚</p><h4 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** æ€»è®°å½•æ•° */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/** Nçš‡å */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> N;</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„å·¦å¯¹è§’çº¿æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] left = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">15</span>];</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„å³å¯¹è§’çº¿æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] right = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">15</span>];</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„åˆ—æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] curn;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalNQueens</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.N = n;</span><br><span class="line">    curn = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">    left = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span> * n - <span class="number">1</span>];</span><br><span class="line">    right = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span> * n - <span class="number">1</span>];</span><br><span class="line">    calResult(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calResult</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ£‹ç›˜ç¬¬iè¡Œ éå†åˆ¤æ–­ç¬¬jåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">      <span class="comment">// å¼€å§‹åˆ¤æ–­ç¬¬iè¡Œç¬¬jåˆ—</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­ç¬¬jåˆ—æ˜¯å¦å·²ç»æœ‰æ£‹å­ï¼›åˆ¤æ–­(i,j)çš„å·¦å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­ï¼›åˆ¤æ–­å³å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­</span></span><br><span class="line">      <span class="keyword">if</span> (curn[j] == <span class="number">0</span> &amp;&amp; left[i + j] == <span class="number">0</span> &amp;&amp; right[N - <span class="number">1</span> + i - j] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰æ£‹å­ å°±å¯ä»¥åœ¨(i,j)æ”¾ç½®æ£‹å­</span></span><br><span class="line">        curn[j] = left[i + j] = right[N - <span class="number">1</span> + i - j] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœNè¡Œéƒ½æ”¾ç½®äº†æ£‹å­ totalå°±åŠ 1 å¦åˆ™ç»§ç»­æ”¾ç½®ä¸‹ä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; N - <span class="number">1</span>) &#123;</span><br><span class="line">          calResult(i + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          total++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ”¾ç½®å®Œæˆä¹‹å (i,j)ä½ç½®æ£‹å­å»æ‰ï¼Œç„¶åé‡æ–°èµ°ä¸‹ä¸€æ­¥ è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢</span></span><br><span class="line">        curn[j] = left[i + j] = right[N - <span class="number">1</span> + i - j] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Solution solution = <span class="keyword">new</span> Solution();</span><br><span class="line">    solution.totalNQueens(<span class="number">8</span>);</span><br><span class="line">    System.out.println(<span class="string">"total = "</span> + solution.total);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Nçš‡åé—®é¢˜-leetcode&quot;&gt;&lt;a href=&quot;#Nçš‡åé—®é¢˜-leetcode&quot; class=&quot;headerlink&quot; title=&quot;Nçš‡åé—®é¢˜ - leetcode&quot;&gt;&lt;/a&gt;Nçš‡åé—®é¢˜ - &lt;a href=&quot;https://leetcode-cn.com/problems/n-queens-ii/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;leetcode&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;n çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚&lt;img src=&quot;/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/8-queens.png&quot; alt=&quot;8çš‡åç¤ºä¾‹&quot;&gt;&lt;br&gt;ä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å› n çš‡åä¸åŒçš„è§£å†³æ–¹æ¡ˆçš„æ•°é‡ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç¤ºä¾‹ï¼š&quot;&gt;&lt;a href=&quot;#ç¤ºä¾‹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç¤ºä¾‹ï¼š&quot;&gt;&lt;/a&gt;ç¤ºä¾‹ï¼š&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;è¾“å…¥: 4&lt;br&gt;è¾“å‡º: 2&lt;br&gt;è§£é‡Š: 4 çš‡åé—®é¢˜å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªä¸åŒçš„è§£æ³•ã€‚&lt;br&gt;&lt;figure class=&quot;highlight md&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&quot;.Q..&quot;, Â // è§£æ³• 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;...Q&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;Q...&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;..Q.&quot;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&quot;..Q.&quot;, Â // è§£æ³• 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;Q...&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;...Q&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;.Q..&quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="leetcode" scheme="http://zhangjiaheng.cn/tags/leetcode/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£</title>
    <link href="http://zhangjiaheng.cn/blog/20190724/LeetCode%E4%B8%8A%E7%9A%84%E5%87%A0%E4%B8%AA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E9%A2%98%E8%A7%A3/"/>
    <id>http://zhangjiaheng.cn/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/</id>
    <published>2019-07-24T07:16:20.000Z</published>
    <updated>2019-11-01T01:40:48.187Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/fm.png" alt=""></p><a id="more"></a><h3 id="ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£-github"><a href="#ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£-github" class="headerlink" title="ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£ - github"></a><a href="https://github.com/Fatezhang/DataStructureAndAlgorithm/tree/master/src/main/java/Alogrithm/Alogrithm" target="_blank" rel="noopener">ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£ - github</a></h3><h4 id="1ã€æŒ‰åºæ‰“å°"><a href="#1ã€æŒ‰åºæ‰“å°" class="headerlink" title="1ã€æŒ‰åºæ‰“å°"></a>1ã€<a href="https://leetcode-cn.com/problems/print-in-order" target="_blank" rel="noopener">æŒ‰åºæ‰“å°</a></h4><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨volatileå˜é‡æ§åˆ¶é¡ºåº</li><li>æ€è·¯ï¼šåˆ©ç”¨volatileè¯­ä¹‰ï¼Œå®ç°å˜é‡çš„å†…å­˜å¯è§æ€§ï¼Œä½¿å¾—åˆ«çš„çº¿ç¨‹åœ¨ä¿®æ”¹å®ŒstateçŠ¶æ€å˜é‡çš„æ—¶å€™ç»“æœå¯¹äºå¦ä¸€ä¸ªçº¿ç¨‹ç«‹å³å¯è§ã€‚è¿™æ ·æ¯ä¸ªçº¿ç¨‹åœ¨æ‰“å°çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡çŠ¶æ€åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥è½®åˆ°è‡ªå·±æ‰§è¡Œäº†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">(Runnable printFirst)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printFirst.run() outputs "first". Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        state = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">second</span><span class="params">(Runnable printSecond)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">2</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printSecond.run() outputs "second". Do not change or remove this line.</span></span><br><span class="line">        printSecond.run();</span><br><span class="line">        state = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">third</span><span class="params">(Runnable printThird)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">3</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printThird.run() outputs "third". Do not change or remove this line.</span></span><br><span class="line">        printThird.run();</span><br><span class="line">        state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•äºŒï¼šä½¿ç”¨CountDownLatchæ§åˆ¶é¡ºåºï¼ˆåªé€‚ç”¨äºæ‰§è¡Œä¸€æ¬¡ã€‚ã€‚ã€‚å¯ä»¥ä½¿ç”¨å¾ªç¯æ …æ æ”¹ä¸€ä¸‹~ï¼‰</li><li>CountDownLatchä¿—ç§°â€œé—­é”â€ã€‚ä½¿ç”¨é—­é”æ¥æ§åˆ¶çº¿ç¨‹æ˜¯å¦è¯¥æ‰§è¡Œï¼Œåœ¨æ²¡æœ‰è¾¾åˆ°æ¡ä»¶æ—¶ï¼Œé—­é”é˜»å¡çº¿ç¨‹ã€‚è¿™æ ·åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åæ‰“å¼€ç¬¬äºŒä¸ªçº¿ç¨‹çš„é—­é”ï¼Œç¬¬äºŒä¸ªæ‰§è¡Œå®Œæˆä¹‹åæ‰“å¼€ç¬¬ä¸‰ä¸ªçº¿ç¨‹çš„é—­é”ï¼Œå®ç°æŒ‰ç…§é¡ºåºæ‰“å°ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch2 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch3 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">(Runnable printFirst)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        countDownLatch2.await();</span><br><span class="line">        <span class="comment">// printFirst.run() outputs "first". Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        countDownLatch2.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">second</span><span class="params">(Runnable printSecond)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        countDownLatch2.await();</span><br><span class="line">        <span class="comment">// printSecond.run() outputs "second". Do not change or remove this line.</span></span><br><span class="line">        printSecond.run();</span><br><span class="line">        countDownLatch3.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">third</span><span class="params">(Runnable printThird)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        <span class="comment">// printThird.run() outputs "third". Do not change or remove this line.</span></span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2ã€äº¤æ›¿æ‰“å°FooBar"><a href="#2ã€äº¤æ›¿æ‰“å°FooBar" class="headerlink" title="2ã€äº¤æ›¿æ‰“å°FooBar"></a>2ã€<a href="https://leetcode-cn.com/problems/print-foobar-alternately" target="_blank" rel="noopener">äº¤æ›¿æ‰“å°FooBar</a></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨æ˜¾ç¤ºå¯é‡å…¥é”åŠ ä¸ŠConditionæ¡ä»¶é˜»å¡æœºåˆ¶ï¼Œå†åŠ ä¸Švolatileä¿®é¥°çš„çŠ¶æ€å˜é‡æ§åˆ¶æ‰“å°é¡ºåºã€‚çº¿ç¨‹æ‰“å°æ—¶åŠ é”ï¼Œå¦‚æœçŠ¶æ€æ˜¯ä½¿å½“å‰çº¿ç¨‹æ‰“å°ï¼Œå°±æ‰“å°å¹¶ä¸”è½¬æ¢çŠ¶æ€ï¼Œç„¶åå”¤é†’å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸‹ä¸€æ¬¡å†åˆ¤æ–­å½“å‰çŠ¶æ€ä¸é€‚åˆæ‰“å°ï¼Œå°±ä½¿ç”¨ç¬¬ä¸€ä¸ªæ¡ä»¶é”é˜»å¡å½“å‰çº¿ç¨‹ã€‚ä»¥æ­¤ç±»æ¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> äº¤æ›¿æ‰“å°FooBar */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.n = n;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                c1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// printFoo.run() outputs "foo". Do not change or remove this line.</span></span><br><span class="line">            printFoo.run();</span><br><span class="line">            flag = !flag;</span><br><span class="line">            c2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">                c2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// printBar.run() outputs "bar". Do not change or remove this line.</span></span><br><span class="line">            printBar.run();</span><br><span class="line">            flag = !flag;</span><br><span class="line">            c1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3ã€æ‰“å°0ä¸å¥‡å¶æ•°"><a href="#3ã€æ‰“å°0ä¸å¥‡å¶æ•°" class="headerlink" title="3ã€æ‰“å°0ä¸å¥‡å¶æ•°"></a>3ã€<a href="https://leetcode-cn.com/problems/print-zero-even-odd" target="_blank" rel="noopener">æ‰“å°0ä¸å¥‡å¶æ•°</a></h4><ul><li>æ€è·¯ï¼šä¹Ÿæ˜¯ä½¿ç”¨æ˜¾ç¤ºå¯é‡å…¥é”åŠ ä¸Šæ¡ä»¶é˜»å¡æœºåˆ¶ï¼ŒåŠ ä¸Švolatileä¿®é¥°çš„çŠ¶æ€å˜é‡æ§åˆ¶å¥‡å¶æ•°çš„æ‰“å°ã€‚ä¸ç¬¦åˆå½“å‰æ‰§è¡Œçš„çŠ¶æ€å°±ä½¿ç”¨conditioné˜»å¡ï¼Œç¬¦åˆå°±æ‰§è¡Œå¹¶ä¸”è½¬æ¢çŠ¶æ€ï¼Œç„¶åå”¤é†’å…¶ä»–çº¿ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.function.IntConsumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> https://leetcode-cn.com/problems/print-zero-even-odd</span></span><br><span class="line"><span class="comment"> * 3ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°å’Œ0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZeroEvenOdd</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ZeroEvenOdd</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.n = n;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 0-æ‰“å°0 1-æ‰“å°å¥‡æ•° 2-æ‰“å°å¶æ•° */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zero</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">0</span>) &#123;</span><br><span class="line">          c1.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">          flag = <span class="number">1</span>;</span><br><span class="line">          c3.signal();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          flag = <span class="number">2</span>;</span><br><span class="line">          c2.signal();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">even</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">2</span>) &#123;</span><br><span class="line">          c2.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(i);</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">        c1.signal();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">odd</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">1</span>) &#123;</span><br><span class="line">          c3.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(i);</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">        c1.signal();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ZeroEvenOdd zeroEvenOdd = <span class="keyword">new</span> ZeroEvenOdd(<span class="number">5</span>);</span><br><span class="line">    ThreadPoolExecutor pools =</span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, TimeUnit.MINUTES, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>), r -&gt; <span class="keyword">new</span> Thread(r, <span class="string">"æŸçº¿ç¨‹"</span>));</span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.zero(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.even(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.odd(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4ã€H2Oç”Ÿæˆ"><a href="#4ã€H2Oç”Ÿæˆ" class="headerlink" title="4ã€H2Oç”Ÿæˆ"></a>4ã€<a href="https://leetcode-cn.com/problems/building-h2o" target="_blank" rel="noopener">H2Oç”Ÿæˆ</a></h4><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ˜¾ç¤ºé”å’Œcondition</li><li>æ€è·¯ï¼šè€ç”Ÿå¸¸è°ˆçš„æ€è·¯äº†ï¼ŒåŒä¸Šé¢ä¸€æ ·çš„åŸç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> æ°´åˆ†å­ç”Ÿæˆ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">H2O</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">H2O</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition H = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition O = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> hCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hydrogen</span><span class="params">(Runnable releaseHydrogen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">while</span> (hCount == <span class="number">2</span>) &#123;</span><br><span class="line">        H.await();</span><br><span class="line">      &#125;</span><br><span class="line">      hCount++;</span><br><span class="line">      releaseHydrogen.run();</span><br><span class="line">      <span class="keyword">if</span> (hCount == <span class="number">2</span>) &#123;</span><br><span class="line">        O.signal();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        H.signal();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oxygen</span><span class="params">(Runnable releaseOxygen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">while</span> (hCount != <span class="number">2</span>) &#123;</span><br><span class="line">        O.await();</span><br><span class="line">      &#125;</span><br><span class="line">      hCount = <span class="number">0</span>;</span><br><span class="line">      releaseOxygen.run();</span><br><span class="line">      H.signal();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String s = <span class="string">"HHOOOHHHH"</span>;</span><br><span class="line">    <span class="keyword">final</span> H2O o = <span class="keyword">new</span> H2O();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">'H'</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">                () -&gt; &#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    o.hydrogen(() -&gt; System.out.print(<span class="string">"H"</span>));</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            .start();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">                () -&gt; &#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    o.oxygen(() -&gt; System.out.print(<span class="string">"O"</span>));</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            .start();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•äºŒï¼šä½¿ç”¨ä¿¡å·é‡æ§åˆ¶é€šçŸ¥çº¿ç¨‹</li><li>æ€è·¯ï¼šä½¿ç”¨ä¿¡å·é‡æ§åˆ¶çº¿ç¨‹é—´çš„é€šä¿¡ã€‚åˆ†åˆ«åˆ†ä¸ºæ‰§è¡Œä¿¡å·å’Œå”¤é†’ä¿¡å·ï¼Œæ°¢åŸå­çš„æ‰§è¡Œä¿¡å·é¦–å…ˆä¸º2ï¼Œæ°§åŸå­çš„æ‰§è¡Œä¿¡å·é¦–å…ˆä¸º1ã€‚æ°¢æ°§çº¿ç¨‹æ‰§è¡Œæ—¶æ¶ˆè€—æ‰§è¡Œä¿¡å·é‡ï¼Œå½“ä¸€ä¸ªæ°¢åŸå­æ‰§è¡Œåï¼Œæ°¢åŸå­çš„é‡Šæ”¾ä¿¡å·å¼€å§‹é‡Šæ”¾ï¼ˆåªæœ‰ä¸€ä¸ªæ°§çº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾ï¼‰ï¼Œç„¶åç­‰å¾…æ°§åŸå­é‡Šæ”¾ä¿¡å·é‡Šæ”¾ï¼ˆå³ä¸€ä¸ªæ°§åŸå­å·²ç»äº§ç”Ÿï¼‰ï¼Œä¹‹åäº§ç”Ÿä¸€ä¸ªæ°¢åŸå­åœ¨é‡Šæ”¾è¯·æ±‚ä¿¡å·ã€‚æ°§çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¼€å§‹è¯·æ±‚é‡Šæ”¾ä¸€ä¸ªæ°§åŸå­ï¼ŒæˆåŠŸä¹‹åæ°§çº¿ç¨‹é‡Šæ”¾ä¿¡å·å¼€å§‹é‡Šæ”¾ï¼ˆå› ä¸º2ä¸ªæ°¢çº¿ç¨‹ç­‰å¾…æ‰€ä»¥é‡Šæ”¾ä¸¤ä¸ªä¿¡å·ï¼‰ï¼Œç„¶åç­‰å¾…æ°¢çº¿ç¨‹é‡Šæ”¾ä¸¤ä¸ªä¿¡å·ï¼ˆè¯´æ˜å·²ç»æœ‰ä¸¤ä¸ªæ°¢åŸå­ç”Ÿæˆï¼‰ã€‚ç„¶åå†ç”Ÿæˆæ°§åŸå­ï¼ŒæˆåŠŸä¹‹ååœ¨é‡Šæ”¾æ°§çº¿ç¨‹çš„è¯·æ±‚ä¿¡å·ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶æ°´åˆ†å­ç”Ÿæˆ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">H2O_2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Semaphore hAcquire, oAcquire, hRelease, oRelease;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">H2O_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// H åŸå­çº¿ç¨‹ è¯·æ±‚ä¿¡å·</span></span><br><span class="line">    hAcquire = <span class="keyword">new</span> Semaphore(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// O åŸå­çº¿ç¨‹ è¯·æ±‚ä¿¡å·</span></span><br><span class="line">    oAcquire = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// H åŸå­çº¿ç¨‹ é‡Šæ”¾ä¿¡å·</span></span><br><span class="line">    hRelease = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// O åŸå­çº¿ç¨‹ é‡Šæ”¾ä¿¡å·</span></span><br><span class="line">    oRelease = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hydrogen</span><span class="params">(Runnable releaseHydrogen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    hAcquire.acquire(); <span class="comment">// Hçº¿ç¨‹å¼€å§‹è¯·æ±‚</span></span><br><span class="line">    hRelease.release(); <span class="comment">// é€šçŸ¥ä¸€ä¸ªHçº¿ç¨‹å³å°†é‡Šæ”¾ å› ä¸ºä¸€ä¸ªHçº¿ç¨‹é‡Šæ”¾æœ€å¤šåªæœ‰ä¸€ä¸ªOçº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾</span></span><br><span class="line">    oRelease.acquire(); <span class="comment">// ç­‰å¾…Oçº¿ç¨‹é‡Šæ”¾ ä¸€ä¸ªOçº¿ç¨‹é‡Šæ”¾å°±å¯ä»¥é€šè¿‡</span></span><br><span class="line">    releaseHydrogen.run();</span><br><span class="line">    hAcquire.release(); <span class="comment">// å”¤é†’Hçº¿ç¨‹è¯·æ±‚</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oxygen</span><span class="params">(Runnable releaseOxygen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    oAcquire.acquire(); <span class="comment">// Oçº¿ç¨‹å¼€å§‹è¯·æ±‚</span></span><br><span class="line">    oRelease.release(<span class="number">2</span>); <span class="comment">// é€šçŸ¥ä¸€ä¸ªOçº¿ç¨‹å³å°†é‡Šæ”¾ å› ä¸ºä¸€ä¸ªOçº¿ç¨‹é‡Šæ”¾ ä¼šæœ‰ä¸¤ä¸ªHçº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾</span></span><br><span class="line">    hRelease.acquire(<span class="number">2</span>); <span class="comment">// ç­‰å¾…Hçº¿ç¨‹é‡Šæ”¾ è¦ç­‰å¾…ä¸¤æ¬¡é‡Šæ”¾ æ‰å¯ä»¥é€šè¿‡</span></span><br><span class="line">    releaseOxygen.run();</span><br><span class="line">    oAcquire.release(); <span class="comment">// å”¤é†’Oçº¿ç¨‹è¯·æ±‚</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String s = <span class="string">"HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHOOHHOOOOOHOOOHHHOHHHHOOOHHHOOOHOHOHOHHOHOOHHHOOHOOOHHOOOOHOHHHHOOOOOHHHOOOHOHOHOOOHHOHOOHHOHHHHHHHHHHHHHHHHHHHHHHHHHHH"</span>;</span><br><span class="line">    <span class="keyword">final</span> H2O_2 o = <span class="keyword">new</span> H2O_2();</span><br><span class="line">    ThreadPoolExecutor pool =</span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">300</span>,</span><br><span class="line">            <span class="number">300</span>,</span><br><span class="line">            <span class="number">10</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">100</span>),</span><br><span class="line">                (ThreadFactory) Thread::<span class="keyword">new</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">'H'</span>) &#123;</span><br><span class="line">        pool.execute(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</span><br><span class="line">                o.hydrogen(() -&gt; System.out.print(<span class="string">"H"</span>));</span><br><span class="line">              &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pool.execute(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</span><br><span class="line">                o.oxygen(() -&gt; System.out.print(<span class="string">"O"</span>));</span><br><span class="line">              &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/fm.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="leetcode" scheme="http://zhangjiaheng.cn/tags/leetcode/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹</title>
    <link href="http://zhangjiaheng.cn/blog/20190716/Synchronized%E4%BD%BF%E7%94%A8%E6%97%B6%E4%B8%80%E4%B8%AA%E4%B8%8D%E8%B5%B7%E7%9C%BC%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
    <id>http://zhangjiaheng.cn/blog/20190716/Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹/</id>
    <published>2019-07-16T09:12:47.000Z</published>
    <updated>2019-11-01T01:40:48.191Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Synchronized-å‰æƒ…æè¦"><a href="#Synchronized-å‰æƒ…æè¦" class="headerlink" title="Synchronized å‰æƒ…æè¦"></a>Synchronized å‰æƒ…æè¦</h4><p>Synchronizedæ˜¯Javaä¸­ç”¨æ¥è¿›è¡Œæ–¹æ³•æˆ–è€…ä»£ç åŒæ­¥çš„ä¸€ä¸ªå†…ç½®é”æœºåˆ¶ã€‚è¿™ç§å†…ç½®é”æœºåˆ¶å¯ä»¥ä¿è¯ä»£ç æ‰§è¡Œçš„åŸå­æ€§ã€å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å±è”½ä»£ç çš„é‡æ’åºã€‚Synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ã€å¯¹è±¡ä»¥åŠä»£ç å—ï¼Œå¹¶å¯ä»¥ä¿è¯è¢«ä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚</p><ul><li>ä¿®é¥°é™æ€æ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶Synchronizedæ²¡æœ‰è¡¨ç°åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè€Œæ˜¯åœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨ä¸­å°†è¯¥æ–¹æ³•çš„access_flagså€¼ç½®ä¸º1ã€‚è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æˆ–è¯¥æ–¹æ³•æ‰€å±çš„ Class åœ¨ JVM çš„å†…éƒ¨å¯¹è±¡è¡¨ç¤º Klass ä½œä¸ºé”å¯¹è±¡ã€‚</li><li>ä¿®é¥°æ™®é€šæ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶åŒä¸Šã€‚</li><li>ä¿®é¥°ä»£ç å—ï¼šé”çš„æ˜¯Synchronized()ä¸­çš„å¯¹è±¡ï¼Œç¼–è¯‘åçš„å­—èŠ‚ç ä¼šåœ¨ä»£ç å—å‰åæ’å…¥monitorenter å’Œmonitorexitã€‚JVMéœ€è¦æ¯ä¸€ä¸ªmonitorenteréƒ½æœ‰ä¸€ä¸ªmonitorexitä¸ä¹‹å¯¹åº”ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹ç›¸å¯¹åº”ï¼Œå½“ä¸€ä¸ªmonitorè¢«æŒæœ‰ï¼Œå³çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræ—¶ï¼Œå¯¹è±¡å°†å¤„äºé”å®šçŠ¶æ€ã€‚</li></ul><p>Synchronizedæ˜¯Javaå†…ç½®çš„é‡é‡çº§é”ï¼Œåœ¨jdk1.6ä¹‹åå¼•å…¥äº†è‡ªæ—‹é”ã€è½»é‡çº§é”ã€é€‚åº”æ€§è‡ªæ—‹ã€é”ç²—åŒ–ã€é”æ¶ˆé™¤ã€åå‘é”ç­‰æŠ€æœ¯æ¥å‡å°‘Synchronizedçš„æ€§èƒ½å¼€é”€ã€‚</p><a id="more"></a><h4 id="åˆ‡å…¥æ­£é¢˜"><a href="#åˆ‡å…¥æ­£é¢˜" class="headerlink" title="åˆ‡å…¥æ­£é¢˜"></a>åˆ‡å…¥æ­£é¢˜</h4><p>ä»¥ä¸ŠçŸ¥è¯†ç‚¹æƒ³å¿…åˆšå¼€å§‹å­¦ä¹ å¹¶å‘ç¼–ç¨‹çš„ç¨‹åºå‘˜éƒ½ä¼šå…ˆå­¦ä¹ ä»¥ä¸ŠçŸ¥è¯†ï¼Œä½†æ˜¯å¾ˆå¤šç¨‹åºå‘˜åœ¨ä½¿ç”¨Synchronizedçš„æ—¶å€™æœ‰å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘æ˜æ˜åŠ é”äº†ï¼Œä½†æ˜¯æ–¹æ³•å´å¹¶æ²¡æœ‰åŒæ­¥æ‰§è¡Œï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå…ˆçœ‹ä¸‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer cn = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (cn) &#123;</span><br><span class="line">                        cn++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å¯åŠ¨äº†20ä¸ªçº¿ç¨‹ï¼Œå¯¹Integerå˜é‡cnè¿›è¡Œè‡ªå¢ã€‚å¾ˆå¤šäººåœ¨å†™Synchronizedçš„æ—¶å€™éƒ½æœ‰å¯èƒ½å‡ºç°è¿™ç§é—®é¢˜ã€‚è¿™æ ·çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼</p><p>å› ä¸º<code>cn++</code>è¿™å¥ä»£ç çš„åŸç†æ˜¯å°†cnæŒ‡å‘ä¸€ä¸ªcn+1çš„æ–°çš„Integerå¯¹è±¡ï¼</p><p>ä¿®æ”¹æˆå¦‚ä¸‹ï¼Œç„¶åçœ‹çœ‹è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer cn = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch cd = <span class="keyword">new</span> CountDownLatch(size);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">        <span class="keyword">int</span> finalJ = j;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cd.countDown();</span><br><span class="line">                    cd.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (cn) &#123;</span><br><span class="line">                        cn++;</span><br><span class="line">                        System.out.println(</span><br><span class="line">                            <span class="string">"cn"</span> + finalJ + <span class="string">" = "</span> + cn + <span class="string">"\t\t\t"</span> + System.identityHashCode(cn));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šä»£ç è¾“å‡ºå¦‚ä¸‹ &gt;&gt;</strong></p><p><img src="/blog/20190716/Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹/cons.png" alt="è¾“å‡º"></p><p>æ¯æ¬¡è¾“å‡ºçš„Integerå¯¹è±¡çš„HashCodeå€¼å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡é”çš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼æ—¢ç„¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åœ¨å¤šçº¿ç¨‹è®¿é—®çš„æ—¶å€™è‚¯å®šå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼å¯¹äºå¦‚ä¸Šè¿™ç§ä¾‹å­æˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨åŸå­å˜é‡<code>AtomicInteger</code>æ¥å®ç°æ›´é«˜çº§çš„åŒæ­¥æœºåˆ¶å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å…¶ä»–åœºæ™¯ä¸‹å‘¢ï¼Ÿ</p><p>ä¸ä»…ä»…æ˜¯Integerå¯¹è±¡å“¦ï¼æ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰å¯èƒ½ä¼šæœ‰è¿™äº›é—®é¢˜å­˜åœ¨ï¼å½“ä½ åœ¨é”è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯åŠ é”çš„å¯¹è±¡åœ¨çº¿ç¨‹ä¸­ä¸è¢«ä¿®æ”¹æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼å¦åˆ™å°±æ˜¯ä¸€ä¸ª<strong>å‡çš„</strong>åŒæ­¥ä»£ç å—ï¼</p><hr><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Synchronized-å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#Synchronized-å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;Synchronized å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;Synchronized å‰æƒ…æè¦&lt;/h4&gt;&lt;p&gt;Synchronizedæ˜¯Javaä¸­ç”¨æ¥è¿›è¡Œæ–¹æ³•æˆ–è€…ä»£ç åŒæ­¥çš„ä¸€ä¸ªå†…ç½®é”æœºåˆ¶ã€‚è¿™ç§å†…ç½®é”æœºåˆ¶å¯ä»¥ä¿è¯ä»£ç æ‰§è¡Œçš„åŸå­æ€§ã€å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å±è”½ä»£ç çš„é‡æ’åºã€‚Synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ã€å¯¹è±¡ä»¥åŠä»£ç å—ï¼Œå¹¶å¯ä»¥ä¿è¯è¢«ä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®é¥°é™æ€æ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶Synchronizedæ²¡æœ‰è¡¨ç°åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè€Œæ˜¯åœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨ä¸­å°†è¯¥æ–¹æ³•çš„access_flagså€¼ç½®ä¸º1ã€‚è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æˆ–è¯¥æ–¹æ³•æ‰€å±çš„ Class åœ¨ JVM çš„å†…éƒ¨å¯¹è±¡è¡¨ç¤º Klass ä½œä¸ºé”å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®é¥°æ™®é€šæ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶åŒä¸Šã€‚&lt;/li&gt;
&lt;li&gt;ä¿®é¥°ä»£ç å—ï¼šé”çš„æ˜¯Synchronized()ä¸­çš„å¯¹è±¡ï¼Œç¼–è¯‘åçš„å­—èŠ‚ç ä¼šåœ¨ä»£ç å—å‰åæ’å…¥monitorenter å’Œmonitorexitã€‚JVMéœ€è¦æ¯ä¸€ä¸ªmonitorenteréƒ½æœ‰ä¸€ä¸ªmonitorexitä¸ä¹‹å¯¹åº”ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹ç›¸å¯¹åº”ï¼Œå½“ä¸€ä¸ªmonitorè¢«æŒæœ‰ï¼Œå³çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræ—¶ï¼Œå¯¹è±¡å°†å¤„äºé”å®šçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Synchronizedæ˜¯Javaå†…ç½®çš„é‡é‡çº§é”ï¼Œåœ¨jdk1.6ä¹‹åå¼•å…¥äº†è‡ªæ—‹é”ã€è½»é‡çº§é”ã€é€‚åº”æ€§è‡ªæ—‹ã€é”ç²—åŒ–ã€é”æ¶ˆé™¤ã€åå‘é”ç­‰æŠ€æœ¯æ¥å‡å°‘Synchronizedçš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Synchronized" scheme="http://zhangjiaheng.cn/tags/Synchronized/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ª[åˆæ ¼]çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶</title>
    <link href="http://zhangjiaheng.cn/blog/20190714/%E4%B8%80%E4%B8%AA-%E5%90%88%E6%A0%BC-%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BF%85%E9%A1%BB%E5%85%B7%E5%A4%87%E7%9A%84%E5%B7%A5%E5%85%B7%E5%92%8C%E6%8F%92%E4%BB%B6/"/>
    <id>http://zhangjiaheng.cn/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/</id>
    <published>2019-07-14T13:38:04.000Z</published>
    <updated>2019-11-01T01:40:48.205Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/gtx.jpg" alt="å°é¢"><br><a id="more"></a></p><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p><strong>å¦‚é¢˜â€¦ æ˜¯æˆ‘æ ‡é¢˜å…šäº†ï¼Œåº”è¯¥è¿™æ ·è®²ï¼šâ€œåˆæ ¼çš„ç¨‹åºå‘˜â€ä¸ä¸€å®šéœ€è¦ä¼šä½¿ç”¨å“ªäº›å·¥å…·ï¼Œä½†æ˜¯ä¼šä½¿ç”¨é‚£äº›èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘è‡ªå·±å·¥ä½œé‡çš„å¾ˆé…·çš„å·¥å…·å’Œæ’ä»¶çš„ç¨‹åºå‘˜ä¸€å®šä¼šè¿›æ­¥æˆä¸€ä¸ªâ€œåˆæ ¼çš„ç¨‹åºå‘˜â€ã€‚å› ä¸ºä»–ä»¬å–„äºæ€è€ƒï¼Œå¹¶èƒ½å¤Ÿå°†ç¹æ‚çš„é‡å¤æ€§å·¥ä½œäº¤ç»™å·¥å…·å»å®Œæˆï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ ¸å¿ƒçš„ç¼–ç ä»»åŠ¡ä¸Šã€‚</strong></p><h4 id="é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™"><a href="#é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™" class="headerlink" title="é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™"></a>é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™</h4><h5 id="Ghelper"><a href="#Ghelper" class="headerlink" title="Ghelper"></a><a href="http://googlehelper.net/" target="_blank" rel="noopener">Ghelper</a></h5><p>è¯´åˆ°å·¥å…·ï¼Œä¸ä¼šç¿»å¢™ç”¨å•¥å­å·¥å…·ã€‚Ghelperæ˜¯ä¸€ä¸ªè°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼Œç›´æ¥ä¸‹è½½å®‰è£…åˆ°chromeæ‰©å±•å³å¯è½»æ¾è®¿é—®è°·æ­Œç­‰æœåŠ¡ï¼æ³¨æ„ï¼Œè®¿é—®è°·æ­Œçš„ç›¸å…³æœåŠ¡æ˜¯å…è´¹çš„å“¦ï¼å¦‚æœä½ æœ‰éœ€æ±‚è®¿é—®å…¶ä»–çš„ä¾‹å¦‚YouTuBeã€Twitterä¹‹ç±»çš„ï¼Œå¯ä»¥è´­ä¹°ä¼šå‘˜æœåŠ¡ï¼è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè°·æ­Œè®¿é—®åŠ©æ‰‹ç ´è§£ç‰ˆï¼Œæˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œæœ‰å…´è¶£å¯ä»¥è£…ä¸€ä¸‹çœ‹çœ‹ï¼š<a href="https://github.com/haotian-wang/google-access-helper" target="_blank" rel="noopener">GHelperç ´è§£ç‰ˆ</a><br>è¿™ä¸ªå·¥å…·å¯ä»¥è¯´æ˜¯ä»¥ä¸‹å¤§éƒ¨åˆ†å·¥å…·çš„åŸºç¡€ã€‚</p><h5 id="FeHelper"><a href="#FeHelper" class="headerlink" title="FeHelper"></a><a href="https://www.baidufe.com/fehelper/feedback.html" target="_blank" rel="noopener">FeHelper</a></h5><p>FeHelperæ˜¯ä¸€ä¸ªåœ¨è°·æ­Œæµè§ˆå™¨ä¸Šæˆ‘æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ’ä»¶ã€‚åŠŸèƒ½å¦‚ä¸‹ï¼Œå­—ç¬¦ä¸²ç¼–è§£ç ã€JSONæ ¼å¼åŒ–ã€æ—¶é—´æˆ³è½¬æ¢ç­‰ç­‰å·¥å…·ï¼Œåœ¨åšwebå¼€å‘çš„æ—¶å€™æŸ¥çœ‹æŸä¸ªJSONæ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®ç›´æ¥é»è´´åˆ°è¿™ä¸ªæ¡†é‡Œå°±OKï¼Œç®€å•æš´åŠ›~</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/feh.png" alt="FeHelper"></p><h5 id="æ²¹çŒ´å„¿"><a href="#æ²¹çŒ´å„¿" class="headerlink" title="æ²¹çŒ´å„¿"></a><a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">æ²¹çŒ´å„¿</a></h5><p>å¤§åé¼é¼çš„æ²¹çŒ´å„¿æƒ³å¿…å¾ˆå¤šç¨‹åºå‘˜éƒ½äº†è§£ä»¥åŠç”¨è¿‡å§(æ²¡ç”¨è¿‡åˆ«å‘Šè¯‰æˆ‘ä½ æ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ­»æ•²ä»£ç çš„)ã€‚</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/yh.png" alt="æ²¹çŒ´å„¿"></p><p>å¦‚ä¸Šå›¾å°±æ˜¯æˆ‘çš„ä¸€äº›æ²¹çŒ´å„¿æ’ä»¶çš„å·²å®‰è£…çš„ä¸€éƒ¨åˆ†è„šæœ¬çš„æˆªå›¾ã€‚ä¾‹å¦‚çœ‹å„å¤§è§†é¢‘ç½‘ç«™ï¼Œä¸æƒ³è¦ä¹°VIPå»çœ‹ï¼Œé‚£ä¹ˆç›´æ¥å®‰è£…ä¸€ä¸ªVIPè§†é¢‘ç ´è§£è„šæœ¬ï¼›æˆ–è€…ç™¾åº¦ç½‘ç›˜ï¼Œæ‹’ç»å¯åŠ¨å®¢æˆ·ç«¯ä¸‹è½½æ–‡ä»¶ï¼Œå®‰è£…ä¸ªæ²¹çŒ´è„šæœ¬ç›´æ¥ç›´é“¾ä¸‹è½½ï¼</p><p>æ²¹çŒ´å„¿åœ¨æˆ‘çœ‹æ¥å°±æ˜¯ä¸€ä¸ªæµè§ˆå™¨è„šæœ¬çš„å®¹å™¨ï¼Œç½‘ä¸Šæå®¢ä¼—å¤šï¼Œä½ å¯ä»¥æ‰¾å¾—åˆ°ä»»ä½•è‡ªå·±æ„Ÿå…´è¶£çš„æƒ³è¦å®‰è£…çš„æ’ä»¶å»å®Œæˆè‡ªå·±è¦åšçš„äº‹æƒ…ã€‚</p><p>æ²¹çŒ´å„¿çš„å®‰è£…ï¼š<a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">è°·æ­Œåº”ç”¨å•†åº— - æ²¹çŒ´å„¿</a>ï¼Œå®‰è£…å®Œæˆä¹‹åä½ å°±å¯ä»¥æ‰¾åˆ°ä»»ä½•ä½ æƒ³è¦çš„è„šæœ¬è£…åœ¨æ²¹çŒ´å„¿é‡Œé¢å•¦ï¼</p><p>è¿™è¾¹ï¼Œæˆ‘åªå‘Šè¯‰å¤§å®¶ä¸€ä¸ªç»ˆæè„šæœ¬ï¼š<a href="https://greasyfork.org/zh-CN/scripts/24508-userscript-show-site-all-userjs" target="_blank" rel="noopener">UserScript+</a>ã€‚ä¸ºå•¥å«å®ƒç»ˆæè„šæœ¬ã€‚ã€‚ã€‚å› ä¸ºå®‰è£…ä¸Šå®ƒä¹‹åï¼Œå½“ä½ æ‰“å¼€ä»»ä½•ç½‘ç«™ï¼Œä»–éƒ½ä¼šæç¤ºä½ è¿™ä¸ªç½‘ç«™å¯ä»¥å®‰è£…çš„è„šæœ¬æœ‰å“ªäº›ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨åœ¨èŒ«èŒ«å¤§æµ·ä¸­å»å¯»æ‰¾è‡ªå·±éœ€è¦çš„é‚£äº›è„šæœ¬äº†ã€‚</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/jb.png" alt="æ˜é‡‘æ²¹çŒ´å„¿è„šæœ¬"></p><p>å¯ä»¥æƒ³è±¡ï¼Œæœ‰äº†è¿™ä¸ªä¹‹åï¼Œé¢å‘ç™¾åº¦ç¼–ç¨‹çš„ç¨‹åºå‘˜æ˜¯ä¸æ˜¯ä¸ç”¨å†è¢«çœ¼èŠ±ç¼­ä¹±çš„å¹¿å‘Šæ‰€éªšæ‰°ï¼å–œæ¬¢ä½¿ç”¨æ˜é‡‘çš„ç¨‹åºå‘˜ä¹Ÿå¯ä»¥è®¾ç½®è‡ªå·±å–œæ¬¢çš„é¡µé¢æ’ç‰ˆ~ ç»å¸¸æ°´V2EXçš„ç¨‹åºå‘˜ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç›–æ¥¼äº†ï¼ï¼å“ˆå“ˆæƒ³æƒ³å°±åˆºæ¿€å‘¢ï¼</p><h5 id="äº‘ç›˜ç²¾çµ"><a href="#äº‘ç›˜ç²¾çµ" class="headerlink" title="äº‘ç›˜ç²¾çµ"></a><a href="https://www.yunpanjingling.com/" target="_blank" rel="noopener">äº‘ç›˜ç²¾çµ</a></h5><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/ypjl.png" alt="äº‘ç›˜ç²¾çµ"></p><p>äº‘ç›˜ç²¾çµæ˜¯ä¸€ä¸ªä¸‹è½½ç™¾åº¦ç½‘ç›˜èµ„æºçš„ç¥å¥‡çš„ç½‘ç«™ï¼Œåœ¨è¿™é‡Œä½ å‡ ä¹å¯ä»¥æ‰¾åˆ°ä»»ä½•æ‚¨æƒ³è¦çš„èµ„æºå»ä¸‹è½½ã€‚ç„¶é¹…ï¼Œéœ€è¦æ³¨å†Œç„¶åä½¿ç”¨è±†å­è´­ä¹°ã€‚ä¸è¿‡è¿™ä¹Ÿæ˜¯ç†æ‰€åº”å½“çš„ï¼Œæ¯•ç«ŸçŸ¥è¯†ä»˜è´¹çš„å¤©ä¸‹ã€‚ä½†æ˜¯éœ€è¦ä»˜çš„å¹¶ä¸å¤šï¼Œè€Œä¸”ä½ è¿˜å¯ä»¥å°†ä½ è‡ªå·±çš„èµ„æºåˆ†äº«åˆ°äº‘ç›˜ç²¾çµï¼Œæœ‰äººä¸‹è½½ä½ ä¹Ÿä¼šèµšå–åˆ°ç›¸åº”çš„è±†å­ã€‚</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/gtx.jpg&quot; alt=&quot;å°é¢&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾</title>
    <link href="http://zhangjiaheng.cn/blog/20190714/%E5%B0%86%E9%98%BF%E9%87%8CJava%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E6%95%B2%E6%88%90%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
    <id>http://zhangjiaheng.cn/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/</id>
    <published>2019-07-14T03:12:01.000Z</published>
    <updated>2019-11-01T01:40:48.223Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/fm.png" alt="é˜¿é‡ŒJavaç¼–ç è§„èŒƒ"></p><p><center>é˜¿é‡ŒJavaç¼–ç è§„èŒƒ</center><br><a id="more"></a></p><p><center></center></p><p><center><a href="https://mubu.com/doc/CuUSIfxtSz" target="_blank" rel="noopener">å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹åˆ†äº«çš„ç¬”è®°</a></center></p><p><center></center></p><p><center></center></p><p><center>æˆ–è€…æ‰«æå¦‚ä¸‹äºŒç»´ç è·å–æˆ‘åˆ†äº«çš„ã€Šé˜¿é‡ŒJavaå¼€å‘æ‰‹å†Œ-å¹•å¸ƒç‰ˆã€‹</center><br><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/qrcode.png" alt=""></p><p><center></center></p><p><center></center></p><h2 id=""><a href="#" class="headerlink" title=""></a><center></center></h2><p><center>æœ€åï¼Œæ€ç»´å¯¼å›¾æ•ˆæœå¦‚ä¸‹ï¼Œå¯†é›†ææƒ§ç—‡æ…å…¥~~</center></p><p><center>æŸ¥çœ‹æ¸…æ™°å®Œæ•´çš„æ•ˆæœè¯·å»å¹•å¸ƒç¬”è®°ï¼Œç‚¹å‡»æŸ¥çœ‹æ€ç»´å¯¼å›¾å³å¯</center><br><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/é˜¿é‡ŒJavaç¼–ç è§„èŒƒ.png" alt=""></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/fm.png&quot; alt=&quot;é˜¿é‡ŒJavaç¼–ç è§„èŒƒ&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;center&gt;é˜¿é‡ŒJavaç¼–ç è§„èŒƒ&lt;/center&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼</title>
    <link href="http://zhangjiaheng.cn/blog/20190707/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    <id>http://zhangjiaheng.cn/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/</id>
    <published>2019-07-07T02:32:44.000Z</published>
    <updated>2019-11-01T01:40:48.196Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/fm.png" alt="å°é¢"><br><a id="more"></a></p><h4 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4><p>åœ¨è®¡ç®—æœºç¨‹åºä¸­ï¼Œä¸ºäº†å°†ä¸€äº›å…·æœ‰ä¸åŒå®ç°ä½†æœ‰ç›¸åŒæ‰§è¡Œæ­¥éª¤çš„ç±»ç»Ÿä¸€èµ·æ¥ï¼Œé€šå¸¸æˆ‘ä»¬å°†è¿™äº›ç±»æŠ½è±¡æˆä¸€ä¸ªæ¨¡æ¿ç±»ã€‚æ¨¡æ¿ç±»å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ç®—æ³•çš„ç»“æ„è€Œå»å¯¹ä¸€äº›ç»†èŠ‚å®ç°è¿›è¡Œé‡æ–°å®šä¹‰ã€‚</p><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ "><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ " class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ "></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ </h4><h5 id="æŠ½è±¡æ¨¡æ¿"><a href="#æŠ½è±¡æ¨¡æ¿" class="headerlink" title="æŠ½è±¡æ¨¡æ¿"></a>æŠ½è±¡æ¨¡æ¿</h5><p>æŠ½è±¡æ¨¡æ¿ä¸­å®šä¹‰äº†ä¸¤ç§æ–¹æ³•ï¼šéœ€è¦å­ç±»å»å®ç°çš„åŸºæœ¬æ–¹æ³•ï¼Œä»¥åŠå›ºå®šçš„ä¸éœ€è¦å­ç±»å»å®ç°çš„å…·ä½“ç®—æ³•æ­¥éª¤çš„æ¨¡æ¿æ–¹æ³•ã€‚åŸºæœ¬æ–¹æ³•åœ¨æ¨¡æ¿æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬ä¼šæ˜¯ä¸€ä¸ªå…·ä½“çš„ç®—æ³•æ¡†æ¶ï¼Œè°ƒåº¦åŸºæœ¬æ–¹æ³•å®Œæˆæ‰€æœ‰åŠŸèƒ½ã€‚</p><h5 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h5><p>å­ç±»å…·ä½“å®ç°æŠ½è±¡æ¨¡æ¿ä¸­çš„åŸºæœ¬æ–¹æ³•ï¼Œå®Œæˆå¯¹æ¡†æ¶ä¸­çš„ç®—æ³•ç»†èŠ‚è¿›è¡Œé‡æ–°å®šä¹‰ã€‚</p><h4 id="æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹"><a href="#æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹" class="headerlink" title="æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹"></a>æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹</h4><p>åœ¨åšæŸä¸ªæŒ‰éœ€æŸ¥è¯¢ä¸åŒç±»åˆ«çš„ç”¨æˆ·ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°OSSä¸Šï¼Œæ¯æ—¥å‘é‚®ä»¶å‘Šè¯‰è¿è¥äººå‘˜ç»“æœçš„ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘å°±ç”¨åˆ°äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚<br>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿ï¼Œåˆ†åˆ«æœ‰æŸ¥è¯¢ç”¨æˆ·(æ¯å¤©éƒ½ä¸åŒçš„SQL)ï¼Œä¸Šä¼ åˆ°OSSï¼Œå‘é‚®ä»¶ç­‰å‡ ä¸ªæ­¥éª¤ï¼Œå³åŸºæœ¬æ–¹æ³•ã€‚åœ¨æ¨¡æ¿æ–¹æ³•ä¸­å°†è¿™å‡ ä¸ªæ­¥éª¤å°è£…èµ·æ¥ã€‚å®šä¹‰7ä¸ªå­ç±»åˆ†åˆ«å¯¹æ¯å¤©ä¸åŒçš„æŸ¥è¯¢ã€ä¸Šä¼ ã€é‚®ä»¶åšå…·ä½“çš„å®ç°ã€‚æœ€åæ ¹æ®ç­–ç•¥æ¨¡å¼ï¼Œä¸åŒçš„æ˜ŸæœŸè°ƒç”¨ä¸åŒçš„å¯¹è±¡çš„æ¨¡æ¿æ–¹æ³•å®Œæˆæ ¸å¿ƒåŠŸèƒ½ã€‚</p><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹</h4><p>å¦‚å›¾ï¼Œæœ‰ä¸ªåšé¥­çš„æŠ½è±¡æ¨¡æ¿ï¼šå®šä¹‰äº†[æ´—èœ-ç‚’èœ-å®Œæˆ]ä¸‰ä¸ªæ­¥éª¤ä¸ºåŸºæœ¬æ–¹æ³•ï¼Œä¸€ä¸ª<code>ComplateCook</code>æ–¹æ³•å®Œæˆæ­¥éª¤çš„ç»„è£…</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/bb.png" alt="æŠ½è±¡æ¨¡æ¿"></p><p>ä¸€ä¸ªè¥¿çº¢æŸ¿ç‚’è›‹çš„å®ç°ç±»</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/z1.png" alt="å­ç±»1"></p><p>ä¸€ä¸ªé±¼é¦™è‚‰ä¸çš„å®ç°ç±»</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/z2.png" alt="å­ç±»2"></p><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CookTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æ­¥éª¤ä¸ºæŠ½è±¡æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">ComplateCook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹åšèœï½"</span>);</span><br><span class="line">        wash();</span><br><span class="line">        cook();</span><br><span class="line">        finish();</span><br><span class="line">        System.out.println(<span class="string">"å®Œæˆåšèœæ­¥éª¤ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XihongshiChaoEgg</span> <span class="keyword">extends</span> <span class="title">CookTemplate</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ‡è¥¿çº¢æŸ¿ï¼Œå‡†å¤‡é¸¡è›‹ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç‚’é¸¡è›‹ï¼Œç„¶åå†ç‚’è¥¿çº¢æŸ¿ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è¥¿çº¢æŸ¿ç‚’è›‹åšå¥½äº†ï¼Œå‡ºé”…ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YuXiangRose</span> <span class="keyword">extends</span> <span class="title">CookTemplate</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ´—èƒ¡èåœï½"</span>);</span><br><span class="line">        System.out.println(<span class="string">"åˆ‡è‚‰ä¸ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹åšé±¼é¦™è‚‰ä¸ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é±¼é¦™è‚‰ä¸åšå¥½äº† å‡ºé”…ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CookTemplate cook = <span class="keyword">new</span> XihongshiChaoEgg();</span><br><span class="line">        cook.ComplateCook();</span><br><span class="line">        cook = <span class="keyword">new</span> YuXiangRose();</span><br><span class="line">        cook.ComplateCook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹</h4><ul><li><p>ä¼˜ç‚¹</p><ul><li>å°è£…äº†ä¸å¯å˜çš„éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†</li><li>æä¾›å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤</li><li>å…·ä½“è¡Œä¸ºçˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»åªç®¡è‡ªå·±çš„ç»†èŠ‚å®ç°ï¼Œç¬¦åˆå¼€é—­åŸåˆ™</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½è¦å¢åŠ ä¸€ä¸ªå­ç±»ï¼Œä¼šå¯¼è‡´ä»£ç é‡å¾ˆåºå¤§</li><li>çˆ¶ç±»çš„æ‰§è¡Œç»“æœä¼šå—åˆ°å­ç±»çš„å½±å“ï¼Œåœ¨å¤æ‚ä»£ç çš„é˜…è¯»ä¸­ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥å¾ˆå¤šéº»çƒ¦</li></ul></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚ç”¨äºï¼šæœ‰ä¸€ä¸ªå›ºå®šçš„ç®—æ³•æ­¥éª¤ï¼Œä½†æ˜¯ç»†èŠ‚å®ç°å­˜åœ¨å¤šç§å¯èƒ½çš„åœºæ™¯ï¼Œå³æ•´ä½“ç¨³å®šä½†æ˜¯ä¸ªåˆ«æ˜“å˜çš„æ—¶å€™è®²ä¼šå˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ã€‚<br>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¼ºè°ƒæŠ½è±¡ç±»ä¸å­ç±»ä¹‹é—´çš„åä½œï¼Œå®ƒå°†è°ƒç”¨æƒäº¤ç»™çˆ¶ç±»ï¼Œæ˜¯ä¸€ç§æ§åˆ¶åè½¬çš„è®¾è®¡ç†å¿µã€‚å­ç±»ä¸å†å»å®Œæˆæ ¸å¿ƒçš„åŠŸèƒ½ï¼Œåªéœ€è¦å…³æ³¨å±äºè‡ªå·±çš„é‚£ä¸€éƒ¨åˆ†çš„å®ç°ã€‚</p><hr><ul><li>JDKä¸­ç»å…¸çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®ç°ï¼š<strong>AQS</strong></li></ul><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/fm.png&quot; alt=&quot;å°é¢&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (å…­)ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯</title>
    <link href="http://zhangjiaheng.cn/blog/20190701/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E5%85%AD-%EF%BC%9AExchanger%E7%9A%84%E5%AD%A6%E4%B9%A0%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <id>http://zhangjiaheng.cn/blog/20190701/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å…­-ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯/</id>
    <published>2019-07-01T13:28:39.000Z</published>
    <updated>2019-11-01T01:40:48.244Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨JUCåŒ…ä¸­ï¼Œé™¤äº†ä¸€äº›å¸¸ç”¨çš„æˆ–è€…è¯´å¸¸è§çš„å¹¶å‘å·¥å…·ç±»(ReentrantLockï¼ŒCountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphore)ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å¸¸ç”¨çš„çº¿ç¨‹åŒæ­¥å™¨ç±» â€”â€” Exchangerã€‚<br></p><p>Exchangeræ˜¯é€‚ç”¨åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®äº¤æ¢çš„å¹¶å‘å·¥å…·ç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ‰¾åˆ°ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†åŒæ­¥ç‚¹(<strong>exchangeæ–¹æ³•</strong>)ä¹‹å(<em>æœ‰ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œåˆ°å°±ä¸€ç›´ç­‰å¾…ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´</em>)ï¼Œå°±å°†è‡ªèº«çº¿ç¨‹çš„æ•°æ®ä¸å¯¹æ–¹äº¤æ¢ã€‚</p><a id="more"></a><p><div style="text-align: center" center=""><a href="javascript:" target="_blank" rel="noopener">Exchangerå·¥å…·ç±»UML</a></div><br><img src="/blog/20190701/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å…­-ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯/exc.png" alt="UML"></p><h4 id="Exchangerç±»ç»“æ„"><a href="#Exchangerç±»ç»“æ„" class="headerlink" title="Exchangerç±»ç»“æ„"></a>Exchangerç±»ç»“æ„</h4><p>å¦‚ä¸Šå›¾UNMLï¼ŒExchangerç±»ä¸­æœ‰ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œä¸€ä¸ªNodeï¼Œä¸€ä¸ªParticipantã€‚</p><p>Participantç»§æ‰¿äº†ThreadLocalå¹¶ä¸”é‡å†™äº†å…¶initialValueæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªNodeå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The corresponding thread local class */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Participant</span> <span class="keyword">extends</span> <span class="title">ThreadLocal</span>&lt;<span class="title">Node</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">initialValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Node(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nodeç±»å°è£…äº†ä¸¤ä¸ªçº¿ç¨‹å­˜å‚¨çš„æ•°æ®å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nodes hold partially exchanged data, plus other per-thread</span></span><br><span class="line"><span class="comment"> * bookkeeping. Padded via <span class="doctag">@sun</span>.misc.Contended to reduce memory</span></span><br><span class="line"><span class="comment"> * contention.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index;              <span class="comment">//  node åœ¨ arena æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">int</span> bound;              <span class="comment">//  äº¤æ¢å™¨çš„æœ€åè®°å½•å€¼ </span></span><br><span class="line">    <span class="keyword">int</span> collides;           <span class="comment">//  è®°å½•çš„ CAS å¤±è´¥æ•°</span></span><br><span class="line">    <span class="keyword">int</span> hash;               <span class="comment">//  ä¼ªéšæœºçš„è‡ªæ—‹æ•°</span></span><br><span class="line">    Object item;            <span class="comment">//  è¿™ä¸ªçº¿ç¨‹çš„æ•°æ®é¡¹</span></span><br><span class="line">    <span class="keyword">volatile</span> Object match;  <span class="comment">//  å¦ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®é¡¹</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread parked; <span class="comment">//  å½“é˜»å¡æ—¶ï¼Œè®¾ç½®æ­¤çº¿ç¨‹ï¼Œä¸é˜»å¡çš„è¯ä¼šè‡ªæ—‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Exchangeræºç åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">exchange</span><span class="params">(V x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    Object v;</span><br><span class="line">    Object item = (x == <span class="keyword">null</span>) ? NULL_ITEM : x; <span class="comment">// translate null args</span></span><br><span class="line">    <span class="keyword">if</span> ((arena != <span class="keyword">null</span> || <span class="comment">// æ˜¯nullå°±æ‰§è¡Œåé¢çš„æ–¹æ³•</span></span><br><span class="line">         (v = slotExchange(item, <span class="keyword">false</span>, <span class="number">0L</span>)) == <span class="keyword">null</span>) &amp;&amp;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰§è¡ŒslotExchangeæœ‰ç»“æœå°±æ‰§è¡Œåé¢çš„ï¼Œå¦åˆ™è¿”å›</span></span><br><span class="line">        ((Thread.interrupted() || <span class="comment">// éä¸­æ–­åˆ™æ‰§è¡Œåé¢çš„æ–¹æ³•</span></span><br><span class="line">          (v = arenaExchange(item, <span class="keyword">false</span>, <span class="number">0L</span>)) == <span class="keyword">null</span>)))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    <span class="keyword">return</span> (v == NULL_ITEM) ? <span class="keyword">null</span> : (V)v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exchange</code>æ–¹æ³•çš„æ­¥éª¤ï¼š</p><ul><li>å¦‚æœæ‰§è¡ŒslotExchangeæœ‰ç»“æœå°±æ‰§è¡Œåé¢çš„arenaExchange</li><li>å¦‚æœsoltè¢«å ç”¨ï¼Œå°±æ‰§è¡ŒarenaExchange</li><li>è¿”å›çš„æ•°æ®væ˜¯å¯¹æ–¹çº¿ç¨‹çš„æ•°æ®é¡¹</li><li>æ€»ç»“å³ï¼šå¦‚æœAçº¿ç¨‹å…ˆè°ƒç”¨ï¼Œé‚£ä¹ˆAçš„æ•°æ®é¡¹å­˜å‚¨çš„itemä¸­</li><li>åˆ™Bçº¿ç¨‹çš„æ•°æ®é¡¹å­˜å‚¨åœ¨matchä¸­</li><li>å½“æ²¡æœ‰å¤šçº¿ç¨‹å¹¶å‘æ“ä½œ Exchange çš„æ—¶å€™ï¼Œä½¿ç”¨ slotExchange å°±è¶³å¤Ÿäº†ã€‚ slot æ˜¯ä¸€ä¸ª node å¯¹è±¡ã€‚</li><li>å½“å‡ºç°å¹¶å‘äº†ï¼Œä¸€ä¸ª slot å°±ä¸å¤Ÿäº†ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ä¸ª node æ•°ç»„ arena æ“ä½œäº†ã€‚</li></ul><p>â€‹    </p><h4 id="Exchangerçš„ä½¿ç”¨"><a href="#Exchangerçš„ä½¿ç”¨" class="headerlink" title="Exchangerçš„ä½¿ç”¨"></a>Exchangerçš„ä½¿ç”¨</h4><p>ä¸‹é¢çš„ä¾‹å­æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ä¸­æ•°æ®çš„äº¤æ¢ä½¿ç”¨çš„åœºæ™¯ï¼š</p><ul><li>çº¿ç¨‹Aå¾€é˜Ÿåˆ—ä¸­å­˜å…¥æ•°æ®</li><li>çº¿ç¨‹Bä»é˜Ÿåˆ—ä¸­æ¶ˆè€—æ•°æ®</li><li>å½“çº¿ç¨‹Aå­˜æ»¡çš„æ—¶å€™</li><li>æ‰äº¤æ¢ç»™çº¿ç¨‹B</li><li>å½“çº¿ç¨‹Bæ¶ˆè€—å®Œæˆä¹‹åæ‰äº¤æ¢ç»™çº¿ç¨‹Aã€‚</li><li>çº¿ç¨‹Aã€Bçš„ç”Ÿäº§å’Œæ¶ˆè€—çš„é€Ÿç‡æœ‰å¯èƒ½ä¸åŒ</li><li>å¯¹æ–¹çº¿ç¨‹è°ƒç”¨exchangeä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°exchangeä¼šé˜»å¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åœ¨å¯¹æ–¹çº¿ç¨‹è°ƒç”¨exchangeä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°exchangeä¼šé˜»å¡ ç›´åˆ°åŒæ–¹éƒ½è°ƒç”¨exchange */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerStudy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ArrayBlockingQueue&lt;String&gt; initialFillQueue </span><br><span class="line">      = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ArrayBlockingQueue&lt;String&gt; initialEmptyQueue </span><br><span class="line">      = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Exchanger&lt;ArrayBlockingQueue&lt;String&gt;&gt; exchanger </span><br><span class="line">      = <span class="keyword">new</span> Exchanger&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** å¡«å……ç¼“å­˜é˜Ÿåˆ—çš„çº¿ç¨‹ */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FillingRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ArrayBlockingQueue&lt;String&gt; current = initialEmptyQueue;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">          String str = StrUtil.uuid();</span><br><span class="line">          System.out.println(<span class="string">"ç”Ÿäº§äº†ä¸€ä¸ªåºåˆ—ï¼š"</span> + str + <span class="string">"&gt;&gt;&gt;&gt;&gt;åŠ å…¥åˆ°äº¤æ¢åŒº"</span>);</span><br><span class="line">          Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            current.add(str);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"é˜Ÿåˆ—å·²æ»¡ï¼Œæ¢ä¸€ä¸ªç©ºçš„"</span>);</span><br><span class="line">            current = exchanger.exchange(current);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** å¡«å……ç¼“å­˜é˜Ÿåˆ—çš„çº¿ç¨‹ */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmptyingRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ArrayBlockingQueue&lt;String&gt; current = initialFillQueue;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!current.isEmpty()) &#123;</span><br><span class="line">            String str = current.poll();</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè€—ä¸€ä¸ªæ•°åˆ—ï¼š"</span> + str);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"é˜Ÿåˆ—ç©ºäº†ï¼Œæ¢ä¸ªæ»¡çš„"</span>);</span><br><span class="line">            current = exchanger.exchange(current);</span><br><span class="line">            System.out.println(<span class="string">"æ¢æ»¡çš„æˆåŠŸ~~~~~~~~~~~~~~~~~~~~~~"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> FillingRunnable()).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> EmptyingRunnable()).start();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><blockquote><p><a href="https://juejin.im/post/5ae7554ff265da0b86360880" target="_blank" rel="noopener">&gt;&gt;&gt;&gt;&gt; æ›´è¯¦ç»†çš„æºç è§£æ - æ˜é‡‘</a></p></blockquote><p><img src="https://user-gold-cdn.xitu.io/2018/5/1/16317a536c642f7c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="ç»“å°¾"></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;åœ¨JUCåŒ…ä¸­ï¼Œé™¤äº†ä¸€äº›å¸¸ç”¨çš„æˆ–è€…è¯´å¸¸è§çš„å¹¶å‘å·¥å…·ç±»(ReentrantLockï¼ŒCountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphore)ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å¸¸ç”¨çš„çº¿ç¨‹åŒæ­¥å™¨ç±» â€”â€” Exchangerã€‚&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Exchangeræ˜¯é€‚ç”¨åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®äº¤æ¢çš„å¹¶å‘å·¥å…·ç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ‰¾åˆ°ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†åŒæ­¥ç‚¹(&lt;strong&gt;exchangeæ–¹æ³•&lt;/strong&gt;)ä¹‹å(&lt;em&gt;æœ‰ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œåˆ°å°±ä¸€ç›´ç­‰å¾…ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´&lt;/em&gt;)ï¼Œå°±å°†è‡ªèº«çº¿ç¨‹çš„æ•°æ®ä¸å¯¹æ–¹äº¤æ¢ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Exchanger" scheme="http://zhangjiaheng.cn/tags/Exchanger/"/>
    
      <category term="çº¿ç¨‹äº¤æ¢å™¨" scheme="http://zhangjiaheng.cn/tags/%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%8D%A2%E5%99%A8/"/>
    
  </entry>
  
</feed>
