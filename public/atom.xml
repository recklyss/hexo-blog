<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é™ˆå¹´é£æ¥¼ | åšå®¢</title>
  
  <subtitle>å½“ä½ çœ‹åˆ°äº†ä¸€åº§å±±ï¼Œä¸€å®šä¼šæƒ³å†çœ‹çœ‹å±±çš„åé¢æ˜¯ä»€ä¹ˆï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zhangjiaheng.cn/"/>
  <updated>2019-12-17T06:44:08.492Z</updated>
  <id>http://zhangjiaheng.cn/</id>
  
  <author>
    <name>é™ˆå¹´é£æ¥¼</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title> è§£å†³@ResuestBodyä¸­çš„ JSON è‡ªåŠ¨è½¬åŒ–é Boolean ä¸º Boolean å€¼</title>
    <link href="http://zhangjiaheng.cn/blog/20191217/%E8%A7%A3%E5%86%B3-ResuestBody%E4%B8%AD%E7%9A%84-JSON-%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%8C%96%E9%9D%9E-boolean-%E4%B8%BA-boolean-%E5%80%BC/"/>
    <id>http://zhangjiaheng.cn/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/</id>
    <published>2019-12-17T03:39:58.000Z</published>
    <updated>2019-12-17T06:44:08.492Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/code.jpg" alt="å°é¢"></p><a id="more"></a><h2 id="é—®é¢˜å‡ºç°"><a href="#é—®é¢˜å‡ºç°" class="headerlink" title="é—®é¢˜å‡ºç°"></a>é—®é¢˜å‡ºç°</h2><p>å½“æˆ‘ä»¬åœ¨ SpringBoot ä¸­å†™ API çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨<code>@RequestBody</code>æ³¨è§£ä¸€ä¸ªå‚æ•°å°†è¿™ä¸ªå¯¹è±¡æ ‡è®°ä¹‹åï¼Œç„¶åæˆ‘ä»¬åœ¨è¯·æ±‚å¤´ä½¿ç”¨<code>application/json</code>è°ƒç”¨è¿™ä¸ª APIï¼Œä¼ å…¥ JSON çš„ body ä½“ï¼Œå°±å¯ä»¥è‡ªåŠ¨çš„å°†æˆ‘ä»¬çš„ JSON è½¬åŒ–æˆ JAVA å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä½¿ç”¨çš„ JAVA å¯¹è±¡ä¸­æœ‰ä¸ª Boolean çš„å­—æ®µçš„æ—¶å€™ï¼Œæˆ‘çš„ JSON çš„ body å¯¹è¿™ä¸ªå¯¹è±¡ä¼ æ•°å€¼ã€â€Trueâ€ç­‰ç­‰å…¶ä»–å€¼å¾—æ—¶å€™ï¼Œå¾€å¾€ä¼šè¢«é»˜è®¤è½¬æˆç›¸åº”çš„ true æˆ–è€… falseã€‚ä¾‹å¦‚ä¼ å…¥{â€œableâ€:0}çš„æ—¶å€™ï¼Œæˆ‘çš„å¯¹è±¡ä¸­çš„ able å­—æ®µå°±æ˜¯ falseã€‚ä½†æ˜¯æˆ‘ä¸æƒ³è¦è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘å¸Œæœ›æ¥å£è°ƒç”¨è€…ä¼ çš„ç±»å‹éƒ½æ˜¯ Boolean ç±»å‹ã€‚</p><h2 id="Debug-æºç "><a href="#Debug-æºç " class="headerlink" title="Debug æºç "></a>Debug æºç </h2><p>é¦–å…ˆä½ è¦çŸ¥é“ï¼Œåœ¨ SpringBoot æˆ–è€… SpringMVC ä¸­å¯¹äºrequest å’Œ response çš„å¤„ç†æ˜¯ä½¿ç”¨çš„æ¶ˆæ¯è½¬æ¢å™¨å¤„ç†çš„ã€‚æ‰€ä»¥æˆ‘åœ¨ debug æºç çš„æ—¶å€™å‘ç°ï¼ŒSpringBoot ä½¿ç”¨<code>MappingJackson2HttpMessageConverter</code>å¤„ç† JSON è½¬åŒ–æˆå¯¹è±¡ï¼Œç„¶åå®é™…çš„è½¬åŒ–æ–¹æ³•<code>MappingJackson2HttpMessageConverter</code>æ²¡æœ‰é‡å†™ï¼Œè€Œæ˜¯äº¤ç»™çˆ¶ç±»<code>AbstractJackson2HttpMessageConverter</code>çš„æ–¹æ³•ï¼Œåœ¨è¯¥ç±»çš„ç¬¬239 è¡Œä¼šå‘ç°å®é™…ä¸Šæ˜¯ä½¿ç”¨çš„ <code>this.objectMapper.readValue(inputMessage.getBody(), javaType);</code> å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬åŒ–æˆ JAVA å¯¹è±¡ã€‚å†è¿›å»çœ‹ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">readValue</span><span class="params">(InputStream src, JavaType valueType)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException, JsonParseException, JsonMappingException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (T) _readMapAndClose(_jsonFactory.createParser(src), valueType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œ<code>_readMapAndClose</code>æ–¹æ³•æ˜¯è¿™æ ·çš„(é‡ç‚¹çœ‹ä¸‹ 4013 è¡Œ)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">_readMapAndClose</span><span class="params">(JsonParser p0, JavaType valueType)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">try</span> (JsonParser p = p0) &#123;</span><br><span class="line">    Object result;</span><br><span class="line">    JsonToken t = _initForReading(p, valueType);</span><br><span class="line">    <span class="keyword">final</span> DeserializationConfig cfg = getDeserializationConfig();</span><br><span class="line">    <span class="keyword">final</span> DeserializationContext ctxt = createDeserializationContext(p, cfg);</span><br><span class="line">    <span class="keyword">if</span> (t == JsonToken.VALUE_NULL) &#123;</span><br><span class="line">      <span class="comment">// Ask JsonDeserializer what 'null value' to use:</span></span><br><span class="line">      result = _findRootDeserializer(ctxt, valueType).getNullValue(ctxt);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == JsonToken.END_ARRAY || t == JsonToken.END_OBJECT) &#123;</span><br><span class="line">      result = <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      JsonDeserializer&lt;Object&gt; deser = _findRootDeserializer(ctxt, valueType);</span><br><span class="line">      <span class="keyword">if</span> (cfg.useRootWrapping()) &#123;</span><br><span class="line">        result = _unwrapAndDeserialize(p, ctxt, cfg, valueType, deser);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = deser.deserialize(p, ctxt);</span><br><span class="line">      &#125;</span><br><span class="line">      ctxt.checkUnresolvedObjectId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cfg.isEnabled(DeserializationFeature.FAIL_ON_TRAILING_TOKENS)) &#123;</span><br><span class="line">      _verifyNoTrailingTokens(p, ctxt, valueType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç <code>result = deser.deserialize(p, ctxt);</code>ä½¿ç”¨ä¸€ä¸ªååºåˆ—åŒ–å¯¹è±¡è¿›è¡Œ JSON çš„ååºåˆ—åŒ–ï¼Œè¿™é‡Œå¦‚æœä¼ å…¥çš„æ˜¯æ•°å­—è½¬åŒ–æˆ Booleançš„è¯å°±æ˜¯ç”¨çš„æ˜¯<code>NumberDeserializers</code>ä¸­çš„<code>BooleanDeserializer</code>ï¼Œè€Œå®ƒçš„<code>deserialize</code>æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  JsonToken t = p.getCurrentToken();</span><br><span class="line">  <span class="keyword">if</span> (t == JsonToken.VALUE_TRUE) &#123;</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (t == JsonToken.VALUE_FALSE) &#123;</span><br><span class="line">    <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _parseBoolean(p, ctxt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å<code>_parseBoolean</code>ä¸­å°†å…¶ä»–çš„æ•°å€¼è½¬åŒ–æˆ Booleanã€‚</p><h2 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h2><p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª debug çš„å…¨è¿‡ç¨‹äº†ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯<code>AbstractJackson2HttpMessageConverter</code>ä¸­ä¼šé»˜è®¤åœ°å°†é Boolean çš„æ•°å€¼è½¬åŒ–æˆ Booleanã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>é¦–å…ˆä½¿ç”¨æœç´¢å¼•æ“è§£å†³ğŸ˜¹ç„¶åæœç´¢ä¸åˆ°ã€‚ã€‚ã€‚ç„¶åæˆ‘åœ¨ StackOverFlow ä¸Šæäº†ä¸€ä¸ª<a href="https://stackoverflow.com/questions/59353379/springboot-atomically-convert-integer-to-boolean-with-requestbody-annotation-h/59355180#59355180" target="_blank" rel="noopener">é—®é¢˜ &lt;click</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹è¿™ç§æ–¹å¼ï¼š</p><ul><li><p>è‡ªå®šä¹‰è‡ªå·±çš„ååºåˆ—åŒ–å·¥å…·ï¼Œç„¶åè®© Spring å»ç®¡ç†è¿™ä¸ªé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleModule <span class="title">addDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleModule().addDeserializer(Boolean<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">MyDeserializer</span>())</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDeserializer</span> <span class="keyword">extends</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Boolean <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            JsonToken t = p.getCurrentToken();</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_TRUE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_FALSE) &#123;</span><br><span class="line">                <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t == JsonToken.VALUE_STRING) &#123;</span><br><span class="line">                String value = p.getValueAsString();</span><br><span class="line">                <span class="keyword">return</span> value.equals(<span class="string">"true"</span>) ? <span class="keyword">true</span> : value.equals(<span class="string">"false"</span>) ? <span class="keyword">false</span> : <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·å°±å°†æ‰€æœ‰ API ä¸­ï¼Œå­˜åœ¨ Boolean çš„æƒ…å†µéƒ½å¤„ç†æ‰äº†ã€‚åªèƒ½æ¥å— Boolean å€¼æˆ–è€…å­—ç¬¦ä¸²çš„â€trueâ€æˆ–è€…â€falseâ€ã€‚</p><p>ä½†æ˜¯ä½œä¸ºä¸€ä¸ªä¼˜ç§€(pa ma fan)çš„ğŸ‘©â€ğŸ’»coderğŸ˜·ï¼Œæˆ‘ä»¬åº”è¯¥ä¿è¯è‡ªå·±ä¿®æ”¹çš„ä»£ç ä¸ä¼šå½±å“åˆ°å…¶ä»–äººæˆ–è€…å…¶ä»–æ¨¡å—ï¼Œéšä¾¿çš„ä¿®æ”¹å…¨å±€çš„é…ç½®ä¸å¤ªå¥½ã€‚æ‰€ä»¥æˆ‘å¯»æ‰¾åˆ°äº†ä¸€ä¸ªæ›´åŠ à­§(à¹‘â€¢Ì€â—¡â€¢Ìà¹‘)à«­çš„æ–¹å¼ â€”â€” ç¼–å†™ä¸€ä¸ªè¯¥å±æ€§çš„ set æ–¹æ³•å³å¯ã€‚</p><p>å› ä¸ºDeserializerä¼šå°†è¯»å–åˆ°çš„ JSON çš„å€¼é€šè¿‡ set æ–¹æ³•å¡«å…¥å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAble</span><span class="params">(Object value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value <span class="keyword">instanceof</span> Boolean) &#123;</span><br><span class="line">    able = (Boolean) value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"true"</span>.equals(value)) &#123;</span><br><span class="line">    able = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆã€‚ä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªè¿‡ç¨‹ debug çš„æ—¶å€™æ˜¯æœ€æœ‰æ„æ€çš„ï¼Œå¯ä»¥äº†è§£åˆ°å®ƒåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šéƒ½åšäº†äº›ä»€ä¹ˆäº‹æƒ…ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191217/è§£å†³-ResuestBodyä¸­çš„-JSON-è‡ªåŠ¨è½¬åŒ–é-boolean-ä¸º-boolean-å€¼/code.jpg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/tags/SpringBoot/"/>
    
      <category term="Spring" scheme="http://zhangjiaheng.cn/tags/Spring/"/>
    
      <category term="SpringMVC" scheme="http://zhangjiaheng.cn/tags/SpringMVC/"/>
    
      <category term="JSON" scheme="http://zhangjiaheng.cn/tags/JSON/"/>
    
      <category term="converter" scheme="http://zhangjiaheng.cn/tags/converter/"/>
    
      <category term="RequestBody" scheme="http://zhangjiaheng.cn/tags/RequestBody/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åœ¨ SpringCloud å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½² Docker å¯åŠ¨</title>
    <link href="http://zhangjiaheng.cn/blog/20191211/%E5%A6%82%E4%BD%95%E5%9C%A8-SpringCloud-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2-docker-%E5%90%AF%E5%8A%A8/"/>
    <id>http://zhangjiaheng.cn/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/</id>
    <published>2019-12-11T09:26:46.000Z</published>
    <updated>2019-12-11T10:13:18.063Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/docker.jpg" alt></p><a id="more"></a><h2 id="å¦‚ä½•ç”¨-docker-ä¸€é”®å¯åŠ¨-SpringCloud-å¾®æœåŠ¡ï¼Ÿ"><a href="#å¦‚ä½•ç”¨-docker-ä¸€é”®å¯åŠ¨-SpringCloud-å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç”¨ docker ä¸€é”®å¯åŠ¨ SpringCloud å¾®æœåŠ¡ï¼Ÿ"></a>å¦‚ä½•ç”¨ docker ä¸€é”®å¯åŠ¨ SpringCloud å¾®æœåŠ¡ï¼Ÿ</h2><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-docker-å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-docker-å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ docker å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ docker å¯åŠ¨æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Ÿ</h3><p>åŸå§‹ä¼ ç»Ÿçš„éƒ¨ç½²æ–¹å¼ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å¤ªå¤šé—®é¢˜ï¼Œæ¯”å¦‚å½“ä½ çš„æœåŠ¡åœ¨æµ‹è¯•ç¯å¢ƒæ­£è¿è¡Œçš„æ­£å¸¸ï¼Œä½†æ˜¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå°±ä¼šå‡ºç°ä¸€å¤§å †æœªçŸ¥é—®é¢˜ï¼Œä½ æŸ¥äº†å¥½ä¹…ï¼Œdebug ä»£ç ä¹‹åå‘ç°ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡æ²¡æœ‰è®¾ç½®æ­£ç¡®ï¼Œå¯¼è‡´äº§ç”Ÿäº†ç›®å‰è¿™ä¹ˆä¸€å¤§ä¸²é—®é¢˜ï¼Œæµªè´¹äº†ä½ çš„æ—¶é—´ï¼Œæ‹–å»¶äº†é¡¹ç›®ä¸Šçº¿çš„æ—¶é—´ï¼Œç”šè‡³äº§ç”Ÿäº†ä¸¥é‡çš„ç”Ÿäº§äº‹æ•…ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæœºåˆ¶æ¥ä¿è¯æˆ‘ä»¬çš„ä»£ç åœ¨éƒ¨ç½²åˆ°æœ¬åœ°ã€æµ‹è¯•ä»¥åŠç”Ÿäº§çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸ä¼šå—åˆ°ç¯å¢ƒä¸ä¸€è‡´çš„å½±å“è€Œå¯¼è‡´æˆ‘ä»¬éƒ¨ç½²å¤±è´¥ï¼</p><p>è¿˜æœ‰å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker æ‰“åŒ…é•œåƒç„¶åä½¿ç”¨ docker-compose ç¼–æ’å®¹å™¨ä¸€é”®å¯åŠ¨ï¼Œè®©è¿ç»´è‡ªåŠ¨åŒ–ï¼Œæå¤§çš„èŠ‚çœæˆ‘ä»¬çš„å·¥ä½œæ—¶é—´ã€‚</p><h3 id="åœ¨-Spring-Cloud-å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨-DOCKERï¼Ÿ"><a href="#åœ¨-Spring-Cloud-å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨-DOCKERï¼Ÿ" class="headerlink" title="åœ¨ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ DOCKERï¼Ÿ"></a>åœ¨ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ DOCKERï¼Ÿ</h3><h4 id="é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ"><a href="#é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ"></a>é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ¯ä¸€ä¸ªæœåŠ¡æ‰“åŒ…æˆé•œåƒ</h4><p>ä¾‹å¦‚æˆ‘çš„<a href="https://github.com/Fatezhang/scaffold-cloud/blob/a6dd55772f59eecd99b099e013ce2ef4470cec91/scaffold-eureka/pom.xml#L43" target="_blank" rel="noopener"> Scaffold-Cloud é¡¹ç›®ä¸­çš„ eureka æœåŠ¡çš„ pom æ–‡ä»¶</a>(ç‚¹å‡»é“¾æ¥è·³è½¬åˆ° github ä»¥ä¸‹ä»£ç è¡Œ)å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">imageName</span>&gt;</span>scaffold-cloud/$&#123;project.artifactId&#125;:$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">forceTags</span>&gt;</span>true<span class="tag">&lt;/<span class="name">forceTags</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">baseImage</span>&gt;</span>java<span class="tag">&lt;/<span class="name">baseImage</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå…¶ä»–æ¨¡å—ä¹Ÿä¸€æ ·ï¼Œåœ¨ pom æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸Š maven æ’ä»¶ï¼Œå®Œæ•´é¡¹ç›®ä»£ç å¦‚ä¸‹(è§‰å¾—å¥½ç”¨ starâœ¨ä¸€ä¸‹å“¦)ï¼š</p><p><a href="https://github.com/Fatezhang/scaffold-cloud" target="_blank" rel="noopener">https://github.com/Fatezhang/scaffold-cloud/</a></p><h4 id="ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º-docker-é•œåƒ"><a href="#ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º-docker-é•œåƒ" class="headerlink" title="ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º docker é•œåƒ"></a>ä½¿ç”¨è„šæœ¬ä¸€é”®åˆ›å»º docker é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line">echo "============start to package with maven and recreate docker image=============="</span><br><span class="line"></span><br><span class="line">SERVICE_FOLDERS=(</span><br><span class="line">  scaffold-eureka</span><br><span class="line">  scaffold-zuul</span><br><span class="line">  scaffold-tx-manager</span><br><span class="line">  scaffold-business/scaffold-business-sys-service</span><br><span class="line">  scaffold-business/scaffold-business-job-service</span><br><span class="line">  scaffold-business/scaffold-business-thirdparty-service</span><br><span class="line">  scaffold-route/scaffold-route-app</span><br><span class="line">  scaffold-route/scaffold-route-openapi</span><br><span class="line">  scaffold-route/scaffold-route-operate</span><br><span class="line">)</span><br><span class="line">path=</span><br><span class="line">for (( i = 0; i &lt; $&#123;#SERVICE_FOLDERS[@]&#125;; i++ )); do</span><br><span class="line">    path=$&#123;SERVICE_FOLDERS[$&#123;i&#125;]&#125;</span><br><span class="line">    echo "è¿›å…¥ç›®å½• &gt;&gt;&gt;&gt; cd $&#123;path&#125;"</span><br><span class="line">    cd "$&#123;path&#125;" || exit</span><br><span class="line">    pwd</span><br><span class="line">    mvn clean package docker:build -Pdocker</span><br><span class="line">    cd - || exit</span><br><span class="line">done</span><br><span class="line">echo "============                      create end                     =============="</span><br></pre></td></tr></table></figure><h4 id="ç¼–æ’-docker-compose-å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡"><a href="#ç¼–æ’-docker-compose-å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡" class="headerlink" title="ç¼–æ’ docker-compose å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡"></a>ç¼–æ’ docker-compose å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡</h4><p>ç„¶ååªéœ€è¦å°†æ‰€æœ‰é•œåƒç¼–æ’åœ¨ docker-compose.yml æ–‡ä»¶ä¸­å³å¯ï¼Œå…¶ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä»¥è®¿é—®åˆ°å¯¹æ–¹æœåŠ¡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ docker-compose.yml æ–‡ä»¶å¦‚ä¸‹ï¼ˆæ³¨æ„æœ‰ä¸€ä¸ª<code>wait-for-it.sh</code>ï¼‰ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.7"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">micro-sys:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="string">tx_manager:7970</span> <span class="string">'java -jar scaffold-business-sys-service-1.0-SNAPSHOT.jar'</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">scaffold-cloud/scaffold-business-sys-service:1.0-SNAPSHOT</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp:/tmp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8750</span><span class="string">:8750</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">eureka</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqbroker</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tx_manager</span></span><br><span class="line">  <span class="attr">route-operate:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="string">micro-sys:8750</span> <span class="string">'java -jar scaffold-route-operate-1.0-SNAPSHOT.jar'</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">scaffold-cloud/scaffold-route-operate:1.0-SNAPSHOT</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp:/tmp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8850</span><span class="string">:8850</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">micro-sys</span></span><br><span class="line">  <span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">java</span> <span class="string">-jar</span> <span class="string">scaffold-eureka-1.0-SNAPSHOT.jar</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">scaffold-cloud/scaffold-eureka:1.0-SNAPSHOT</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp:/tmp</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8761</span><span class="string">:8761</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">  <span class="attr">zuul:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="string">eureka:8761</span> <span class="string">'java -jar scaffold-zuul-1.0-SNAPSHOT.jar'</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">scaffold-cloud/scaffold-zuul:1.0-SNAPSHOT</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp:/tmp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8861</span><span class="string">:8861</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">eureka</span></span><br><span class="line">  <span class="attr">tx_manager:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="string">mysql:3306,redis:6379</span> <span class="string">'java -jar scaffold-txmanager-1.0-SNAPSHOT.jar'</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">scaffold-cloud/scaffold-txmanager:1.0-SNAPSHOT</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp:/tmp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.scripts/wait-for-it.sh:/wait-for-it.sh</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8890</span><span class="string">:8890</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7970</span><span class="string">:7970</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">eureka</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql/mysql-server:5.7</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/config/my.cnf:/etc/my.cnf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql/init:/docker-entrypoint-initdb.d/</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--requirepass</span> <span class="string">pwd8ok8</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">  <span class="attr">rmqnamesrv:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">foxiswho/rocketmq:server-4.5.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9876</span><span class="string">:9876</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rmq/logs:/opt/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rmq/store:/opt/store</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">"-Duser.home=/opt -Xms128m -Xmx128m -Xmn128m"</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line">  <span class="attr">rmqbroker:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">foxiswho/rocketmq:broker-4.5.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqbroker</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10909</span><span class="string">:10909</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10911</span><span class="string">:10911</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rmq/logs:/opt/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rmq/store:/opt/store</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./rmq/brokerconf/broker.conf:/etc/rocketmq/broker.conf</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPT_EXT:</span> <span class="string">"-Duser.home=/opt -server -Xms128m -Xmx128m -Xmn128m"</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">["/bin/bash","mqbroker","-c","/etc/rocketmq/broker.conf","-n","rmqnamesrv:9876","autoCreateTopicEnable=true"]</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">rmqconsole:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">styletang/rocketmq-console-ng</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rmqconsole</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8180</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPTS:</span> <span class="string">"-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rmqnamesrv</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">scaffold-cloud</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">scaffold-cloud:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">scaffold-cloud</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure></p><h4 id="å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ"><a href="#å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ"></a>å¦‚ä½•åœ¨å¯åŠ¨æ‰€æœ‰å¾®æœåŠ¡çš„æ—¶å€™æŒ‰é¡ºåºå¯åŠ¨å‘¢ï¼Ÿ</h4><p>æˆ‘ä»¬çŸ¥é“ï¼ŒSpringCloud å¾®æœåŠ¡ä¸­å„ä¸ªæœåŠ¡ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ tx-manager æœåŠ¡éœ€è¦ç­‰å¾… MySQL å’Œ Redis éƒ½å¯åŠ¨å®Œæˆä¹‹åæ‰èƒ½å¤Ÿé¡ºåˆ©å¯åŠ¨ï¼Œä½†æ˜¯ docker-compose.yml æ–‡ä»¶ä¸­çš„ <code>depends_on</code>åªèƒ½ç­‰å¾… docker å®¹å™¨å¯åŠ¨æˆåŠŸï¼Œè€Œä¸èƒ½ç­‰å¾… docker å®¹å™¨ä¸­çš„æœåŠ¡å¯åŠ¨å®Œæˆï¼</p><p>docker å®˜æ–¹ç»™å‡ºçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨wait-for-it.shè„šæœ¬ï¼Œåœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œè„šæœ¬ï¼Œåˆ¤æ–­ä¾èµ–çš„æœåŠ¡å’Œç«¯å£æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œç„¶åå†æ‰§è¡Œè‡ªå·±æœåŠ¡çš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·å»å†™ä¸€ä¸ªè„šæœ¬ï¼š<code>wait-for-it.sh</code>å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> shellcheck disable=SC2223</span><br><span class="line">: $&#123;SLEEP_SECOND:=2&#125;</span><br><span class="line"></span><br><span class="line">wait_for() &#123;</span><br><span class="line">  echo Waiting for $1 on port $2... ...</span><br><span class="line"><span class="meta">  #</span> shellcheck disable=SC2086</span><br><span class="line"><span class="meta">  #</span> shellcheck disable=SC2188</span><br><span class="line">  while ! &lt;/dev/tcp/$1/$2; do</span><br><span class="line">    echo Waiting for $1 on port $2... ...</span><br><span class="line">    sleep $SLEEP_SECOND</span><br><span class="line">  done</span><br><span class="line">  echo Server:"$1" on port:"$2" is running... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SER_STRS=$1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> shellcheck disable=SC2207</span><br><span class="line"><span class="meta">#</span> shellcheck disable=SC2006</span><br><span class="line">SERVICES_PORTS=($(echo "$SER_STRS" | tr ',' ' '))</span><br><span class="line"></span><br><span class="line">THEN_COMMAND=$2</span><br><span class="line"></span><br><span class="line">for ((i = 0; i &lt; $&#123;#SERVICES_PORTS[@]&#125;; i++)); do</span><br><span class="line">  SERVICE_PORT=$&#123;SERVICES_PORTS[$&#123;i&#125;]&#125;</span><br><span class="line"><span class="meta">  #</span> shellcheck disable=SC2207</span><br><span class="line"><span class="meta">  #</span> shellcheck disable=SC2006</span><br><span class="line">  array=($(echo "$SERVICE_PORT" | tr ':' ' '))</span><br><span class="line">  servername=$&#123;array[0]&#125;</span><br><span class="line">  serverport=$&#123;array[1]&#125;</span><br><span class="line">  wait_for "$servername" "$&#123;serverport&#125;"</span><br><span class="line">done</span><br><span class="line">echo "start to run command: $THEN_COMMAND"</span><br><span class="line"><span class="meta">#</span> shellcheck disable=SC2004</span><br><span class="line">if [ "$THEN_COMMAND" ]; then</span><br><span class="line">  eval "$THEN_COMMAND"</span><br><span class="line">else</span><br><span class="line"><span class="meta">  #</span> shellcheck disable=SC2102</span><br><span class="line">  echo command: [$THEN_COMMAND] is invalid... ...</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è„šæœ¬çš„ä½œç”¨å°±æ˜¯ç­‰å¾…å¯åŠ¨çš„æœåŠ¡ä»¥åŠç«¯å£å¯åŠ¨æˆåŠŸï¼Œæ²¡æœ‰æˆåŠŸçš„è¯å°±ç»§ç»­ wait ç­‰å¾…ï¼Œé»˜è®¤ç­‰å¾… 2 ç§’ï¼Œå¯åŠ¨æˆåŠŸçš„è¯å°±æ‰§è¡Œè‡ªå·±çš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tx_manager:</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">./wait-for-it.sh</span> <span class="string">mysql:3306,redis:6379</span> <span class="string">'java -jar scaffold-txmanager-1.0-SNAPSHOT.jar'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ docker å¯åŠ¨ SpringCloud å¾®æœåŠ¡çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œå¸Œæœ›èƒ½å¤Ÿç»™æˆ‘çš„é¡¹ç›®<a href="https://github.com/Fatezhang/scaffold-cloud/ç‚¹ä¸ªstar" target="_blank" rel="noopener">https://github.com/Fatezhang/scaffold-cloud/ç‚¹ä¸ªstar</a> å“¦~</p><p>è€Œä¸”ä½ ä¹Ÿå¯ä»¥ç»™æˆ‘æ issueï¼Œæ PRï¼Œæ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ï¼Œä¸€èµ·å¼€å‘~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191211/å¦‚ä½•åœ¨-SpringCloud-å¾®æœåŠ¡é¡¹ç›®ä¸­ä¸€é”®éƒ¨ç½²-docker-å¯åŠ¨/docker.jpg&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/categories/SpringCloud/"/>
    
    
      <category term="springboot" scheme="http://zhangjiaheng.cn/tags/springboot/"/>
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/tags/SpringCloud/"/>
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="spring" scheme="http://zhangjiaheng.cn/tags/spring/"/>
    
      <category term="docker" scheme="http://zhangjiaheng.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Scaffold-Cloud â€”â€” SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ</title>
    <link href="http://zhangjiaheng.cn/blog/20191025/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/"/>
    <id>http://zhangjiaheng.cn/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/</id>
    <published>2019-10-25T05:42:24.000Z</published>
    <updated>2019-12-07T03:23:32.461Z</updated>
    
    <content type="html"><![CDATA[<p><center><u style="font-size=16px;"><a href="/">Scaffold-Cloud: SpringCloudå¾®æœåŠ¡è„šæ‰‹æ¶</a></u></center> <a href="https://mubu.com/doc/6NZlNw3DIw" target="_blank" rel="noopener">å¹•å¸ƒ</a><br>Scaffold-Cloud æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¼€å‘è€…å­¦ä¹ çš„ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®è„šæ‰‹æ¶ã€‚é¡¹ç›®æœŸæœ›é›†æˆå¤§éƒ¨åˆ†ç›®å‰äº’è”ç½‘å…¬å¸ä½¿ç”¨çš„ä¸»æµçš„Spring-Cloudå¾®æœåŠ¡ç›¸å…³å·¥å…·å’ŒæœåŠ¡ã€‚å¹¶ç»“åˆä¸€äº›å®é™…çš„ä¸šåŠ¡å¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œå¦‚ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—åˆ†æç­‰ç­‰ï¼Œç„¶ååŠ å…¥ CI/CD å¹¶å¼•å…¥ docker éƒ¨ç½²ã€‚</p><p>Scaffold-Cloud åŸºäº SpringCloud Netflix å…¨å®¶æ¡¶è¿›è¡Œå¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºï¼Œæ‰€ä»¥åœ¨è¿™ä¹‹å‰ï¼Œä½¿ç”¨ Scaffold-Cloud éœ€è¦å…ˆäº†è§£ä¸‹ SpringCloud ä»¥åŠ Netflix å·¥å…·å…¨å®¶æ¡¶ã€‚</p><p><img src="/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/netflix.png" alt></p><p><center><u style="font-size=6px; color:gray">Sorry, NetFlix is not available in your country yet.</u></center><br><a id="more"></a></p><h2 id="Spring-Cloud-ä»‹ç»"><a href="#Spring-Cloud-ä»‹ç»" class="headerlink" title="Spring Cloud ä»‹ç»"></a>Spring Cloud ä»‹ç»</h2><h4 id="ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡"><a href="#ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡" class="headerlink" title="ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡"></a>ä»å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡</h4><p>åœ¨æ—©æœŸçš„ä¼ä¸šä¸­ï¼Œé¡¹ç›®åŸºæœ¬ä¸Šéƒ½æ˜¯å•ä½“åº”ç”¨ï¼Œå°†ä¸€ä¸ªç½‘ç«™éƒ¨ç½²åœ¨ä¸€å°å•ç‹¬çš„æœåŠ¡å™¨ä¸Šå¯¹ç”¨æˆ·æä¾›æœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·çš„æœåŠ¡æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå½“æœåŠ¡å™¨æ–­ç”µæˆ–è€…æœåŠ¡è¿›ç¨‹æŒ‚æ‰ï¼Œç”¨æˆ·ç›´æ¥å°±æ— æ³•è®¿é—®ã€‚åæ¥æ¼”è¿›å‡ºé›†ç¾¤æœåŠ¡ï¼Œå°†åŒæ ·çš„æœåŠ¡åœ¨å¤šå°æœåŠ¡å™¨åˆ†åˆ«éƒ¨ç½²ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡ç­‰æ‰‹æ®µè®©æœåŠ¡å¯¹äºç”¨æˆ·æ¥è¯´çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™æ ·å½“ä¸€å°æœåŠ¡å™¨å¤¯æœºè‡³å°‘è¿˜æœ‰å…¶ä»–çš„æœåŠ¡å™¨æä¾›ç›¸åŒçš„åº”ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå½“ä¼ä¸šçº§æœåŠ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚çš„æ—¶å€™ï¼Œé¡¹ç›®å˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œæœ‰æ—¶ç”šè‡³å½±å“åˆ°äº†æœåŠ¡çš„éƒ¨ç½²ï¼Œè¿™ä¸ªæ—¶å€™å°±åº”è¯¥å°†åºå¤§çš„æœåŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ç³»ç»Ÿï¼Œéƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·çš„æœåŠ¡å½“é­é‡é«˜å¹¶å‘è®¿é—®çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿå°†è¯·æ±‚å‹åŠ›åˆ†æ‘Šåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼ã€‚</p><p>è€Œå½“ä¼ä¸šéœ€è¦å¼€å¯ä¸€ä¸ªæ–°çš„é¡¹ç›®æ—¶ï¼Œä¸ºäº†é¿å…é‡å¤é€ è½®å­ï¼Œå¾€å¾€ä¸€äº›å¯å¤ç”¨çš„æ¨¡å—ä¼šè¢«æ‹†åˆ†å‡ºæ¥ä½œä¸ºä¸€ä¸ªå¾®å°çš„ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç‹¬ç«‹çš„å¼€å‘ã€è®¾è®¡ã€è¿è¡Œå’Œè¿ç»´ï¼Œåªéœ€è¦ä½¿ç”¨ ESBä¼ä¸šæœåŠ¡æ€»çº¿å°†æ‰€æœ‰æœåŠ¡æ•´åˆå¹¶æä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œå°±èƒ½å¤Ÿå¤ç”¨ï¼Œè¿™å°±æ˜¯ SOAã€‚</p><p>è€Œå¾®æœåŠ¡æ˜¯å¯¹ä»¥ä¸ŠæœåŠ¡æ¶æ„çš„æœ€ç»ˆæ¼”è¿›ç»“æ„ï¼šå°†æœåŠ¡åˆ‡åˆ†æˆå¤šä¸ªå¾®å°çš„åº”ç”¨ï¼Œæä¾›ç»Ÿä¸€çš„æœåŠ¡è®¿é—®åè®®HTTP(SpringCloud)/TCP(Dubbo)ï¼Œå¼ºè°ƒè¿è¡Œæ—¶çš„åˆ†æ•£è§£è€¦ï¼Œåœ¨ä¸šåŠ¡ä¸Šä¹Ÿæœ‰ç€é«˜åº¦çš„æŠ½ç¦»ã€‚</p><blockquote><p><code>å¾®æœåŠ¡æ¶æ„é£æ ¼</code><strong>æ˜¯ä¸€ç§å°†<code>ä¸€ä¸ªå•ä¸€åº”ç”¨ç¨‹åº</code>å¼€å‘ä¸º<code>ä¸€ç»„å°å‹æœåŠ¡</code>çš„æ–¹æ³•ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶</strong>(é€šå¸¸ä½¿ç”¨HTTPèµ„æºAPI)ã€‚è¿™äº›<strong>æœåŠ¡å›´ç»•<code>ä¸šåŠ¡èƒ½åŠ›</code>æ„å»º</strong>ï¼Œå¹¶ä¸”å¯é€šè¿‡<strong>å…¨è‡ªåŠ¨éƒ¨ç½²æœºåˆ¶ç‹¬ç«‹éƒ¨ç½²</strong>ã€‚è¿™äº›æœåŠ¡å…±ç”¨ä¸€ä¸ª<strong>æœ€å°å‹çš„é›†ä¸­å¼çš„ç®¡ç†</strong>ï¼ŒæœåŠ¡å¯ç”¨ä¸åŒçš„è¯­è¨€å¼€å‘ï¼Œä½¿ç”¨ä¸åŒçš„<strong>æ•°æ®å­˜å‚¨æŠ€æœ¯</strong>ã€‚<br><img src="/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/microservice.webp" alt><br>â€”â€” Martin Fowler</p></blockquote><p><strong>ä½†æ˜¯æ‹†åˆ†æˆè¿™ä¹ˆå¾®å°çš„å¾®æœåŠ¡ä¸€å®šä¼šç¢°åˆ°å„ç§å„æ ·çš„é—®é¢˜â€”â€”å¦‚ä½•æ‹†åˆ†ï¼ŸæœåŠ¡ä¹‹é—´å¦‚ä½•å‘ç°ï¼Ÿå¦‚ä½•æˆæƒï¼Ÿå¦‚ä½•åšè´Ÿè½½å‡è¡¡ï¼Ÿå¦‚ä½•ç®¡ç†å¤šæœåŠ¡é…ç½®ï¼Ÿå¦‚ä½•è·Ÿè¸ªè°ƒç”¨é“¾è·¯ï¼Ÿå¦‚ä½•å®æ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€ç­‰ç­‰â€¦ â€¦ SpringCloud å°±æ˜¯ä»¥ä¸Šä¸€ç³»åˆ—é—®é¢˜çš„ Solverã€‚å®ƒæä¾›äº†ä¸€æ•´å¥—çš„è§£å†³æ–¹æ¡ˆï¼</strong></p><h4 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h4><p>é¦–å…ˆï¼ŒSpringCloud å¹¶ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ä¸ªå¾®æœåŠ¡çš„è§„èŒƒï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªå¾®æœåŠ¡å·¥å…·é›†åˆã€‚</p><h5 id="SpringCloudç‰¹ç‚¹ï¼š"><a href="#SpringCloudç‰¹ç‚¹ï¼š" class="headerlink" title="SpringCloudç‰¹ç‚¹ï¼š"></a>SpringCloudç‰¹ç‚¹ï¼š</h5><ul><li>çº¦å®šå¤§äºé…ç½®ï¼ŒåŸºäº SpringBoot</li><li>å¼€å‘éƒ¨ç½²äºå„ç§ç¯å¢ƒï¼ŒAWSï¼Œé˜¿é‡Œäº‘ï¼ŒPC ç­‰</li><li>éšè—ç»„ä»¶å¤æ‚æ€§ï¼Œå£°æ˜å¼é…ç½®ï¼Œæ—  xml</li><li>å¼€ç®±å³ç”¨ï¼Œå¿«é€Ÿå¯åŠ¨</li><li>ä¸°å¯Œçš„è½»é‡çº§ç»„ä»¶</li><li>çµæ´»é€‰å‹ï¼Œå¦‚æ³¨å†Œå‘ç°å¯ç”¨ eurekaï¼Œzookeeper æˆ–è€… Redis</li></ul><h5 id="SpringCloud-å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§"><a href="#SpringCloud-å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§" class="headerlink" title="SpringCloud å„ç‰ˆæœ¬ç»„ä»¶åŠç‰ˆæœ¬å…¼å®¹æ€§"></a>SpringCloud å„ç‰ˆæœ¬ç»„ä»¶åŠ<a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">ç‰ˆæœ¬å…¼å®¹æ€§</a></h5><table><thead><tr><th>Component</th><th>Edgware.SR6</th><th>Greenwich.SR2</th><th>Greenwich.BUILD-SNAPSHOT</th></tr></thead><tbody><tr><td>spring-cloud-aws</td><td>1.2.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-bus</td><td>1.3.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-cli</td><td>1.4.1.RELEASE</td><td>2.0.0.RELEASE</td><td>2.0.1.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-commons</td><td>1.3.6.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-contract</td><td>1.2.7.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-config</td><td>1.4.7.RELEASE</td><td>2.1.3.RELEASE</td><td>2.1.4.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-netflix</td><td>1.4.7.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-security</td><td>1.2.4.RELEASE</td><td>2.1.3.RELEASE</td><td>2.1.4.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-cloudfoundry</td><td>1.1.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-consul</td><td>1.3.6.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-sleuth</td><td>1.3.6.RELEASE</td><td>2.1.1.RELEASE</td><td>2.1.2.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-stream</td><td>Ditmars.SR5</td><td>Fishtown.SR3</td><td>Fishtown.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-zookeeper</td><td>1.2.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-boot</td><td>1.5.21.RELEASE</td><td>2.1.5.RELEASE</td><td>2.1.8.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-task</td><td>1.2.4.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-vault</td><td>1.1.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-gateway</td><td>1.0.3.RELEASE</td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-openfeign</td><td></td><td>2.1.2.RELEASE</td><td>2.1.3.BUILD-SNAPSHOT</td></tr><tr><td>spring-cloud-function</td><td>1.0.2.RELEASE</td><td>2.0.2.RELEASE</td><td>2.0.3.BUILD-SNAPSHOT</td></tr></tbody></table><h3 id="SpringCloud-å…¨å®¶æ¡¶"><a href="#SpringCloud-å…¨å®¶æ¡¶" class="headerlink" title="SpringCloud å…¨å®¶æ¡¶"></a><a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">SpringCloud å…¨å®¶æ¡¶</a></h3><h4 id="spring-cloud-netflix"><a href="#spring-cloud-netflix" class="headerlink" title="spring-cloud-netflix"></a>spring-cloud-netflix</h4><h5 id="eureka-åŸç†ï¼š"><a href="#eureka-åŸç†ï¼š" class="headerlink" title="eureka åŸç†ï¼š"></a>eureka åŸç†ï¼š</h5><ul><li>æœåŠ¡å¯åŠ¨æ—¶ï¼Œè°ƒç”¨ eureka æ¥å£è¿›è¡Œæ³¨å†Œï¼ŒEureka Server ä¼šå­˜å‚¨è¿™äº›ä¿¡æ¯ï¼ŒIPã€ç«¯å£ã€å¾®æœåŠ¡åç§°ç­‰</li><li>å¾®æœåŠ¡å¯åŠ¨ä¹‹åï¼Œä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³è¿›è¡Œâ€œç»­ç§Ÿâ€ï¼Œé»˜è®¤ 30 ç§’</li><li>å¦‚æœä¸€å®šæ—¶é—´æ²¡æœ‰â€œç»­ç§Ÿâ€ï¼Œé»˜è®¤ 90 ç§’ï¼Œå°±é”€æ¯å¾®æœåŠ¡å®ä¾‹</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEureka Server ä¹Ÿæ˜¯ä¸€ä¸ª Eureka Clientï¼Œé›†ç¾¤ä¸‹ä¼šäº’ç›¸å¤åˆ¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯è¿›è¡ŒåŒæ­¥</li><li>Eureka Client ä¼šç¼“å­˜æ³¨å†Œè¡¨çš„ä¿¡æ¯ï¼Œå‡å°‘Eureka Server çš„è¯·æ±‚å‹åŠ›ï¼Œä»¥åŠå®¹ç¾</li></ul><h4 id="spring-cloud-openfeign"><a href="#spring-cloud-openfeign" class="headerlink" title="spring-cloud-openfeign"></a>spring-cloud-openfeign</h4><h4 id="spring-cloud-zuul-å¾®æœåŠ¡ç½‘å…³"><a href="#spring-cloud-zuul-å¾®æœåŠ¡ç½‘å…³" class="headerlink" title="spring-cloud-zuul å¾®æœåŠ¡ç½‘å…³"></a>spring-cloud-zuul å¾®æœåŠ¡ç½‘å…³</h4><h4 id="spring-cloud-config-é…ç½®ä¸­å¿ƒ"><a href="#spring-cloud-config-é…ç½®ä¸­å¿ƒ" class="headerlink" title="spring-cloud-config é…ç½®ä¸­å¿ƒ"></a>spring-cloud-config é…ç½®ä¸­å¿ƒ</h4><h2 id="é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ"><a href="#é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ" class="headerlink" title="é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ"></a>é¡¹ç›®åˆ›å»ºçš„ç›®çš„ï¼Ÿ</h2><p>ç¬¬ä¸€ä¸ªç›®çš„æ˜¯ä¸ºäº†æœ¬äººèƒ½å¤Ÿç†Ÿæ‚‰å’Œå­¦ä¹  Spring-Cloud ç›¸å…³çŸ¥è¯†ï¼Œä¸è¿‡åœ¨åšäº†ä¸€æ®µæ—¶é—´ä¹‹åè¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ†äº«å‡ºæ¥è®©æ›´å¤šçš„åŒå­¦ä¸€èµ·å­¦ä¹ å’Œè®¨è®ºã€‚</p><h2 id="é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ"><a href="#é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ" class="headerlink" title="é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ"></a>é¡¹ç›®ç»“æ„å¦‚ä½•ï¼Ÿ</h2><ul><li>scaffold-business <a href="#">ä¸šåŠ¡æœåŠ¡æä¾›è€…</a> ç«¯å£ä»8850 - 8860<ul><li>scaffold-business-sys-service <a href="#">ç³»ç»Ÿä¸šåŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8850</li><li>scaffold-business-job-service <a href="#">å®šæ—¶ä»»åŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8851</li><li>scaffold-business-thirdparty-service <a href="#">ç¬¬ä¸‰æ–¹ä¸šåŠ¡å¾®æœåŠ¡-ä¸šåŠ¡æ¨¡å—</a> ç«¯å£ 8852</li></ul></li><li>scaffold-business-api <a href="#">ä¸šåŠ¡APIåŒ… ç”¨äºæ¥å£ä¸å®ç°åˆ†ç¦»</a><ul><li>scaffold-business-sys-api <a href="#">ç³»ç»Ÿèµ„æºã€èœå•ã€æƒé™ç­‰APIå°è£…</a></li><li>scaffold-business-job-api <a href="#">å®šæ—¶ä»»åŠ¡APIå°è£…</a></li><li>scaffold-business-thirdparty-api <a href="#">ç¬¬ä¸‰æ–¹æœåŠ¡APIå°è£…</a></li></ul></li><li>scaffold-core <a href="#">å·¥å…·ç±»ä»¥åŠå„ç§å…¬å…±ä»£ç </a><ul><li>scaffold-core-code <a href="#">æ¯ä¸ªæ¨¡å—éƒ½ä¼šç”¨åˆ°çš„å…¬å…±ä»£ç ï¼ŒBeanï¼Œconfigç­‰</a></li><li>scaffold-core-common <a href="#">å·¥å…·ç±»æ¨¡å—ï¼Œå…¬å…±ä»£ç </a></li><li>scaffold-core-plugin <a href="#">è‡ªåŠ¨ä»£ç ç”Ÿæˆæ’ä»¶æ¨¡å—</a></li></ul></li><li>scaffold-eureka <a href="#">æ³¨å†Œä¸­å¿ƒEureka</a> ç«¯å£ 8761 - 8771</li><li>scaffold-zuul <a href="#">ç½‘å…³æœåŠ¡</a> ç«¯å£ 8861 - 8870</li><li>scaffold-config-server <a href="#">é…ç½®æœåŠ¡ç«¯æœåŠ¡</a> ç«¯å£ 8871 - 8881</li><li>scaffold-config-client <a href="#">é…ç½®å®¢æˆ·ç«¯æœåŠ¡</a> ç«¯å£ 8880 - 8891</li><li>scaffold-tx-manager <a href="#">åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒæœåŠ¡</a> ç«¯å£7970 </li><li>scaffold-feign <a href="#">Feignæ¨¡å—</a><ul><li>scaffold-feign-sys <a href="#">feign-sysæ¨¡å—</a></li><li>scaffold-feign-job <a href="#">feign-jobæ¨¡å—</a></li><li>scaffold-feign-thirdparty <a href="#">feign-thirdpartyæ¨¡å—</a></li></ul></li><li>scaffold-route <a href="#">ä¸»ä¸šåŠ¡æ¶ˆè´¹è€…</a> ç«¯å£ä»8750 - 8760<ul><li>scaffold-route-operate <a href="#">åå°ç®¡ç†æ¥å£åŠé¡µé¢</a> ç«¯å£ 8750</li><li>scaffold-route-app <a href="#">APPå®¢æˆ·ç«¯æ¥å£</a> ç«¯å£ 8751</li></ul></li></ul><h2 id="å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ"><a href="#å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ"></a>å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ</h2><h3 id="1-æœ¬åœ°ç›´æ¥å¯åŠ¨"><a href="#1-æœ¬åœ°ç›´æ¥å¯åŠ¨" class="headerlink" title="1. æœ¬åœ°ç›´æ¥å¯åŠ¨"></a>1. æœ¬åœ°ç›´æ¥å¯åŠ¨</h3><ul><li><p>ä¸‹è½½/å…‹éš†é¡¹ç›®åˆ°æœ¬åœ° </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/Fatezhang/scaffold-cloud</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…MySqlæ•°æ®åº“å¹¶å¯åŠ¨</p></li><li>åˆ›å»ºæ•°æ®åº“scaffold_cloud_base å’Œ tx_manager</li><li>ä¿®æ”¹ scaffold-cloud ä¸­å¾®æœåŠ¡çš„æ•°æ®åº“é“¾æ¥é…ç½®ï¼Œæœ¬åœ°è¿è¡Œåªéœ€è¦ä¿®æ”¹application-local.yml</li><li>å®‰è£…redisæœåŠ¡å¹¶å¯åŠ¨ï¼Œä¿®æ”¹scaffold-core-codeé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼ŒåŒæ ·åªéœ€è¦ä¿®æ”¹localä¸­çš„</li><li>å®‰è£…Rocket MQæœåŠ¡ï¼ŒåŒæ ·ä¿®æ”¹é…ç½®</li><li>å¦‚æœæœ‰éœ€è¦ï¼Œæ³¨å†Œé˜¿é‡ŒOSSï¼Œå¹¶ä¿®æ”¹é…ç½®ä¸­çš„é…ç½®</li><li>å¯åŠ¨EurekaApplicationæ³¨å†Œä¸­å¿ƒ</li><li>å¯åŠ¨TxlcnApplicationåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒæœåŠ¡</li><li>å¯åŠ¨SysServiceApplicationï¼ŒåŠ è½½æ•°æ®åº“å­—å…¸ç­‰é…ç½®åˆ°ç¼“å­˜ã€æä¾›åå°ç®¡ç†å¾®æœåŠ¡ï¼ˆæƒé™ã€æ“ä½œå‘˜ã€è§’è‰²ã€å›½é™…åŒ–é…ç½®ç­‰ï¼‰</li><li>å¯åŠ¨RouteOperateApplicationæœåŠ¡ï¼Œé»˜è®¤ç«¯å£ä¸º8750</li><li>è®¿é—®<a href="http://localhost:8750/ÃŸÃŸ" target="_blank" rel="noopener">http://localhost:8750/ÃŸÃŸ</a></li><li>é»˜è®¤è´¦å·å¯†ç ä¸ºadmin/admin123</li></ul><h3 id="2-ä½¿ç”¨-docker-éƒ¨ç½²"><a href="#2-ä½¿ç”¨-docker-éƒ¨ç½²" class="headerlink" title="2. ä½¿ç”¨ docker éƒ¨ç½²"></a>2. ä½¿ç”¨ docker éƒ¨ç½²</h3><h4 id="docker-å¯åŠ¨-Linux-æˆ–è€…-Mac-ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬-Windows-ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ"><a href="#docker-å¯åŠ¨-Linux-æˆ–è€…-Mac-ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬-Windows-ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ" class="headerlink" title="docker å¯åŠ¨ : Linux æˆ–è€… Mac ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬, Windows ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ"></a>docker å¯åŠ¨ : Linux æˆ–è€… Mac ä¸‹ä½¿ç”¨å¦‚ä¸‹è„šæœ¬, Windows ç¯å¢ƒè‡ªè¡ŒæŒ‰ç…§è„šæœ¬ä¸­çš„ç¤ºä¾‹æ‰§è¡Œ</h4><h4 id="mvn-clean-package-docker-build-Pdocker"><a href="#mvn-clean-package-docker-build-Pdocker" class="headerlink" title="mvn clean package docker:build -Pdocker"></a><code>mvn clean package docker:build -Pdocker</code></h4><pre><code>1. è¿›å…¥é¡¹ç›®æ‰€åœ¨ç›®å½•2. æ‰§è¡Œ `./.scripts/recreate-docker-image.sh` åˆ›å»º docker é•œåƒ3. æ‰§è¡Œ `./.scripts/start-docker-service.sh` å³ä½¿ç”¨ docker-compose å¯åŠ¨</code></pre><h2 id="é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ"><a href="#é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ"></a>é¡¹ç›®æœªæ¥è¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ</h2><ul><li>æ›´æ”¹é¡¹ç›®æ³¨å†Œå‘ç°ä¸­å¿ƒï¼Œä¹Ÿè®¸ç”¨ nacos æˆ–è€… zookeeper</li><li>åŠ å…¥æ›´å¤š spring-cloud å‘¨è¾¹æœåŠ¡ï¼ŒåŒ…æ‹¬å„ç§ç›‘æ§å¹³å°ç­‰</li><li>CI/CD ä½¿ç”¨ Jenkins æˆ–è€… BuildKite</li><li>ä½¿ç”¨ docker å®¹å™¨åŒ–éƒ¨ç½²</li><li>ElasticSearch æ—¥å¿—æ”¶é›†</li><li><a href="https://github.com/xuxueli/xxl-job" target="_blank" rel="noopener">xxl-job</a> åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ <a href="https://www.xuxueli.com/xxl-job/" target="_blank" rel="noopener">https://www.xuxueli.com/xxl-job/</a></li><li>æ•´åˆ<a href="https://github.com/justauth/JustAuth" target="_blank" rel="noopener">ç¬¬ä¸‰æ–¹å¼€æºåº“</a>ç”¨ä»¥ç™»å½•ã€æ”¯ä»˜ç­‰</li><li>æœ€åï¼Œå®é™…å¼€å‘ä¸€äº›ä¸šåŠ¡åŠŸèƒ½</li></ul><hr><h4 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h4><blockquote><p><a href="https://juejin.im/post/5c28f2fe51882565a15776fb" target="_blank" rel="noopener">https://juejin.im/post/5c28f2fe51882565a15776fb</a></p><p><a href="https://juejin.im/post/5de740566fb9a0165721b744" target="_blank" rel="noopener">https://juejin.im/post/5de740566fb9a0165721b744</a></p><p><a href="https://juejin.im/post/5dc220126fb9a04aa660dcfb" target="_blank" rel="noopener">https://juejin.im/post/5dc220126fb9a04aa660dcfb</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;center&gt;&lt;u style=&quot;font-size=16px;&quot;&gt;&lt;a href=&quot;/&quot;&gt;Scaffold-Cloud: SpringCloudå¾®æœåŠ¡è„šæ‰‹æ¶&lt;/a&gt;&lt;/u&gt;&lt;/center&gt; &lt;a href=&quot;https://mubu.com/doc/6NZlNw3DIw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¹•å¸ƒ&lt;/a&gt;&lt;br&gt;Scaffold-Cloud æ˜¯ä¸€ä¸ªé€‚ç”¨äºå¼€å‘è€…å­¦ä¹ çš„ Spring-Cloud å¾®æœåŠ¡é¡¹ç›®è„šæ‰‹æ¶ã€‚é¡¹ç›®æœŸæœ›é›†æˆå¤§éƒ¨åˆ†ç›®å‰äº’è”ç½‘å…¬å¸ä½¿ç”¨çš„ä¸»æµçš„Spring-Cloudå¾®æœåŠ¡ç›¸å…³å·¥å…·å’ŒæœåŠ¡ã€‚å¹¶ç»“åˆä¸€äº›å®é™…çš„ä¸šåŠ¡å¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œå¦‚ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—åˆ†æç­‰ç­‰ï¼Œç„¶ååŠ å…¥ CI/CD å¹¶å¼•å…¥ docker éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;Scaffold-Cloud åŸºäº SpringCloud Netflix å…¨å®¶æ¡¶è¿›è¡Œå¾®æœåŠ¡é¡¹ç›®çš„æ„å»ºï¼Œæ‰€ä»¥åœ¨è¿™ä¹‹å‰ï¼Œä½¿ç”¨ Scaffold-Cloud éœ€è¦å…ˆäº†è§£ä¸‹ SpringCloud ä»¥åŠ Netflix å·¥å…·å…¨å®¶æ¡¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/20191025/SpringCloudå¾®æœåŠ¡æ¶æ„å®è·µ/netflix.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;u style=&quot;font-size=6px; color:gray&quot;&gt;Sorry, NetFlix is not available in your country yet.&lt;/u&gt;&lt;/center&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/categories/SpringCloud/"/>
    
    
      <category term="SpringCloud" scheme="http://zhangjiaheng.cn/tags/SpringCloud/"/>
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="SpringBoot" scheme="http://zhangjiaheng.cn/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN</title>
    <link href="http://zhangjiaheng.cn/blog/20191020/%E6%88%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%EF%BC%9ALCN/"/>
    <id>http://zhangjiaheng.cn/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/</id>
    <published>2019-10-20T03:14:44.000Z</published>
    <updated>2019-12-05T15:41:57.697Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png" alt="å®˜ç½‘é¦–é¡µ"></p><center><a href="#more2">å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†</a></center><a id="more"></a><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç”±äºå…¬å¸é¡¹ç›®æ˜¯ä½¿ç”¨dubboè¿›è¡Œå¼€å‘çš„åˆ†å¸ƒå¼æœåŠ¡ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­æœ‰å¾ˆå¤šæ¶‰åŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„åœºæ™¯ã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªæ¨¡å—ï¼šç”¨æˆ·æ¨¡å—å’Œè´¦æˆ·èµ„é‡‘æ¨¡å—ã€‚æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯ç”¨æˆ·è¢«é‚€è¯·æˆä¸ºç³»ç»Ÿçš„æ–°ç”¨æˆ·ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå†å»è´¦æˆ·èµ„é‡‘æ¨¡å—åˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ã€‚ä¸¤ä¸ªä¸åŒçš„æ¨¡å—ä¸ºä¸¤ä¸ªä¸åŒçš„RPCæœåŠ¡ï¼Œåˆ†åˆ«è¢«è°ƒç”¨ç„¶åæ’å…¥æ•°æ®ï¼Œè¿™æ—¶å€™å¦‚æœè´¦æˆ·èµ„é‡‘æ’å…¥å¤±è´¥ï¼Œä¸åŠ å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ç”¨æˆ·ç›´æ¥åˆå§‹åŒ–æˆåŠŸã€‚æˆ‘ä»¬å¸Œæœ›è¿™ç§æƒ…å†µä¸‹ç”¨æˆ·æ’å…¥çš„ä¿¡æ¯è¢«å›æ»šï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æ¥è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚</p><h4 id="ä½¿ç”¨çš„æ¡†æ¶"><a href="#ä½¿ç”¨çš„æ¡†æ¶" class="headerlink" title="ä½¿ç”¨çš„æ¡†æ¶"></a>ä½¿ç”¨çš„æ¡†æ¶</h4><p>ç»è¿‡è°ƒç ”ï¼Œæˆ‘ä»¬å‘ç°TX-LCNæ¡†æ¶æ¯”è¾ƒé€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬æ‰“ç®—å¼•å…¥å¹¶ä½¿ç”¨LCNäº‹åŠ¡æ¨¡å¼æ¥è¿›è¡ŒæœåŠ¡ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸šåŠ¡å¤„ç†ã€‚å…³äºLCNã€TCCã€TXCå‡ ç§äº‹åŠ¡æ¨¡å¼çš„åŒºåˆ«åœ¨<a href="#more2">ä¸‹é¢</a>æ•´ç†ã€‚</p><p>åœ¨<a href="https://www.txlcn.org/zh-cn/index.html" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½å¯¹åº”çš„æœåŠ¡ï¼Œå¹¶å¼•å…¥é¡¹ç›®æˆ–è€…å•ç‹¬å¯åŠ¨ï¼š</p><p><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png" alt="å®˜ç½‘é¦–é¡µ"></p><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.codingapi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transaction-dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lcn.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.codingapi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tx-plugins-db<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lcn.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><p>åœ¨æœåŠ¡çš„å‘èµ·æ–¹ä½¿ç”¨æ³¨è§£<code>@TxTransaction(isStart = true)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@TxTransaction</span>(isStart = <span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ExperienceLogVO <span class="title">doUseExperience</span><span class="params">(Long userId, Long experienceRecordId, ExperienceLogCreateModel createModel)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">    userFacade.insert();</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">    accountFacede.insert();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœåŠ¡çš„å‚ä¸æ–¹ä½¿ç”¨æ³¨è§£<code>@TxTransaction</code>æ ‡è¯†å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TxTransaction</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="comment">// ... do something  ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†å¯åŠ¨é¡¹ç›®ä¹‹å‰ï¼Œå…ˆå¯åŠ¨tx-manageræœåŠ¡ï¼Œä½œä¸ºåè°ƒè€…çš„è§’è‰²å­˜åœ¨ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨æ¥å£çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p><p><a id="more2" class="active"></a></p><h4 id="å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†"><a href="#å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†" class="headerlink" title="å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†"></a>å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†</h4><h5 id="å…³äºTx-LCN-å®˜ç½‘æ–‡æ¡£"><a href="#å…³äºTx-LCN-å®˜ç½‘æ–‡æ¡£" class="headerlink" title="å…³äºTx-LCN - å®˜ç½‘æ–‡æ¡£"></a>å…³äºTx-LCN - <a href="https://www.txlcn.org/zh-cn/docs/preface.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a></h5><p>Tx-LCNæ—©æœŸæ˜¯ä¸ºäº†è®¾è®¡å‡ºLCNåˆ†å¸ƒå¼äº‹åŠ¡è€Œå‘½åçš„ï¼Œä¸è¿‡åœ¨5.0ä¹‹åå¯ä»¥æ”¯æŒLCNã€TXCã€TCCä¸‰ç§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ã€‚LCNæ¡†æ¶å®šä½ä¸º<code>ä¸ç”Ÿäº§äº‹åŠ¡ï¼Œåªåšäº‹åŠ¡çš„æ¬è¿å·¥</code>ã€‚å³TX-LCNæ˜¯ä¸€æ¬¾äº‹åŠ¡åè°ƒæ¡†æ¶ï¼Œæœ¬èº«å¹¶ä¸æ“ä½œäº‹åŠ¡ï¼Œåªæ˜¯åŸºäºå¯¹äº‹åŠ¡çš„åè°ƒä»è€Œè¾¾åˆ°äº‹åŠ¡ä¸€è‡´æ€§çš„æ•ˆæœã€‚</p><p>æœ€æ–°ç‰ˆæœ¬çš„TX-LCNåŒæ—¶æ”¯æŒå¤šç§äº‹åŠ¡æ¨¡å¼ã€‚å¹¶æ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®æºåŒæ—¶ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®Œå…¨è¾¾åˆ°æ‹”æ’æ•ˆæœã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§äº‹åŠ¡æ¨¡å¼çš„ä»‹ç»ã€åŒºåˆ«åŠä¼˜ç¼ºç‚¹ã€‚</p><h6 id="LCNäº‹åŠ¡æ¨¡å¼"><a href="#LCNäº‹åŠ¡æ¨¡å¼" class="headerlink" title="LCNäº‹åŠ¡æ¨¡å¼"></a>LCNäº‹åŠ¡æ¨¡å¼</h6><ul><li>ä»…ä»…ä½œä¸ºäº‹åŠ¡çš„åè°ƒè€…ï¼Œæœ¬èº«ä¸ç”Ÿäº§äº‹åŠ¡ã€‚åŸç†æ˜¯åœ¨äº‹åŠ¡å‘èµ·æ–¹åˆ›å»ºäº‹åŠ¡åˆ†ç»„ï¼Œå¹¶é€šè¿‡Http/Tcpåè®®è°ƒç”¨çš„æ—¶å€™å°†äº‹åŠ¡åˆ†ç»„ä¼ é€’åˆ°äº‹åŠ¡å‚ä¸æ–¹ã€‚äº‹åŠ¡å‚ä¸æ–¹çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œæ ¹æ®äº‹åŠ¡åˆ†ç»„IDé€šçŸ¥äº‹åŠ¡çš„å‘èµ·æ–¹æäº¤æ‰€æœ‰äº‹åŠ¡ã€‚åœ¨å…¨éƒ¨äº‹åŠ¡æˆåŠŸé€šçŸ¥ä¹‹å‰ï¼Œå…¶å„ä¸ªæœ¬åœ°äº‹åŠ¡å‡ä¸ºå‡å…³é—­ï¼Œç­‰å¾…TxManageråè°ƒå®Œæˆäº‹åŠ¡ä¹‹åå†å…³é—­è¿æ¥ã€‚</li><li>LCNäº‹åŠ¡å¯¹äºä»£ç å‡ ä¹æ²¡æœ‰åµŒå…¥æ€§ï¼Œåªéœ€è¦æ·»åŠ æ³¨è§£å³å¯å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li><li>LCNçš„äº‹åŠ¡æäº¤ä¸å›æ»šéƒ½æœ‰æœ¬åœ°äº‹åŠ¡ä¿éšœï¼Œæ›´å®‰å…¨çš„ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>ä½†æ˜¯LCNä»…é™äºå­˜åœ¨æœ¬åœ°äº‹åŠ¡å¹¶ä¸”å¯ä»¥é€šè¿‡è¿æ¥å¯¹è±¡æ§åˆ¶äº‹åŠ¡æ¨¡å—çš„ç³»ç»Ÿã€‚</li><li>LCNæ¨¡å¼ä¾èµ–äºè¿æ¥ä»£ç†æœåŠ¡ï¼Œäº‹åŠ¡çš„å‘èµ·æ–¹ä¸å‚ä¸æ–¹è¦ä¸€èµ·è¿æ¥ä¸é‡Šæ”¾ï¼Œè¾ƒè€—æ€§èƒ½ã€‚</li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN1.png" alt="æƒ…å†µ1"></li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN2.png" alt="æƒ…å†µ1"></li><li><img src="/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/LCN3.png" alt="æƒ…å†µ1"><h6 id="TCCäº‹åŠ¡æ¨¡å¼"><a href="#TCCäº‹åŠ¡æ¨¡å¼" class="headerlink" title="TCCäº‹åŠ¡æ¨¡å¼"></a>TCCäº‹åŠ¡æ¨¡å¼</h6></li><li>TCCäº‹åŠ¡æ¨¡å¼ä¸ä¾èµ–äºèµ„æºç®¡ç†å™¨å¯¹äºXAçš„æ”¯æŒï¼Œè€Œæ˜¯é€šè¿‡ä¸šåŠ¡ç³»ç»Ÿæä¾›çš„ä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å³ç¼–å†™ä¸‰æ­¥æ“ä½œï¼šTryï¼šå°è¯•æ‰§è¡Œä¸šåŠ¡ï¼ˆå…ˆæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒçŠ¶æ€ä¸ºTryï¼‰ã€Confrimï¼šç¡®è®¤æ‰§è¡Œä¸šåŠ¡ï¼ˆæˆåŠŸåçŠ¶æ€æ”¹ä¸ºConfrimï¼‰ã€Cancelï¼šå–æ¶ˆæ‰§è¡Œä¸šåŠ¡ï¼ˆéœ€è¦å›æ»šçš„è¯æ ¹æ®å‰ä¸¤ä¸ªæ­¥éª¤çš„idç»§ç»­æ›´æ”¹çŠ¶æ€æˆ–è€…åˆ é™¤æ•°æ®ï¼‰ã€‚</li><li>TCCæ¨¡å¼å¯¹äºä»£ç çš„ä¾µå…¥æ€§å¾ˆé«˜ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªæ¥å£éœ€è¦æ‹†åˆ†æˆ3ä¸ªï¼Œå¯¹äºç¨‹åºå‘˜çš„ç¼–ç è¦æ±‚å¾ˆé«˜ï¼Œä¸šåŠ¡çš„æ­£ç¡®æ€§ã€æ•°æ®ä¸€è‡´æ€§éƒ½ç”±å¼€å‘è€…æ¥ä¿è¯</li><li>ä¼˜ç‚¹æ˜¯TCCæ¨¡å¼å¯¹äºæœ‰æ— æœ¬åœ°äº‹åŠ¡çš„åœºæ™¯éƒ½é€‚ç”¨ï¼Œç”šè‡³å¯ä»¥è·¨æ•°æ®æºï¼Œé’ˆå¯¹MySQLã€redisã€Mongoç­‰æ•´åˆæˆä¸€ä¸ªå¤§çš„äº‹åŠ¡<h6 id="TXCäº‹åŠ¡æ¨¡å¼"><a href="#TXCäº‹åŠ¡æ¨¡å¼" class="headerlink" title="TXCäº‹åŠ¡æ¨¡å¼"></a>TXCäº‹åŠ¡æ¨¡å¼</h6></li><li>å…¶æ¥æºäºé˜¿é‡Œå·´å·´çš„ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Œå¯ä»¥é€šè¿‡æå°‘é‡çš„ä»£ç ä¾µå…¥ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åŸç†æ˜¯åœ¨æ‰§è¡ŒSQLä¹‹å‰ï¼Œå…ˆæŸ¥è¯¢SQLçš„å½±å“æ•°æ®ï¼Œç„¶åä¿å­˜æ‰§è¡Œçš„SQLå¿«ç…§ä¿¡æ¯å¹¶åˆ›å»ºé”ã€‚å½“éœ€è¦å›æ»šçš„æ—¶å€™å°±é‡‡ç”¨è¿™äº›è®°å½•å›æ»šæ•°æ®åº“ã€‚ç›®å‰å®ç°é”ä½¿ç”¨çš„æ˜¯redisåˆ†å¸ƒå¼é”æ§åˆ¶ã€‚</li><li>TXCäº‹åŠ¡æ¨¡å¼åŒæ ·å¯¹ä»£ç çš„ä¾µå…¥æ€§ä½</li><li>è¯¥æ¨¡å¼ä»…é™äºå¯¹æ”¯æŒSQLæ–¹å¼çš„æ¨¡å—æ”¯æŒ</li><li>è¯¥æ¨¡å¼ç”±äºæ¯æ¬¡æ‰§è¡ŒSQLä¹‹å‰éœ€è¦å…ˆæŸ¥è¯¢å½±å“æ•°æ®ï¼Œå› æ­¤ç›¸æ¯”LCNæ¨¡å¼æ›´æ¶ˆè€—æ€§èƒ½</li><li>TXCäº‹åŠ¡æ¨¡å¼ä¸ä¼šå ç”¨æ•°æ®åº“èµ„æº</li><li>å…³äºTXCäº‹åŠ¡çš„è¯¦ç»†ä»‹ç»å¯ä»¥æŸ¥çœ‹<a href="https://blog.csdn.net/m0_38110132/article/details/77043580" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a></li></ul><h5 id="CAPç†è®ºå’ŒBASEç†è®º"><a href="#CAPç†è®ºå’ŒBASEç†è®º" class="headerlink" title="CAPç†è®ºå’ŒBASEç†è®º"></a>CAPç†è®ºå’ŒBASEç†è®º</h5><h6 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h6><p>CAPç†è®ºå³æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§çš„ç®€ç§°ã€‚</p><ul><li>Consistency æ•°æ®ä¸€è‡´æ€§ï¼šä¸€æ¬¡å®Œæ•´çš„æ›´æ–°æ“ä½œï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»è®¿é—®åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„</li><li>Availability æœåŠ¡å¯ç”¨æ€§ï¼šæœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œå¹¶ä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´</li><li>Partition tolerance åˆ†åŒºå®¹é”™æ€§ï¼šåˆ†å¸ƒå¼å¤šèŠ‚ç‚¹åœ¨æŸå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰åä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æ­£å¸¸çš„æœåŠ¡</li></ul><p>äº‹å®ä¸Šï¼ŒCAPè¿™ä¸‰ç§å¹¶æ— æ³•ä¿è¯å®Œå…¨æ»¡è¶³ï¼Œä¸€èˆ¬åªèƒ½æ»¡è¶³å…¶äºŒã€‚å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯æœ€åŸºæœ¬éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦åˆ™ä¸èƒ½ç§°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåªæ»¡è¶³CA å…¶å®æ˜¯ä¼ ç»Ÿçš„å•æœºæœåŠ¡ã€‚é‚£ä¹ˆåœ¨æ»¡è¶³Pï¼ˆåˆ†åŒºå®¹é”™ï¼‰çš„æ—¶å€™ï¼Œå°±éœ€è¦åœ¨Cå’ŒAä¹‹é—´æƒè¡¡ã€‚äº‹å®ä¸Šï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ä¸€èˆ¬ä¼šä¿è¯Aï¼ˆæœåŠ¡å¯ç”¨ï¼‰Pï¼Œæ”¾å¼ƒæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåªä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™æ ·å°±è¡ç”Ÿå‡ºäº†BASEç†è®ºã€‚</p><h6 id="BASEç†è®º"><a href="#BASEç†è®º" class="headerlink" title="BASEç†è®º"></a>BASEç†è®º</h6><p>BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚BASEç†è®ºæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„æ€»ç»“ï¼Œæ˜¯åŸºäºCAPå®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ã€‚BASEç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p><ul><li>åŸºæœ¬å¯ç”¨ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå…è®¸åœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æƒ…å†µä¸‹æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼ˆå¹¶ä¸æ˜¯å…è®¸ç³»ç»Ÿä¸å¯ç”¨ï¼‰ï¼Œå…è®¸å“åº”æ—¶é—´ä¸Šçš„ç¡®å®å’Œéƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½çš„é”™è¯¯ï¼ˆå¹¶å‘åœºæ™¯ä¸‹æ‹’ç»æœåŠ¡äº§ç”ŸæŠ¥é”™ç­‰ï¼‰</li><li>è½¯çŠ¶æ€ï¼šå³å…è®¸æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå…è®¸ä¸åŒèŠ‚ç‚¹çš„æ•°æ®ä¹‹é—´å­˜åœ¨æ—¶é—´ä¸Šçš„æ•°æ®å·®å¼‚</li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼ºè°ƒæ‰€æœ‰æ•°æ®å‰¯æœ¬èƒ½å¤Ÿæœ€ç»ˆä¸€è‡´ï¼Œä¸éœ€è¦ä¿è¯æ•°æ®å®æ—¶å¼ºä¸€è‡´ã€‚</li></ul><p>ä¼ ç»Ÿäº‹åŠ¡çš„ACIDæœºåˆ¶è¿½æ±‚å¼ºä¸€è‡´æ€§ï¼Œè€ŒBASEç†è®ºä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œç”Ÿï¼Œä¸»å¼ ç‰ºç‰²å¼ºä¸€è‡´æ€§ï¼Œä½¿å¾—æœåŠ¡è¾¾åˆ°é«˜å¯ç”¨ã€‚ä¸è¿‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸åŒåœºæ™¯ä¸‹å¯¹äºæ•°æ®çš„ä¸€è‡´æ€§åˆæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´ï¼Œå³ACIDä¸BASEç†è®ºç»“åˆä½¿ç”¨ã€‚</p><h5 id="2PCå’Œ3PC"><a href="#2PCå’Œ3PC" class="headerlink" title="2PCå’Œ3PC"></a>2PCå’Œ3PC</h5><h6 id="2PC-äºŒæ®µå¼æäº¤"><a href="#2PC-äºŒæ®µå¼æäº¤" class="headerlink" title="2PC - äºŒæ®µå¼æäº¤"></a>2PC - äºŒæ®µå¼æäº¤</h6><p>2PCï¼Œæ˜¯Two-Phase Commitçš„ç¼©å†™ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>é˜¶æ®µä¸€ï¼šæäº¤äº‹åŠ¡è¯·æ±‚</p><ul><li>åè°ƒè€…è¯¢é—®å‚ä¸æ–¹æ˜¯å¦å¯ä»¥æ‰§è¡Œæäº¤æ“ä½œå¹¶ç­‰å¾…å“åº”</li><li>å‚ä¸è€…æ‰§è¡Œè¯¢é—®ä¸ºæ­¢çš„æ‰€æœ‰äº‹åŠ¡æ“ä½œ</li><li>å‚ä¸è€…å“åº”åè°ƒè€…ï¼Œè¿”å›äº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦</li></ul></li><li><p>é˜¶æ®µäºŒï¼šæ‰§è¡Œäº‹åŠ¡æäº¤</p><ul><li><p>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰ç¬¬ä¸€é˜¶æ®µå“åº”ä¹‹åå‘èµ·æ­£å¼æäº¤è¯·æ±‚</p></li><li><p>å‚ä¸è€…æ­£å¼å®Œæˆæ“ä½œå¹¶é‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æœŸé—´å ç”¨çš„èµ„æº</p></li><li><p>åé¦ˆäº‹åŠ¡æäº¤ç»“æœ</p></li><li><p>åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å®Œæˆçš„æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚</p></li><li><p>å¦‚æœä»»æ„å‚ä¸è€…åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›æ‰§è¡Œå¤±è´¥æˆ–è€…è¶…æ—¶çš„æ¶ˆæ¯ï¼Œä¸­æ–­äº‹åŠ¡</p></li><li><p>å‚ä¸è€…èŠ‚ç‚¹åˆ©ç”¨ä¹‹å‰å†™å…¥çš„Undoä¿¡æ¯æ‰§è¡Œå›æ»šï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚</p></li><li><p>å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹å‘é€â€å›æ»šå®Œæˆâ€æ¶ˆæ¯ã€‚</p></li><li><p>åè°ƒè€…èŠ‚ç‚¹å—åˆ°æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹åé¦ˆçš„â€å›æ»šå®Œæˆâ€æ¶ˆæ¯åï¼Œå–æ¶ˆäº‹åŠ¡ã€‚</p></li><li><p>ä¸ç®¡æœ€åç»“æœå¦‚ä½•ï¼Œç¬¬äºŒé˜¶æ®µéƒ½ä¼šç»“æŸå½“å‰äº‹åŠ¡</p></li></ul></li></ul><p>  <strong>2PCçš„ç¼ºç‚¹ï¼š</strong> æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼›å¦‚æœåè°ƒè€…æ˜¯å•ç‚¹å¹¶ä¸”å‘ç”Ÿæ•…éšœï¼Œå‚ä¸è€…å°†ä¸€ç›´é˜»å¡ï¼›å¦‚æœåœ¨ç¬¬äºŒé˜¶æ®µåè°ƒè€…æ­£å¼å‘æ‰€æœ‰å‚ä¸è€…å‘é€æ­£å¼æäº¤äº‹åŠ¡çš„è¯·æ±‚ï¼Œå…¶ä¸­éƒ¨åˆ†å› ä¸ºç½‘ç»œé—®é¢˜æ²¡æœ‰æ”¶åˆ°ï¼Œå¦ä¸€éƒ¨åˆ†å´å·²ç»æäº¤æ— æ³•å›æ»šï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼›åè°ƒè€…å†å‘å‡ºcommitæ¶ˆæ¯ä¹‹åå®•æœºï¼Œè€Œå”¯ä¸€æ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸è€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚</p><p>  ç”±äºäºŒé˜¶æ®µæäº¤å­˜åœ¨ç€è¯¸å¦‚åŒæ­¥é˜»å¡ã€å•ç‚¹é—®é¢˜ã€è„‘è£‚ç­‰ç¼ºé™·ï¼Œæ‰€ä»¥ï¼Œç ”ç©¶è€…ä»¬åœ¨äºŒé˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œæå‡ºäº†ä¸‰é˜¶æ®µæäº¤ã€‚</p><h6 id="3PC-ä¸‰æ®µå¼æäº¤"><a href="#3PC-ä¸‰æ®µå¼æäº¤" class="headerlink" title="3PC - ä¸‰æ®µå¼æäº¤"></a>3PC - ä¸‰æ®µå¼æäº¤</h6><p>3PCå°†2PCçš„å‡†å¤‡é˜¶æ®µåˆåˆ’åˆ†ä¸ºä¸¤æ¬¡å‡†å¤‡ï¼Œè¿™æ ·ä¸‰é˜¶æ®µæäº¤å°±æœ‰CanCommitã€PreCommitã€DoCommitä¸‰ä¸ªé˜¶æ®µã€‚ã€‚å¹¶ä¸”åœ¨åè°ƒè€…ä¸å‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚</p><ul><li><p>CanCommité˜¶æ®µ</p><ul><li>åŒ2PCçš„å‡†å¤‡é˜¶æ®µï¼Œåè°ƒè€…å‘å‚ä¸è€…å‘é€äº‹åŠ¡æäº¤è¯·æ±‚ï¼Œè¯¢é—®å¹¶ç­‰å¾…å“åº”</li><li>å¾—åˆ°å“åº”ä¹‹åè¿›å…¥é¢„å¤‡æäº¤é˜¶æ®µ</li></ul></li><li><p>PreCommité˜¶æ®µ</p><ul><li>æ‰€æœ‰å‚ä¸è€…ç¬¬ä¸€é˜¶æ®µéƒ½è¿”å›æˆåŠŸçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹äº‹åŠ¡çš„é¢„æ‰§è¡Œ</li><li>è¿›å…¥PreCommitå¹¶æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå…¨éƒ¨æˆåŠŸå°±è¿”å›ç»™æäº¤è€…</li><li>å‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚;ä¸­æ–­äº‹åŠ¡å‚ä¸è€…æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ä¹‹åï¼ˆæˆ–è¶…æ—¶ä¹‹åï¼Œä»æœªæ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼‰ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</li></ul></li><li><p>doCommité˜¶æ®µ</p><ul><li><p>å‘é€æäº¤è¯·æ±‚åè°ƒæ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»é¢„æäº¤çŠ¶æ€è¿›å…¥åˆ°æäº¤çŠ¶æ€ã€‚å¹¶å‘æ‰€æœ‰å‚ä¸è€…å‘é€doCommitè¯·æ±‚ã€‚</p></li><li><p>äº‹åŠ¡æäº¤å‚ä¸è€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œæ‰§è¡Œæ­£å¼çš„äº‹åŠ¡æäº¤ã€‚å¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºã€‚</p></li><li><p>å“åº”åé¦ˆäº‹åŠ¡æäº¤å®Œä¹‹åï¼Œå‘åè°ƒè€…å‘é€Ackå“åº”ã€‚</p></li><li><p>å®Œæˆäº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ackå“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ã€‚</p></li></ul></li></ul><p>  ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ²¡æœ‰æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼ˆå¯èƒ½æ˜¯æ¥å—è€…å‘é€çš„ä¸æ˜¯ACKå“åº”ï¼Œä¹Ÿå¯èƒ½å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ã€‚</p><ul><li><p>å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚</p></li><li><p>äº‹åŠ¡å›æ»šå‚ä¸è€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºã€‚</p></li><li><p>åé¦ˆç»“æœå‚ä¸è€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKæ¶ˆæ¯</p></li><li><p>ä¸­æ–­äº‹åŠ¡åè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ACKæ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</p></li></ul><p>  ç›¸æ¯”äº2PCï¼Œ3PCæœ€å…³é”®è¦è§£å†³çš„å°±æ˜¯åè°ƒè€…å’Œå‚ä¸è€…åŒæ—¶æŒ‚æ‰çš„é—®é¢˜ï¼Œæ‰€ä»¥3PCæŠŠ2PCçš„å‡†å¤‡é˜¶æ®µå†æ¬¡ä¸€åˆ†ä¸ºäºŒã€‚åœ¨ç¬¬ä¸€é˜¶æ®µåªæ˜¯è¯¢é—®æ‰€æœ‰å‚ä¸è€…æ˜¯å¦éƒ½å¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶ä¸åœ¨æœ¬é˜¶æ®µæ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚å½“åè°ƒè€…æ”¶åˆ°æ‰€æœ‰çš„å‚ä¸è€…éƒ½è¿”å›YESæ—¶ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæ‰æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œç„¶ååœ¨ç¬¬ä¸‰é˜¶æ®µåœ¨æ‰§è¡Œcommitæˆ–è€…rollbackã€‚</p><p>  <strong>3PCå­˜åœ¨çš„é—®é¢˜ï¼š</strong> åœ¨doCommité˜¶æ®µï¼Œå¦‚æœå‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…abortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚è¿™æ ·ä¸å…¶ä»–æ‰§è¡Œå›æ»šçš„å‚ä¸è€…å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><hr><blockquote><p>å‚è€ƒï¼š</p><ul><li><p><a href="https://www.hollischuang.com/archives/1580" target="_blank" rel="noopener">https://www.hollischuang.com/archives/1580</a></p></li><li><p><a href="http://anruence.com/2018/03/05/tcc-2pc-3pc/" target="_blank" rel="noopener">http://anruence.com/2018/03/05/tcc-2pc-3pc/</a></p></li><li><p><a href="http://blog.jobbole.com/95632/" target="_blank" rel="noopener">http://blog.jobbole.com/95632/</a></p></li><li><a href="http://blog.csdn.net/zhangjq520/article/details/78433686" target="_blank" rel="noopener">http://blog.csdn.net/zhangjq520/article/details/78433686</a></li><li><a href="https://www.zhihu.com/question/48627764/answer/111983553" target="_blank" rel="noopener">https://www.zhihu.com/question/48627764/answer/111983553</a></li><li><a href="https://www.jianshu.com/p/d3eda795188a" target="_blank" rel="noopener">https://www.jianshu.com/p/d3eda795188a</a></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20191020/æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼šLCN/tx.png&quot; alt=&quot;å®˜ç½‘é¦–é¡µ&quot;&gt;&lt;/p&gt;
&lt;center&gt;&lt;a href=&quot;#more2&quot;&gt;å…¶ä»–å…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ€»ç»“æ•´ç†&lt;/a&gt;&lt;/center&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="http://zhangjiaheng.cn/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
      <category term="æ•°æ®åº“" scheme="http://zhangjiaheng.cn/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="http://zhangjiaheng.cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸ƒ)ï¼šFork/Joinæ¡†æ¶åŸç†åŠdemo</title>
    <link href="http://zhangjiaheng.cn/blog/20190814/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E4%B8%83-%EF%BC%9AFork-Join%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E5%8F%8Ademo/"/>
    <id>http://zhangjiaheng.cn/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/</id>
    <published>2019-08-14T08:48:56.000Z</published>
    <updated>2019-11-01T01:40:48.237Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fm.jpg" alt="fm.jpg"></p><a id="more"></a><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>Fork/Joinæ¡†æ¶æ˜¯jdk1.7å¼•å…¥çš„ä¸€ä¸ªåŸºäºâ€œåˆ†æ²»â€æ€æƒ³çš„å¤šçº¿ç¨‹æ¡†æ¶ã€‚å®ƒçš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ‡åˆ†(<strong>fork</strong>)æˆå¤šä¸ªç›¸åŒé€»è¾‘çš„å°ä»»åŠ¡ï¼Œåˆ†è€Œæ²»ä¹‹ï¼Œå½“å­ä»»åŠ¡å…¨éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°†ç»“æœåˆå¹¶(<strong>join</strong>)èµ·æ¥ï¼Œæœ€ç»ˆæˆä¸ºæ•´ä½“ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚åŸç†å¯ä»¥æŠ½è±¡æˆä¸‹å›¾è¡¨ç¤ºï¼š</p><p><img src="/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fj.png" alt="Fork/Join"></p><h3 id="Fork-Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³"><a href="#Fork-Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³" class="headerlink" title="Fork/Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³"></a>Fork/Joinç›¸å…³ä»£ç åŸç†åŠæ€æƒ³</h3><h6 id="Fork-Joinæ‰§è¡Œæ­¥éª¤"><a href="#Fork-Joinæ‰§è¡Œæ­¥éª¤" class="headerlink" title="Fork/Joinæ‰§è¡Œæ­¥éª¤"></a>Fork/Joinæ‰§è¡Œæ­¥éª¤</h6><ol><li><p>è¿›è¡Œä»»åŠ¡åˆ†å‰²ï¼šå°†ä»»åŠ¡åˆ†å‰²æˆå°ä»»åŠ¡ï¼Œç„¶åè¿™ä¸ªå°ä»»åŠ¡æœ‰å¯èƒ½è¿˜éœ€è¦ç»§ç»­åˆ†å‰²ï¼Œç›´åˆ°è¶³å¤Ÿå°ã€‚</p></li><li><p>æ‰§è¡Œå¹¶åˆå¹¶ç»“æœï¼šåˆ†å‰²çš„å­ä»»åŠ¡åˆ†åˆ«æ”¾åœ¨åŒç«¯é˜Ÿåˆ—é‡Œï¼Œç„¶åå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»åŒç«¯é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ‰§è¡Œã€‚å­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœéƒ½ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä»é˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ï¼Œç„¶ååˆå¹¶è¿™äº›æ•°æ®ã€‚</p></li></ol><p>Fork/Joinä½¿ç”¨ä¸¤ä¸ªç±»å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼š</p><ul><li><strong>ForkJoinTask</strong>ï¼š<ul><li>Fork/Joinæä¾›äº†ä¸¤ä¸ªå­ç±»ï¼šRecursiveActionï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ï¼›RecursiveTask ï¼šç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡</li></ul></li><li><strong>ForkJoinPool</strong> ï¼š<code>public class ForkJoinPool extends AbstractExecutorService{ ... }</code>ForkJoinTaskéœ€è¦é€šè¿‡ForkJoinPoolæ¥æ‰§è¡Œï¼Œä»»åŠ¡åˆ†å‰²å‡ºçš„å­ä»»åŠ¡ä¼šæ·»åŠ åˆ°å½“å‰å·¥ä½œçº¿ç¨‹æ‰€ç»´æŠ¤çš„åŒç«¯é˜Ÿåˆ—ä¸­ï¼Œè¿›å…¥é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚å½“ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—é‡Œæš‚æ—¶æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šéšæœºä»å…¶ä»–å·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—çš„å°¾éƒ¨è·å–ä¸€ä¸ªä»»åŠ¡ã€‚è¿™ç§ç®—æ³•æˆä¸º<strong>å·¥ä½œçªƒå–ç®—æ³•(work-stealing)</strong></li></ul><h6 id="å·¥ä½œçªƒå–ç®—æ³•-work-stealing"><a href="#å·¥ä½œçªƒå–ç®—æ³•-work-stealing" class="headerlink" title="å·¥ä½œçªƒå–ç®—æ³•(work-stealing)"></a>å·¥ä½œçªƒå–ç®—æ³•(work-stealing)</h6><ul><li><p>Fork/Joinæ¡†æ¶å†…éƒ¨å®ç°äº†ä¸€ä¸ªç±»ä¼¼äºLinkedBlockingDequeçš„åŒç«¯é˜Ÿåˆ—ç”¨ä½œå·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—<strong>WorkQueue</strong>ã€‚ä½¿ç”¨<code>ForkJoinWorkerThread</code>ä¿å­˜å·¥ä½œçº¿ç¨‹ï¼Œ<code>ForkJoinPool.WorkQueue</code>å°±åœ¨å…¶å†…éƒ¨ã€‚</p></li><li><p>Fork/Joinæ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨è¿è¡Œä¸­äº§ç”Ÿäº†æ–°çš„ä»»åŠ¡(é€šå¸¸æ˜¯è°ƒç”¨forkæ–¹æ³•)çš„æ—¶å€™ï¼Œå°†ä»»åŠ¡åŠ å…¥WorkQueueå°¾éƒ¨ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹æ¯æ¬¡å–å‡ºä»»åŠ¡æ‰§è¡Œä¹Ÿæ˜¯ä»é˜Ÿå°¾å–å‡ºæ‰§è¡Œï¼Œå³LIFO</p></li><li><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨å¤„ç†è‡ªå·±çš„å·¥ä½œé˜Ÿåˆ—åŒæ—¶ï¼Œä¼šå°è¯•çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼ˆæˆ–æ˜¯æ¥è‡ªäºåˆšåˆšæäº¤åˆ° pool çš„ä»»åŠ¡ï¼Œæˆ–æ˜¯æ¥è‡ªäºå…¶ä»–å·¥ä½œçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—ï¼‰ï¼Œçªƒå–çš„ä»»åŠ¡ä½äºå…¶ä»–çº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œä¹Ÿå°±æ˜¯è¯´å·¥ä½œçº¿ç¨‹åœ¨çªƒå–å…¶ä»–å·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ FIFO æ–¹å¼ã€‚</p></li><li><p>åœ¨é‡åˆ° join() æ—¶ï¼Œå¦‚æœéœ€è¦ join çš„ä»»åŠ¡å°šæœªå®Œæˆï¼Œåˆ™ä¼šå…ˆå¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚</p></li><li><p>åœ¨æ—¢æ²¡æœ‰è‡ªå·±çš„ä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥çªƒå–çš„ä»»åŠ¡æ—¶ï¼Œè¿›å…¥ä¼‘çœ ã€‚</p></li></ul><h3 id="Fork-Join-demoæ¼”ç¤º"><a href="#Fork-Join-demoæ¼”ç¤º" class="headerlink" title="Fork/Join demoæ¼”ç¤º"></a>Fork/Join demoæ¼”ç¤º</h3><blockquote><p>ä½¿ç”¨Fork/Joinå®Œæˆå¤§é‡æœ‰åºæ•°å­—çš„åŠ å’Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCalculateTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THREADSHOLD = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> start;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">  <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyCalculateTask</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end, List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.start = start;</span><br><span class="line">    <span class="keyword">this</span>.end = end;</span><br><span class="line">    <span class="keyword">this</span>.list = list;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (end - start &lt; THREADSHOLD) &#123;</span><br><span class="line">      <span class="comment">// å½“ä¸¤æ•°å­—ä¹‹é—´å·®å€¼å°äºæŒ‡å®šå€¼ å°±ä¸å†æŸ¥åˆ†æˆå°ä»»åŠ¡ </span></span><br><span class="line">      String so = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">        so += list.get(i) + <span class="string">","</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(Thread.currentThread().getName() + <span class="string">"å¤„ç† "</span> + so + <span class="string">" çš„æ•°æ®"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">int</span> mid = (start + end) / <span class="number">2</span>;</span><br><span class="line">      <span class="comment">// ä¸€åˆ†ä¸ºäºŒ æ‹†åˆ†ä»»åŠ¡</span></span><br><span class="line">      <span class="keyword">final</span> MyCalculateTask left = <span class="keyword">new</span> MyCalculateTask(start, mid, list);</span><br><span class="line">      <span class="keyword">final</span> MyCalculateTask right = <span class="keyword">new</span> MyCalculateTask(mid, end, list);</span><br><span class="line">      left.fork();</span><br><span class="line">      right.fork();</span><br><span class="line">      sum += left.join();</span><br><span class="line">      sum += right.join();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">400</span>;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      list.add(<span class="string">"i-"</span> + i);</span><br><span class="line">      sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    MyCalculateTask task = <span class="keyword">new</span> MyCalculateTask(<span class="number">0</span>, count, list);</span><br><span class="line">    <span class="keyword">final</span> ForkJoinTask&lt;Integer&gt; submit = pool.submit(task);</span><br><span class="line">    System.out.println(<span class="string">"sum = "</span> + sum + <span class="string">" --- submit.get() = "</span> + submit.get());</span><br><span class="line">    pool.awaitTermination(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">    pool.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Fork/Joinæ¡†æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå¾ˆå¤šè¿™ç§å¤§ä»»åŠ¡å¯ä»¥æ‹†åˆ†æˆå°ä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯ï¼Œä¸è¿‡ä¸Šé¢çš„æ–¹æ³•å¹¶ä¸æ˜¯æœ€ä½³æ‰§è¡Œè°ƒç”¨æ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">left.fork();  </span><br><span class="line">right.fork();</span><br><span class="line">æ›¿æ¢ä¸º</span><br><span class="line">invokeAll(left, right);</span><br></pre></td></tr></table></figure><p>å› ä¸ºå¯¹äºFork/Joinæ¨¡å¼ï¼Œå‡å¦‚Poolé‡Œé¢çº¿ç¨‹æ•°é‡æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆè°ƒç”¨å­ä»»åŠ¡çš„forkæ–¹æ³•ç›¸å½“äºAå…ˆåˆ†å·¥ç»™Bï¼Œç„¶åAå½“ç›‘å·¥ä¸å¹²æ´»ï¼ŒBå»å®ŒæˆAäº¤ä»£çš„ä»»åŠ¡ã€‚æ‰€ä»¥ä¸Šé¢çš„æ¨¡å¼ç›¸å½“äºæµªè´¹äº†ä¸€ä¸ªçº¿ç¨‹ã€‚é‚£ä¹ˆå¦‚æœä½¿ç”¨invokeAllç›¸å½“äºAåˆ†å·¥ç»™Båï¼ŒAå’ŒBéƒ½å»å®Œæˆå·¥ä½œã€‚è¿™æ ·å¯ä»¥æ›´å¥½çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œç¼©çŸ­æ‰§è¡Œçš„æ—¶é—´ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="http://ifeve.com/talk-concurrency-forkjoin/" target="_blank" rel="noopener">http://ifeve.com/talk-concurrency-forkjoin/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190814/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸ƒ-ï¼šFork-Joinæ¡†æ¶åŸç†åŠdemo/fm.jpg&quot; alt=&quot;fm.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="çº¿ç¨‹æ± " scheme="http://zhangjiaheng.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    
      <category term="Fork/Joinæ¡†æ¶" scheme="http://zhangjiaheng.cn/tags/Fork-Join%E6%A1%86%E6%9E%B6/"/>
    
      <category term="ForkJoinPool" scheme="http://zhangjiaheng.cn/tags/ForkJoinPool/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†</title>
    <link href="http://zhangjiaheng.cn/blog/20190812/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9F%BA%E6%9C%AC%E6%80%9D%E6%83%B3%E4%BB%A5%E5%8F%8A23%E7%A7%8D%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E6%95%B4%E7%90%86/"/>
    <id>http://zhangjiaheng.cn/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/</id>
    <published>2019-08-12T03:47:54.000Z</published>
    <updated>2019-11-01T01:40:48.200Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/bz.png" alt="å°é¢"></p><a id="more"></a><h3 id="è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³"><a href="#è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³"></a>è®¾è®¡æ¨¡å¼ä¸»è¦æ€æƒ³</h3><p>è®¾è®¡æ¨¡å¼æ˜¯åœ¨é•¿æœŸåº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼—å¤šå¼€å‘è€…æ€»ç»“å½’çº³å‡ºæ¥çš„ç¨‹åºæ¶æ„ä¸è®¾è®¡æ€æƒ³ã€‚æ˜¯ç»è¿‡å®è·µè¯æ˜çš„ï¼Œå¯åœ¨å®é™…èƒŒæ™¯ä¸‹ä½¿ç”¨çš„ä¸€ç³»åˆ—ç¨‹åºè®¾è®¡æ–¹æ¡ˆã€‚è®¾è®¡æ¨¡å¼äº§ç”Ÿçš„æ ¹æœ¬ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³å¼€å‘è¿‡ç¨‹ä¸­é‡å¤çš„ä»£ç ç¼–å†™ï¼Œä»¥åŠè®©ç¨‹åºæ›´æ˜“æ‰©å±•å¤ç”¨ã€‚</p><h4 id="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„åŸåˆ™</h4><ul><li>å•ä¸€èŒè´£ï¼šæ¯ä¸ªç±»éƒ½åº”è¯¥å®ç°å•ä¸€çš„åŠŸèƒ½ï¼Œå¦åˆ™åº”è¯¥å°†ç±»è¿›è¡Œæ‹†åˆ†</li><li>é‡Œæ°æ›¿æ¢ï¼šå³ç»§æ‰¿å¤ç”¨/åˆæˆå¤ç”¨ã€‚å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼è€Œä¸æ˜¯ç»§æ‰¿ã€‚ä»»ä½•çˆ¶ç±»å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»éƒ½å¯ä»¥å‡ºç°ã€‚æ´¾ç”Ÿç±»å¯ä»¥åœ¨åŸºç±»çš„åŸºç¡€ä¸Šæ‰©å±•è‡ªå·±çš„åŠŸèƒ½å®ç°ã€‚æ˜¯å¯¹â€œå¼€é—­åŸåˆ™â€çš„ä¸€ä¸ªè¡¥å……ã€‚åœ¨é‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ï¼Œå°½é‡ä¸è¦å¯¹çˆ¶ç±»è¿›è¡Œé‡è½½æˆ–è€…é‡å†™ï¼Œå› ä¸ºçˆ¶ç±»ä»£è¡¨ä¸€ä¸ªå®šä¹‰å¥½çš„ç»“æ„ï¼Œé€šè¿‡è§„èŒƒå¥½çš„æ¥å£ä¸å¤–ç•Œè¿›è¡Œäº¤äº’ï¼Œå­ç±»ä¸åº”è¯¥éšæ„ç ´åå®ƒï¼Œè€Œæ˜¯å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚</li><li>ä¾èµ–å€’ç½®ï¼šâ€œå¼€é—­åŸåˆ™â€çš„åŸºç¡€ã€‚å³é¢å‘æ¥å£ç¼–ç¨‹ã€‚ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¾èµ–äºå…·ä½“çš„å®ç°ï¼Œç¼–ç¨‹æ—¶é‡åˆ°å…·ä½“çš„ç±»æ—¶ï¼Œä¸ä¸å…·ä½“çš„ç±»äº¤äº’ï¼Œè€Œä¸æŠ½è±¡æ¥å£è¿›è¡Œäº¤äº’ã€‚ä¾¿äºå¢åŠ æ–°çš„å…·ä½“ç±»çš„æ—¶å€™ä»£ç å¯ä»¥å¤ç”¨ã€‚</li><li>æ¥å£éš”ç¦»ï¼šæ¯ä¸ªæ¥å£ä¸åº”è¯¥å­˜åœ¨å­ç±»ç”¨ä¸åˆ°å´å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œå¦åˆ™å°±åº”è¯¥å°†æ¥å£æ‹†åˆ†ï¼Œå°†èŒè´£å•ä¸€åŒ–ã€‚</li><li>æœ€å°‘çŸ¥é“ï¼šå³è¿ªç±³ç‰¹æ³•åˆ™ã€‚ä¸€ä¸ªç±»å¯¹äºè‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ï¼Œæ— è®ºè¢«ä¾èµ–çš„ç±»å¤šä¹ˆå¤æ‚ï¼Œéƒ½åº”è¯¥å°†é€»è¾‘å°è£…åœ¨æ–¹æ³•å†…éƒ¨ï¼Œé€šè¿‡ä¸€ä¸ªå…±æœ‰çš„æ–¹æ³•æä¾›ç»™ä¾èµ–ç±»ä½¿ç”¨ï¼Œè¿™æ ·å½“è¢«ä¾èµ–ç±»å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šå°½å¯èƒ½å°‘çš„å½±å“ä¾èµ–ç±»ã€‚</li></ul><h3 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"></a>è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h3><blockquote><p>ç‚¹å‡»å¯¹åº”é“¾æ¥è·³è½¬åˆ°è¯¥è®¾è®¡æ¨¡å¼çš„è¯¦ç»†æ•´ç†ä¸ä»£ç ç¤ºä¾‹</p></blockquote><table><thead><tr><th>èŒƒå›´</th><th>åˆ›å»ºå‹æ¨¡å¼</th><th>ç»“æ„å‹æ¨¡å¼</th><th>è¡Œä¸ºå‹æ¨¡å¼</th></tr></thead><tbody><tr><td>å¯¹è±¡åˆ›å»º</td><td><a href="http://zhangjiaheng.cn/blog/20190607/%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%95%E4%BE%8B/">Singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</a><br>Prototype(åŸå‹æ¨¡å¼)<br>Factory Methodï¼ˆå·¥å‚æ–¹æ³•æ¨¡å¼ï¼‰<br>Abstract Factoryï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰<br>Builderï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰</td><td></td><td></td></tr><tr><td>æ¥å£é€‚é…</td><td></td><td>Adapterï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰<br>Bridgeï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰<br>Facadeï¼ˆå¤–è§‚æ¨¡å¼ï¼‰</td><td></td></tr><tr><td>å¯¹è±¡è§£è€¦</td><td></td><td></td><td>Mediatorï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰<br>Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰</td></tr><tr><td>æŠ½è±¡é›†åˆ</td><td></td><td>Compositeï¼ˆç»„åˆæ¨¡å¼ï¼‰</td><td>Iteratorï¼ˆè¿­ä»£å™¨æ¨¡å¼ï¼‰</td></tr><tr><td>è¡Œä¸ºæ‰©å±•</td><td></td><td>Decoratorï¼ˆè£…é¥°æ¨¡å¼ï¼‰</td><td>Visitorï¼ˆè®¿é—®è€…æ¨¡å¼ï¼‰<br>Chain of Responsibilityï¼ˆèŒè´£é“¾ï¼‰</td></tr><tr><td>ç®—æ³•å°è£…</td><td></td><td></td><td><a href="http://zhangjiaheng.cn/blog/20190707/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/">Templateï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰</a><br>Strategyï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</td></tr><tr><td>æ€§èƒ½ä¸å¯¹è±¡è®¿é—®</td><td></td><td>Flyweightï¼ˆäº«å…ƒæ¨¡å¼ï¼‰<br>Proxyï¼ˆä»£ç†æ¨¡å¼ï¼‰</td><td></td></tr><tr><td>å¯¹è±¡çŠ¶æ€</td><td></td><td></td><td>Mementoï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰<br>Stateï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰</td></tr><tr><td>å…¶ä»–</td><td></td><td></td><td>Interpreterï¼ˆè§£é‡Šå™¨æ¨¡å¼ï¼‰</td></tr></tbody></table><h4 id="æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»"><a href="#æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»" class="headerlink" title="æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»"></a>æ€»ç»“ä¸‹è®¾è®¡æ¨¡å¼çš„å½’ç±»</h4><p><img src="/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/sjmo.png" alt="è®¾è®¡æ¨¡å¼åˆ†ç±» - å¹•å¸ƒ"></p><h4 id="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"><a href="#åˆ›å»ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼"></a>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</h4><p>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œä½¿è°ƒç”¨è€…æ— éœ€newå¯¹è±¡ï¼Œåœ¨ç¨‹åºä¸­é’ˆå¯¹ç»™å®šä¸šåŠ¡åœºæ™¯å»è°ƒç”¨ç‰¹å®šçš„å¯¹è±¡åˆ›å»ºæ–¹æ³•ï¼Œä½¿ç¨‹åºæ›´åŠ çµæ´»ã€‚</p><h4 id="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"><a href="#è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼" class="headerlink" title="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"></a>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</h4><p>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚</p><h4 id="ç»“æ„å‹è®¾è®¡æ¨¡å¼"><a href="#ç»“æ„å‹è®¾è®¡æ¨¡å¼" class="headerlink" title="ç»“æ„å‹è®¾è®¡æ¨¡å¼"></a>ç»“æ„å‹è®¾è®¡æ¨¡å¼</h4><p>ç»“æ„å‹è®¾è®¡æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œç»§æ‰¿çš„æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡è·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190812/ã€è®¾è®¡æ¨¡å¼ã€‘è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³ä»¥åŠ23ç§æ¨¡å¼æ€»ç»“æ•´ç†/bz.png&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è®¾è®¡æ¨¡å¼åŸºæœ¬æ€æƒ³" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9F%BA%E6%9C%AC%E6%80%9D%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode - 52. Nçš‡å II å›æº¯ç®—æ³•æ±‚è§£</title>
    <link href="http://zhangjiaheng.cn/blog/20190809/Leetcode-52-N%E7%9A%87%E5%90%8E-II-%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E6%B1%82%E8%A7%A3/"/>
    <id>http://zhangjiaheng.cn/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/</id>
    <published>2019-08-09T10:19:50.000Z</published>
    <updated>2019-11-01T01:40:48.191Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Nçš‡åé—®é¢˜-leetcode"><a href="#Nçš‡åé—®é¢˜-leetcode" class="headerlink" title="Nçš‡åé—®é¢˜ - leetcode"></a>Nçš‡åé—®é¢˜ - <a href="https://leetcode-cn.com/problems/n-queens-ii/" target="_blank" rel="noopener">leetcode</a></h4><p>n çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚<img src="/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/8-queens.png" alt="8çš‡åç¤ºä¾‹"><br>ä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å› n çš‡åä¸åŒçš„è§£å†³æ–¹æ¡ˆçš„æ•°é‡ã€‚</p><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><blockquote><p>è¾“å…¥: 4<br>è¾“å‡º: 2<br>è§£é‡Š: 4 çš‡åé—®é¢˜å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªä¸åŒçš„è§£æ³•ã€‚<br><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">[".Q..", Â // è§£æ³• 1</span><br><span class="line">"...Q",</span><br><span class="line">"Q...",</span><br><span class="line">"..Q."],</span><br><span class="line">["..Q.", Â // è§£æ³• 2</span><br><span class="line">"Q...",</span><br><span class="line">"...Q",</span><br><span class="line">".Q.."]</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p></blockquote><a id="more"></a><h4 id="è§£é¢˜æ€è·¯ï¼š"><a href="#è§£é¢˜æ€è·¯ï¼š" class="headerlink" title="è§£é¢˜æ€è·¯ï¼š"></a>è§£é¢˜æ€è·¯ï¼š</h4><p>ä½¿ç”¨å›æº¯ç®—æ³•ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œè¿›è¡Œéå†æŸ¥è¯¢æ·±åº¦ä¼˜å…ˆæœç´¢çš„æ¡ä»¶æ˜¯æœ‰èƒ½å¤Ÿåˆ¤æ–­æ£‹ç›˜æ˜¯å¦èƒ½è½å­çš„ä¾æ®ã€‚</p><p>æˆ‘è¿™è¾¹ä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°ç»„å­˜å‚¨ç¬¬Jåˆ—æ˜¯å¦æœ‰æ£‹å­ï¼Œä½¿ç”¨ä¸¤ä¸ªN*2-1é•¿åº¦çš„æ•°ç»„åˆ†åˆ«å­˜å‚¨å·¦å¯¹è§’çº¿å’Œå³å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­ã€‚</p><p>å¯¹äºå·¦å³å¯¹è§’çº¿æ¥è¯´ï¼Œå·¦å¯¹è§’çº¿çš„æ¯ä¸€ä¸ªä½ç½®iä¸jçš„å’Œéƒ½ç›¸åŒï¼Œå³å¯¹è§’çº¿çš„æ¯ä¸€ä¸ªä½ç½®çš„iä¸jçš„å·®éƒ½ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªä½ç½®çš„æ–œçº¿ä¸Šæ˜¯å¦å­˜åœ¨æ£‹å­ï¼Œå¯¹åº”å¯¹è§’çº¿çš„æ•°ç»„æ ‡å¿—ä¸ºæœ‰æˆ–è€…æ²¡æœ‰ã€‚</p><h4 id="ä»£ç å¦‚ä¸‹"><a href="#ä»£ç å¦‚ä¸‹" class="headerlink" title="ä»£ç å¦‚ä¸‹"></a>ä»£ç å¦‚ä¸‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** æ€»è®°å½•æ•° */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/** Nçš‡å */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> N;</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„å·¦å¯¹è§’çº¿æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] left = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">15</span>];</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„å³å¯¹è§’çº¿æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] right = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">15</span>];</span><br><span class="line">  <span class="comment">/** åˆ¤æ–­å½“å‰ä½ç½®çš„åˆ—æ˜¯å¦å­˜æ”¾äº†æ£‹å­ */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>[] curn;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">totalNQueens</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.N = n;</span><br><span class="line">    curn = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">    left = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span> * n - <span class="number">1</span>];</span><br><span class="line">    right = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span> * n - <span class="number">1</span>];</span><br><span class="line">    calResult(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calResult</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ£‹ç›˜ç¬¬iè¡Œ éå†åˆ¤æ–­ç¬¬jåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">      <span class="comment">// å¼€å§‹åˆ¤æ–­ç¬¬iè¡Œç¬¬jåˆ—</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­ç¬¬jåˆ—æ˜¯å¦å·²ç»æœ‰æ£‹å­ï¼›åˆ¤æ–­(i,j)çš„å·¦å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­ï¼›åˆ¤æ–­å³å¯¹è§’çº¿æ˜¯å¦æœ‰æ£‹å­</span></span><br><span class="line">      <span class="keyword">if</span> (curn[j] == <span class="number">0</span> &amp;&amp; left[i + j] == <span class="number">0</span> &amp;&amp; right[N - <span class="number">1</span> + i - j] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰æ£‹å­ å°±å¯ä»¥åœ¨(i,j)æ”¾ç½®æ£‹å­</span></span><br><span class="line">        curn[j] = left[i + j] = right[N - <span class="number">1</span> + i - j] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœNè¡Œéƒ½æ”¾ç½®äº†æ£‹å­ totalå°±åŠ 1 å¦åˆ™ç»§ç»­æ”¾ç½®ä¸‹ä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; N - <span class="number">1</span>) &#123;</span><br><span class="line">          calResult(i + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          total++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ”¾ç½®å®Œæˆä¹‹å (i,j)ä½ç½®æ£‹å­å»æ‰ï¼Œç„¶åé‡æ–°èµ°ä¸‹ä¸€æ­¥ è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢</span></span><br><span class="line">        curn[j] = left[i + j] = right[N - <span class="number">1</span> + i - j] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Solution solution = <span class="keyword">new</span> Solution();</span><br><span class="line">    solution.totalNQueens(<span class="number">8</span>);</span><br><span class="line">    System.out.println(<span class="string">"total = "</span> + solution.total);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Nçš‡åé—®é¢˜-leetcode&quot;&gt;&lt;a href=&quot;#Nçš‡åé—®é¢˜-leetcode&quot; class=&quot;headerlink&quot; title=&quot;Nçš‡åé—®é¢˜ - leetcode&quot;&gt;&lt;/a&gt;Nçš‡åé—®é¢˜ - &lt;a href=&quot;https://leetcode-cn.com/problems/n-queens-ii/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;leetcode&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;n çš‡åé—®é¢˜ç ”ç©¶çš„æ˜¯å¦‚ä½•å°† n ä¸ªçš‡åæ”¾ç½®åœ¨ nÃ—n çš„æ£‹ç›˜ä¸Šï¼Œå¹¶ä¸”ä½¿çš‡åå½¼æ­¤ä¹‹é—´ä¸èƒ½ç›¸äº’æ”»å‡»ã€‚&lt;img src=&quot;/blog/20190809/Leetcode-52-Nçš‡å-II-å›æº¯ç®—æ³•æ±‚è§£/8-queens.png&quot; alt=&quot;8çš‡åç¤ºä¾‹&quot;&gt;&lt;br&gt;ä¸Šå›¾ä¸º 8 çš‡åé—®é¢˜çš„ä¸€ç§è§£æ³•ã€‚ç»™å®šä¸€ä¸ªæ•´æ•° nï¼Œè¿”å› n çš‡åä¸åŒçš„è§£å†³æ–¹æ¡ˆçš„æ•°é‡ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç¤ºä¾‹ï¼š&quot;&gt;&lt;a href=&quot;#ç¤ºä¾‹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç¤ºä¾‹ï¼š&quot;&gt;&lt;/a&gt;ç¤ºä¾‹ï¼š&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;è¾“å…¥: 4&lt;br&gt;è¾“å‡º: 2&lt;br&gt;è§£é‡Š: 4 çš‡åé—®é¢˜å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªä¸åŒçš„è§£æ³•ã€‚&lt;br&gt;&lt;figure class=&quot;highlight md&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&quot;.Q..&quot;, Â // è§£æ³• 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;...Q&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;Q...&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;..Q.&quot;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[&quot;..Q.&quot;, Â // è§£æ³• 2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;Q...&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;...Q&quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&quot;.Q..&quot;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="leetcode" scheme="http://zhangjiaheng.cn/tags/leetcode/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£</title>
    <link href="http://zhangjiaheng.cn/blog/20190724/LeetCode%E4%B8%8A%E7%9A%84%E5%87%A0%E4%B8%AA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E9%A2%98%E8%A7%A3/"/>
    <id>http://zhangjiaheng.cn/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/</id>
    <published>2019-07-24T07:16:20.000Z</published>
    <updated>2019-11-01T01:40:48.187Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/fm.png" alt></p><a id="more"></a><h3 id="ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£-github"><a href="#ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£-github" class="headerlink" title="ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£ - github"></a><a href="https://github.com/Fatezhang/DataStructureAndAlgorithm/tree/master/src/main/java/Alogrithm/Alogrithm" target="_blank" rel="noopener">ä»¥ä¸‹æ‰€æœ‰é¢˜ç›®çš„é¢˜è§£ - github</a></h3><h4 id="1ã€æŒ‰åºæ‰“å°"><a href="#1ã€æŒ‰åºæ‰“å°" class="headerlink" title="1ã€æŒ‰åºæ‰“å°"></a>1ã€<a href="https://leetcode-cn.com/problems/print-in-order" target="_blank" rel="noopener">æŒ‰åºæ‰“å°</a></h4><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨volatileå˜é‡æ§åˆ¶é¡ºåº</li><li>æ€è·¯ï¼šåˆ©ç”¨volatileè¯­ä¹‰ï¼Œå®ç°å˜é‡çš„å†…å­˜å¯è§æ€§ï¼Œä½¿å¾—åˆ«çš„çº¿ç¨‹åœ¨ä¿®æ”¹å®ŒstateçŠ¶æ€å˜é‡çš„æ—¶å€™ç»“æœå¯¹äºå¦ä¸€ä¸ªçº¿ç¨‹ç«‹å³å¯è§ã€‚è¿™æ ·æ¯ä¸ªçº¿ç¨‹åœ¨æ‰“å°çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡çŠ¶æ€åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥è½®åˆ°è‡ªå·±æ‰§è¡Œäº†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">(Runnable printFirst)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printFirst.run() outputs "first". Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        state = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">second</span><span class="params">(Runnable printSecond)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">2</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printSecond.run() outputs "second". Do not change or remove this line.</span></span><br><span class="line">        printSecond.run();</span><br><span class="line">        state = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">third</span><span class="params">(Runnable printThird)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (state != <span class="number">3</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// printThird.run() outputs "third". Do not change or remove this line.</span></span><br><span class="line">        printThird.run();</span><br><span class="line">        state = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•äºŒï¼šä½¿ç”¨CountDownLatchæ§åˆ¶é¡ºåºï¼ˆåªé€‚ç”¨äºæ‰§è¡Œä¸€æ¬¡ã€‚ã€‚ã€‚å¯ä»¥ä½¿ç”¨å¾ªç¯æ …æ æ”¹ä¸€ä¸‹~ï¼‰</li><li>CountDownLatchä¿—ç§°â€œé—­é”â€ã€‚ä½¿ç”¨é—­é”æ¥æ§åˆ¶çº¿ç¨‹æ˜¯å¦è¯¥æ‰§è¡Œï¼Œåœ¨æ²¡æœ‰è¾¾åˆ°æ¡ä»¶æ—¶ï¼Œé—­é”é˜»å¡çº¿ç¨‹ã€‚è¿™æ ·åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åæ‰“å¼€ç¬¬äºŒä¸ªçº¿ç¨‹çš„é—­é”ï¼Œç¬¬äºŒä¸ªæ‰§è¡Œå®Œæˆä¹‹åæ‰“å¼€ç¬¬ä¸‰ä¸ªçº¿ç¨‹çš„é—­é”ï¼Œå®ç°æŒ‰ç…§é¡ºåºæ‰“å°ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch2 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch3 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">(Runnable printFirst)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        countDownLatch2.await();</span><br><span class="line">        <span class="comment">// printFirst.run() outputs "first". Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        countDownLatch2.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">second</span><span class="params">(Runnable printSecond)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        countDownLatch2.await();</span><br><span class="line">        <span class="comment">// printSecond.run() outputs "second". Do not change or remove this line.</span></span><br><span class="line">        printSecond.run();</span><br><span class="line">        countDownLatch3.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">third</span><span class="params">(Runnable printThird)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        countDownLatch3.await();</span><br><span class="line">        <span class="comment">// printThird.run() outputs "third". Do not change or remove this line.</span></span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2ã€äº¤æ›¿æ‰“å°FooBar"><a href="#2ã€äº¤æ›¿æ‰“å°FooBar" class="headerlink" title="2ã€äº¤æ›¿æ‰“å°FooBar"></a>2ã€<a href="https://leetcode-cn.com/problems/print-foobar-alternately" target="_blank" rel="noopener">äº¤æ›¿æ‰“å°FooBar</a></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨æ˜¾ç¤ºå¯é‡å…¥é”åŠ ä¸ŠConditionæ¡ä»¶é˜»å¡æœºåˆ¶ï¼Œå†åŠ ä¸Švolatileä¿®é¥°çš„çŠ¶æ€å˜é‡æ§åˆ¶æ‰“å°é¡ºåºã€‚çº¿ç¨‹æ‰“å°æ—¶åŠ é”ï¼Œå¦‚æœçŠ¶æ€æ˜¯ä½¿å½“å‰çº¿ç¨‹æ‰“å°ï¼Œå°±æ‰“å°å¹¶ä¸”è½¬æ¢çŠ¶æ€ï¼Œç„¶åå”¤é†’å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸‹ä¸€æ¬¡å†åˆ¤æ–­å½“å‰çŠ¶æ€ä¸é€‚åˆæ‰“å°ï¼Œå°±ä½¿ç”¨ç¬¬ä¸€ä¸ªæ¡ä»¶é”é˜»å¡å½“å‰çº¿ç¨‹ã€‚ä»¥æ­¤ç±»æ¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> äº¤æ›¿æ‰“å°FooBar */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FooBar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.n = n;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                c1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// printFoo.run() outputs "foo". Do not change or remove this line.</span></span><br><span class="line">            printFoo.run();</span><br><span class="line">            flag = !flag;</span><br><span class="line">            c2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">                c2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// printBar.run() outputs "bar". Do not change or remove this line.</span></span><br><span class="line">            printBar.run();</span><br><span class="line">            flag = !flag;</span><br><span class="line">            c1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3ã€æ‰“å°0ä¸å¥‡å¶æ•°"><a href="#3ã€æ‰“å°0ä¸å¥‡å¶æ•°" class="headerlink" title="3ã€æ‰“å°0ä¸å¥‡å¶æ•°"></a>3ã€<a href="https://leetcode-cn.com/problems/print-zero-even-odd" target="_blank" rel="noopener">æ‰“å°0ä¸å¥‡å¶æ•°</a></h4><ul><li>æ€è·¯ï¼šä¹Ÿæ˜¯ä½¿ç”¨æ˜¾ç¤ºå¯é‡å…¥é”åŠ ä¸Šæ¡ä»¶é˜»å¡æœºåˆ¶ï¼ŒåŠ ä¸Švolatileä¿®é¥°çš„çŠ¶æ€å˜é‡æ§åˆ¶å¥‡å¶æ•°çš„æ‰“å°ã€‚ä¸ç¬¦åˆå½“å‰æ‰§è¡Œçš„çŠ¶æ€å°±ä½¿ç”¨conditioné˜»å¡ï¼Œç¬¦åˆå°±æ‰§è¡Œå¹¶ä¸”è½¬æ¢çŠ¶æ€ï¼Œç„¶åå”¤é†’å…¶ä»–çº¿ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.function.IntConsumer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> https://leetcode-cn.com/problems/print-zero-even-odd</span></span><br><span class="line"><span class="comment"> * 3ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°å’Œ0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZeroEvenOdd</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ZeroEvenOdd</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.n = n;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition c1 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c2 = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition c3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 0-æ‰“å°0 1-æ‰“å°å¥‡æ•° 2-æ‰“å°å¶æ•° */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zero</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">0</span>) &#123;</span><br><span class="line">          c1.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">          flag = <span class="number">1</span>;</span><br><span class="line">          c3.signal();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          flag = <span class="number">2</span>;</span><br><span class="line">          c2.signal();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">even</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">2</span>) &#123;</span><br><span class="line">          c2.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(i);</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">        c1.signal();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">odd</span><span class="params">(IntConsumer printNumber)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag != <span class="number">1</span>) &#123;</span><br><span class="line">          c3.await();</span><br><span class="line">        &#125;</span><br><span class="line">        printNumber.accept(i);</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">        c1.signal();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ZeroEvenOdd zeroEvenOdd = <span class="keyword">new</span> ZeroEvenOdd(<span class="number">5</span>);</span><br><span class="line">    ThreadPoolExecutor pools =</span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, TimeUnit.MINUTES, <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>), r -&gt; <span class="keyword">new</span> Thread(r, <span class="string">"æŸçº¿ç¨‹"</span>));</span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.zero(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.even(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    pools.execute(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            zeroEvenOdd.odd(System.out::print);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4ã€H2Oç”Ÿæˆ"><a href="#4ã€H2Oç”Ÿæˆ" class="headerlink" title="4ã€H2Oç”Ÿæˆ"></a>4ã€<a href="https://leetcode-cn.com/problems/building-h2o" target="_blank" rel="noopener">H2Oç”Ÿæˆ</a></h4><ul><li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨æ˜¾ç¤ºé”å’Œcondition</li><li>æ€è·¯ï¼šè€ç”Ÿå¸¸è°ˆçš„æ€è·¯äº†ï¼ŒåŒä¸Šé¢ä¸€æ ·çš„åŸç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> æ°´åˆ†å­ç”Ÿæˆ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">H2O</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">H2O</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Condition H = lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> Condition O = lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> hCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hydrogen</span><span class="params">(Runnable releaseHydrogen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">while</span> (hCount == <span class="number">2</span>) &#123;</span><br><span class="line">        H.await();</span><br><span class="line">      &#125;</span><br><span class="line">      hCount++;</span><br><span class="line">      releaseHydrogen.run();</span><br><span class="line">      <span class="keyword">if</span> (hCount == <span class="number">2</span>) &#123;</span><br><span class="line">        O.signal();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        H.signal();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oxygen</span><span class="params">(Runnable releaseOxygen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">while</span> (hCount != <span class="number">2</span>) &#123;</span><br><span class="line">        O.await();</span><br><span class="line">      &#125;</span><br><span class="line">      hCount = <span class="number">0</span>;</span><br><span class="line">      releaseOxygen.run();</span><br><span class="line">      H.signal();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String s = <span class="string">"HHOOOHHHH"</span>;</span><br><span class="line">    <span class="keyword">final</span> H2O o = <span class="keyword">new</span> H2O();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">'H'</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">                () -&gt; &#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    o.hydrogen(() -&gt; System.out.print(<span class="string">"H"</span>));</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            .start();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">                () -&gt; &#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    o.oxygen(() -&gt; System.out.print(<span class="string">"O"</span>));</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            .start();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–¹æ³•äºŒï¼šä½¿ç”¨ä¿¡å·é‡æ§åˆ¶é€šçŸ¥çº¿ç¨‹</li><li>æ€è·¯ï¼šä½¿ç”¨ä¿¡å·é‡æ§åˆ¶çº¿ç¨‹é—´çš„é€šä¿¡ã€‚åˆ†åˆ«åˆ†ä¸ºæ‰§è¡Œä¿¡å·å’Œå”¤é†’ä¿¡å·ï¼Œæ°¢åŸå­çš„æ‰§è¡Œä¿¡å·é¦–å…ˆä¸º2ï¼Œæ°§åŸå­çš„æ‰§è¡Œä¿¡å·é¦–å…ˆä¸º1ã€‚æ°¢æ°§çº¿ç¨‹æ‰§è¡Œæ—¶æ¶ˆè€—æ‰§è¡Œä¿¡å·é‡ï¼Œå½“ä¸€ä¸ªæ°¢åŸå­æ‰§è¡Œåï¼Œæ°¢åŸå­çš„é‡Šæ”¾ä¿¡å·å¼€å§‹é‡Šæ”¾ï¼ˆåªæœ‰ä¸€ä¸ªæ°§çº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾ï¼‰ï¼Œç„¶åç­‰å¾…æ°§åŸå­é‡Šæ”¾ä¿¡å·é‡Šæ”¾ï¼ˆå³ä¸€ä¸ªæ°§åŸå­å·²ç»äº§ç”Ÿï¼‰ï¼Œä¹‹åäº§ç”Ÿä¸€ä¸ªæ°¢åŸå­åœ¨é‡Šæ”¾è¯·æ±‚ä¿¡å·ã€‚æ°§çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¼€å§‹è¯·æ±‚é‡Šæ”¾ä¸€ä¸ªæ°§åŸå­ï¼ŒæˆåŠŸä¹‹åæ°§çº¿ç¨‹é‡Šæ”¾ä¿¡å·å¼€å§‹é‡Šæ”¾ï¼ˆå› ä¸º2ä¸ªæ°¢çº¿ç¨‹ç­‰å¾…æ‰€ä»¥é‡Šæ”¾ä¸¤ä¸ªä¿¡å·ï¼‰ï¼Œç„¶åç­‰å¾…æ°¢çº¿ç¨‹é‡Šæ”¾ä¸¤ä¸ªä¿¡å·ï¼ˆè¯´æ˜å·²ç»æœ‰ä¸¤ä¸ªæ°¢åŸå­ç”Ÿæˆï¼‰ã€‚ç„¶åå†ç”Ÿæˆæ°§åŸå­ï¼ŒæˆåŠŸä¹‹ååœ¨é‡Šæ”¾æ°§çº¿ç¨‹çš„è¯·æ±‚ä¿¡å·ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@Author</span> zhangjiaheng <span class="doctag">@Description</span> ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶æ°´åˆ†å­ç”Ÿæˆ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">H2O_2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Semaphore hAcquire, oAcquire, hRelease, oRelease;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">H2O_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// H åŸå­çº¿ç¨‹ è¯·æ±‚ä¿¡å·</span></span><br><span class="line">    hAcquire = <span class="keyword">new</span> Semaphore(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// O åŸå­çº¿ç¨‹ è¯·æ±‚ä¿¡å·</span></span><br><span class="line">    oAcquire = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// H åŸå­çº¿ç¨‹ é‡Šæ”¾ä¿¡å·</span></span><br><span class="line">    hRelease = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// O åŸå­çº¿ç¨‹ é‡Šæ”¾ä¿¡å·</span></span><br><span class="line">    oRelease = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hydrogen</span><span class="params">(Runnable releaseHydrogen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    hAcquire.acquire(); <span class="comment">// Hçº¿ç¨‹å¼€å§‹è¯·æ±‚</span></span><br><span class="line">    hRelease.release(); <span class="comment">// é€šçŸ¥ä¸€ä¸ªHçº¿ç¨‹å³å°†é‡Šæ”¾ å› ä¸ºä¸€ä¸ªHçº¿ç¨‹é‡Šæ”¾æœ€å¤šåªæœ‰ä¸€ä¸ªOçº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾</span></span><br><span class="line">    oRelease.acquire(); <span class="comment">// ç­‰å¾…Oçº¿ç¨‹é‡Šæ”¾ ä¸€ä¸ªOçº¿ç¨‹é‡Šæ”¾å°±å¯ä»¥é€šè¿‡</span></span><br><span class="line">    releaseHydrogen.run();</span><br><span class="line">    hAcquire.release(); <span class="comment">// å”¤é†’Hçº¿ç¨‹è¯·æ±‚</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oxygen</span><span class="params">(Runnable releaseOxygen)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    oAcquire.acquire(); <span class="comment">// Oçº¿ç¨‹å¼€å§‹è¯·æ±‚</span></span><br><span class="line">    oRelease.release(<span class="number">2</span>); <span class="comment">// é€šçŸ¥ä¸€ä¸ªOçº¿ç¨‹å³å°†é‡Šæ”¾ å› ä¸ºä¸€ä¸ªOçº¿ç¨‹é‡Šæ”¾ ä¼šæœ‰ä¸¤ä¸ªHçº¿ç¨‹ç­‰å¾…å…¶é‡Šæ”¾</span></span><br><span class="line">    hRelease.acquire(<span class="number">2</span>); <span class="comment">// ç­‰å¾…Hçº¿ç¨‹é‡Šæ”¾ è¦ç­‰å¾…ä¸¤æ¬¡é‡Šæ”¾ æ‰å¯ä»¥é€šè¿‡</span></span><br><span class="line">    releaseOxygen.run();</span><br><span class="line">    oAcquire.release(); <span class="comment">// å”¤é†’Oçº¿ç¨‹è¯·æ±‚</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String s = <span class="string">"HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHOOHHOOOOOHOOOHHHOHHHHOOOHHHOOOHOHOHOHHOHOOHHHOOHOOOHHOOOOHOHHHHOOOOOHHHOOOHOHOHOOOHHOHOOHHOHHHHHHHHHHHHHHHHHHHHHHHHHHH"</span>;</span><br><span class="line">    <span class="keyword">final</span> H2O_2 o = <span class="keyword">new</span> H2O_2();</span><br><span class="line">    ThreadPoolExecutor pool =</span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">            <span class="number">300</span>,</span><br><span class="line">            <span class="number">300</span>,</span><br><span class="line">            <span class="number">10</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">100</span>),</span><br><span class="line">                (ThreadFactory) Thread::<span class="keyword">new</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c : s.toCharArray()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">'H'</span>) &#123;</span><br><span class="line">        pool.execute(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</span><br><span class="line">                o.hydrogen(() -&gt; System.out.print(<span class="string">"H"</span>));</span><br><span class="line">              &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pool.execute(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</span><br><span class="line">                o.oxygen(() -&gt; System.out.print(<span class="string">"O"</span>));</span><br><span class="line">              &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190724/LeetCodeä¸Šçš„å‡ ä¸ªå¤šçº¿ç¨‹ç¼–ç¨‹é¢˜è§£/fm.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="leetcode" scheme="http://zhangjiaheng.cn/tags/leetcode/"/>
    
      <category term="ç®—æ³•é¢˜è§£" scheme="http://zhangjiaheng.cn/tags/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹</title>
    <link href="http://zhangjiaheng.cn/blog/20190716/Synchronized%E4%BD%BF%E7%94%A8%E6%97%B6%E4%B8%80%E4%B8%AA%E4%B8%8D%E8%B5%B7%E7%9C%BC%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
    <id>http://zhangjiaheng.cn/blog/20190716/Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹/</id>
    <published>2019-07-16T09:12:47.000Z</published>
    <updated>2019-11-01T01:40:48.191Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Synchronized-å‰æƒ…æè¦"><a href="#Synchronized-å‰æƒ…æè¦" class="headerlink" title="Synchronized å‰æƒ…æè¦"></a>Synchronized å‰æƒ…æè¦</h4><p>Synchronizedæ˜¯Javaä¸­ç”¨æ¥è¿›è¡Œæ–¹æ³•æˆ–è€…ä»£ç åŒæ­¥çš„ä¸€ä¸ªå†…ç½®é”æœºåˆ¶ã€‚è¿™ç§å†…ç½®é”æœºåˆ¶å¯ä»¥ä¿è¯ä»£ç æ‰§è¡Œçš„åŸå­æ€§ã€å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å±è”½ä»£ç çš„é‡æ’åºã€‚Synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ã€å¯¹è±¡ä»¥åŠä»£ç å—ï¼Œå¹¶å¯ä»¥ä¿è¯è¢«ä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚</p><ul><li>ä¿®é¥°é™æ€æ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶Synchronizedæ²¡æœ‰è¡¨ç°åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè€Œæ˜¯åœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨ä¸­å°†è¯¥æ–¹æ³•çš„access_flagså€¼ç½®ä¸º1ã€‚è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æˆ–è¯¥æ–¹æ³•æ‰€å±çš„ Class åœ¨ JVM çš„å†…éƒ¨å¯¹è±¡è¡¨ç¤º Klass ä½œä¸ºé”å¯¹è±¡ã€‚</li><li>ä¿®é¥°æ™®é€šæ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶åŒä¸Šã€‚</li><li>ä¿®é¥°ä»£ç å—ï¼šé”çš„æ˜¯Synchronized()ä¸­çš„å¯¹è±¡ï¼Œç¼–è¯‘åçš„å­—èŠ‚ç ä¼šåœ¨ä»£ç å—å‰åæ’å…¥monitorenter å’Œmonitorexitã€‚JVMéœ€è¦æ¯ä¸€ä¸ªmonitorenteréƒ½æœ‰ä¸€ä¸ªmonitorexitä¸ä¹‹å¯¹åº”ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹ç›¸å¯¹åº”ï¼Œå½“ä¸€ä¸ªmonitorè¢«æŒæœ‰ï¼Œå³çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræ—¶ï¼Œå¯¹è±¡å°†å¤„äºé”å®šçŠ¶æ€ã€‚</li></ul><p>Synchronizedæ˜¯Javaå†…ç½®çš„é‡é‡çº§é”ï¼Œåœ¨jdk1.6ä¹‹åå¼•å…¥äº†è‡ªæ—‹é”ã€è½»é‡çº§é”ã€é€‚åº”æ€§è‡ªæ—‹ã€é”ç²—åŒ–ã€é”æ¶ˆé™¤ã€åå‘é”ç­‰æŠ€æœ¯æ¥å‡å°‘Synchronizedçš„æ€§èƒ½å¼€é”€ã€‚</p><a id="more"></a><h4 id="åˆ‡å…¥æ­£é¢˜"><a href="#åˆ‡å…¥æ­£é¢˜" class="headerlink" title="åˆ‡å…¥æ­£é¢˜"></a>åˆ‡å…¥æ­£é¢˜</h4><p>ä»¥ä¸ŠçŸ¥è¯†ç‚¹æƒ³å¿…åˆšå¼€å§‹å­¦ä¹ å¹¶å‘ç¼–ç¨‹çš„ç¨‹åºå‘˜éƒ½ä¼šå…ˆå­¦ä¹ ä»¥ä¸ŠçŸ¥è¯†ï¼Œä½†æ˜¯å¾ˆå¤šç¨‹åºå‘˜åœ¨ä½¿ç”¨Synchronizedçš„æ—¶å€™æœ‰å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘æ˜æ˜åŠ é”äº†ï¼Œä½†æ˜¯æ–¹æ³•å´å¹¶æ²¡æœ‰åŒæ­¥æ‰§è¡Œï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå…ˆçœ‹ä¸‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer cn = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (cn) &#123;</span><br><span class="line">                        cn++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å¯åŠ¨äº†20ä¸ªçº¿ç¨‹ï¼Œå¯¹Integerå˜é‡cnè¿›è¡Œè‡ªå¢ã€‚å¾ˆå¤šäººåœ¨å†™Synchronizedçš„æ—¶å€™éƒ½æœ‰å¯èƒ½å‡ºç°è¿™ç§é—®é¢˜ã€‚è¿™æ ·çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼</p><p>å› ä¸º<code>cn++</code>è¿™å¥ä»£ç çš„åŸç†æ˜¯å°†cnæŒ‡å‘ä¸€ä¸ªcn+1çš„æ–°çš„Integerå¯¹è±¡ï¼</p><p>ä¿®æ”¹æˆå¦‚ä¸‹ï¼Œç„¶åçœ‹çœ‹è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer cn = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch cd = <span class="keyword">new</span> CountDownLatch(size);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">        <span class="keyword">int</span> finalJ = j;</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cd.countDown();</span><br><span class="line">                    cd.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (cn) &#123;</span><br><span class="line">                        cn++;</span><br><span class="line">                        System.out.println(</span><br><span class="line">                            <span class="string">"cn"</span> + finalJ + <span class="string">" = "</span> + cn + <span class="string">"\t\t\t"</span> + System.identityHashCode(cn));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»¥ä¸Šä»£ç è¾“å‡ºå¦‚ä¸‹ &gt;&gt;</strong></p><p><img src="/blog/20190716/Synchronizedä½¿ç”¨æ—¶ä¸€ä¸ªä¸èµ·çœ¼çš„æ³¨æ„ç‚¹/cons.png" alt="è¾“å‡º"></p><p>æ¯æ¬¡è¾“å‡ºçš„Integerå¯¹è±¡çš„HashCodeå€¼å¹¶ä¸ç›¸åŒã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡é”çš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼æ—¢ç„¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åœ¨å¤šçº¿ç¨‹è®¿é—®çš„æ—¶å€™è‚¯å®šå°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼å¯¹äºå¦‚ä¸Šè¿™ç§ä¾‹å­æˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨åŸå­å˜é‡<code>AtomicInteger</code>æ¥å®ç°æ›´é«˜çº§çš„åŒæ­¥æœºåˆ¶å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å…¶ä»–åœºæ™¯ä¸‹å‘¢ï¼Ÿ</p><p>ä¸ä»…ä»…æ˜¯Integerå¯¹è±¡å“¦ï¼æ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰å¯èƒ½ä¼šæœ‰è¿™äº›é—®é¢˜å­˜åœ¨ï¼å½“ä½ åœ¨é”è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯åŠ é”çš„å¯¹è±¡åœ¨çº¿ç¨‹ä¸­ä¸è¢«ä¿®æ”¹æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼å¦åˆ™å°±æ˜¯ä¸€ä¸ª<strong>å‡çš„</strong>åŒæ­¥ä»£ç å—ï¼</p><hr>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Synchronized-å‰æƒ…æè¦&quot;&gt;&lt;a href=&quot;#Synchronized-å‰æƒ…æè¦&quot; class=&quot;headerlink&quot; title=&quot;Synchronized å‰æƒ…æè¦&quot;&gt;&lt;/a&gt;Synchronized å‰æƒ…æè¦&lt;/h4&gt;&lt;p&gt;Synchronizedæ˜¯Javaä¸­ç”¨æ¥è¿›è¡Œæ–¹æ³•æˆ–è€…ä»£ç åŒæ­¥çš„ä¸€ä¸ªå†…ç½®é”æœºåˆ¶ã€‚è¿™ç§å†…ç½®é”æœºåˆ¶å¯ä»¥ä¿è¯ä»£ç æ‰§è¡Œçš„åŸå­æ€§ã€å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½å±è”½ä»£ç çš„é‡æ’åºã€‚Synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ã€å¯¹è±¡ä»¥åŠä»£ç å—ï¼Œå¹¶å¯ä»¥ä¿è¯è¢«ä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œåœ¨åŒä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®å¾—åˆ°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¿®é¥°é™æ€æ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶Synchronizedæ²¡æœ‰è¡¨ç°åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè€Œæ˜¯åœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨ä¸­å°†è¯¥æ–¹æ³•çš„access_flagså€¼ç½®ä¸º1ã€‚è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æˆ–è¯¥æ–¹æ³•æ‰€å±çš„ Class åœ¨ JVM çš„å†…éƒ¨å¯¹è±¡è¡¨ç¤º Klass ä½œä¸ºé”å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®é¥°æ™®é€šæ–¹æ³•ï¼šé”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ï¼Œä¿®é¥°æ–¹æ³•æ—¶åŒä¸Šã€‚&lt;/li&gt;
&lt;li&gt;ä¿®é¥°ä»£ç å—ï¼šé”çš„æ˜¯Synchronized()ä¸­çš„å¯¹è±¡ï¼Œç¼–è¯‘åçš„å­—èŠ‚ç ä¼šåœ¨ä»£ç å—å‰åæ’å…¥monitorenter å’Œmonitorexitã€‚JVMéœ€è¦æ¯ä¸€ä¸ªmonitorenteréƒ½æœ‰ä¸€ä¸ªmonitorexitä¸ä¹‹å¯¹åº”ï¼Œä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªmonitorä¸ä¹‹ç›¸å¯¹åº”ï¼Œå½“ä¸€ä¸ªmonitorè¢«æŒæœ‰ï¼Œå³çº¿ç¨‹æ‰§è¡Œåˆ°monitorenteræ—¶ï¼Œå¯¹è±¡å°†å¤„äºé”å®šçŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Synchronizedæ˜¯Javaå†…ç½®çš„é‡é‡çº§é”ï¼Œåœ¨jdk1.6ä¹‹åå¼•å…¥äº†è‡ªæ—‹é”ã€è½»é‡çº§é”ã€é€‚åº”æ€§è‡ªæ—‹ã€é”ç²—åŒ–ã€é”æ¶ˆé™¤ã€åå‘é”ç­‰æŠ€æœ¯æ¥å‡å°‘Synchronizedçš„æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Synchronized" scheme="http://zhangjiaheng.cn/tags/Synchronized/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ª[åˆæ ¼]çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶</title>
    <link href="http://zhangjiaheng.cn/blog/20190714/%E4%B8%80%E4%B8%AA-%E5%90%88%E6%A0%BC-%E7%9A%84%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BF%85%E9%A1%BB%E5%85%B7%E5%A4%87%E7%9A%84%E5%B7%A5%E5%85%B7%E5%92%8C%E6%8F%92%E4%BB%B6/"/>
    <id>http://zhangjiaheng.cn/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/</id>
    <published>2019-07-14T13:38:04.000Z</published>
    <updated>2019-11-01T01:40:48.205Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/gtx.jpg" alt="å°é¢"><br><a id="more"></a></p><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p><strong>å¦‚é¢˜â€¦ æ˜¯æˆ‘æ ‡é¢˜å…šäº†ï¼Œåº”è¯¥è¿™æ ·è®²ï¼šâ€œåˆæ ¼çš„ç¨‹åºå‘˜â€ä¸ä¸€å®šéœ€è¦ä¼šä½¿ç”¨å“ªäº›å·¥å…·ï¼Œä½†æ˜¯ä¼šä½¿ç”¨é‚£äº›èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘è‡ªå·±å·¥ä½œé‡çš„å¾ˆé…·çš„å·¥å…·å’Œæ’ä»¶çš„ç¨‹åºå‘˜ä¸€å®šä¼šè¿›æ­¥æˆä¸€ä¸ªâ€œåˆæ ¼çš„ç¨‹åºå‘˜â€ã€‚å› ä¸ºä»–ä»¬å–„äºæ€è€ƒï¼Œå¹¶èƒ½å¤Ÿå°†ç¹æ‚çš„é‡å¤æ€§å·¥ä½œäº¤ç»™å·¥å…·å»å®Œæˆï¼Œå°†ç²¾åŠ›é›†ä¸­åœ¨æ ¸å¿ƒçš„ç¼–ç ä»»åŠ¡ä¸Šã€‚</strong></p><h4 id="é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™"><a href="#é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™" class="headerlink" title="é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™"></a>é€ä¸ªä»‹ç»é‚£äº›æˆ‘è‡ªå·±å¸¸ç”¨çš„å·¥å…·ã€æ’ä»¶æˆ–è€…ç½‘ç«™</h4><h5 id="Ghelper"><a href="#Ghelper" class="headerlink" title="Ghelper"></a><a href="http://googlehelper.net/" target="_blank" rel="noopener">Ghelper</a></h5><p>è¯´åˆ°å·¥å…·ï¼Œä¸ä¼šç¿»å¢™ç”¨å•¥å­å·¥å…·ã€‚Ghelperæ˜¯ä¸€ä¸ªè°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼Œç›´æ¥ä¸‹è½½å®‰è£…åˆ°chromeæ‰©å±•å³å¯è½»æ¾è®¿é—®è°·æ­Œç­‰æœåŠ¡ï¼æ³¨æ„ï¼Œè®¿é—®è°·æ­Œçš„ç›¸å…³æœåŠ¡æ˜¯å…è´¹çš„å“¦ï¼å¦‚æœä½ æœ‰éœ€æ±‚è®¿é—®å…¶ä»–çš„ä¾‹å¦‚YouTuBeã€Twitterä¹‹ç±»çš„ï¼Œå¯ä»¥è´­ä¹°ä¼šå‘˜æœåŠ¡ï¼è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªè°·æ­Œè®¿é—®åŠ©æ‰‹ç ´è§£ç‰ˆï¼Œæˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œæœ‰å…´è¶£å¯ä»¥è£…ä¸€ä¸‹çœ‹çœ‹ï¼š<a href="https://github.com/haotian-wang/google-access-helper" target="_blank" rel="noopener">GHelperç ´è§£ç‰ˆ</a><br>è¿™ä¸ªå·¥å…·å¯ä»¥è¯´æ˜¯ä»¥ä¸‹å¤§éƒ¨åˆ†å·¥å…·çš„åŸºç¡€ã€‚</p><h5 id="FeHelper"><a href="#FeHelper" class="headerlink" title="FeHelper"></a><a href="https://www.baidufe.com/fehelper/feedback.html" target="_blank" rel="noopener">FeHelper</a></h5><p>FeHelperæ˜¯ä¸€ä¸ªåœ¨è°·æ­Œæµè§ˆå™¨ä¸Šæˆ‘æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ’ä»¶ã€‚åŠŸèƒ½å¦‚ä¸‹ï¼Œå­—ç¬¦ä¸²ç¼–è§£ç ã€JSONæ ¼å¼åŒ–ã€æ—¶é—´æˆ³è½¬æ¢ç­‰ç­‰å·¥å…·ï¼Œåœ¨åšwebå¼€å‘çš„æ—¶å€™æŸ¥çœ‹æŸä¸ªJSONæ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®ç›´æ¥é»è´´åˆ°è¿™ä¸ªæ¡†é‡Œå°±OKï¼Œç®€å•æš´åŠ›~</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/feh.png" alt="FeHelper"></p><h5 id="æ²¹çŒ´å„¿"><a href="#æ²¹çŒ´å„¿" class="headerlink" title="æ²¹çŒ´å„¿"></a><a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">æ²¹çŒ´å„¿</a></h5><p>å¤§åé¼é¼çš„æ²¹çŒ´å„¿æƒ³å¿…å¾ˆå¤šç¨‹åºå‘˜éƒ½äº†è§£ä»¥åŠç”¨è¿‡å§(æ²¡ç”¨è¿‡åˆ«å‘Šè¯‰æˆ‘ä½ æ˜¯ä¸ªç¨‹åºå‘˜ï¼Œæ­»æ•²ä»£ç çš„)ã€‚</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/yh.png" alt="æ²¹çŒ´å„¿"></p><p>å¦‚ä¸Šå›¾å°±æ˜¯æˆ‘çš„ä¸€äº›æ²¹çŒ´å„¿æ’ä»¶çš„å·²å®‰è£…çš„ä¸€éƒ¨åˆ†è„šæœ¬çš„æˆªå›¾ã€‚ä¾‹å¦‚çœ‹å„å¤§è§†é¢‘ç½‘ç«™ï¼Œä¸æƒ³è¦ä¹°VIPå»çœ‹ï¼Œé‚£ä¹ˆç›´æ¥å®‰è£…ä¸€ä¸ªVIPè§†é¢‘ç ´è§£è„šæœ¬ï¼›æˆ–è€…ç™¾åº¦ç½‘ç›˜ï¼Œæ‹’ç»å¯åŠ¨å®¢æˆ·ç«¯ä¸‹è½½æ–‡ä»¶ï¼Œå®‰è£…ä¸ªæ²¹çŒ´è„šæœ¬ç›´æ¥ç›´é“¾ä¸‹è½½ï¼</p><p>æ²¹çŒ´å„¿åœ¨æˆ‘çœ‹æ¥å°±æ˜¯ä¸€ä¸ªæµè§ˆå™¨è„šæœ¬çš„å®¹å™¨ï¼Œç½‘ä¸Šæå®¢ä¼—å¤šï¼Œä½ å¯ä»¥æ‰¾å¾—åˆ°ä»»ä½•è‡ªå·±æ„Ÿå…´è¶£çš„æƒ³è¦å®‰è£…çš„æ’ä»¶å»å®Œæˆè‡ªå·±è¦åšçš„äº‹æƒ…ã€‚</p><p>æ²¹çŒ´å„¿çš„å®‰è£…ï¼š<a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">è°·æ­Œåº”ç”¨å•†åº— - æ²¹çŒ´å„¿</a>ï¼Œå®‰è£…å®Œæˆä¹‹åä½ å°±å¯ä»¥æ‰¾åˆ°ä»»ä½•ä½ æƒ³è¦çš„è„šæœ¬è£…åœ¨æ²¹çŒ´å„¿é‡Œé¢å•¦ï¼</p><p>è¿™è¾¹ï¼Œæˆ‘åªå‘Šè¯‰å¤§å®¶ä¸€ä¸ªç»ˆæè„šæœ¬ï¼š<a href="https://greasyfork.org/zh-CN/scripts/24508-userscript-show-site-all-userjs" target="_blank" rel="noopener">UserScript+</a>ã€‚ä¸ºå•¥å«å®ƒç»ˆæè„šæœ¬ã€‚ã€‚ã€‚å› ä¸ºå®‰è£…ä¸Šå®ƒä¹‹åï¼Œå½“ä½ æ‰“å¼€ä»»ä½•ç½‘ç«™ï¼Œä»–éƒ½ä¼šæç¤ºä½ è¿™ä¸ªç½‘ç«™å¯ä»¥å®‰è£…çš„è„šæœ¬æœ‰å“ªäº›ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨åœ¨èŒ«èŒ«å¤§æµ·ä¸­å»å¯»æ‰¾è‡ªå·±éœ€è¦çš„é‚£äº›è„šæœ¬äº†ã€‚</p><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/jb.png" alt="æ˜é‡‘æ²¹çŒ´å„¿è„šæœ¬"></p><p>å¯ä»¥æƒ³è±¡ï¼Œæœ‰äº†è¿™ä¸ªä¹‹åï¼Œé¢å‘ç™¾åº¦ç¼–ç¨‹çš„ç¨‹åºå‘˜æ˜¯ä¸æ˜¯ä¸ç”¨å†è¢«çœ¼èŠ±ç¼­ä¹±çš„å¹¿å‘Šæ‰€éªšæ‰°ï¼å–œæ¬¢ä½¿ç”¨æ˜é‡‘çš„ç¨‹åºå‘˜ä¹Ÿå¯ä»¥è®¾ç½®è‡ªå·±å–œæ¬¢çš„é¡µé¢æ’ç‰ˆ~ ç»å¸¸æ°´V2EXçš„ç¨‹åºå‘˜ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç›–æ¥¼äº†ï¼ï¼å“ˆå“ˆæƒ³æƒ³å°±åˆºæ¿€å‘¢ï¼</p><h5 id="äº‘ç›˜ç²¾çµ"><a href="#äº‘ç›˜ç²¾çµ" class="headerlink" title="äº‘ç›˜ç²¾çµ"></a><a href="https://www.yunpanjingling.com/" target="_blank" rel="noopener">äº‘ç›˜ç²¾çµ</a></h5><p><img src="/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/ypjl.png" alt="äº‘ç›˜ç²¾çµ"></p><p>äº‘ç›˜ç²¾çµæ˜¯ä¸€ä¸ªä¸‹è½½ç™¾åº¦ç½‘ç›˜èµ„æºçš„ç¥å¥‡çš„ç½‘ç«™ï¼Œåœ¨è¿™é‡Œä½ å‡ ä¹å¯ä»¥æ‰¾åˆ°ä»»ä½•æ‚¨æƒ³è¦çš„èµ„æºå»ä¸‹è½½ã€‚ç„¶é¹…ï¼Œéœ€è¦æ³¨å†Œç„¶åä½¿ç”¨è±†å­è´­ä¹°ã€‚ä¸è¿‡è¿™ä¹Ÿæ˜¯ç†æ‰€åº”å½“çš„ï¼Œæ¯•ç«ŸçŸ¥è¯†ä»˜è´¹çš„å¤©ä¸‹ã€‚ä½†æ˜¯éœ€è¦ä»˜çš„å¹¶ä¸å¤šï¼Œè€Œä¸”ä½ è¿˜å¯ä»¥å°†ä½ è‡ªå·±çš„èµ„æºåˆ†äº«åˆ°äº‘ç›˜ç²¾çµï¼Œæœ‰äººä¸‹è½½ä½ ä¹Ÿä¼šèµšå–åˆ°ç›¸åº”çš„è±†å­ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190714/ä¸€ä¸ª-åˆæ ¼-çš„ç¨‹åºå‘˜å¿…é¡»å…·å¤‡çš„å·¥å…·å’Œæ’ä»¶/gtx.jpg&quot; alt=&quot;å°é¢&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾</title>
    <link href="http://zhangjiaheng.cn/blog/20190714/%E5%B0%86%E9%98%BF%E9%87%8CJava%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83%E6%95%B2%E6%88%90%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
    <id>http://zhangjiaheng.cn/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/</id>
    <published>2019-07-14T03:12:01.000Z</published>
    <updated>2019-11-01T01:40:48.223Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/fm.png" alt="é˜¿é‡ŒJavaç¼–ç è§„èŒƒ"></p><p><center>é˜¿é‡ŒJavaç¼–ç è§„èŒƒ</center><br><a id="more"></a></p><p><center></center></p><p><center><a href="https://mubu.com/doc/CuUSIfxtSz" target="_blank" rel="noopener">å¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹åˆ†äº«çš„ç¬”è®°</a></center></p><p><center></center></p><p><center></center></p><p><center>æˆ–è€…æ‰«æå¦‚ä¸‹äºŒç»´ç è·å–æˆ‘åˆ†äº«çš„ã€Šé˜¿é‡ŒJavaå¼€å‘æ‰‹å†Œ-å¹•å¸ƒç‰ˆã€‹</center><br><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/qrcode.png" alt></p><p><center></center></p><p><center></center></p><h2 id><a href="#" class="headerlink" title></a><center></center></h2><p><center>æœ€åï¼Œæ€ç»´å¯¼å›¾æ•ˆæœå¦‚ä¸‹ï¼Œå¯†é›†ææƒ§ç—‡æ…å…¥~~</center></p><p><center>æŸ¥çœ‹æ¸…æ™°å®Œæ•´çš„æ•ˆæœè¯·å»å¹•å¸ƒç¬”è®°ï¼Œç‚¹å‡»æŸ¥çœ‹æ€ç»´å¯¼å›¾å³å¯</center><br><img src="/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/é˜¿é‡ŒJavaç¼–ç è§„èŒƒ.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190714/å°†é˜¿é‡ŒJavaç¼–ç è§„èŒƒæ•²æˆæ€ç»´å¯¼å›¾/fm.png&quot; alt=&quot;é˜¿é‡ŒJavaç¼–ç è§„èŒƒ&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;center&gt;é˜¿é‡ŒJavaç¼–ç è§„èŒƒ&lt;/center&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="http://zhangjiaheng.cn/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼</title>
    <link href="http://zhangjiaheng.cn/blog/20190707/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%91%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    <id>http://zhangjiaheng.cn/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/</id>
    <published>2019-07-07T02:32:44.000Z</published>
    <updated>2019-11-01T01:40:48.196Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/fm.png" alt="å°é¢"><br><a id="more"></a></p><h4 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4><p>åœ¨è®¡ç®—æœºç¨‹åºä¸­ï¼Œä¸ºäº†å°†ä¸€äº›å…·æœ‰ä¸åŒå®ç°ä½†æœ‰ç›¸åŒæ‰§è¡Œæ­¥éª¤çš„ç±»ç»Ÿä¸€èµ·æ¥ï¼Œé€šå¸¸æˆ‘ä»¬å°†è¿™äº›ç±»æŠ½è±¡æˆä¸€ä¸ªæ¨¡æ¿ç±»ã€‚æ¨¡æ¿ç±»å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ç®—æ³•çš„ç»“æ„è€Œå»å¯¹ä¸€äº›ç»†èŠ‚å®ç°è¿›è¡Œé‡æ–°å®šä¹‰ã€‚</p><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ "><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ " class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ "></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒè¦ç´ </h4><h5 id="æŠ½è±¡æ¨¡æ¿"><a href="#æŠ½è±¡æ¨¡æ¿" class="headerlink" title="æŠ½è±¡æ¨¡æ¿"></a>æŠ½è±¡æ¨¡æ¿</h5><p>æŠ½è±¡æ¨¡æ¿ä¸­å®šä¹‰äº†ä¸¤ç§æ–¹æ³•ï¼šéœ€è¦å­ç±»å»å®ç°çš„åŸºæœ¬æ–¹æ³•ï¼Œä»¥åŠå›ºå®šçš„ä¸éœ€è¦å­ç±»å»å®ç°çš„å…·ä½“ç®—æ³•æ­¥éª¤çš„æ¨¡æ¿æ–¹æ³•ã€‚åŸºæœ¬æ–¹æ³•åœ¨æ¨¡æ¿æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬ä¼šæ˜¯ä¸€ä¸ªå…·ä½“çš„ç®—æ³•æ¡†æ¶ï¼Œè°ƒåº¦åŸºæœ¬æ–¹æ³•å®Œæˆæ‰€æœ‰åŠŸèƒ½ã€‚</p><h5 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h5><p>å­ç±»å…·ä½“å®ç°æŠ½è±¡æ¨¡æ¿ä¸­çš„åŸºæœ¬æ–¹æ³•ï¼Œå®Œæˆå¯¹æ¡†æ¶ä¸­çš„ç®—æ³•ç»†èŠ‚è¿›è¡Œé‡æ–°å®šä¹‰ã€‚</p><h4 id="æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹"><a href="#æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹" class="headerlink" title="æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹"></a>æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡ˆä¾‹</h4><p>åœ¨åšæŸä¸ªæŒ‰éœ€æŸ¥è¯¢ä¸åŒç±»åˆ«çš„ç”¨æˆ·ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°OSSä¸Šï¼Œæ¯æ—¥å‘é‚®ä»¶å‘Šè¯‰è¿è¥äººå‘˜ç»“æœçš„ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘å°±ç”¨åˆ°äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚<br>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¨¡æ¿ï¼Œåˆ†åˆ«æœ‰æŸ¥è¯¢ç”¨æˆ·(æ¯å¤©éƒ½ä¸åŒçš„SQL)ï¼Œä¸Šä¼ åˆ°OSSï¼Œå‘é‚®ä»¶ç­‰å‡ ä¸ªæ­¥éª¤ï¼Œå³åŸºæœ¬æ–¹æ³•ã€‚åœ¨æ¨¡æ¿æ–¹æ³•ä¸­å°†è¿™å‡ ä¸ªæ­¥éª¤å°è£…èµ·æ¥ã€‚å®šä¹‰7ä¸ªå­ç±»åˆ†åˆ«å¯¹æ¯å¤©ä¸åŒçš„æŸ¥è¯¢ã€ä¸Šä¼ ã€é‚®ä»¶åšå…·ä½“çš„å®ç°ã€‚æœ€åæ ¹æ®ç­–ç•¥æ¨¡å¼ï¼Œä¸åŒçš„æ˜ŸæœŸè°ƒç”¨ä¸åŒçš„å¯¹è±¡çš„æ¨¡æ¿æ–¹æ³•å®Œæˆæ ¸å¿ƒåŠŸèƒ½ã€‚</p><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä»£ç ç¤ºä¾‹</h4><p>å¦‚å›¾ï¼Œæœ‰ä¸ªåšé¥­çš„æŠ½è±¡æ¨¡æ¿ï¼šå®šä¹‰äº†[æ´—èœ-ç‚’èœ-å®Œæˆ]ä¸‰ä¸ªæ­¥éª¤ä¸ºåŸºæœ¬æ–¹æ³•ï¼Œä¸€ä¸ª<code>ComplateCook</code>æ–¹æ³•å®Œæˆæ­¥éª¤çš„ç»„è£…</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/bb.png" alt="æŠ½è±¡æ¨¡æ¿"></p><p>ä¸€ä¸ªè¥¿çº¢æŸ¿ç‚’è›‹çš„å®ç°ç±»</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/z1.png" alt="å­ç±»1"></p><p>ä¸€ä¸ªé±¼é¦™è‚‰ä¸çš„å®ç°ç±»</p><p><img src="/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/z2.png" alt="å­ç±»2"></p><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CookTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æ­¥éª¤ä¸ºæŠ½è±¡æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">ComplateCook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹åšèœï½"</span>);</span><br><span class="line">        wash();</span><br><span class="line">        cook();</span><br><span class="line">        finish();</span><br><span class="line">        System.out.println(<span class="string">"å®Œæˆåšèœæ­¥éª¤ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XihongshiChaoEgg</span> <span class="keyword">extends</span> <span class="title">CookTemplate</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åˆ‡è¥¿çº¢æŸ¿ï¼Œå‡†å¤‡é¸¡è›‹ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç‚’é¸¡è›‹ï¼Œç„¶åå†ç‚’è¥¿çº¢æŸ¿ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"è¥¿çº¢æŸ¿ç‚’è›‹åšå¥½äº†ï¼Œå‡ºé”…ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YuXiangRose</span> <span class="keyword">extends</span> <span class="title">CookTemplate</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wash</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ´—èƒ¡èåœï½"</span>);</span><br><span class="line">        System.out.println(<span class="string">"åˆ‡è‚‰ä¸ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹åšé±¼é¦™è‚‰ä¸ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"é±¼é¦™è‚‰ä¸åšå¥½äº† å‡ºé”…ï½"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CookTemplate cook = <span class="keyword">new</span> XihongshiChaoEgg();</span><br><span class="line">        cook.ComplateCook();</span><br><span class="line">        cook = <span class="keyword">new</span> YuXiangRose();</span><br><span class="line">        cook.ComplateCook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¼˜ç¼ºç‚¹</h4><ul><li><p>ä¼˜ç‚¹</p><ul><li>å°è£…äº†ä¸å¯å˜çš„éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†</li><li>æä¾›å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤</li><li>å…·ä½“è¡Œä¸ºçˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»åªç®¡è‡ªå·±çš„ç»†èŠ‚å®ç°ï¼Œç¬¦åˆå¼€é—­åŸåˆ™</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½è¦å¢åŠ ä¸€ä¸ªå­ç±»ï¼Œä¼šå¯¼è‡´ä»£ç é‡å¾ˆåºå¤§</li><li>çˆ¶ç±»çš„æ‰§è¡Œç»“æœä¼šå—åˆ°å­ç±»çš„å½±å“ï¼Œåœ¨å¤æ‚ä»£ç çš„é˜…è¯»ä¸­ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥å¾ˆå¤šéº»çƒ¦</li></ul></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€‚ç”¨äºï¼šæœ‰ä¸€ä¸ªå›ºå®šçš„ç®—æ³•æ­¥éª¤ï¼Œä½†æ˜¯ç»†èŠ‚å®ç°å­˜åœ¨å¤šç§å¯èƒ½çš„åœºæ™¯ï¼Œå³æ•´ä½“ç¨³å®šä½†æ˜¯ä¸ªåˆ«æ˜“å˜çš„æ—¶å€™è®²ä¼šå˜åŒ–çš„é‚£ä¸€éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ã€‚<br>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¼ºè°ƒæŠ½è±¡ç±»ä¸å­ç±»ä¹‹é—´çš„åä½œï¼Œå®ƒå°†è°ƒç”¨æƒäº¤ç»™çˆ¶ç±»ï¼Œæ˜¯ä¸€ç§æ§åˆ¶åè½¬çš„è®¾è®¡ç†å¿µã€‚å­ç±»ä¸å†å»å®Œæˆæ ¸å¿ƒçš„åŠŸèƒ½ï¼Œåªéœ€è¦å…³æ³¨å±äºè‡ªå·±çš„é‚£ä¸€éƒ¨åˆ†çš„å®ç°ã€‚</p><hr><ul><li>JDKä¸­ç»å…¸çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®ç°ï¼š<strong>AQS</strong></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190707/ã€è®¾è®¡æ¨¡å¼ã€‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼/fm.png&quot; alt=&quot;å°é¢&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (å…­)ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯</title>
    <link href="http://zhangjiaheng.cn/blog/20190701/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E5%85%AD-%EF%BC%9AExchanger%E7%9A%84%E5%AD%A6%E4%B9%A0%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <id>http://zhangjiaheng.cn/blog/20190701/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å…­-ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯/</id>
    <published>2019-07-01T13:28:39.000Z</published>
    <updated>2019-11-01T01:40:48.244Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨JUCåŒ…ä¸­ï¼Œé™¤äº†ä¸€äº›å¸¸ç”¨çš„æˆ–è€…è¯´å¸¸è§çš„å¹¶å‘å·¥å…·ç±»(ReentrantLockï¼ŒCountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphore)ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å¸¸ç”¨çš„çº¿ç¨‹åŒæ­¥å™¨ç±» â€”â€” Exchangerã€‚<br></p><p>Exchangeræ˜¯é€‚ç”¨åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®äº¤æ¢çš„å¹¶å‘å·¥å…·ç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ‰¾åˆ°ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†åŒæ­¥ç‚¹(<strong>exchangeæ–¹æ³•</strong>)ä¹‹å(<em>æœ‰ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œåˆ°å°±ä¸€ç›´ç­‰å¾…ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´</em>)ï¼Œå°±å°†è‡ªèº«çº¿ç¨‹çš„æ•°æ®ä¸å¯¹æ–¹äº¤æ¢ã€‚</p><a id="more"></a><p><div style="text-align: center" center><a href="javascript:" target="_blank" rel="noopener">Exchangerå·¥å…·ç±»UML</a></div><br><img src="/blog/20190701/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å…­-ï¼šExchangerçš„å­¦ä¹ åŠä½¿ç”¨åœºæ™¯/exc.png" alt="UML"></p><h4 id="Exchangerç±»ç»“æ„"><a href="#Exchangerç±»ç»“æ„" class="headerlink" title="Exchangerç±»ç»“æ„"></a>Exchangerç±»ç»“æ„</h4><p>å¦‚ä¸Šå›¾UNMLï¼ŒExchangerç±»ä¸­æœ‰ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œä¸€ä¸ªNodeï¼Œä¸€ä¸ªParticipantã€‚</p><p>Participantç»§æ‰¿äº†ThreadLocalå¹¶ä¸”é‡å†™äº†å…¶initialValueæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªNodeå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The corresponding thread local class */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Participant</span> <span class="keyword">extends</span> <span class="title">ThreadLocal</span>&lt;<span class="title">Node</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">initialValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Node(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nodeç±»å°è£…äº†ä¸¤ä¸ªçº¿ç¨‹å­˜å‚¨çš„æ•°æ®å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nodes hold partially exchanged data, plus other per-thread</span></span><br><span class="line"><span class="comment"> * bookkeeping. Padded via <span class="doctag">@sun</span>.misc.Contended to reduce memory</span></span><br><span class="line"><span class="comment"> * contention.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> index;              <span class="comment">//  node åœ¨ arena æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">int</span> bound;              <span class="comment">//  äº¤æ¢å™¨çš„æœ€åè®°å½•å€¼ </span></span><br><span class="line">    <span class="keyword">int</span> collides;           <span class="comment">//  è®°å½•çš„ CAS å¤±è´¥æ•°</span></span><br><span class="line">    <span class="keyword">int</span> hash;               <span class="comment">//  ä¼ªéšæœºçš„è‡ªæ—‹æ•°</span></span><br><span class="line">    Object item;            <span class="comment">//  è¿™ä¸ªçº¿ç¨‹çš„æ•°æ®é¡¹</span></span><br><span class="line">    <span class="keyword">volatile</span> Object match;  <span class="comment">//  å¦ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®é¡¹</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread parked; <span class="comment">//  å½“é˜»å¡æ—¶ï¼Œè®¾ç½®æ­¤çº¿ç¨‹ï¼Œä¸é˜»å¡çš„è¯ä¼šè‡ªæ—‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Exchangeræºç åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">exchange</span><span class="params">(V x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    Object v;</span><br><span class="line">    Object item = (x == <span class="keyword">null</span>) ? NULL_ITEM : x; <span class="comment">// translate null args</span></span><br><span class="line">    <span class="keyword">if</span> ((arena != <span class="keyword">null</span> || <span class="comment">// æ˜¯nullå°±æ‰§è¡Œåé¢çš„æ–¹æ³•</span></span><br><span class="line">         (v = slotExchange(item, <span class="keyword">false</span>, <span class="number">0L</span>)) == <span class="keyword">null</span>) &amp;&amp;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰§è¡ŒslotExchangeæœ‰ç»“æœå°±æ‰§è¡Œåé¢çš„ï¼Œå¦åˆ™è¿”å›</span></span><br><span class="line">        ((Thread.interrupted() || <span class="comment">// éä¸­æ–­åˆ™æ‰§è¡Œåé¢çš„æ–¹æ³•</span></span><br><span class="line">          (v = arenaExchange(item, <span class="keyword">false</span>, <span class="number">0L</span>)) == <span class="keyword">null</span>)))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    <span class="keyword">return</span> (v == NULL_ITEM) ? <span class="keyword">null</span> : (V)v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>exchange</code>æ–¹æ³•çš„æ­¥éª¤ï¼š</p><ul><li>å¦‚æœæ‰§è¡ŒslotExchangeæœ‰ç»“æœå°±æ‰§è¡Œåé¢çš„arenaExchange</li><li>å¦‚æœsoltè¢«å ç”¨ï¼Œå°±æ‰§è¡ŒarenaExchange</li><li>è¿”å›çš„æ•°æ®væ˜¯å¯¹æ–¹çº¿ç¨‹çš„æ•°æ®é¡¹</li><li>æ€»ç»“å³ï¼šå¦‚æœAçº¿ç¨‹å…ˆè°ƒç”¨ï¼Œé‚£ä¹ˆAçš„æ•°æ®é¡¹å­˜å‚¨çš„itemä¸­</li><li>åˆ™Bçº¿ç¨‹çš„æ•°æ®é¡¹å­˜å‚¨åœ¨matchä¸­</li><li>å½“æ²¡æœ‰å¤šçº¿ç¨‹å¹¶å‘æ“ä½œ Exchange çš„æ—¶å€™ï¼Œä½¿ç”¨ slotExchange å°±è¶³å¤Ÿäº†ã€‚ slot æ˜¯ä¸€ä¸ª node å¯¹è±¡ã€‚</li><li>å½“å‡ºç°å¹¶å‘äº†ï¼Œä¸€ä¸ª slot å°±ä¸å¤Ÿäº†ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ä¸ª node æ•°ç»„ arena æ“ä½œäº†ã€‚</li></ul><p>â€‹    </p><h4 id="Exchangerçš„ä½¿ç”¨"><a href="#Exchangerçš„ä½¿ç”¨" class="headerlink" title="Exchangerçš„ä½¿ç”¨"></a>Exchangerçš„ä½¿ç”¨</h4><p>ä¸‹é¢çš„ä¾‹å­æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ä¸­æ•°æ®çš„äº¤æ¢ä½¿ç”¨çš„åœºæ™¯ï¼š</p><ul><li>çº¿ç¨‹Aå¾€é˜Ÿåˆ—ä¸­å­˜å…¥æ•°æ®</li><li>çº¿ç¨‹Bä»é˜Ÿåˆ—ä¸­æ¶ˆè€—æ•°æ®</li><li>å½“çº¿ç¨‹Aå­˜æ»¡çš„æ—¶å€™</li><li>æ‰äº¤æ¢ç»™çº¿ç¨‹B</li><li>å½“çº¿ç¨‹Bæ¶ˆè€—å®Œæˆä¹‹åæ‰äº¤æ¢ç»™çº¿ç¨‹Aã€‚</li><li>çº¿ç¨‹Aã€Bçš„ç”Ÿäº§å’Œæ¶ˆè€—çš„é€Ÿç‡æœ‰å¯èƒ½ä¸åŒ</li><li>å¯¹æ–¹çº¿ç¨‹è°ƒç”¨exchangeä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°exchangeä¼šé˜»å¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åœ¨å¯¹æ–¹çº¿ç¨‹è°ƒç”¨exchangeä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°exchangeä¼šé˜»å¡ ç›´åˆ°åŒæ–¹éƒ½è°ƒç”¨exchange */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerStudy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ArrayBlockingQueue&lt;String&gt; initialFillQueue </span><br><span class="line">      = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ArrayBlockingQueue&lt;String&gt; initialEmptyQueue </span><br><span class="line">      = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Exchanger&lt;ArrayBlockingQueue&lt;String&gt;&gt; exchanger </span><br><span class="line">      = <span class="keyword">new</span> Exchanger&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** å¡«å……ç¼“å­˜é˜Ÿåˆ—çš„çº¿ç¨‹ */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FillingRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ArrayBlockingQueue&lt;String&gt; current = initialEmptyQueue;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">          String str = StrUtil.uuid();</span><br><span class="line">          System.out.println(<span class="string">"ç”Ÿäº§äº†ä¸€ä¸ªåºåˆ—ï¼š"</span> + str + <span class="string">"&gt;&gt;&gt;&gt;&gt;åŠ å…¥åˆ°äº¤æ¢åŒº"</span>);</span><br><span class="line">          Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            current.add(str);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"é˜Ÿåˆ—å·²æ»¡ï¼Œæ¢ä¸€ä¸ªç©ºçš„"</span>);</span><br><span class="line">            current = exchanger.exchange(current);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/** å¡«å……ç¼“å­˜é˜Ÿåˆ—çš„çº¿ç¨‹ */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmptyingRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ArrayBlockingQueue&lt;String&gt; current = initialFillQueue;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!current.isEmpty()) &#123;</span><br><span class="line">            String str = current.poll();</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆè€—ä¸€ä¸ªæ•°åˆ—ï¼š"</span> + str);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"é˜Ÿåˆ—ç©ºäº†ï¼Œæ¢ä¸ªæ»¡çš„"</span>);</span><br><span class="line">            current = exchanger.exchange(current);</span><br><span class="line">            System.out.println(<span class="string">"æ¢æ»¡çš„æˆåŠŸ~~~~~~~~~~~~~~~~~~~~~~"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> FillingRunnable()).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> EmptyingRunnable()).start();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><blockquote><p><a href="https://juejin.im/post/5ae7554ff265da0b86360880" target="_blank" rel="noopener">&gt;&gt;&gt;&gt;&gt; æ›´è¯¦ç»†çš„æºç è§£æ - æ˜é‡‘</a></p></blockquote><p><img src="https://user-gold-cdn.xitu.io/2018/5/1/16317a536c642f7c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="ç»“å°¾"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;åœ¨JUCåŒ…ä¸­ï¼Œé™¤äº†ä¸€äº›å¸¸ç”¨çš„æˆ–è€…è¯´å¸¸è§çš„å¹¶å‘å·¥å…·ç±»(ReentrantLockï¼ŒCountDownLatchï¼ŒCyclicBarrierï¼ŒSemaphore)ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å¸¸ç”¨çš„çº¿ç¨‹åŒæ­¥å™¨ç±» â€”â€” Exchangerã€‚&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Exchangeræ˜¯é€‚ç”¨åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®äº¤æ¢çš„å¹¶å‘å·¥å…·ç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ‰¾åˆ°ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†åŒæ­¥ç‚¹(&lt;strong&gt;exchangeæ–¹æ³•&lt;/strong&gt;)ä¹‹å(&lt;em&gt;æœ‰ä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œåˆ°å°±ä¸€ç›´ç­‰å¾…ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç­‰å¾…è¶…æ—¶æ—¶é—´&lt;/em&gt;)ï¼Œå°±å°†è‡ªèº«çº¿ç¨‹çš„æ•°æ®ä¸å¯¹æ–¹äº¤æ¢ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Exchanger" scheme="http://zhangjiaheng.cn/tags/Exchanger/"/>
    
      <category term="çº¿ç¨‹äº¤æ¢å™¨" scheme="http://zhangjiaheng.cn/tags/%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%8D%A2%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (äº”)ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹</title>
    <link href="http://zhangjiaheng.cn/blog/20190623/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E4%BA%94-%EF%BC%9ASemaphore%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/"/>
    <id>http://zhangjiaheng.cn/blog/20190623/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äº”-ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹/</id>
    <published>2019-06-23T12:27:19.000Z</published>
    <updated>2019-11-01T01:40:48.241Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190623/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äº”-ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹/fm.png" alt></p><a id="more"></a><h3 id="SemaphoreåŒæ­¥å·¥å…·ç±»ä¹‹ä¿¡å·é‡ä»‹ç»"><a href="#SemaphoreåŒæ­¥å·¥å…·ç±»ä¹‹ä¿¡å·é‡ä»‹ç»" class="headerlink" title="SemaphoreåŒæ­¥å·¥å…·ç±»ä¹‹ä¿¡å·é‡ä»‹ç»"></a>SemaphoreåŒæ­¥å·¥å…·ç±»ä¹‹ä¿¡å·é‡ä»‹ç»</h3><h4 id="ä»€ä¹ˆæ˜¯Semaphore"><a href="#ä»€ä¹ˆæ˜¯Semaphore" class="headerlink" title="ä»€ä¹ˆæ˜¯Semaphore"></a>ä»€ä¹ˆæ˜¯Semaphore</h4><ul><li>Semaphoreæ˜¯JUCåŒ…ä¸­çš„ä¸€ä¸ªå¾ˆç®€å•çš„å·¥å…·ç±»ï¼Œç”¨æ¥å®ç°å¤šçº¿ç¨‹ä¸‹å¯¹äºèµ„æºçš„åŒä¸€æ—¶åˆ»çš„è®¿é—®çº¿ç¨‹æ•°é™åˆ¶</li><li>Semaphoreä¸­å­˜åœ¨ä¸€ä¸ªã€è®¸å¯ã€‘çš„æ¦‚å¿µï¼Œå³è®¿é—®èµ„æºä¹‹å‰ï¼Œå…ˆè¦è·å¾—è®¸å¯ï¼Œå¦‚æœå½“å‰è®¸å¯æ•°é‡ä¸º0ï¼Œé‚£ä¹ˆçº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°è·å¾—è®¸å¯</li><li>Semaphoreå†…éƒ¨ä½¿ç”¨AQSå®ç°ï¼Œç”±æŠ½è±¡å†…éƒ¨ç±»Syncç»§æ‰¿äº†AQSã€‚å› ä¸ºSemaphoreå¤©ç”Ÿå°±æ˜¯å…±äº«çš„åœºæ™¯ï¼Œæ‰€ä»¥å…¶å†…éƒ¨å®é™…ä¸Šç±»ä¼¼äºå…±äº«é”çš„å®ç°ã€‚</li><li>Semaphoreæœºåˆ¶æ˜¯æä¾›ç»™çº¿ç¨‹æŠ¢å å¼è·å–è®¸å¯ï¼Œæ‰€ä»¥ä»–å¯ä»¥å®ç°å…¬å¹³æˆ–è€…éå…¬å¹³ï¼Œç±»ä¼¼äºReentrantLockã€‚</li><li>Semaphoreæä¾›ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œç”¨æ¥ä¼ å…¥è®¸å¯æ•°é‡ä»¥åŠå…¬å¹³æˆ–è€…éå…¬å¹³ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">boolean</span> fair)</span> </span>&#123;</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> FairSync(permits) : <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Semaphoreçš„ä½¿ç”¨åœºæ™¯"><a href="#Semaphoreçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Semaphoreçš„ä½¿ç”¨åœºæ™¯"></a>Semaphoreçš„ä½¿ç”¨åœºæ™¯</h4><ul><li>é™æµï¼šå¹¶å‘ç¯å¢ƒ(ä¾‹å¦‚æœ‰1000ä¸ªçº¿ç¨‹)ä¸‹åªå…è®¸100ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®åº“æŸèµ„æº</li><li>äº¦ä¾‹å¦‚å®é™…çš„ï¼Œåœè½¦åœºåªæœ‰10ä¸ªè½¦ä½ï¼Œç›®å‰æœ‰15ä¸ªæ±½è½¦è¦æ¥åœè½¦ï¼Œå¤šå‡ºçš„5ä¸ªéœ€è¦ç­‰å…¶ä»–è½¦è¾†ç¦»å¼€ä¹‹åæ‰èƒ½è¿›è¡Œåœè½¦</li></ul><h3 id="Semaphoreæºç è§£è¯»"><a href="#Semaphoreæºç è§£è¯»" class="headerlink" title="Semaphoreæºç è§£è¯»"></a>Semaphoreæºç è§£è¯»</h3><p>åˆ†ä¸ºå…¬å¹³ä¸éå…¬å¹³</p><h4 id="è·å–è®¸å¯çš„éå…¬å¹³çš„å®ç°"><a href="#è·å–è®¸å¯çš„éå…¬å¹³çš„å®ç°" class="headerlink" title="è·å–è®¸å¯çš„éå…¬å¹³çš„å®ç°"></a>è·å–è®¸å¯çš„éå…¬å¹³çš„å®ç°</h4><p>åœ¨æŠ½è±¡ç±»Syncä¸­å®ç°äº†éå…¬å¹³çš„æ¶ˆè€—â€œè®¸å¯â€çš„æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">nonfairTryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> available = getState();</span><br><span class="line">        <span class="keyword">int</span> remaining = available - acquires;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt; <span class="number">0</span> ||</span><br><span class="line">        compareAndSetState(available, remaining))</span><br><span class="line">        <span class="keyword">return</span> remaining;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>é¦–å…ˆè·å–å½“å‰è®¸å¯æ•°é‡</p></li><li><p>åˆ¤æ–­æ¶ˆè€—è®¸å¯ä¹‹åçš„å‰©ä½™æ•°é‡æ˜¯å¦&gt;=0</p></li><li><p>æ˜¯çš„è¯æ‰§è¡Œ<code>compareAndSetState(available, remaining)</code>è®¾ç½®è®¸å¯ä¹‹åè¿”å›</p></li><li><p>å¦åˆ™è¿”å›çš„è´Ÿæ•°ä¼šä½¿å¾—å…¶åœ¨<code>doAcquireSharedInterruptibly</code>ä¸­ç­‰å¾…è®¸å¯å¹¶æŒ‚èµ·ï¼Œç›´åˆ°è¢«å”¤é†’(è¿™æ­¥éª¤åœ¨AQSä¸­å®ç°ï¼Œå¦‚ä¸‹)</p></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    <span class="comment">//è·å–è®¸å¯å¤±è´¥ï¼Œå°†çº¿ç¨‹åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">    doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–è®¸å¯çš„å…¬å¹³å®ç°"><a href="#è·å–è®¸å¯çš„å…¬å¹³å®ç°" class="headerlink" title="è·å–è®¸å¯çš„å…¬å¹³å®ç°"></a>è·å–è®¸å¯çš„å…¬å¹³å®ç°</h4><p>é¦–å…ˆä¼šåœ¨è·å–è®¸å¯ä¹‹å‰ï¼Œåˆ¤æ–­<code>hasQueuedPredecessors()</code>ï¼Œæ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…è®¸å¯ï¼Œæœ‰çš„è¯ç›´æ¥è¿”å›-1ï¼Œè¿™ä¸ªåº•å±‚å®ç°åœ¨AQSä¸­å·²ç»å®ç°å¥½äº†ã€‚æ¥ä¸‹æ¥å‰©ä¸‹çš„æ“ä½œå°±å’Œéå…¬å¹³çš„åŸºæœ¬ä¸€è‡´äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2014338818796000944L</span>;</span><br><span class="line"></span><br><span class="line">    FairSync(<span class="keyword">int</span> permits) &#123;</span><br><span class="line">        <span class="keyword">super</span>(permits);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hasQueuedPredecessors())</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> available = getState();</span><br><span class="line">            <span class="keyword">int</span> remaining = available - acquires;</span><br><span class="line">            <span class="keyword">if</span> (remaining &lt; <span class="number">0</span> ||</span><br><span class="line">                compareAndSetState(available, remaining))</span><br><span class="line">                <span class="keyword">return</span> remaining;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">hasQueuedPredecessors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// The correctness of this depends on head being initialized</span></span><br><span class="line">    <span class="comment">// before tail and on head.next being accurate if the current</span></span><br><span class="line">    <span class="comment">// thread is first in queue.</span></span><br><span class="line">    Node t = tail; <span class="comment">// Read fields in reverse initialization order</span></span><br><span class="line">    Node h = head;</span><br><span class="line">    Node s;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¤´èŠ‚ç‚¹ä¸ç­‰äºå°¾èŠ‚ç‚¹å¹¶ä¸”ï¼ˆå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…å…¶ä¸ºå½“å‰çº¿ç¨‹ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> h != t &amp;&amp;</span><br><span class="line">        ((s = h.next) == <span class="keyword">null</span> || s.thread != Thread.currentThread());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¸å¯çš„é‡Šæ”¾"><a href="#è®¸å¯çš„é‡Šæ”¾" class="headerlink" title="è®¸å¯çš„é‡Šæ”¾"></a>è®¸å¯çš„é‡Šæ”¾</h4><p>è®¸å¯çš„é‡Šæ”¾å¯¹äºå…¬å¹³å’Œéå…¬å¹³çš„å®ç°éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå®šä¹‰åœ¨Syncç±»ä¸­ã€‚å› ä¸ºæ˜¯å…±äº«å¼çš„ï¼Œé‡Šæ”¾çš„æ—¶å€™æ²¡æœ‰åƒReentrantLockä¸€æ ·å»åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹æ¥é‡Šæ”¾è®¸å¯ã€‚é‡Šæ”¾è®¸å¯ä¹Ÿæ˜¯é‡‡ç”¨åŸå­æ“ä½œå°†éœ€è¦é‡Šæ”¾çš„è®¸å¯åŠ å›å»å°±å®Œæˆäº†ã€‚</p><p>ä¸€æ—¦çº¿ç¨‹è°ƒç”¨<code>releaseShared</code>é‡Šæ”¾è®¸å¯æˆåŠŸï¼Œå°±ä¼šåŒæ—¶è°ƒç”¨<code>doReleaseShared</code>æ–¹æ³•ï¼Œå…¶ä¸­ä¼šå¯¹é˜»å¡çš„çº¿ç¨‹è¿›è¡Œç¯å‹ï¼Œä¸‹é¢æ˜¯<code>tryReleaseShared</code>çš„æºç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°å½“å‰çš„è®¸å¯æ•°é‡</span></span><br><span class="line">        <span class="keyword">int</span> current = getState();</span><br><span class="line">        <span class="comment">// åŠ ä¸Šè¿˜å›æ¥çš„è®¸å¯</span></span><br><span class="line">        <span class="keyword">int</span> next = current + releases;</span><br><span class="line">        <span class="keyword">if</span> (next &lt; current) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum permit count exceeded"</span>);</span><br><span class="line">        <span class="comment">// åŸå­æ“ä½œ å½’è¿˜è®¸å¯</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(current, next))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‡å°‘è®¸å¯æ•°é‡ä»¥åŠå°†å‰©ä½™è®¸å¯æ•°é‡éƒ½å–èµ°"><a href="#å‡å°‘è®¸å¯æ•°é‡ä»¥åŠå°†å‰©ä½™è®¸å¯æ•°é‡éƒ½å–èµ°" class="headerlink" title="å‡å°‘è®¸å¯æ•°é‡ä»¥åŠå°†å‰©ä½™è®¸å¯æ•°é‡éƒ½å–èµ°"></a>å‡å°‘è®¸å¯æ•°é‡ä»¥åŠå°†å‰©ä½™è®¸å¯æ•°é‡éƒ½å–èµ°</h4><p>Semaphoreè¿˜æä¾›äº†å‡ ä¸ªé¢å¤–çš„æ“ä½œè®¸å¯çš„æ–¹æ³•</p><ul><li><p>å‡å°‘è®¸å¯æ•°é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">reducePermits</span><span class="params">(<span class="keyword">int</span> reductions)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> current = getState();</span><br><span class="line">        <span class="keyword">int</span> next = current - reductions;</span><br><span class="line">        <span class="keyword">if</span> (next &gt; current) <span class="comment">// underflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Permit count underflow"</span>);</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(current, next))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å–èµ°å‰©ä½™å…¨éƒ¨è®¸å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">drainPermits</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> current = getState();</span><br><span class="line">        <span class="keyword">if</span> (current == <span class="number">0</span> || compareAndSetState(current, <span class="number">0</span>))</span><br><span class="line">            <span class="keyword">return</span> current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å®é™…ä½¿ç”¨ä¿¡å·é‡çš„ä»£ç å®ä¾‹"><a href="#å®é™…ä½¿ç”¨ä¿¡å·é‡çš„ä»£ç å®ä¾‹" class="headerlink" title="å®é™…ä½¿ç”¨ä¿¡å·é‡çš„ä»£ç å®ä¾‹"></a>å®é™…ä½¿ç”¨ä¿¡å·é‡çš„ä»£ç å®ä¾‹</h3><p>å¦‚ä¸‹ï¼šä½¿ç”¨ä¿¡å·é‡åšäº†ä¸€ä¸ªé™æµçš„åŠŸèƒ½ã€‚</p><p>åœ¨1000ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡é™åˆ¶åªæœ‰100ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreStudy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¸å¯çš„æ•°é‡</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> N = <span class="number">100</span>;</span><br><span class="line">  <span class="comment">// çº¿ç¨‹æ•°é‡</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> M = <span class="number">1000</span>;</span><br><span class="line">  <span class="comment">// è·å–è®¸å¯å¤±è´¥çš„æ¬¡æ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger F = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">  <span class="comment">// è·å–è®¸å¯æˆåŠŸçš„æ¬¡æ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger S = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">  <span class="comment">// å£°æ˜è®¸å¯</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Semaphore store = <span class="keyword">new</span> Semaphore(N);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> BrokenBarrierException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ …æ æ¨¡æ‹Ÿ1000å¹¶å‘</span></span><br><span class="line">    CyclicBarrier BARRIER = <span class="keyword">new</span> CyclicBarrier(M + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    ExecutorService pool = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M; i++) &#123;</span><br><span class="line">      pool.execute(</span><br><span class="line">          () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              BARRIER.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            getData();</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"ç­‰å¾…2ç§’æ‰§è¡Œå¹¶å‘1000çº¿ç¨‹"</span>);</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="comment">// ç­‰å¾…ä¸¤ç§’åæ‰“å¼€æ …æ  å¹¶å‘è·å–æ•°æ®å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">    BARRIER.await();</span><br><span class="line">    pool.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** æ¨¡æ‹Ÿè·å–æ•°æ®æˆ–è€…ä¸šåŠ¡å¤„ç† */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!store.tryAcquire()) &#123;</span><br><span class="line">      <span class="keyword">int</span> a = <span class="number">5000</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>);</span><br><span class="line">      System.out.println(<span class="string">"æ²¡æœ‰å¯ç”¨èµ„æºï¼Œç­‰å¾…ä¸€å°ä¼šå„¿: "</span> + a + <span class="string">"ï¼Œç›®å‰ï¼š"</span> + F.incrementAndGet());</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(a);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"æˆåŠŸæ‹¿åˆ°èµ„æº"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    store.release();</span><br><span class="line">    System.out.println(<span class="string">"é‡Šæ”¾èµ„æºï¼Œç°åœ¨ï¼š"</span> + S.incrementAndGet());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190623/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äº”-ï¼šSemaphoreæºç å­¦ä¹ åŠä½¿ç”¨æ¡ˆä¾‹/fm.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="Semaphore" scheme="http://zhangjiaheng.cn/tags/Semaphore/"/>
    
      <category term="ä¿¡å·é‡" scheme="http://zhangjiaheng.cn/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (å››)ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± </title>
    <link href="http://zhangjiaheng.cn/blog/20190617/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E5%9B%9B-%EF%BC%9A%E7%90%86%E8%A7%A3ThreadPoolExecutor%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <id>http://zhangjiaheng.cn/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /</id>
    <published>2019-06-17T06:19:07.000Z</published>
    <updated>2019-11-01T01:40:48.245Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /xcc.png" alt="çº¿ç¨‹æ± "></p><a id="more"></a><h3 id="å‰è¨€ï¼šå…³äºThreadPoolExecutor"><a href="#å‰è¨€ï¼šå…³äºThreadPoolExecutor" class="headerlink" title="å‰è¨€ï¼šå…³äºThreadPoolExecutor"></a>å‰è¨€ï¼šå…³äºThreadPoolExecutor</h3><p><strong>ThreadPoolExecutor</strong>å³æˆ‘ä»¬å¸¸è¯´çš„çº¿ç¨‹æ± ã€‚ã€Šé˜¿é‡Œå·´å·´Javaæ‰‹å†Œã€‹ä¸­å¯¹äºçº¿ç¨‹æ± çš„ä½¿ç”¨è§„å®šå¦‚ä¸‹ï¼š</p><blockquote><p><strong>3.ã€å¼ºåˆ¶ã€‘çº¿ç¨‹èµ„æºå¿…é¡»é€šè¿‡çº¿ç¨‹æ± æä¾›ï¼Œä¸å…è®¸åœ¨åº”ç”¨ä¸­è‡ªè¡Œæ˜¾ç¤ºåˆ›å»ºçº¿ç¨‹ã€‚</strong><br><br><strong>è¯´æ˜ï¼šä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€èŠ±çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€ï¼Œè§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½é€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡çš„åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€…â€œè¿‡åº¦åˆ‡æ¢â€çš„é—®é¢˜â€‹</strong></p></blockquote><h3 id="ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„"><a href="#ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„"></a>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„</h3><h4 id="ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¯ä»¥"><a href="#ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¯ä»¥" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¯ä»¥"></a>ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¯ä»¥</h4><ul><li>é¿å…åœ¨åº”ç”¨ä¸­é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹</li><li>ä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å¯ä»¥å¤ç”¨CPUèµ„æº</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</li></ul><h3 id="ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©"><a href="#ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©"></a>ä½¿ç”¨çº¿ç¨‹æ± çš„é£é™©</h3><h4 id="çº¿ç¨‹é¥¥é¥¿æ­»é”"><a href="#çº¿ç¨‹é¥¥é¥¿æ­»é”" class="headerlink" title="çº¿ç¨‹é¥¥é¥¿æ­»é”"></a>çº¿ç¨‹é¥¥é¥¿æ­»é”</h4><p>çº¿ç¨‹æ± ä¸ºâ€œæ­»é”â€è¿™ä¸€æ¦‚å¿µå¸¦æ¥äº†ä¸€ç§æ–°çš„å¯èƒ½ï¼šçº¿ç¨‹é¥¥é¥¿æ­»é”ã€‚åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡å°†å¦ä¸€ä¸ªä»»åŠ¡æäº¤åˆ°åŒä¸€ä¸ªExecutorï¼Œé‚£ä¹ˆé€šå¸¸ä¼šå¼•å‘æ­»é”ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹åœç•™åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ç­‰å¾…ç¬¬ä¸€ä¸ªæäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡åˆæ— æ³•æ‰§è¡Œå®Œæˆï¼Œå› ä¸ºå®ƒåœ¨ç­‰å¾…ç¬¬äºŒä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class MyThreadPoolDeadLock &#123;</span><br><span class="line">    static ExecutorService singlePool = Executors.newSingleThreadExecutor();</span><br><span class="line">    static class MyTask implements Callable&lt;String&gt; &#123;</span><br><span class="line">        String name;</span><br><span class="line">        public MyTask(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public String call() throws Exception &#123;</span><br><span class="line">            Future&lt;String&gt; inner = singlePool.submit(new MyTask(&quot;inner&quot;));</span><br><span class="line">            return inner.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        Future&lt;String&gt; result = singlePool.submit(new MyTask(&quot;outer&quot;));</span><br><span class="line">        System.out.println(result.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨æ›´å¤§çš„çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½ç”±äºç­‰å¾…å…¶ä»–ä»å¤„äºå·¥ä½œé˜Ÿåˆ—çš„ä»»åŠ¡è€Œé˜»å¡ï¼Œé‚£ä¹ˆä¼šå‘ç”ŸåŒæ ·çš„é—®é¢˜ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºçº¿ç¨‹é¥¥é¥¿æ­»é”ã€‚</p><h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p>é™¤äº†Thread å¯¹è±¡æ‰€éœ€çš„å†…å­˜ä¹‹å¤–ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ä¸¤ä¸ªå¯èƒ½å¾ˆå¤§çš„æ‰§è¡Œè°ƒç”¨å †æ ˆã€‚é™¤æ­¤ä»¥å¤–ï¼ŒJVM å¯èƒ½ä¼šä¸ºæ¯ä¸ª Java çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæœ¬æœºçº¿ç¨‹ï¼Œè¿™äº›æœ¬æœºçº¿ç¨‹å°†æ¶ˆè€—é¢å¤–çš„ç³»ç»Ÿèµ„æºã€‚å¦‚æœçº¿ç¨‹æ± çš„å¤§å°è®¾ç½®çš„ä¸åˆç†å°±ä¼šæœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºçš„é£é™©ã€‚è¿˜æœ‰å°±æ˜¯Javaé¢„ç½®çº¿ç¨‹æ± FixedThreadPool å’Œ SingleThreadPoolä¸­çš„é˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ— ç•Œé˜Ÿåˆ—ï¼Œæœ€å¤šå¯ä»¥ä¿å­˜2147483647ä¸ªä»»åŠ¡ï¼Œå¦‚æœä»£ç ç¼–å†™ä¸ä¸¥è°¨å°±ä¼šå †ç§¯å¤§é‡è¯·æ±‚å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p><h4 id="çº¿ç¨‹æ³„æ¼"><a href="#çº¿ç¨‹æ³„æ¼" class="headerlink" title="çº¿ç¨‹æ³„æ¼"></a>çº¿ç¨‹æ³„æ¼</h4><p>å„ç§çº¿ç¨‹æ± éƒ½ä¼šå¯¼è‡´ä¸€ç§é—®é¢˜å°±æ˜¯çº¿ç¨‹æ³„æ¼ã€‚å½“ä»çº¿ç¨‹æ± å–å‡ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¦‚æœä»»åŠ¡æŠ›å‡ºRuntimeException æˆ–ä¸€ä¸ªErrorè€Œæœªæ•è·å¼‚å¸¸æ—¶ï¼Œé‚£ä¹ˆçº¿ç¨‹åªä¼šé€€å‡ºè€Œçº¿ç¨‹æ± çš„å¤§å°å°†æ°¸è¿œå‡å°‘ä¸€ä¸ªï¼Œå½“è¿™ç§æƒ…å†µå‘ç”Ÿå¤šæ¬¡æ—¶ï¼Œçº¿ç¨‹æ± æœ€ç»ˆå°±ä¼šä¸ºç©ºå¹¶ä¸”å› ä¸ºæ²¡æœ‰å¯ç”¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚</p><h3 id="å¦‚æœè¦è‡ªå·±å®ç°çº¿ç¨‹æ± éœ€è¦å…³æ³¨å“ªäº›ç‚¹"><a href="#å¦‚æœè¦è‡ªå·±å®ç°çº¿ç¨‹æ± éœ€è¦å…³æ³¨å“ªäº›ç‚¹" class="headerlink" title="å¦‚æœè¦è‡ªå·±å®ç°çº¿ç¨‹æ± éœ€è¦å…³æ³¨å“ªäº›ç‚¹"></a>å¦‚æœè¦è‡ªå·±å®ç°çº¿ç¨‹æ± éœ€è¦å…³æ³¨å“ªäº›ç‚¹</h3><ul><li>é¦–å…ˆè¦æœ‰ä¸€ä¸ªå­˜æ”¾çº¿ç¨‹çš„å®¹å™¨å¹¶è®¾ç½®å®¹é‡</li><li>è¿˜éœ€è¦ä¸€ä¸ªå­˜æ”¾ç”¨æˆ·æäº¤çš„ä»»åŠ¡çš„å®¹å™¨ï¼Œé˜»å¡é˜Ÿåˆ—ï¼Œæœ‰ç•Œè¿˜æ˜¯æ— ç•Œ</li><li>çº¿ç¨‹æ± åˆ›å»ºçš„æ—¶å€™éœ€è¦å°†æŒ‡å®šæ•°é‡çš„çº¿ç¨‹å¯åŠ¨</li><li>ç”¨æˆ·æäº¤ä»»åŠ¡çš„æ—¶å€™å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹å¦‚ä½•åˆ›å»ºçº¿ç¨‹å¹¶æ”¾å…¥çº¿ç¨‹æ± </li><li>çº¿ç¨‹æ•°é‡è¿œå¤§äºç”¨æˆ·æäº¤çš„ä»»åŠ¡æ•°é‡éœ€è¦æœ‰ä¸€ä¸ªå›æ”¶çº¿ç¨‹çš„æœºåˆ¶</li><li>çº¿ç¨‹å…¨éƒ¨åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™å­˜æ”¾çš„ä»»åŠ¡éœ€è¦ç­‰å¾…è¿˜æ˜¯æ€æ ·æˆ–è€…å†æ–°åŠ å…¥ä»»åŠ¡æ—¶è¦æä¾›ä¸€ä¸ªé¥±å’Œç­–ç•¥</li></ul><h3 id="ThreadPoolExecutoræ„é€ å‡½æ•°å‚æ•°æ„ä¹‰"><a href="#ThreadPoolExecutoræ„é€ å‡½æ•°å‚æ•°æ„ä¹‰" class="headerlink" title="ThreadPoolExecutoræ„é€ å‡½æ•°å‚æ•°æ„ä¹‰"></a>ThreadPoolExecutoræ„é€ å‡½æ•°å‚æ•°æ„ä¹‰</h3><p><img src="/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /gzhs.png" alt="æ„é€ å‡½æ•°"><br>ThreadPoolExecutoræä¾›äº†å››ç§æ„é€ å‡½æ•°ï¼Œæ€»å…±æœ‰å¦‚ä¸‹å‡ ç§å‚æ•°ï¼Œæ„ä¹‰ä¸ºï¼š</p><ul><li><code>int corePoolSize</code>: æ ¸å¿ƒçº¿ç¨‹æ•°çš„å¤§å°ï¼Œåœ¨çº¿ç¨‹æ± åˆ›å»ºçš„æ—¶å€™å°±ä¼šåˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹å¾…å‘½ï¼Œç”¨æˆ·æäº¤ä»»åŠ¡ä¹‹åç«‹å³å¼€å§‹æ‰§è¡Œä»»åŠ¡</li><li><code>int maximumPoolSize</code>: æœ€å¤§çº¿ç¨‹æ•°çš„å¤§å°ï¼Œå³æœ€å¤šä¼šåˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œå½“è¶…è¿‡è¿™ä¸ªæ•°ç›®çš„æ—¶å€™å¯èƒ½ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åå›æ”¶å¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹</li><li><code>long keepAliveTime</code>: çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œæ˜¯ç›¸å¯¹äºæ ¸å¿ƒçº¿ç¨‹æ•°æ¥è®²çš„ã€‚æ²¡æœ‰è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°çš„ä¼šä¸€ç›´å­˜æ´»çš„ã€‚è¶…è¿‡çš„æ‰æœ‰å­˜æ´»æ—¶é—´çš„é™åˆ¶</li><li><code>TimeUnit unit</code>: æ—¶é—´å•ä½</li><li><code>BlockingQueue&lt;Runnable&gt; workQueue</code>: é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·æäº¤çš„ä»»åŠ¡ã€‚ç³»ç»Ÿé¢„ç½®çš„çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—ä¸€èˆ¬éƒ½æ˜¯æ— ç•Œçš„LinkBlockingQueueï¼Œä½†æ˜¯å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå¯¹äºéå¸¸å¤§æˆ–è€…æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥ç§»äº¤é˜Ÿåˆ—æ§åˆ¶é¿å…æ’é˜Ÿï¼Œç›´æ¥å°†ä»»åŠ¡ä»ç”Ÿäº§è€…ç§»äº¤åˆ°å·¥ä½œè€…çº¿ç¨‹ã€‚</li><li><code>ThreadFactory threadFactory</code>: çº¿ç¨‹å·¥å‚æ¥å£ã€‚åªæœ‰ä¸€ä¸ªnewThreadæ–¹æ³•ã€‚ä¾¿äºç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€è¦å®ç°è‡ªå·±çš„çº¿ç¨‹åˆ›å»ºæœºåˆ¶ã€‚</li><li><code>RejectedExecutionHandler handler</code>: é¥±å’Œç­–ç•¥ã€‚é»˜è®¤å››ç§ï¼Œåœ¨ä¸‹é¢è®²è§£ã€‚</li></ul><h3 id="å‡ ç§é»˜è®¤çš„é¥±å’Œç­–ç•¥"><a href="#å‡ ç§é»˜è®¤çš„é¥±å’Œç­–ç•¥" class="headerlink" title="å‡ ç§é»˜è®¤çš„é¥±å’Œç­–ç•¥"></a>å‡ ç§é»˜è®¤çš„é¥±å’Œç­–ç•¥</h3><p>å½“æœ‰ç•Œé˜Ÿåˆ—è¢«å¡«æ»¡åï¼Œç”¨æˆ·åˆ›å»ºçš„ä»»åŠ¡æ— æ³•å†æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ä¿å­˜ï¼Œé¥±å’Œç­–ç•¥å¼€å§‹å‘æŒ¥ä½œç”¨ã€‚å¦‚æœæŸä¸ªä»»åŠ¡è¢«æäº¤åˆ°å·²å…³é—­çš„Executorsæ—¶ï¼Œé¥±å’Œç­–ç•¥ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚é¥±å’Œç­–ç•¥çš„å®ç°éœ€è¦å®ç°æ¥å£<code>RejectedExecutionHandler</code>ã€‚<br><img src="/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /bhcl.png" alt="å››ç§é»˜è®¤çš„é¥±å’Œç­–ç•¥"><br>å¦‚ä¸Šï¼Œåœ¨ThreadPoolExecutorç±»ä¸­æœ‰å››ä¸ªå†…éƒ¨ç±»å®ç°äº†<code>RejectedExecutionHandler</code>æ¥å£ã€‚åˆ†åˆ«æ˜¯:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static class AbortPolicy implements RejectedExecutionHandler &#123;...&#125;</span><br><span class="line">public static class DiscardPolicy implements RejectedExecutionHandler &#123;...&#125;</span><br><span class="line">public static class DiscardOldestPolicy implements RejectedExecutionHandler &#123;...&#125;</span><br><span class="line">public static class CallerRunsPolicy implements RejectedExecutionHandler &#123;...&#125;</span><br></pre></td></tr></table></figure></p><h4 id="AbortPolicy"><a href="#AbortPolicy" class="headerlink" title="AbortPolicy"></a>AbortPolicy</h4><p>â€œä¸­æ­¢â€ç­–ç•¥æ˜¯é»˜è®¤çš„é¥±å’Œç­–ç•¥ï¼Œè¯¥ç­–ç•¥å°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<code>RejectedExecutionException</code>ï¼Œè°ƒç”¨è€…å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ç„¶åç¼–å†™è‡ªå·±çš„ä¸šåŠ¡ä»£ç ã€‚</p><h4 id="DiscardPolicy"><a href="#DiscardPolicy" class="headerlink" title="DiscardPolicy"></a>DiscardPolicy</h4><p>â€œæŠ›å¼ƒâ€ç­–ç•¥ä¼šåœ¨æ–°æäº¤çš„ä»»åŠ¡æ— æ³•ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œæ—¶å°†å…¶æŠ›å¼ƒæ‰ã€‚</p><h4 id="DiscardOldestPolicy"><a href="#DiscardOldestPolicy" class="headerlink" title="DiscardOldestPolicy"></a>DiscardOldestPolicy</h4><p>åŒâ€œæŠ›å¼ƒâ€ç­–ç•¥ï¼Œè¿™ç§ç­–ç•¥ä¼šå°†å³å°†æ‰§è¡Œçš„é‚£ä¸ªä»»åŠ¡æŠ›å¼ƒæ‰ï¼Œå³æŠ›å¼ƒæœ€è€çš„ä»»åŠ¡ç„¶åå°è¯•æäº¤æ–°çš„ä»»åŠ¡ã€‚å¦‚æœå·¥ä½œé˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯ä¼˜å…ˆé˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡è¢«æŠ›å¼ƒï¼Œ<strong>æ…ç”¨</strong>ï¼</p><h4 id="CallerRunsPolicy"><a href="#CallerRunsPolicy" class="headerlink" title="CallerRunsPolicy"></a>CallerRunsPolicy</h4><p>â€œè°ƒç”¨è€…æ‰§è¡Œâ€ç­–ç•¥å³åœ¨é˜Ÿåˆ—æ»¡çš„æ—¶å€™ç”±è°ƒç”¨è€…å»æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ä¸ä¼šåœ¨çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ–°çš„ä»»åŠ¡ã€‚</p><blockquote><p>ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºè°ƒä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™å°½é‡ä½¿ç”¨ThreadPoolExecutorï¼Œç›®çš„åœ¨äºè®©ç¨‹åºå‘˜æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶ï¼Œå®é™…ä¸šåŠ¡ä¸­ä¸å¯èƒ½åœ¨ä»»åŠ¡æ»¡æ—¶å°†ä»»åŠ¡æŠ›å¼ƒæ‰ï¼Œæ‰€ä»¥å®ç°è‡ªå·±çš„é¥±å’Œç­–ç•¥æ˜¯æœ‰å¿…è¦çš„ã€‚</p></blockquote><h3 id="Javaé¢„ç½®çº¿ç¨‹æ± åŠå…¶ä½¿ç”¨åœºæ™¯"><a href="#Javaé¢„ç½®çº¿ç¨‹æ± åŠå…¶ä½¿ç”¨åœºæ™¯" class="headerlink" title="Javaé¢„ç½®çº¿ç¨‹æ± åŠå…¶ä½¿ç”¨åœºæ™¯"></a>Javaé¢„ç½®çº¿ç¨‹æ± åŠå…¶ä½¿ç”¨åœºæ™¯</h3><p>å¦‚å›¾æ˜¯Executorsç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•<br><img src="/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /yzxcgz.png" alt="é¢„ç½®çº¿ç¨‹æ± æ„é€ "></p><h4 id="Executors-newCachedThreadPool"><a href="#Executors-newCachedThreadPool" class="headerlink" title="Executors.newCachedThreadPool()"></a>Executors.newCachedThreadPool()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                              <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                              <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— é™å®¹é‡çš„çº¿ç¨‹æ± (æœ€å¤§ä¸º2147483647)ï¼Œè°ƒç”¨ThreadPoolExecutoræ„é€ ä¼ å…¥çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0ã€‚é€‚åˆåœºæ™¯ä¸ºåˆ›å»ºæ‰§è¡Œæ—¶é—´çŸ­æ•ˆå¿«é€Ÿçš„çº¿ç¨‹ä»»åŠ¡ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæˆä¹‹åç›´æ¥è¢«å›æ”¶ã€‚é˜»å¡é˜Ÿåˆ—ä½¿ç”¨SynchronousQueueï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ä¿å­˜æ•°æ®çš„é˜Ÿåˆ—ï¼Œå› ä¸ºè¯¥çº¿ç¨‹æ± æœ‰ä»»åŠ¡æäº¤å°±ä¼šåˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿å­˜</p><h4 id="Executors-newFixedThreadPool-nThreads"><a href="#Executors-newFixedThreadPool-nThreads" class="headerlink" title="Executors.newFixedThreadPool(nThreads)"></a>Executors.newFixedThreadPool(nThreads)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ã€‚è°ƒç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°ä¼ å…¥çš„æ ¸å¿ƒçº¿ç¨‹æ•°ç­‰äºæœ€å¤§çº¿ç¨‹æ•°ã€‚è¯¥çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—ä¹Ÿä½¿ç”¨çš„æ˜¯æ— ç•Œçš„LinkedBlockingQueueã€‚</p><h4 id="Executors-newSingleThreadExecutor-ï¼š"><a href="#Executors-newSingleThreadExecutor-ï¼š" class="headerlink" title="Executors.newSingleThreadExecutor()ï¼š"></a>Executors.newSingleThreadExecutor()ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œç”¨æˆ·æäº¤çš„ä»»åŠ¡éƒ½ä¼šæ’é˜Ÿé˜»å¡åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œä¸‹ä¸€ä¸ªã€‚é€‚ç”¨åœºæ™¯ä¸ºåé¢ä»»åŠ¡ä¾èµ–å‰é¢ä»»åŠ¡çš„æƒ…å†µã€‚è¯¥çº¿ç¨‹æ± ä¸­çš„é˜»å¡é˜Ÿåˆ—ä¹Ÿä½¿ç”¨çš„æ˜¯æ— ç•Œçš„LinkedBlockingQueueã€‚ä½¿ç”¨è¿™ä¸ªçº¿ç¨‹æ± éœ€è¦å°å¿ƒ<a href="#çº¿ç¨‹é¥¥é¥¿æ­»é”">çº¿ç¨‹é¥¥é¥¿æ­»é”</a></p><h4 id="Executors-newWorkStealingPool"><a href="#Executors-newWorkStealingPool" class="headerlink" title="Executors.newWorkStealingPool()"></a>Executors.newWorkStealingPool()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newWorkStealingPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ForkJoinPool</span><br><span class="line">        (Runtime.getRuntime().availableProcessors(),</span><br><span class="line">         ForkJoinPool.defaultForkJoinWorkerThreadFactory,</span><br><span class="line">         <span class="keyword">null</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–å½“å‰å¯ç”¨çš„çº¿ç¨‹æ•°é‡è¿›è¡Œåˆ›å»ºä½œä¸ºå¹¶è¡Œçº§åˆ«ï¼Œé€šè¿‡æºç å¯ä»¥çœ‹å‡ºåº•å±‚è°ƒç”¨çš„æ˜¯ForkJoinPoolçº¿ç¨‹æ± ï¼ŒnewWorkStealingPoolé€‚åˆä½¿ç”¨åœ¨å¾ˆè€—æ—¶çš„æ“ä½œï¼Œä½†æ˜¯newWorkStealingPoolä¸æ˜¯ThreadPoolExecutorçš„æ‰©å±•ï¼Œå®ƒæ˜¯æ–°çš„çº¿ç¨‹æ± ç±»ForkJoinPoolçš„æ‰©å±•ï¼Œä½†æ˜¯éƒ½æ˜¯åœ¨ç»Ÿä¸€çš„ä¸€ä¸ªExecutorsç±»ä¸­å®ç°ï¼Œç”±äºèƒ½å¤Ÿåˆç†çš„ä½¿ç”¨CPUè¿›è¡Œå¯¹ä»»åŠ¡æ“ä½œï¼ˆå¹¶è¡Œæ“ä½œï¼‰ï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨åœ¨å¾ˆè€—æ—¶çš„ä»»åŠ¡ä¸­ã€‚</p><h4 id="Executors-newScheduledThreadPool"><a href="#Executors-newScheduledThreadPool" class="headerlink" title="Executors.newScheduledThreadPool()"></a>Executors.newScheduledThreadPool()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">&#125;</span><br><span class="line">â†‘â†‘â†‘</span><br><span class="line">â†“â†“â†“</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledThreadPoolExecutor</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">ThreadPoolExecutor</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">ScheduledExecutorService</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS,</span><br><span class="line">              <span class="keyword">new</span> DelayedWorkQueue());</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾å®šå»¶è¿Ÿæ—¶é—´ï¼Œå®šæœŸæ‰§è¡Œã€‚é€šè¿‡æºç å¯ä»¥çœ‹å‡ºåº•å±‚è°ƒç”¨çš„æ˜¯ä¸€ä¸ªScheduledThreadPoolExecutorï¼Œç„¶åä¼ å…¥çº¿ç¨‹æ•°é‡ã€‚åŒnewWorkStealingPoolä¸€æ ·ä¹Ÿä¸æ˜¯ç›´æ¥ä½¿ç”¨ThreadPoolExecutorè¿›è¡Œæ‰©å±•ã€‚å¯ä»¥å»¶æ—¶å¯åŠ¨ï¼Œå®šæ—¶å¯åŠ¨çš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºéœ€è¦å¤šä¸ªåå°çº¿ç¨‹æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„åœºæ™¯ã€‚</p><h3 id="ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± "><a href="#ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± " class="headerlink" title="ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± "></a>ä¼˜é›…çš„å…³é—­çº¿ç¨‹æ± </h3><h4 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h4><p>è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºå…³é—­ï¼Œä½†æ˜¯åªä¼šå…³é—­å·²ç»æ‰§è¡Œå®Œæˆçš„çº¿ç¨‹ï¼Œå¯¹äºè¿˜æœªæ‰§è¡Œå®Œæˆçš„çº¿ç¨‹ï¼Œä¼šç­‰å¾…æ‰§è¡Œå®Œæˆå†å…³é—­ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨shuwdownæ–¹æ³•å…³é—­çº¿ç¨‹æ± æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿ä»»åŠ¡é‡Œä¸ä¼šæœ‰æ°¸ä¹…é˜»å¡ç­‰å¾…çš„é€»è¾‘ï¼Œå¦åˆ™çº¿ç¨‹æ± å°±å…³é—­ä¸äº†ã€‚</p><h4 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow"></a>shutdownNow</h4><p>ç«‹é©¬å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡ä¸å†æ‰§è¡Œã€‚</p><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨shutdownNowæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹å¤„äºä»é˜Ÿåˆ—é‡Œè¯»å–ä»»åŠ¡è€Œé˜»å¡ä¸­ï¼Œåˆ™ä¼šå¯¼è‡´æŠ›å‡ºInterruptedExceptionå¼‚å¸¸</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190617/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -å››-ï¼šç†è§£ThreadPoolExecutorçº¿ç¨‹æ± /xcc.png&quot; alt=&quot;çº¿ç¨‹æ± &quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="ThreadPoolExecutor" scheme="http://zhangjiaheng.cn/tags/ThreadPoolExecutor/"/>
    
      <category term="çº¿ç¨‹æ± " scheme="http://zhangjiaheng.cn/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    
  </entry>
  
  <entry>
    <title>äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†</title>
    <link href="http://zhangjiaheng.cn/blog/20190613/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%87%A0%E7%A7%8D%E9%9D%9E%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86/"/>
    <id>http://zhangjiaheng.cn/blog/20190613/äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†/</id>
    <published>2019-06-13T09:36:48.000Z</published>
    <updated>2019-11-01T01:40:48.210Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190613/äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†/fm.jpg" alt="å°é¢"></p><a id="more"></a><h2 id="äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†è§£æ³•"><a href="#äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†è§£æ³•" class="headerlink" title="äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†è§£æ³•"></a>äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†è§£æ³•</h2><p>äºŒå‰æ ‘çš„é€’å½’éå†æƒ³å¿…äº†è§£é€’å½’ä»¥åŠäºŒå‰æ ‘çš„åŒå­¦éƒ½èƒ½å¤Ÿè½»æ¾å†™å‡ºæ­£ç¡®ç­”æ¡ˆï¼Œç„¶è€ŒäºŒå‰æ ‘çš„éé€’å½’éå†ç¡®æ˜¯å¾ˆå¤šäººéš¾ä»¥ç†è§£å­¦ä¼šçš„ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè¿›è¡Œä¸€ä¸‹å½’çº³æ€»ç»“ï¼Œä¸»è¦æ˜¯å¤ä¹ å·©å›ºä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚</p><h3 id="éé€’å½’å…ˆåºéå†"><a href="#éé€’å½’å…ˆåºéå†" class="headerlink" title="éé€’å½’å…ˆåºéå†"></a>éé€’å½’å…ˆåºéå†</h3><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul><li>é¦–å…ˆå°†æ ¹èŠ‚ç‚¹å…¥æ ˆ</li><li>ç„¶åå¾ªç¯åˆ¤æ–­æ ˆä¸ä¸ºç©º</li><li>åˆ™å¼¹å‡ºæ ˆé¡¶å…ƒç´ </li><li>å¦‚æœå¼¹å‡ºå…ƒç´ çš„å³å­æ ‘ä¸ä¸ºç©ºåˆ™å…¥æ ˆ</li><li>å¦‚æœå¼¹å‡ºå…ƒç´ çš„å·¦å­æ ‘ä¸ä¸ºç©ºåˆ™å…¥æ ˆ</li><li>ç»§ç»­å¾ªç¯</li></ul><p>è§£æï¼šç”±äºå…ˆåºéå†ä¸º[æ ¹-å·¦-å³]ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹åº”è¯¥å…ˆå…¥æ ˆï¼Œç„¶åå‡ºæ ˆçš„åŒæ—¶ä¾æ¬¡å…¥æ ˆå³-å·¦å­æ ‘å³å¯ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">frontPrintByLoop</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            TreeNode node = stack.pop();</span><br><span class="line">            System.out.print(node.val + <span class="string">" | "</span>);</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éé€’å½’ä¸­åºéå†"><a href="#éé€’å½’ä¸­åºéå†" class="headerlink" title="éé€’å½’ä¸­åºéå†"></a>éé€’å½’ä¸­åºéå†</h3><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul><li>é¦–å…ˆå°†æ ¹èŠ‚ç‚¹å…¥æ ˆ</li><li>å¾ªç¯åˆ¤æ–­æ ¹èŠ‚ç‚¹æ˜¯å¦æœ‰å·¦å­æ ‘ï¼Œæœ‰åˆ™å…¥æ ˆç»§ç»­å¾ªç¯ï¼Œå¦åˆ™å¾ªç¯ç»“æŸ</li><li>ç„¶åå¾ªç¯åˆ¤æ–­æ ˆä¸ä¸ºç©º</li><li>åˆ™å¼¹å‡ºæ ˆé¡¶å…ƒç´ </li><li>å¦‚æœæ ˆé¡¶å…ƒç´ å³å­æ ‘ä¸ä¸ºç©º</li><li>åˆ™å¾ªç¯å…¥æ ˆå³å­æ ‘åŠå…¶å³å­æ ‘çš„å·¦å­æ ‘</li><li>ç»§ç»­å¾ªç¯</li></ul><p>è§£æï¼šå› ä¸ºä¸­åºéå†ä¸º[å·¦-æ ¹-åˆ]ï¼Œæ‰€ä»¥æ ‘çš„å·¦å­æ ‘åº”è¯¥å…ˆå…¥æ ˆï¼Œå¾ªç¯å…¥æ ˆå·¦å­æ ‘ä¹‹åå¾ªç¯å‡ºæ ˆï¼Œå‡ºæ ˆçš„åŒæ—¶åˆ¤æ–­å‡ºæ ˆå…ƒç´ æ˜¯å¦æœ‰å³å­æ ‘ï¼Œå¦‚æœå³å­æ ‘ä¸ä¸ºç©ºåˆ™å¯¹å³å­æ ‘æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œå³å…¥æ ˆå³å­æ ‘çš„å·¦å­æ ‘ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">midPrintByLoop</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        TreeNode node = root;</span><br><span class="line">        stack.push(node);</span><br><span class="line">        <span class="keyword">while</span> (node.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            stack.push(node.left);</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            node = stack.pop();</span><br><span class="line">            TreeNode n = node.right;</span><br><span class="line">            <span class="keyword">while</span> (n != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stack.push(n);</span><br><span class="line">                n = n.left;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(node.val + <span class="string">" | "</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éé€’å½’ååºéå†"><a href="#éé€’å½’ååºéå†" class="headerlink" title="éé€’å½’ååºéå†"></a>éé€’å½’ååºéå†</h3><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯ 1"></a>æ€è·¯ 1</h4><ul><li>é€†å‘æ€è€ƒå…ˆåºéå†ï¼Œå› ä¸ºååºéå†ä¸º[æ ¹-å·¦-å³]ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ç±»ä¼¼å…ˆåºéå†çš„æ–¹å¼å…ˆå°†[å³-å·¦-æ ¹]çš„é¡ºåºæ‰¾å‡ºæ¥å­˜å…¥å¦ä¸€ä¸ªæ ˆï¼Œç„¶åå†ä¾æ¬¡å‡ºæ ˆè¯¥æ ˆå…ƒç´ å³å¯</li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç  1"></a>ä»£ç  1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">lastPrintByOtherStack</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="keyword">final</span> Stack&lt;TreeNode&gt; stackReverse = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            TreeNode node = stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stackReverse.push(node);</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    stack.push(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    stack.push(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!stackReverse.isEmpty()) &#123;</span><br><span class="line">            TreeNode node = stackReverse.pop();</span><br><span class="line">            System.out.print(node.val + <span class="string">" | "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯ 2"></a>æ€è·¯ 2</h4><ul><li>åªä½¿ç”¨ä¸€ä¸ªæ ˆ</li><li>å…ˆå°†æ ¹èŠ‚ç‚¹å…¥æ ˆ</li><li>è®¾ç½®ä¸€ä¸ªæ ‡è¯†å¼•ç”¨ hé¦–å…ˆæŒ‡å‘root</li><li>å¾ªç¯åˆ¤æ–­æ ˆéç©º</li><li>åœ¨å¾ªç¯ä¸­åˆ¤æ–­æ ˆé¡¶å…ƒç´ node</li><li>å¦‚æœnodeå·¦å­æ ‘ä¸ä¸ºç©ºå¹¶ä¸”å·¦å³å­æ ‘éƒ½ä¸ä¸ºhæŒ‡å‘çš„å…ƒç´ </li><li>å…¥æ ˆå·¦å­æ ‘</li><li>å¦åˆ™å†åˆ¤æ–­å³å­æ ‘æ˜¯å¦ä¸ºç©ºä»¥åŠå³å­æ ‘æ˜¯å¦ä¸ºhèŠ‚ç‚¹</li><li>å…¥æ ˆå³å­æ ‘</li><li>å¦åˆ™ï¼Œå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå¹¶ä¸”å°†hæŒ‡å‘è¯¥å¼¹å‡ºçš„æ ˆé¡¶å…ƒç´ </li></ul><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç  2"></a>ä»£ç  2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">lastPrintByOneStack</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != root) &#123;</span><br><span class="line">        TreeNode h = root;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        stack.push(h);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            TreeNode node = stack.peek();</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="keyword">null</span> &amp;&amp; node.left != h &amp;&amp; node.right != h) &#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">null</span> != node.right &amp;&amp; node.right != h) &#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                node = stack.pop();</span><br><span class="line">                System.out.print(node.val + <span class="string">" | "</span>);</span><br><span class="line">                h = node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æï¼šä½¿ç”¨ä¸€ä¸ªæ ˆè¿›è¡Œååºéå†çš„æ—¶å€™éœ€è¦ä½¿ç”¨ä¸€ä¸ªhå¼•ç”¨æ¥æ ‡è¯†ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦è¢«éå†è¿‡ï¼Œæ˜¯çš„è¯å°±å¾€ä¸Šåˆ¤æ–­ä¹‹åçš„æ ‘èŠ‚ç‚¹å³å¯ã€‚</p><h3 id="æŒ‰å±‚éå†äºŒå‰æ ‘"><a href="#æŒ‰å±‚éå†äºŒå‰æ ‘" class="headerlink" title="æŒ‰å±‚éå†äºŒå‰æ ‘"></a>æŒ‰å±‚éå†äºŒå‰æ ‘</h3><h4 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ä»¥ä¸Šå‰ä¸­ååºéå†äºŒå‰æ ‘éƒ½æ˜¯ç”¨åˆ°äº†æ ˆè¿™ç§æ•°æ®ç»“æ„ï¼Œè€ŒæŒ‰å±‚éå†äºŒå‰æ ‘å°±éå¸¸ç®€å•äº†ï¼Œåªéœ€è¦å¼•å…¥å…ˆå…¥å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œç„¶åä¾æ¬¡åœ¨å‡ºé˜Ÿçš„æ—¶å€™å°†å‡ºé˜Ÿå…ƒç´ çš„å·¦å³å­æ ‘å…¥é˜Ÿå³å¯ã€‚</p><ul><li>æ ¹èŠ‚ç‚¹å…¥é˜Ÿ</li><li>é˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™å¼€å§‹å¾ªç¯</li><li>å¦‚æœé˜Ÿé¦–å…ƒç´ å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œå°±å…¥é˜Ÿ</li><li>å³å­æ ‘ä¸ä¸ºç©ºï¼Œä¹Ÿå…¥é˜Ÿ</li><li>é˜Ÿé¦–å…ƒç´ å‡ºé˜Ÿè¾“å‡º</li></ul><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">levelPrintOutTree</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != root) &#123;</span><br><span class="line">        LinkedList&lt;TreeNode&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        TreeNode i = root;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.add(i.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.add(i.right);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(i.val + <span class="string">" | "</span>);</span><br><span class="line">            queue.poll();</span><br><span class="line">            i = queue.peek();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190613/äºŒå‰æ ‘çš„å‡ ç§éé€’å½’éå†/fm.jpg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="äºŒå‰æ ‘" scheme="http://zhangjiaheng.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://zhangjiaheng.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="äºŒå‰æ ‘" scheme="http://zhangjiaheng.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>æ·±åº¦åˆ†æå¦‚ä½•å†™å‡ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹</title>
    <link href="http://zhangjiaheng.cn/blog/20190607/%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%95%E4%BE%8B/"/>
    <id>http://zhangjiaheng.cn/blog/20190607/æ·±åº¦åˆ†æå¦‚ä½•å†™å‡ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹/</id>
    <published>2019-06-07T12:51:33.000Z</published>
    <updated>2019-11-01T01:40:48.257Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190607/æ·±åº¦åˆ†æå¦‚ä½•å†™å‡ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹/fm.png" alt="å°é¢"></p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ</h3><p>å•ä¾‹æ¨¡å¼æ˜¯åœ¨Javaç¼–ç¨‹ä¸­é™¤äº†å·¥å‚æ¨¡å¼ä¹‹å¤–æœ€å¸¸ç”¨çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚å•ä¾‹æ¨¡å¼æä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä½¿å¾—æ¯æ¬¡è·å–åˆ°çš„è¯¥ç±»çš„å®ä¾‹éƒ½æ˜¯åŒä¸€ä¸ªã€‚å³æ‰€è°“çš„æä¾›äº†è®¿é—®è¯¥ç±»å®ä¾‹çš„å”¯ä¸€é€”å¾„ã€‚</p><p><strong>å•ä¾‹æ¨¡å¼åœ¨åˆ›å»ºæ—¶çš„æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>å› ä¸ºæ¯ä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ„é€ æ–¹æ³•å°é—­èµ·æ¥ä¸èƒ½è¢«å¤–éƒ¨è°ƒç”¨ï¼Œå³ç§æœ‰åŒ–ï¼›</li><li>éœ€è¦æä¾›ä¸€ä¸ªè·å–ç±»å®ä¾‹çš„å…¬æœ‰æ–¹æ³•ï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥ç±»å®ä¾‹çš„äººéƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æ‹¿åˆ°å•ä¾‹å¯¹è±¡ï¼›</li><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå‡ºå¤šä¸ªä¸åŒçš„å®ä¾‹ï¼Œè¿èƒŒäº†å•ä¾‹çš„åŸåˆ™ã€‚</li></ul><h3 id="åˆ›å»ºå•ä¾‹æ¨¡å¼çš„æ–¹æ³•åŠå…¶ä¼˜ç¼ºç‚¹"><a href="#åˆ›å»ºå•ä¾‹æ¨¡å¼çš„æ–¹æ³•åŠå…¶ä¼˜ç¼ºç‚¹" class="headerlink" title="åˆ›å»ºå•ä¾‹æ¨¡å¼çš„æ–¹æ³•åŠå…¶ä¼˜ç¼ºç‚¹"></a>åˆ›å»ºå•ä¾‹æ¨¡å¼çš„æ–¹æ³•åŠå…¶ä¼˜ç¼ºç‚¹</h3><h4 id="é¥¿æ±‰å‹"><a href="#é¥¿æ±‰å‹" class="headerlink" title="é¥¿æ±‰å‹"></a>é¥¿æ±‰å‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungrySingleton</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HungrySingleton INSTANCE = <span class="keyword">new</span> HungrySingleton();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§æœ‰æ„é€ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungrySingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç±»åœ¨åŠ è½½çš„æ—¶å€™å°±åˆ›å»ºå¥½çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼šé¥¿æ±‰å‹å•ä¾‹æ˜¯æœ€ç®€å•çš„å•ä¾‹åˆ›å»ºæ–¹æ³•ï¼Œåœ¨ç±»ä¸­ç»´æŠ¤ä¸€ä¸ªè¯¥ç±»ç§æœ‰ä¸å¯å˜çš„å®ä¾‹ï¼Œç„¶åæä¾›ä¸€ä¸ªè·å–è¯¥å®ä¾‹çš„é™æ€æ–¹æ³•å³å¯ã€‚</li><li>ä¼˜ç‚¹ï¼šä»£ç ç¼–å†™ç®€å•ï¼Œçº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œclassloaderåœ¨åŠ è½½ç±»çš„æ—¶å€™ä½¿ç”¨synchronizedåŒæ­¥ï¼‰</li><li>ç¼ºç‚¹ï¼šæ— æ³•å®ç°æ‡’åŠ è½½ï¼Œåœ¨ä½¿ç”¨è¾ƒå°‘çš„æ—¶å€™æµªè´¹èµ„æºï¼Œæ— æ³•é˜²æ­¢åå°„ç ´åä»¥åŠååºåˆ—åŒ–ç ´åå•ä¾‹å”¯ä¸€æ€§</li></ul><h4 id="æ™®é€šæ‡’æ±‰å‹"><a href="#æ™®é€šæ‡’æ±‰å‹" class="headerlink" title="æ™®é€šæ‡’æ±‰å‹"></a>æ™®é€šæ‡’æ±‰å‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton INSTANCE ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == INSTANCE)&#123;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼šè¿™ç§æ‡’æ±‰å‹å•ä¾‹ä¹Ÿæ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„å•ä¾‹å®ç°æ–¹å¼ï¼Œä¸ç¬¬ä¸€ç§ä¸åŒåœ¨äºè¿™ç§å®ä¾‹æ˜¯åœ¨è°ƒç”¨è·å–å®ä¾‹çš„é™æ€æ–¹æ³•çš„æ—¶å€™æ‰åˆ›å»º</li><li>ä¼˜ç‚¹ï¼šä»£ç ç®€å•ï¼Œå¯ä»¥å®ç°æ‡’åŠ è½½</li><li>ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶èµ°åˆ°ç¬¬8è¡Œä»£ç ï¼Œåˆ¤æ–­å®ä¾‹æœªåˆ›å»ºï¼Œåˆ™ä¼šåˆ›å»ºå‡ºå¤šä¸ªå®ä¾‹;æ— æ³•é˜²æ­¢åå°„ç ´åä»¥åŠååºåˆ—åŒ–ç ´å</li></ul><p><em>é‚£ä¹ˆä¸ºäº†å®ç°çº¿ç¨‹å®‰å…¨æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸ŠåŠ ä¸ŠåŒæ­¥å…³é”®å­—ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒè°ƒç”¨è¯¥æ–¹æ³•éƒ½ä¼šé˜»å¡ï¼Œå¯¼è‡´æ€§èƒ½å­˜åœ¨ä¸å¿…è¦çš„æµªè´¹</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">null</span> == INSTANCE)&#123;</span><br><span class="line">INSTANCE = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="åŒé‡æ£€æµ‹é”å®ç°æ‡’åŠ è½½å•ä¾‹"><a href="#åŒé‡æ£€æµ‹é”å®ç°æ‡’åŠ è½½å•ä¾‹" class="headerlink" title="åŒé‡æ£€æµ‹é”å®ç°æ‡’åŠ è½½å•ä¾‹"></a>åŒé‡æ£€æµ‹é”å®ç°æ‡’åŠ è½½å•ä¾‹</h4><p>ä¸Šè¿°æ‡’æ±‰å‹åŒæ­¥æœºåˆ¶å¯ä»¥æ”¹è¿›å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleLockSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DoubleLockSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DoubleLockSingleton INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleLockSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// è¿›å…¥æ–¹æ³•åå…ˆåˆ¤æ–­ä¸€æ¬¡ å¤§å¹…å‡å°‘å¤šçº¿ç¨‹ç¯å¢ƒåŒæ­¥é˜»å¡é—®é¢˜ </span></span><br><span class="line"><span class="comment">// ä½†æ˜¯è¿™ç§æ–¹å¼åœ¨å¤šçº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == INSTANCE) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleLockSingleton<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == INSTANCE) &#123;</span><br><span class="line"><span class="comment">// é—®é¢˜çš„æ ¹æºæ‰€åœ¨</span></span><br><span class="line"><span class="comment">// æ­¤å¤„å¯èƒ½ä¼šå‡ºç°æŒ‡ä»¤é‡æ’åº </span></span><br><span class="line"><span class="comment">// newå¯¹è±¡å¹¶ä¸æ˜¯åŸå­æ“ä½œ</span></span><br><span class="line">INSTANCE = <span class="keyword">new</span> DoubleLockSingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼šåŒé‡æ£€æµ‹é”æœºåˆ¶åœ¨è¿›å…¥<code>getInstance()</code>æ–¹æ³•çš„æ—¶å€™ä¼šåˆ¤æ–­å®ä¾‹æ˜¯å¦è¢«åˆ›å»ºï¼Œå¦‚æœè¢«åˆ›å»ºï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¿›å…¥åŒæ­¥ä»£ç å—ï¼Œåˆ›å»ºå®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è²Œä¼¼æ²¡æœ‰é—®é¢˜ï¼Œè€Œä¸”è¿˜å¤§å¤§å‡å°‘çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—é˜»å¡çš„æƒ…å†µï¼ˆå› ä¸ºåªæœ‰ç¬¬ä¸€æ¬¡åˆ¤æ–­å¯¹è±¡è¿˜æ²¡æœ‰åˆ›å»ºçš„æ—¶å€™æ‰ä¼šæœ‰çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—ï¼‰ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•ä»ç„¶å­˜åœ¨çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚<font color="#db1414">é—®é¢˜å‡ºåœ¨ç¬¬17è¡Œï¼š<code>INSTANCE = new DoubleLockSingleton();</code>ç”±äºJVMè™šæ‹Ÿæœºå†…éƒ¨ä¼šå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨ä½¿ç”¨newåˆ›å»ºå¯¹è±¡çš„æ—¶å€™å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œä¸”ä¼šè¢«è™šæ‹Ÿæœºè¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚è¿™ä¸ªæ­¥éª¤ä¼šè¢«åˆ†æˆä¸‰æ­¥ï¼š<strong>1ã€åœ¨å †ä¸Šä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ï¼›2ã€å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼›3ã€å°†å¼•ç”¨æŒ‡å‘è¯¥å †ä¸Šçš„åœ°å€ã€‚ </strong>ç”±äºåœ¨è™šæ‹Ÿæœºä¸­ï¼ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¯¼è‡´ç¬¬2æ­¥å’Œç¬¬3æ­¥çš„æ‰§è¡Œé¡ºåºå¯ä»¥è¢«æ‰“ä¹±ï¼Œé‚£ä¹ˆåœ¨ä»£ç æ‰§è¡Œåˆ°ç¬¬11è¡Œçš„æ—¶å€™å‘ç°ï¼ŒINSTANCEä¸ä¸ºnullï¼Œç›´æ¥è¿”å›ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</font><strong>æ³¨æ„ï¼šsynchronzedå…³é”®å­—æ²¡æœ‰å±è”½æŒ‡ä»¤é‡æ’åºçš„åŠŸèƒ½</strong>ï¼Œé‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨<code>volatile</code>å…³é”®å­—ä¿®é¥°å®ä¾‹å˜é‡å¼•ç”¨ï¼Œå³<code>private volatile static TripleLockSingleton INSTANCE;</code>ã€‚<code>volatile</code>å…³é”®å­—æ‰æœ‰å±è”½æŒ‡ä»¤é‡æ’åºçš„è¯­ä¹‰ã€‚</li><li>ä¼˜ç‚¹ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¤§éƒ¨åˆ†æ—¶é—´çº¿ç¨‹å®‰å…¨</li><li>ç¼ºç‚¹ï¼šæœ‰å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›ä¸èƒ½é¿å…åå°„å’Œååºåˆ—åŒ–ç ´å</li><li>ä¼˜åŒ–ï¼š<code>private volatile static TripleLockSingleton INSTANCE;</code></li></ul><h4 id="é™æ€å†…éƒ¨ç±»å•ä¾‹"><a href="#é™æ€å†…éƒ¨ç±»å•ä¾‹" class="headerlink" title="é™æ€å†…éƒ¨ç±»å•ä¾‹"></a>é™æ€å†…éƒ¨ç±»å•ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticInnerClassSingleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StaticInnerClassSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> StaticInnerClassSingleton INSTANCE = <span class="keyword">new</span> StaticInnerClassSingleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StaticInnerClassSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼šé™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹ä¹Ÿæ˜¯å€ŸåŠ©äº†ç±»åŠ è½½çš„çº¿ç¨‹å®‰å…¨æœºåˆ¶ï¼Œå¹¶åŒæ—¶åŸºäºå†…éƒ¨ç±»çš„ä½¿ç”¨æ—¶å†åˆ›å»ºçš„æ‡’åŠ è½½æœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’åŠ è½½æ¨¡å¼çš„å•ä¾‹</li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥å®ç°æ‡’åŠ è½½</li><li>ç¼ºç‚¹ï¼šæ— æ³•é˜²æ­¢è¢«åå°„ä»¥åŠååºåˆ—åŒ–ç ´åå•ä¾‹çš„å”¯ä¸€æ€§</li></ul><h4 id="æšä¸¾ç±»å•ä¾‹"><a href="#æšä¸¾ç±»å•ä¾‹" class="headerlink" title="æšä¸¾ç±»å•ä¾‹"></a>æšä¸¾ç±»å•ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EnumSingleton &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼š<strong>Joshua Bloch</strong>å¤§ç¥è¯´è¿‡ï¼šâ€œå•å…ƒç´ çš„æšä¸¾ç±»å‹å·²ç»æˆä¸ºå®ç°Singletonçš„æœ€ä½³æ–¹æ³•â€ã€‚è¶³ä»¥è§è¯æšä¸¾ç±»åœ¨åˆ›å»ºå•ä¾‹ä¸­çš„ä¼˜åŠ¿ã€‚</li><li>ä¼˜ç‚¹ï¼šä»£ç ç®€å•ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´å</li><li>ç¼ºç‚¹ï¼šæš‚æ— </li></ul><h4 id="CASåˆ›å»ºå•ä¾‹"><a href="#CASåˆ›å»ºå•ä¾‹" class="headerlink" title="CASåˆ›å»ºå•ä¾‹"></a>CASåˆ›å»ºå•ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CASSingleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReference&lt;CASSingleton&gt; INSTANCE = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">CASSingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨åŸå­æ“ä½œ å®ç°è·å–å”¯ä¸€å®ä¾‹</span></span><br><span class="line"><span class="comment">     * ç†è®ºä¸Šåœ¨å¤§é‡ç«äº‰çš„ç¯å¢ƒä¸­ åŸå­æ“ä½œè‡ªæ—‹ç­‰å¾…æ¶ˆè€—å¤§é‡æ€§èƒ½ ä½†æ˜¯å®é™…ä¸Šå½“ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå¥½å®ä¾‹ä¹‹åå…¶ä½™çº¿ç¨‹ä¸ä¼šå‡ºç°æ­»å¾ªç¯</span></span><br><span class="line"><span class="comment">     * ç›¸å¯¹äºé”å®ƒæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢å’Œé˜»å¡çš„é¢å¤–æ¶ˆè€—,å¯ä»¥æ”¯æŒè¾ƒå¤§çš„å¹¶è¡Œåº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CASSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            CASSingleton instance = INSTANCE.get();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != instance) &#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            instance = <span class="keyword">new</span> CASSingleton();</span><br><span class="line">            <span class="keyword">if</span> (INSTANCE.compareAndSet(<span class="keyword">null</span>, instance)) &#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æï¼šä½¿ç”¨åŸå­æ“ä½œ<code>AtomicReference</code>è¿›è¡Œå•ä¾‹çš„åˆ›å»ºï¼Œäº‹å®ä¸Šç›®å‰ç›¸å¯¹äºåŒé‡æ£€æŸ¥é”æ€§èƒ½ä¸Šå·®çš„ä¹Ÿä¸æ˜¯ä¹Ÿåˆ«å¤§</li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼Œæ‡’åŠ è½½ï¼Œç›¸å¯¹äºé”å®ƒæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢å’Œé˜»å¡çš„é¢å¤–æ¶ˆè€—,å¯ä»¥æ”¯æŒè¾ƒå¤§çš„å¹¶è¡Œåº¦</li><li>ç¼ºç‚¹ï¼šä»£ç ç¼–å†™ç›¸å¯¹å¤æ‚ï¼Œä¸èƒ½é˜²æ­¢è¢«åå°„å’Œååºåˆ—åŒ–ç ´å</li></ul><h3 id="é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´åå•ä¾‹çš„æ–¹å¼"><a href="#é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´åå•ä¾‹çš„æ–¹å¼" class="headerlink" title="é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´åå•ä¾‹çš„æ–¹å¼"></a>é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´åå•ä¾‹çš„æ–¹å¼</h3><p>ä¸Šè¿°å‡ ä¸ªåˆ›å»ºå•ä¾‹çš„æ–¹å¼ä¸­ï¼Œé™¤äº†ä½¿ç”¨æšä¸¾ç±»åˆ›å»ºå•ä¾‹ï¼Œéƒ½ä¼šäº§ç”Ÿè¢«åå°„å’Œååºåˆ—åŒ–ç ´åçš„æƒ…å†µï¼Œé¿å…è¯¥é—®é¢˜çš„æ–¹å¼å¦‚ä¸‹ï¼Œå¤§å®¶éœ€è¦æ·±ç©¶çš„è¯å¯ä»¥æ‰“å¼€æœç´¢å¼•æ“â€¦ è¿™é‡Œä¸å†å±•å¼€äº†~</p><h4 id="æšä¸¾ç±»é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´å"><a href="#æšä¸¾ç±»é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´å" class="headerlink" title="æšä¸¾ç±»é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´å"></a>æšä¸¾ç±»é˜²æ­¢åå°„å’Œååºåˆ—åŒ–ç ´å</h4><blockquote><p><strong> å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/chiclee/p/9097772.html" target="_blank" rel="noopener">https://www.cnblogs.com/chiclee/p/9097772.html</a> </strong></p></blockquote><h4 id="é˜²æ­¢åå°„ç ´å"><a href="#é˜²æ­¢åå°„ç ´å" class="headerlink" title="é˜²æ­¢åå°„ç ´å"></a>é˜²æ­¢åå°„ç ´å</h4><p>å› ä¸ºåå°„æ˜¯é€šè¿‡classå¯¹è±¡æ¥è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå®ä¾‹å·²ç»å­˜åœ¨ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§æœ‰æ„é€ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(INSTANCE != <span class="keyword">null</span>)&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="é˜²æ­¢ååºåˆ—åŒ–ç ´å"><a href="#é˜²æ­¢ååºåˆ—åŒ–ç ´å" class="headerlink" title="é˜²æ­¢ååºåˆ—åŒ–ç ´å"></a>é˜²æ­¢ååºåˆ—åŒ–ç ´å</h4><p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™<code>ObjectInputStream.readObject()</code>ä¸­ä¼šå»åˆ¤æ–­æ˜¯å¦å­˜åœ¨<code>readResolve()</code>æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨çš„è¯ä¼šè°ƒç”¨è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥åœ¨å•ä¾‹ç±»ä¸­ç¼–å†™<code>readResolve()</code>æ–¹æ³•è¿”å›<code>INSTANCE</code>å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ååºåˆ—åŒ–æ—¶ï¼Œç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›æŒ‡å®šçš„å¯¹è±¡ï¼Œæ— éœ€å†æ–°å»ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190607/æ·±åº¦åˆ†æå¦‚ä½•å†™å‡ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹/fm.png&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="å•ä¾‹æ¨¡å¼" scheme="http://zhangjiaheng.cn/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (ä¸‰)ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨</title>
    <link href="http://zhangjiaheng.cn/blog/20190602/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E4%B8%89-%EF%BC%9ACountDownLatch%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <id>http://zhangjiaheng.cn/blog/20190602/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸‰-ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨/</id>
    <published>2019-06-02T13:36:53.000Z</published>
    <updated>2019-11-01T01:40:48.239Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190602/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸‰-ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨/cdl.png" alt="ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ"></p><a id="more"></a><h3 id="ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ"></a>ä»€ä¹ˆæ˜¯<code>CountDownLatch</code>ï¼Ÿ</h3><p>  åœ¨æœ¬ç¯‡åšå®¢çš„å°é¢ï¼Œæˆ‘æ”¾äº†ä¸€ä¸ªæˆªå›¾ï¼Œä¸Šé¢å¯¹äº<code>CountDownLatch</code>çš„ç¿»è¯‘æ˜¯è¿™æ ·çš„ï¼š<em>é—­é”ï¼Œå€’è®¡æ—¶é—¨é—©</em>ã€‚å…¶å®é¡¾åæ€ä¹‰ï¼Œ<code>CountDownLatch</code>å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼š<strong>è®¡æ•°-è®¡æ•°å®Œæˆååšä¸€äº›äº‹</strong>ã€‚å…¶å®è¿™ä¸ªä¸œè¥¿å¯ä»¥ç±»æ¯”ä¸ºä¸€ä¸ªæ°´åï¼šå½“æ°´è¿˜æ²¡æœ‰è£…æ»¡æ°´åº“çš„æ—¶å€™æ°´åæ˜¯å…³é—­çš„ï¼Œå½“æ°´è£…æ»¡ä¹‹åå¼€é—¸æ”¾æ°´ï¼Œæ°´åº“ä¸­çš„æ°´â€ä¸€èµ·â€æ¶Œå‡ºæ°´åº“ã€‚</p><p>  æ‹¥æœ‰åŒæ ·åŠŸèƒ½çš„è¿˜æœ‰<code>CyclicBarrier</code>è¿™ä¸ªç±»ï¼Œä½†æ˜¯è¿™ä¸ªç±»ç›¸å¯¹è¾ƒå¤æ‚ï¼Œå¹¶ä¸”ç›¸å¯¹äº<code>CountDownLatch</code>è¿˜å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå®é™…ä¸Šå‰è€…ä¸€èˆ¬è¢«å«åšçº¿ç¨‹è®¡æ•°å™¨ï¼Œåè€…è¢«å«åšå¾ªç¯å±éšœï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ã€‚è¿™ä¸ª <strong>åœ¨åé¢å†è¿›è¡Œæºç å­¦ä¹ </strong>ã€‚</p><h3 id="CountDownLatchæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#CountDownLatchæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="CountDownLatchæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a><code>CountDownLatch</code>æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>  åŒ<code>ReentrantLock</code>ç±»ä¼¼ï¼Œå†…éƒ¨ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªå®ç°äº†<code>AbstractQueueSynchronizer</code>çš„å†…éƒ¨ç±»ã€‚å†…éƒ¨ç±»åšäº†çˆ¶ç±»çš„å…±äº«å¼çš„æ˜¾ç¤ºé”çš„æ–¹æ³•å®ç°ï¼Œç»´æŠ¤ä¸€ä¸ªåˆå§‹ä¸ºNçš„çŠ¶æ€<code>state</code>ï¼Œæ¯æ¬¡æœ‰çº¿ç¨‹è°ƒç”¨ä¹‹åé˜»å¡ï¼Œç„¶å<code>state</code>å‡1ï¼Œç›´åˆ°å‡ä¸º0ä¹‹åæ‰€æœ‰é˜»å¡çš„çº¿ç¨‹é‡æ–°å¼€å§‹æ‰§è¡Œã€‚</p><h4 id="é¦–å…ˆæ˜¯å†…éƒ¨ç±»Syncçš„å®ç°"><a href="#é¦–å…ˆæ˜¯å†…éƒ¨ç±»Syncçš„å®ç°" class="headerlink" title="é¦–å…ˆæ˜¯å†…éƒ¨ç±»Syncçš„å®ç°"></a>é¦–å…ˆæ˜¯å†…éƒ¨ç±»Syncçš„å®ç°</h4><p>  æ„é€ å™¨æ¥æ”¶ä¸€ä¸ªintå‚æ•°åˆå§‹åŒ–stateçš„å€¼ã€‚<code>tryAcquireShared()</code>æ–¹æ³•ä¸ä¼šå¯¹stateåšæ”¹å˜ï¼Œå½“stateä¸ä¸º0çš„æ—¶å€™è¿”å›-1å³å¤±è´¥ï¼Œå½“stateç­‰äº0å…¶è¿”å›1ï¼Œè¡¨ç¤ºè®¡æ•°å™¨å·²ç»è®¡æ•°å®Œæˆï¼Œ<code>await()</code>æ–¹æ³•ä¸å†é˜»å¡ã€‚<code>tryReleaseShared()</code>æ–¹æ³•ä¼šä½¿ç”¨åŸå­æ“ä½œå½“<code>countDown()</code>è¢«è°ƒç”¨çš„æ—¶å€™é‡Šæ”¾ä¸€ä¸ªstateçš„å ç”¨ï¼Œå³state-1ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line">      Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">          setState(count);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> getState();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line">          <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">              <span class="keyword">int</span> c = getState();</span><br><span class="line">              <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">              <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">              <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                  <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CountDownLatchçš„countDownæ–¹æ³•"><a href="#CountDownLatchçš„countDownæ–¹æ³•" class="headerlink" title="CountDownLatchçš„countDownæ–¹æ³•"></a>CountDownLatchçš„countDownæ–¹æ³•</h4><p>  countDownæ–¹æ³•ä¸»è¦ä½œç”¨å°±æ˜¯ä½¿state-1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sync.releaseShared(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  AQSä¸­çš„<code>releaseShared()</code>æ–¹æ³•çš„å®ç°ï¼Œå¦‚æœé‡Šæ”¾æˆåŠŸæ‰§è¡Œ<code>doReleaseShared();</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CountDownLatchçš„awaitæ–¹æ³•"><a href="#CountDownLatchçš„awaitæ–¹æ³•" class="headerlink" title="CountDownLatchçš„awaitæ–¹æ³•"></a>CountDownLatchçš„awaitæ–¹æ³•</h4><p>  awaitæ–¹æ³•ä¼šç­‰å¾…å½“å‰stateå€¼æ˜¯å¦æ˜¯0ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±ä¸€ç›´é˜»å¡ã€‚ç›´åˆ°stateä¸º0ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sync.tryAcquireSharedNanos(<span class="number">1</span>, unit.toNanos(timeout));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  AQSä¸­çš„<code>acquireSharedInterruptibly()</code>æ–¹æ³•å®ç°å¦‚ä¸‹ï¼Œåœ¨AQSçš„å®ç°ä¸­ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œæ˜¯çš„è¯æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼Œå¦åˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ç»§ç»­éœ€è¦é˜»å¡ï¼Œå³è°ƒç”¨<code>tryAcquireShared()</code>ã€‚æ˜¯çš„è¯è¿›å…¥<code>doAcquireSharedInterruptibly()</code>æ–¹æ³•ï¼Œä¸æ–­çš„åˆ¤æ–­<code>int r = tryAcquireShared(arg);</code>ï¼Œstateå¦‚æœä¸€ç›´ä¸ç­‰äº0ï¼Œrå°±ä¸€ç›´æ˜¯è´Ÿæ•°ï¼Œå°±ä¼šç»§ç»­è¿›å…¥å¾ªç¯ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Acquires in shared interruptible mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arg the acquire argument</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAcquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node node = addWaiter(Node.SHARED);</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">                <span class="keyword">int</span> r = tryAcquireShared(arg);</span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶å®ä»¥ä¸Šä»£ç çš„æ•´ä½“æµç¨‹éå¸¸ç®€å•ï¼Œå³åˆå§‹åŒ–<code>CountDownLatch</code>çš„state=Nï¼Œæ¯æ¬¡è°ƒç”¨countDownæ—¶state-1ï¼Œå‡åˆ°0çš„æ—¶å€™åœæ­¢é˜»å¡ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><h3 id="æˆ‘å¯ä»¥ç”¨CountDownLatchæ¥åšä»€ä¹ˆäº‹æƒ…ï¼Ÿ"><a href="#æˆ‘å¯ä»¥ç”¨CountDownLatchæ¥åšä»€ä¹ˆäº‹æƒ…ï¼Ÿ" class="headerlink" title="æˆ‘å¯ä»¥ç”¨CountDownLatchæ¥åšä»€ä¹ˆäº‹æƒ…ï¼Ÿ"></a>æˆ‘å¯ä»¥ç”¨<code>CountDownLatch</code>æ¥åšä»€ä¹ˆäº‹æƒ…ï¼Ÿ</h3><h4 id="ä½¿ç”¨CountDownLatchæ¨¡æ‹Ÿå¹¶å‘åœºæ™¯"><a href="#ä½¿ç”¨CountDownLatchæ¨¡æ‹Ÿå¹¶å‘åœºæ™¯" class="headerlink" title="ä½¿ç”¨CountDownLatchæ¨¡æ‹Ÿå¹¶å‘åœºæ™¯"></a>ä½¿ç”¨<code>CountDownLatch</code>æ¨¡æ‹Ÿå¹¶å‘åœºæ™¯</h4><ul><li>å¯ä»¥ä½¿ç”¨<code>CountDownLatch</code>ï¼Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹å¹¶ç­‰å¾…çº¿ç¨‹å…¨éƒ¨å°±ç»ªä¹‹åå”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚å¯ä»¥ç”¨è¿™ç§æ–¹å¼æµ‹è¯•ä»£ç çš„å¯ç”¨æ€§ï¼Œæˆ–è€…æµ‹è¯•å•ä¾‹ç±»ç­‰ï¼›</li></ul><p>æˆ‘åœ¨è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­ä¹Ÿæœ‰å†™è¿‡ç±»ä¼¼çš„æµ‹è¯•ç±» - <a href="https://github.com/Fatezhang/Concurrent/tree/master/src/main/java/com/mime/concurrent/CountDownLatchStudy" target="_blank" rel="noopener">github</a></p><h4 id="ä½¿ç”¨CountDownLatchç­‰å¾…ä¾èµ–çº¿ç¨‹æ‰§è¡Œ"><a href="#ä½¿ç”¨CountDownLatchç­‰å¾…ä¾èµ–çº¿ç¨‹æ‰§è¡Œ" class="headerlink" title="ä½¿ç”¨CountDownLatchç­‰å¾…ä¾èµ–çº¿ç¨‹æ‰§è¡Œ"></a>ä½¿ç”¨<code>CountDownLatch</code>ç­‰å¾…ä¾èµ–çº¿ç¨‹æ‰§è¡Œ</h4><ul><li><code>CountDownLatch</code>ç”¨æ¥ç­‰å¾…å…¶ä»–ä¾èµ–æœåŠ¡éƒ½å¯åŠ¨å¥½ä¹‹ååœ¨è¿›è¡Œè‡ªèº«çº¿ç¨‹çš„ä»»åŠ¡å¤„ç†</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>  <code>CountDownLatch</code>æ˜¯é¢è¯•çš„æ—¶å€™å¤šçº¿ç¨‹è¿™å—å¾ˆå®¹æ˜“è¢«é—®åˆ°çš„ç‚¹ï¼Œå®é™…ä¸Šä¼šè€ƒå¯Ÿè¿™å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>1ã€å†…éƒ¨å®ç°åŸç† <strong>â€”â€”</strong> ä½¿ç”¨å†…éƒ¨ç±»ç»§æ‰¿AQSå®ç°ï¼›</li><li>2ã€éœ€è¦æ³¨æ„çš„æ–¹é¢ <strong>â€”â€”</strong> è®¡æ•°å™¨ä¸º0æ—¶ï¼Œawaitåé¢çš„æ–¹æ³•æ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™ä¸€ç›´é˜»å¡ï¼ŒcountDownæ–¹æ³•å°½é‡å†™åœ¨finallyä»£ç å—ä¸­ï¼Œé¿å…å‡ºç°å¼‚å¸¸å¯¼è‡´æ­»é”ï¼›</li><li>3ã€ä½¿ç”¨åœºæ™¯ <strong>â€”â€”</strong> ç›‘æ§ä¸€äº›ä¾èµ–æœåŠ¡å¯åŠ¨å®Œæˆä¹‹åæ‰§è¡Œä»£ç ï¼Œæˆ–è€…é€ â€œæ°´åâ€ï¼Œå³æ¨¡æ‹Ÿå¤§é‡å¹¶å‘åœºæ™¯ç­‰ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190602/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -ä¸‰-ï¼šCountDownLatchçš„å®ç°åŸç†åŠä½¿ç”¨/cdl.png&quot; alt=&quot;ä»€ä¹ˆæ˜¯CountDownLatchï¼Ÿ&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="AQS" scheme="http://zhangjiaheng.cn/tags/AQS/"/>
    
      <category term="CountDownLatch" scheme="http://zhangjiaheng.cn/tags/CountDownLatch/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–å†™è‡ªå·±çš„SpringMVCæ¡†æ¶</title>
    <link href="http://zhangjiaheng.cn/blog/20190531/%E7%BC%96%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84SpringMVC%E6%A1%86%E6%9E%B6/"/>
    <id>http://zhangjiaheng.cn/blog/20190531/ç¼–å†™è‡ªå·±çš„SpringMVCæ¡†æ¶/</id>
    <published>2019-05-31T07:25:00.000Z</published>
    <updated>2019-11-01T01:40:48.261Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190531/ç¼–å†™è‡ªå·±çš„SpringMVCæ¡†æ¶/aaa.jpeg" alt="å°é¢"><br><a id="more"></a></p><h2 id="Summeré¡¹ç›®"><a href="#Summeré¡¹ç›®" class="headerlink" title="Summeré¡¹ç›®"></a>Summeré¡¹ç›®</h2><p><strong><a href="https://github.com/Fatezhang/Summer" target="_blank" rel="noopener">é¡¹ç›®githubåœ°å€</a></strong></p><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul><li>Summeré¡¹ç›®æ˜¯æœ¬äººåœ¨å­¦ä¹ Springæºç çš„æ—¶å€™æŒ‰ç…§SpringMVCçš„æµç¨‹ç¼–å†™çš„ä¸€ä¸ªç®€æ˜“çš„SpringMVCæ¡†æ¶ï¼Œä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š<ul><li>è¯»å–é…ç½®æ–‡ä»¶è¿›è¡ŒåŒ…çš„æ‰«æ</li><li>å¯¹æ‰€æœ‰åŠ å…¥æ³¨è§£çš„beanè¿›è¡Œè£…é…</li><li>å¯¹åŠ äº†æ³¨è§£çš„å­—æ®µè¿›è¡Œä¾èµ–è‡ªåŠ¨æ³¨å…¥</li><li>URLä¸ç›¸åº”æ–¹æ³•çš„æ˜ å°„</li><li>è¯·æ±‚çš„åˆ†å‘å¤„ç†</li></ul></li></ul><p>é¡¹ç›®é€šè¿‡å®ç°ä»¥ä¸Šæµç¨‹å®ŒæˆSpringMVCæ¡†æ¶å·¥ä½œçš„æ•´ä½“è¿‡ç¨‹æ¼”ç¤º</p><h3 id="ä»¥ä¸‹æ˜¯æ¡†æ¶æµç¨‹çš„è¯¦ç»†æ­¥éª¤è¯´æ˜"><a href="#ä»¥ä¸‹æ˜¯æ¡†æ¶æµç¨‹çš„è¯¦ç»†æ­¥éª¤è¯´æ˜" class="headerlink" title="ä»¥ä¸‹æ˜¯æ¡†æ¶æµç¨‹çš„è¯¦ç»†æ­¥éª¤è¯´æ˜"></a>ä»¥ä¸‹æ˜¯æ¡†æ¶æµç¨‹çš„è¯¦ç»†æ­¥éª¤è¯´æ˜</h3><h4 id="é¡¹ç›®çš„ç»“æ„"><a href="#é¡¹ç›®çš„ç»“æ„" class="headerlink" title="é¡¹ç›®çš„ç»“æ„"></a>é¡¹ç›®çš„ç»“æ„</h4><p>Summeré¡¹ç›®ä»…ä»…æ˜¯ä¸€ä¸ªå•ç‹¬çš„Servleté¡¹ç›®ï¼Œæ²¡æœ‰å¼•å…¥Springç›¸å…³çš„ä»»ä½•ä¾èµ–ï¼Œä»…ä»…ä½¿ç”¨äº†ä¸€äº›å¤–éƒ¨çš„å·¥å…·ç±»ï¼Œæˆ‘çš„pom.xmlæ–‡ä»¶å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetty-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.3.12.v20160915<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>é¡¹ç›®ä½¿ç”¨jettyå¯åŠ¨ï¼Œæ‰€ä»¥æˆ‘è¿˜é…ç½®äº†jettyæ’ä»¶<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- jettyæ’ä»¶ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mortbay.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jetty-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scanIntervalSeconds</span>&gt;</span>0<span class="tag">&lt;/<span class="name">scanIntervalSeconds</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">contextPath</span>&gt;</span>/Summer<span class="tag">&lt;/<span class="name">contextPath</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">connectors</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">connector</span> <span class="attr">implementation</span>=<span class="string">"org.mortbay.jetty.nio.SelectChannelConnector"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">port</span>&gt;</span>4000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">connector</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">connectors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="æ•´ä½“æ¡†æ¶ç»“æ„"><a href="#æ•´ä½“æ¡†æ¶ç»“æ„" class="headerlink" title="æ•´ä½“æ¡†æ¶ç»“æ„"></a>æ•´ä½“æ¡†æ¶ç»“æ„</h4><p><img src="/blog/20190531/ç¼–å†™è‡ªå·±çš„SpringMVCæ¡†æ¶/zj.png" alt="æ³¨è§£"><br>é™¤äº†è‡ªå®šä¹‰çš„è¿™å‡ ä¸ªæ³¨è§£ä¹‹å¤–å…¶ä»–çš„å°±å’Œå¹³å¸¸ç¼–å†™Controllerä»¥åŠServiceçš„æµç¨‹ä¸€æ ·ï¼Œæˆ‘çš„æ ¸å¿ƒä»£ç ä¸»è¦åœ¨MyServletä¸­</p><h4 id="MyServletä¸»è¦åšäº†ä»€ä¹ˆ"><a href="#MyServletä¸»è¦åšäº†ä»€ä¹ˆ" class="headerlink" title="MyServletä¸»è¦åšäº†ä»€ä¹ˆ"></a>MyServletä¸»è¦åšäº†ä»€ä¹ˆ</h4><h5 id="åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè¯»å–web-xmlä¸­é…ç½®çš„é…ç½®æ–‡ä»¶"><a href="#åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè¯»å–web-xmlä¸­é…ç½®çš„é…ç½®æ–‡ä»¶" class="headerlink" title="åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè¯»å–web.xmlä¸­é…ç½®çš„é…ç½®æ–‡ä»¶"></a>åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè¯»å–web.xmlä¸­é…ç½®çš„é…ç½®æ–‡ä»¶</h5><p>æŠŠæ‰«æåˆ°çš„æ‰€æœ‰ç±»å…¨é“¾è·¯å¾„åä¿å­˜åœ¨listä¸­</p><blockquote><p>ä»¥ä¸‹æ˜¯servletçš„é…ç½®</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å£°æ˜Servletå¯¹è±¡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸Šé¢ä¸€å¥æŒ‡å®šServletå¯¹è±¡çš„åç§° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zhang.summer.servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸Šé¢ä¸€å¥æŒ‡å®šServletå¯¹è±¡çš„å®Œæ•´ä½ç½®ï¼ŒåŒ…å«åŒ…åå’Œç±»å --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:config.properties<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸‹é¢ä¸€å¥æ˜¯åœ¨å¯åŠ¨æ—¶åŠ è½½servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ˜ å°„Servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;servlet-name&gt;ä¸ä¸Šé¢&lt;Servlet&gt;æ ‡ç­¾çš„&lt;servlet-name&gt;å…ƒç´ ç›¸å¯¹åº”ï¼Œä¸å¯ä»¥éšä¾¿èµ·å  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸Šé¢ä¸€å¥è¯ç”¨äºæ˜ å°„è®¿é—®URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="éå†æ‰€æœ‰ç±»ï¼Œä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡class-forName"><a href="#éå†æ‰€æœ‰ç±»ï¼Œä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡class-forName" class="headerlink" title="éå†æ‰€æœ‰ç±»ï¼Œä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡class.forName"></a>éå†æ‰€æœ‰ç±»ï¼Œä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡<code>class.forName</code></h5><p>åˆ›å»ºå¯¹è±¡ï¼Œå°†æ‰€æœ‰æˆ‘ä»¬å£°æ˜äº†è‡ªå·±æ³¨è§£çš„ç±»åŠ å…¥åˆ°ä¸€ä¸ªMapä¸­ï¼Œå³IOC-Map</p><h5 id="éå†IOC-Mapä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æ³¨å…¥"><a href="#éå†IOC-Mapä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æ³¨å…¥" class="headerlink" title="éå†IOC-Mapä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æ³¨å…¥"></a>éå†IOC-Mapä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿›è¡Œä¾èµ–æ³¨å…¥</h5><p>åœ¨è¿™é‡Œæˆ‘åªåˆ¤æ–­æ˜¯<code>@MyController</code>æ³¨è§£çš„ç±»æ‰è¿›è¡Œä¾èµ–æ³¨å…¥</p><h5 id="å¤„ç†URLå’Œæ–¹æ³•ä¹‹é—´çš„æ˜ å°„"><a href="#å¤„ç†URLå’Œæ–¹æ³•ä¹‹é—´çš„æ˜ å°„" class="headerlink" title="å¤„ç†URLå’Œæ–¹æ³•ä¹‹é—´çš„æ˜ å°„"></a>å¤„ç†URLå’Œæ–¹æ³•ä¹‹é—´çš„æ˜ å°„</h5><p>å°†æ³¨è§£äº†<code>@MyRequestMapping</code>çš„ç±»å’Œæ–¹æ³•è·¯å¾„æ‹¼æ¥èµ·æ¥ï¼Œå¯¹æ–¹æ³•å’Œæ‹¼æ¥èµ·æ¥çš„urlè·¯å¾„è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”å¯¹æ–¹æ³•å‚æ•°åšç‰¹æ®Šå¤„ç†</p><h5 id="è¯·æ±‚åˆ†å‘"><a href="#è¯·æ±‚åˆ†å‘" class="headerlink" title="è¯·æ±‚åˆ†å‘"></a>è¯·æ±‚åˆ†å‘</h5><p>åœ¨doGetæˆ–è€…doPostè¯·æ±‚ä¸­é€šè¿‡æ˜ å°„å¥½çš„url-methodæ‰¾åˆ°æ–¹æ³•è¿›è¡Œè¯·æ±‚çš„åˆ†å‘å¤„ç†</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190531/ç¼–å†™è‡ªå·±çš„SpringMVCæ¡†æ¶/aaa.jpeg&quot; alt=&quot;å°é¢&quot;&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="SpringMVCæ¡†æ¶" scheme="http://zhangjiaheng.cn/categories/SpringMVC%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Spring" scheme="http://zhangjiaheng.cn/tags/Spring/"/>
    
      <category term="SpringMVC" scheme="http://zhangjiaheng.cn/tags/SpringMVC/"/>
    
      <category term="Servlet" scheme="http://zhangjiaheng.cn/tags/Servlet/"/>
    
  </entry>
  
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹å­¦ä¹ (äºŒ)ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”</title>
    <link href="http://zhangjiaheng.cn/blog/20190525/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-%E4%BA%8C-%EF%BC%9A%E4%BD%BF%E7%94%A8AQS%E7%BC%96%E5%86%99%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81/"/>
    <id>http://zhangjiaheng.cn/blog/20190525/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äºŒ-ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”/</id>
    <published>2019-05-25T06:07:35.000Z</published>
    <updated>2019-11-01T01:40:48.240Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/blog/20190525/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äºŒ-ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”/aqs.png" alt="AQSä¸­æ–‡æ–‡æ¡£ä»‹ç»"></p><div style="width:100%;text-align: center;"><a href="http://www.matools.com/api/java8" target="_blank" rel="noopener">AQSä¸­æ–‡æ–‡æ¡£ä»‹ç»</a></div><a id="more"></a><hr><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><strong> <a href="/blog/20190517/ç¼–å†™ä¸€ä¸ªç®€æ˜“çš„å¯é‡å…¥é”-ä¸€/">ä¸Šä¸€ç« </a> </strong> æˆ‘ä½¿ç”¨å®ç°<code>Lock</code>æ¥å£çš„æ–¹å¼å¹¶ç»“åˆ<code>Synchronized</code>å…³é”®å­—å®ç°äº†è‡ªå·±çš„å¯é‡å…¥é”ï¼Œå­¦ä¹ å¹¶äº†è§£äº†å¯é‡å…¥é”çš„åŸç†æœºåˆ¶ã€‚è¿™ä¸€ç« æˆ‘åœ¨å­¦ä¹ äº†AQSä¹‹åç»“åˆAQSå®ç°è‡ªå·±çš„æ˜¾ç¤ºå¯é‡å…¥é”ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯AQS"><a href="#ä»€ä¹ˆæ˜¯AQS" class="headerlink" title="ä»€ä¹ˆæ˜¯AQS"></a>ä»€ä¹ˆæ˜¯AQS</h3><p>å¦‚ä¸Šæ‰€è¿°ï¼ŒJava8ä¸­æ–‡æ–‡æ¡£ä¸­æè¿°çš„ï¼ŒAQSå³<code>AbstractQueuedSynchronizer</code>ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºå®ç°ä¾èµ–å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ç­‰å¾…é˜Ÿåˆ—çš„é˜»å¡é”å’Œç›¸å…³åŒæ­¥å™¨ï¼ˆä¿¡å·é‡ï¼Œäº‹ä»¶ç­‰ï¼‰ã€‚è¯¥ç±»è¢«è®¾è®¡ä¸ºå¤§å¤šæ•°ç±»å‹çš„åŒæ­¥å™¨çš„æœ‰ç”¨ä¾æ®ï¼Œè¿™äº›åŒæ­¥å™¨ä¾èµ–äºå•ä¸ªåŸå­intå€¼æ¥è¡¨ç¤ºçŠ¶æ€ã€‚ å­ç±»å¿…é¡»å®šä¹‰æ”¹å˜æ­¤çŠ¶æ€çš„å—ä¿æŠ¤æ–¹æ³•ï¼Œä»¥åŠæ ¹æ®è¯¥å¯¹è±¡è¢«è·å–æˆ–é‡Šæ”¾æ¥å®šä¹‰è¯¥çŠ¶æ€çš„å«ä¹‰ã€‚ ç»™å®šè¿™äº›ï¼Œè¿™ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•æ‰§è¡Œæ‰€æœ‰æ’é˜Ÿå’Œé˜»å¡æœºåˆ¶ã€‚ å­ç±»å¯ä»¥ä¿æŒå…¶ä»–çŠ¶æ€å­—æ®µï¼Œä½†åªä»¥åŸå­æ–¹å¼æ›´æ–°intä½¿ç”¨æ–¹æ³•æ“çºµå€¼getState() ï¼Œ setState(int)å’ŒcompareAndSetState(int, int)è¢«è·Ÿè¸ªç›¸å¯¹äºåŒæ­¥ã€‚<strong>å­ç±»åº”å®šä¹‰ä¸ºéå…¬å…±å†…éƒ¨åŠ©æ‰‹ç±»ï¼Œç”¨äºå®ç°å…¶å°é—­ç±»çš„åŒæ­¥å±æ€§ã€‚ AbstractQueuedSynchronizerç±»ä¸å®ç°ä»»ä½•åŒæ­¥æ¥å£ã€‚ ç›¸åï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ–¹æ³•ï¼Œå¦‚acquireInterruptibly(int) ï¼Œå¯ä»¥é€šè¿‡å…·ä½“çš„é”å’Œç›¸å…³åŒæ­¥å™¨æ¥è°ƒç”¨é€‚å½“å±¥è¡Œå…¶å…¬å…±æ–¹æ³•ã€‚</strong></p><p>å…¶å®AQSç±»æ˜¯ä¸€ä¸ªä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æŠ½è±¡æ¡†æ¶ç±»ã€‚å®ƒå°†æ ¸å¿ƒå®ç°å°è£…åœ¨æ¨¡æ¿æ–¹æ³•ä¸­ï¼Œæä¾›ç»™ç¨‹åºå‘˜å»å®ç°å…·ä½“çš„åŠ é”å’Œé‡Šæ”¾çš„æœºåˆ¶ï¼Œä»¥ä¾¿äºå®ç°ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½çš„é”ï¼Œæ¯”å¦‚JDKæä¾›çš„å¯é‡å…¥é”å’Œå¯é‡å…¥è¯»å†™é”ç­‰ç­‰ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨AQS"><a href="#å¦‚ä½•ä½¿ç”¨AQS" class="headerlink" title="å¦‚ä½•ä½¿ç”¨AQS"></a>å¦‚ä½•ä½¿ç”¨AQS</h3><p><strong>AQSåœ¨ä½¿ç”¨çš„æ—¶å€™ä¸»è¦éœ€è¦é‡å†™ä»¥ä¸‹æ–¹æ³•</strong></p><ul><li><code>isHeldExclusively()</code>ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚</li><li><code>tryAcquire(int)</code>ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li><li><code>tryRelease(int)</code>ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚</li><li><code>tryAcquireShared(int)</code>ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</li><li><code>tryReleaseShared(int)</code>ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li></ul><h3 id="ä½¿ç”¨AQSå®ç°è‡ªå·±çš„å¯é‡å…¥ç‹¬å éå…¬å¹³é”çš„ä¼ªä»£ç å¦‚ä¸‹"><a href="#ä½¿ç”¨AQSå®ç°è‡ªå·±çš„å¯é‡å…¥ç‹¬å éå…¬å¹³é”çš„ä¼ªä»£ç å¦‚ä¸‹" class="headerlink" title="ä½¿ç”¨AQSå®ç°è‡ªå·±çš„å¯é‡å…¥ç‹¬å éå…¬å¹³é”çš„ä¼ªä»£ç å¦‚ä¸‹"></a>ä½¿ç”¨AQSå®ç°è‡ªå·±çš„å¯é‡å…¥ç‹¬å éå…¬å¹³é”çš„ä¼ªä»£ç å¦‚ä¸‹</h3><h4 id="åŠ é”æ­¥éª¤ä¼ªä»£ç "><a href="#åŠ é”æ­¥éª¤ä¼ªä»£ç " class="headerlink" title="åŠ é”æ­¥éª¤ä¼ªä»£ç "></a>åŠ é”æ­¥éª¤ä¼ªä»£ç </h4><p>çº¿ç¨‹è°ƒç”¨<code>lock</code>æ–¹æ³•åŠ é”ï¼Œç›´æ¥è°ƒç”¨<code>sync.acquire(1);</code>ï¼Œå…·ä½“å®ç°åœ¨<code>tryAcquire</code></p><ul><li>é¦–å…ˆçº¿ç¨‹è¿›å…¥æƒ³è¦è·å–é”</li><li>æ‹¿åˆ°å½“å‰çº¿ç¨‹çš„å¼•ç”¨</li><li>åˆ¤æ–­åŠ é”çŠ¶æ€ï¼Œå¦‚æœæ˜¯æœªåŠ é”çŠ¶æ€<ul><li>ä½¿ç”¨<code>compareAndSetState</code>è‡ªæ—‹åŸå­æ“ä½œåŠ é”</li><li>è®¾ç½®å½“å‰çº¿ç¨‹</li><li>è¿”å›trueåŠ é”æˆåŠŸ</li></ul></li><li>å¦‚æœæ˜¯åŠ é”çŠ¶æ€<ul><li>åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹é‡å…¥</li><li>å¦‚æœæ˜¯å½“å‰çº¿ç¨‹é‡å…¥ï¼ŒstateåŠ 1ï¼Œå¹¶è¿”å›trueåŠ é”æˆåŠŸ</li></ul></li><li>æœ€åå¦‚æœéƒ½ä¸æ˜¯å°±è¿”å›falseåŠ é”å¤±è´¥</li></ul><h4 id="é‡Šæ”¾é”æ­¥éª¤ä¼ªä»£ç "><a href="#é‡Šæ”¾é”æ­¥éª¤ä¼ªä»£ç " class="headerlink" title="é‡Šæ”¾é”æ­¥éª¤ä¼ªä»£ç "></a>é‡Šæ”¾é”æ­¥éª¤ä¼ªä»£ç </h4><p>çº¿ç¨‹è°ƒç”¨<code>unLock</code>æ–¹æ³•åŠ é”ï¼Œç›´æ¥è°ƒç”¨<code>sync.release(1);</code>ï¼Œå…·ä½“å®ç°åœ¨<code>tryRelease</code></p><ul><li>é¦–å…ˆçº¿ç¨‹è¿›å…¥æ–¹æ³•æƒ³è¦é‡Šæ”¾é”</li><li>åˆ¤æ–­å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</li><li>å¦‚æœæ˜¯å½“å‰çº¿ç¨‹ï¼Œstateå°±å‡1ï¼ˆargä¸€èˆ¬ä¸º1ï¼‰ï¼Œè¡¨ç¤ºé‡Šæ”¾ä¸€æ¬¡</li><li>å½“stateé‡Šæ”¾åˆ°0æ—¶ï¼Œè®¾ç½®æ‹¥æœ‰é”çš„çº¿ç¨‹ä¸ºnullï¼Œç„¶åè¿”å›true</li></ul><p><strong>å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> zhangjiaheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> ä½¿ç”¨AQSé‡å†™ä¸€ä¸ªå¯é‡å…¥é”</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReentrantLockByAQS</span> <span class="keyword">implements</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Sync sync = <span class="keyword">new</span> Sync();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…éƒ¨ç±»Sync ReentrantLockä½¿ç”¨çš„å†…éƒ¨æŠ½è±¡ç±» å¹¶æ´¾ç”Ÿä¸¤ä¸ªå­ç±»å®ç°ä¸¤ç§(å…¬å¹³/éå…¬å¹³)é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">            Thread t = Thread.currentThread();</span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ å¯ä»¥æ‹¿åˆ°é” åˆ™è¿”å›true</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬äºŒä¸ªçº¿ç¨‹è¿›æ¥ å¦‚æœä¸ç­‰äºå½“å‰çº¿ç¨‹ è¿”å›false å¦åˆ™æ›´æ–°å½“å‰çº¿ç¨‹å€¼</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> state = getState();</span><br><span class="line">            <span class="keyword">if</span> (state == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">                    setExclusiveOwnerThread(t);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == getExclusiveOwnerThread()) &#123;</span><br><span class="line">                <span class="comment">// å½“å‰çº¿ç¨‹å†è¿›æ¥</span></span><br><span class="line">                setState(getState() + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// é”çš„è·å–å’Œé‡Šæ”¾æ—¶ä¸€ä¸€å¯¹åº”çš„</span></span><br><span class="line">            <span class="comment">// è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è‚¯å®šæ˜¯å½“å‰çº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> c = getState() - arg;</span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            setState(c);</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> newCondition();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(time));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/blog/20190525/å¹¶å‘ç¼–ç¨‹å­¦ä¹ -äºŒ-ï¼šä½¿ç”¨AQSç¼–å†™å¯é‡å…¥é”/aqs.png&quot; alt=&quot;AQSä¸­æ–‡æ–‡æ¡£ä»‹ç»&quot;&gt;&lt;/p&gt;
&lt;div style=&quot;width:100%;text-align: center;&quot;&gt;&lt;a href=&quot;http://www.matools.com/api/java8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AQSä¸­æ–‡æ–‡æ¡£ä»‹ç»&lt;/a&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="JavaåŸºç¡€" scheme="http://zhangjiaheng.cn/tags/Java%E5%9F%BA%E7%A1%80/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://zhangjiaheng.cn/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="AQS" scheme="http://zhangjiaheng.cn/tags/AQS/"/>
    
      <category term="å¯é‡å…¥é”" scheme="http://zhangjiaheng.cn/tags/%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81/"/>
    
  </entry>
  
</feed>
